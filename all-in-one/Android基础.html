<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Android基础</title>
  <style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}

html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
  <style type="text/css">html {scroll-behavior: smooth;}body {font-size: 1rem;line-height: 1.6;tab-size: 4;color: rgb(51, 51, 51);font-family: Microsoft YaHei,"Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;-webkit-font-smoothing: antialiased;position: relative;top: 0;left: 300px;width: calc(90% - 300px);padding: 2em 5%;}h1,h2,h3,h4,h5,h6 {position: relative;margin-top: 1rem;margin-bottom: 1rem;padding-bottom: 0;font-weight: bold;line-height: 1.4;cursor: text;}h1 {font-size: 2.25em;line-height: 1.2;border-bottom: 1px solid #eee;}h2 {font-size: 1.75em;line-height: 1.225;border-bottom: 1px solid #eee;}h3 {font-size: 1.5em;line-height: 1.43;}h4 {font-size: 1.25em;}h5 {font-size: 1em;}h6 {font-size: 1em;color: #777;}p,blockquote{ margin: 0.8em 0 !important; }ul,ol,dl,table{margin: 0.8em 0;}li>ol,li>ul {margin: 0 0;}a {color: #4183C4;text-decoration: none;}hr {height: 2px;padding: 0;margin: 16px 0;background-color: #e7e7e7;border: 0 none;overflow: hidden;box-sizing: content-box;}li p.first {display: inline-block;}ul,ol {padding-left: 20px;}ul:first-child,ol:first-child {margin-top: 0;}ul:last-child,ol:last-child {margin-bottom: 0;}blockquote {border-left: 4px solid #dfe2e5 !important;padding: 0 15px;color: #777777 !important;background-color: #ffffff !important;}blockquote blockquote {padding-right: 0;}table {padding: 0;word-break: initial;border-collapse: collapse;}table tr {border: 1px solid #dfe2e5;margin: 0;padding: 0;}table tr:nth-child(2n),thead {background-color: #f8f8f8;}table th {font-weight: normal;text-align: unset;border-bottom: 0;border: 1px solid #dfe2e5;margin: 0;padding: 6px 13px;}table td {border: 1px solid #dfe2e5;margin: 0;padding: 6px 13px;}table th:first-child,table td:first-child {margin-top: 0;}table th:last-child,table td:last-child {margin-bottom: 0;}tt {border: 1px solid #e7eaed;background-color: #f8f8f8;border-radius: 3px;padding: 2px 4px 0px 4px;font-size: 0.9em;}code {border: 1px solid #e7eaed;background-color: #f3f4f4;border-radius: 3px;padding: 0 2px 0 2px;font-size: 0.9em;}img {width: 50%;height: 50%;display: block;vertical-align: middle;image-orientation: from-image;margin: auto;}figcaption {text-align: center;}pre>code{counter-reset: linenumber;display: block;white-space: pre;overflow: auto !important;padding: 0.2em;border-radius: 7px;}pre>code>span {counter-increment: linenumber;display: inline-block;line-height: 1.25em !important;}pre>code>span::before {content: counter(linenumber);display: inline-block;font-size: 0.9em;color: #999;min-width: 1.8em;margin-right: 0.5em;padding-right: 0.25em;text-align: right;border-right: 1px solid #999;line-height: 1.9em;user-select: none;pointer-events: none;}#TOC {font-size: 0.8rem;position: fixed;top: 0;left: 0;width: 300px;height: 100%;padding: 32px 16px 48px 16px !important;box-shadow: 0 0 4px rgba(150,150,150,0.33);box-sizing: border-box;overflow: auto;}#TOC::-webkit-scrollbar{width: 1px;border-right: 1px solid #f5f5f5;}#TOC a{color: #333333;text-decoration: none;}#TOC a:hover{color: #333333 !important;text-decoration: underline !important;}#TOC ul { list-style: none; }#TOC li { margin-bottom: 0.25rem; }@media (max-width: 700px) {#TOC { display: none; }body { left: 0px; width: 90%; }}</style>
  <script type="text/javascript">
  window.onload = function(){
    document.querySelectorAll('a[href^="#"]').forEach(function(item,index,arr){
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const target =  document.getElementById(decodeURI((item.href.substring(item.href.indexOf('#')+1))));
            if(target == null) { return; }
            target.scrollIntoView({ behavior: 'smooth' });
        });
    })
    const toc_a = document.querySelectorAll('#TOC a');
    function updateTOC(){
      const scrollPosition = window.scrollY;
      let highlightTarget;
      for(let i=toc_a.length-1; i>=0; i--){
        const target = document.getElementById(decodeURI((toc_a[i].href.substring(toc_a[i].href.indexOf('#')+1))));
        if(target == null) { continue; }
        const ItemPosition = target.offsetTop;
        if (scrollPosition > ItemPosition && typeof(highlightTarget) == "undefined") {
          highlightTarget = toc_a[i];
        } else if(typeof(highlightTarget) == "undefined" && i == 0) {
          highlightTarget = toc_a[0];
        }
      }
      toc_a.forEach( item => {
        item.style.fontWeight = "";
      });
      if(typeof(highlightTarget) == "undefined") { return; }
      highlightTarget.style.fontWeight = "bold";
    }
    let timer = null;
    window.addEventListener('scroll', () => {
      window.clearTimeout(timer);
      timer = window.setTimeout(() => { updateTOC() }, 200);
    });
  };
  </script>
  <base target="_blank">
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#activity的四种加载模式launchmode" id="toc-activity的四种加载模式launchmode">Activity的四种加载模式(launchMode)</a></li>
<li><a href="#activity的生命周期" id="toc-activity的生命周期">Activity的生命周期</a></li>
<li><a href="#用户界面" id="toc-用户界面">用户界面</a>
<ul>
<li><a href="#radiogroup" id="toc-radiogroup">RadioGroup</a></li>
<li><a href="#selector" id="toc-selector">selector</a></li>
<li><a href="#layer-list" id="toc-layer-list">layer-list</a></li>
<li><a href="#optionsmenu" id="toc-optionsmenu">OptionsMenu</a></li>
<li><a href="#contextmenu" id="toc-contextmenu">ContextMenu</a></li>
<li><a href="#alertdialog" id="toc-alertdialog">AlertDialog</a></li>
<li><a href="#日期时间dialog" id="toc-日期时间dialog">日期时间Dialog</a></li>
<li><a href="#listview" id="toc-listview">ListView</a></li>
<li><a href="#viewpager" id="toc-viewpager">ViewPager</a>
<ul>
<li><a href="#使用" id="toc-使用">使用</a></li>
<li><a href="#原理" id="toc-原理">原理</a></li>
<li><a href="#tablayoutviewpager" id="toc-tablayoutviewpager">TabLayout+ViewPager</a></li>
</ul></li>
<li><a href="#recyclerview" id="toc-recyclerview">RecyclerView</a></li>
<li><a href="#floatbutton" id="toc-floatbutton">FloatButton</a></li>
<li><a href="#appwidget" id="toc-appwidget">AppWidget</a></li>
<li><a href="#shortcuts" id="toc-shortcuts">Shortcuts</a>
<ul>
<li><a href="#静态配置" id="toc-静态配置">静态配置</a></li>
<li><a href="#动态配置" id="toc-动态配置">动态配置</a></li>
<li><a href="#pinned-shortcuts" id="toc-pinned-shortcuts">Pinned
Shortcuts</a></li>
</ul></li>
</ul></li>
<li><a href="#布局方式" id="toc-布局方式">布局方式</a>
<ul>
<li><a href="#linearlayout" id="toc-linearlayout">LinearLayout</a></li>
<li><a href="#relativelayout" id="toc-relativelayout">RelativeLayout</a></li>
<li><a href="#framelayout" id="toc-framelayout">FrameLayout</a></li>
<li><a href="#absolutelayout" id="toc-absolutelayout">AbsoluteLayout</a></li>
<li><a href="#constraintlayout" id="toc-constraintlayout">ConstraintLayout</a></li>
<li><a href="#tablelayout" id="toc-tablelayout">TableLayout</a></li>
<li><a href="#gridlayout" id="toc-gridlayout">GridLayout</a></li>
<li><a href="#drawerlayout" id="toc-drawerlayout">DrawerLayout</a></li>
<li><a href="#slidingpanelayout" id="toc-slidingpanelayout">SlidingPaneLayout</a></li>
</ul></li>
<li><a href="#sharepreference" id="toc-sharepreference">SharePreference</a></li>
<li><a href="#内外部存储" id="toc-内外部存储">内外部存储</a></li>
<li><a href="#数据库" id="toc-数据库">数据库</a></li>
<li><a href="#网络" id="toc-网络">网络</a>
<ul>
<li><a href="#httpclient" id="toc-httpclient"><del>HttpClient</del></a></li>
<li><a href="#httpurlconnection" id="toc-httpurlconnection">HttpUrlConnection</a></li>
<li><a href="#https" id="toc-https">HTTPS</a>
<ul>
<li><a href="#pkicara" id="toc-pkicara">PKI、CA、RA</a></li>
<li><a href="#openssl" id="toc-openssl">openssl</a></li>
<li><a href="#https-api" id="toc-https-api">HTTPS API</a>
<ul>
<li><a href="#默认信任策略" id="toc-默认信任策略">默认信任策略</a></li>
<li><a href="#自定义信任策略" id="toc-自定义信任策略">自定义信任策略</a></li>
</ul></li>
</ul></li>
<li><a href="#volley" id="toc-volley">Volley</a>
<ul>
<li><a href="#stringrequest" id="toc-stringrequest">StringRequest</a></li>
<li><a href="#jsonobjectrequest" id="toc-jsonobjectrequest">JsonObjectRequest</a></li>
<li><a href="#imagerequest" id="toc-imagerequest">ImageRequest</a></li>
<li><a href="#imageloader" id="toc-imageloader">ImageLoader</a></li>
<li><a href="#networkimageview" id="toc-networkimageview">NetworkImageView</a></li>
</ul></li>
<li><a href="#案例-多线程下载" id="toc-案例-多线程下载">案例:
多线程下载</a></li>
</ul></li>
<li><a href="#消息异步" id="toc-消息异步">消息异步</a>
<ul>
<li><a href="#handler" id="toc-handler">Handler</a>
<ul>
<li><a href="#基本使用" id="toc-基本使用">基本使用</a></li>
<li><a href="#底层原理" id="toc-底层原理">底层原理</a></li>
<li><a href="#内存泄露问题" id="toc-内存泄露问题">内存泄露问题</a></li>
</ul></li>
<li><a href="#asynctask" id="toc-asynctask">AsyncTask</a></li>
</ul></li>
<li><a href="#json解析" id="toc-json解析">JSON解析</a>
<ul>
<li><a href="#jsonobject和jsonarray" id="toc-jsonobject和jsonarray">JSONObject和JSONArray</a></li>
<li><a href="#gson" id="toc-gson">Gson</a></li>
</ul></li>
<li><a href="#自定义view" id="toc-自定义view">自定义View</a>
<ul>
<li><a href="#生命周期" id="toc-生命周期">生命周期</a></li>
<li><a href="#事件处理" id="toc-事件处理">事件处理</a></li>
<li><a href="#事件拦截与消费" id="toc-事件拦截与消费">事件拦截与消费</a></li>
<li><a href="#案例-侧滑返回" id="toc-案例-侧滑返回">案例:
侧滑返回</a></li>
<li><a href="#shape" id="toc-shape">Shape</a></li>
<li><a href="#rectshape" id="toc-rectshape">RectShape</a></li>
<li><a href="#自定义属性" id="toc-自定义属性">自定义属性</a></li>
</ul></li>
<li><a href="#service" id="toc-service">Service</a>
<ul>
<li><a href="#startservice" id="toc-startservice">startService</a></li>
<li><a href="#bindservice" id="toc-bindservice">bindService</a></li>
<li><a href="#context与service交互" id="toc-context与service交互">Context与Service交互</a>
<ul>
<li><a href="#ibinder" id="toc-ibinder">IBinder</a></li>
<li><a href="#messenger" id="toc-messenger">Messenger</a></li>
<li><a href="#aidl" id="toc-aidl">AIDL</a></li>
</ul></li>
<li><a href="#前台服务" id="toc-前台服务">前台服务</a></li>
<li><a href="#android-5.0以上的隐式启动问题" id="toc-android-5.0以上的隐式启动问题">Android
5.0以上的隐式启动问题</a></li>
</ul></li>
<li><a href="#broadcastreceiver" id="toc-broadcastreceiver">BroadcastReceiver</a>
<ul>
<li><a href="#注册" id="toc-注册">注册</a></li>
<li><a href="#发送广播" id="toc-发送广播">发送广播</a>
<ul>
<li><a href="#普通广播" id="toc-普通广播">普通广播</a></li>
<li><a href="#系统广播" id="toc-系统广播">系统广播</a></li>
<li><a href="#有序广播" id="toc-有序广播">有序广播</a></li>
<li><a href="#粘性广播" id="toc-粘性广播"><del>粘性广播</del></a></li>
<li><a href="#app应用内广播" id="toc-app应用内广播">App应用内广播</a></li>
</ul></li>
</ul></li>
<li><a href="#contentprovider" id="toc-contentprovider">ContentProvider</a>
<ul>
<li><a href="#provider" id="toc-provider">Provider</a></li>
<li><a href="#observer" id="toc-observer">Observer</a></li>
<li><a href="#案例-自动填写短信验证码" id="toc-案例-自动填写短信验证码">案例: 自动填写短信验证码</a></li>
</ul></li>
<li><a href="#动画" id="toc-动画">动画</a>
<ul>
<li><a href="#tween动画" id="toc-tween动画">Tween动画</a></li>
<li><a href="#帧动画" id="toc-帧动画">帧动画</a></li>
<li><a href="#属性动画" id="toc-属性动画">属性动画</a></li>
<li><a href="#interpolator" id="toc-interpolator">Interpolator</a></li>
<li><a href="#activity转场动画" id="toc-activity转场动画">Activity转场动画</a></li>
<li><a href="#circularreveral" id="toc-circularreveral">CircularReveral</a></li>
<li><a href="#矢量动画" id="toc-矢量动画">矢量动画</a></li>
</ul></li>
<li><a href="#fragment" id="toc-fragment">Fragment</a>
<ul>
<li><a href="#生命周期-1" id="toc-生命周期-1">生命周期</a></li>
<li><a href="#静态添加" id="toc-静态添加">静态添加</a></li>
<li><a href="#动态添加与删除" id="toc-动态添加与删除">动态添加与删除</a></li>
<li><a href="#懒加载" id="toc-懒加载">懒加载</a></li>
</ul></li>
<li><a href="#其他" id="toc-其他">其他</a>
<ul>
<li><a href="#横竖屏切换" id="toc-横竖屏切换">横竖屏切换</a></li>
<li><a href="#java与javascript互调" id="toc-java与javascript互调">JAVA与javascript互调</a></li>
<li><a href="#浏览器跳转app" id="toc-浏览器跳转app">浏览器跳转app</a></li>
<li><a href="#夜间模式" id="toc-夜间模式">夜间模式</a></li>
<li><a href="#intent" id="toc-intent">Intent</a>
<ul>
<li><a href="#action" id="toc-action">Action</a></li>
<li><a href="#category" id="toc-category">Category</a></li>
<li><a href="#data" id="toc-data">Data</a></li>
<li><a href="#extras" id="toc-extras">Extras</a></li>
<li><a href="#type" id="toc-type">Type</a></li>
<li><a href="#component" id="toc-component">Component</a></li>
<li><a href="#flag" id="toc-flag">FLAG</a></li>
<li><a href="#显式和隐式intent" id="toc-显式和隐式intent">显式和隐式intent</a></li>
</ul></li>
<li><a href="#systemservice" id="toc-systemservice">SystemService</a></li>
<li><a href="#动态权限获取" id="toc-动态权限获取">动态权限获取</a></li>
<li><a href="#通知" id="toc-通知">通知</a></li>
<li><a href="#ndk" id="toc-ndk">NDK</a></li>
<li><a href="#热更新" id="toc-热更新">热更新</a></li>
<li><a href="#material-design" id="toc-material-design">Material
Design</a></li>
<li><a href="#设计模式" id="toc-设计模式">设计模式</a></li>
<li><a href="#学习路线" id="toc-学习路线">学习路线</a></li>
</ul></li>
</ul>
</nav>
<h2 id="activity的四种加载模式launchmode">Activity的四种加载模式(launchMode)</h2>
<p>Acitvity都被放再任务栈(TaskStack)中，不同的加载模式使得任务栈中的结构不同</p>
<p>四种加载模式分别是: - standard: 默认模式 - singleTop:
位于栈顶时唯一，如果栈顶已经是当前要创建的Activity，则不创建，否则创建新的Activity
- singleTask:
如果该Activity的实例不存在，则创建并获得栈顶位置；如果该Activity的实例已存在，会调用<code>onNewIntent</code>方法，不会创建新的Activity实例，且原来已经存在的singTaskActivity上方的Activity均出栈，使得这个singTaskActivity获得栈顶位置
- singleInstance: 如果此Activity没有实例，它会创建一个新的任务栈；
如果任务栈中已经有此实例，会调用<code>onNewIntent</code>方法，不会创建新的任务栈和实例；无论哪个Activity新建该singleInstanceActivity，只要已存在，都共享一个实例；由singleInstanceActivity创建的其他Activity，会尝试放在存在“亲属”关系的任务栈(taskAffinity)中，如果没有匹配的任务栈存在，则会创建新的任务栈存放被创建的Activity</p>
<p>配置加载模式的位置在AndroidManifest.xml中:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">activity</span><span class="ot"> android:launchMode=</span><span class="st">&quot;singleTask&quot;</span>&gt;&lt;/<span class="kw">activity</span>&gt;</span></code></pre></div>
<p>也可以在通过Intent启动Activity时指定FLAG，FLAG可以叠加使用</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> MyActivity<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">FLAG_ACTIVITY_NEW_TASK</span> <span class="op">|</span> Intent<span class="op">.</span><span class="fu">FLAG_ACTIVITY_CLEAR_TOP</span><span class="op">);</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span></span></code></pre></div>
<p>常用的FLAG有：</p>
<ul>
<li>FLAG_ACTIVITY_NEW_TASK，与<code>singleTask</code>相似，但单独使用会出现奇怪的现象，一般与<code>FLAG_ACTIVITY_CLEAR_TOP</code>或<code>FLAG_ACTIVITY_CLEAR_TASK</code>一起使用</li>
<li>FLAG_ACTIVITY_CLEAR_TOP，与<code>FLAG_ACTIVITY_NEW_TASK</code>一起使用时，可以达到和<code>singleTask</code>一样的效果</li>
<li>FLAG_ACTIVITY_SINGLE_TOP，与<code>singleTop</code>相同</li>
<li>FLAG_ACTIVITY_BROUGHT_TO_FRONT，把已经启动过的、在后台的Activity调回前台</li>
<li>FLAG_ACTIVITY_MULTIPLE_TASK，与<code>FLAG_ACTIVITY_NEW_TASK</code>一起使用，每次启动都会创建新的Task</li>
<li>FLAG_ACTIVITY_RESET_TASK_IF_NEEDED，与<code>FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET</code>成对使用</li>
<li>FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET，在当前的Task堆栈中设置一个还原点，当带有<code>FLAG_ACTIVITY_RESET_TASK_IF_NEEDED</code>的Intent请求启动这个堆栈时，还原点之上包括这个应用将会被清除</li>
</ul>
<h2 id="activity的生命周期">Activity的生命周期</h2>
<p><code>onCreate()</code>-&gt;<code>onAttachFragment()</code>-&gt;<code>onContentChanged()</code>[-&gt;onRestart]-&gt;<code>onStart()</code>[-&gt;onActivityResult()]-&gt;<code>onRestoreInstanceState()</code>-&gt;<code>onPostCreate()</code>-&gt;<code>onResume()</code>-&gt;<code>onPostResume()</code>-&gt;<code>onAttachedToWindow()</code>-&gt;<code>onCreateOptionsMenu()</code>-&gt;<code>onPrepareOptionMenu()</code>-&gt;应用运行-&gt;<code>onPause()</code>-&gt;<code>onSaveInstanceState()</code>-&gt;<code>onStop()</code>-&gt;<code>onDestory()</code></p>
<p>当启动其他Activity时，调用onPause()，从其他Activity回来时，调用onResume()
当应用被放到后台时，调用onStop()，回到前台调用onRestart()-&gt;onStart()；如果在后台时，由于内存不足等原因，进程被杀掉了，则回到前台时调的是onCreate()，而不会调onRestart()
onSaveInstanceState会在onDestroy之前的任意时刻调，调用的时机不固定</p>
<p>onStart和onStop是根据是否可见调用的，onPause和onResume是根据是否在前台调用的</p>
<h2 id="用户界面">用户界面</h2>
<h3 id="radiogroup">RadioGroup</h3>
<p>使用RadioGroup实现底部导航栏</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">RelativeLayout</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:app=</span><span class="st">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">FrameLayout</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:id=</span><span class="st">&quot;@+id/frame_layout&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_above=</span><span class="st">&quot;@id/tab_ll&quot;</span>/&gt;</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">LinearLayout</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:id=</span><span class="st">&quot;@+id/tab_ll&quot;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_height=</span><span class="st">&quot;match_parent&quot;</span>&gt;</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">RadioGroup</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:paddingTop=</span><span class="st">&quot;5dp&quot;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:id=</span><span class="st">&quot;@+id/tab_bar&quot;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:background=</span><span class="st">&quot;@android:color/white&quot;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:layout_height=</span><span class="st">&quot;60dp&quot;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:gravity=</span><span class="st">&quot;center&quot;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:orientation=</span><span class="st">&quot;horizontal&quot;</span>&gt;</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">RadioButton</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:id=</span><span class="st">&quot;@+id/tab_home&quot;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:gravity=</span><span class="st">&quot;center&quot;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:button=</span><span class="st">&quot;@null&quot;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:drawableTop=</span><span class="st">&quot;@drawable/selector_tab_home&quot;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_width=</span><span class="st">&quot;0dp&quot;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_weight=</span><span class="st">&quot;1&quot;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:textColor=</span><span class="st">&quot;@drawable/selector_tab_color&quot;</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:text=</span><span class="st">&quot;首页&quot;</span>/&gt;</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">RadioButton</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:id=</span><span class="st">&quot;@+id/tab_discover&quot;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:gravity=</span><span class="st">&quot;center&quot;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:button=</span><span class="st">&quot;@null&quot;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:drawableTop=</span><span class="st">&quot;@drawable/selector_tab_discover&quot;</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_width=</span><span class="st">&quot;0dp&quot;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_weight=</span><span class="st">&quot;1&quot;</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:textColor=</span><span class="st">&quot;@drawable/selector_tab_color&quot;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:text=</span><span class="st">&quot;发现&quot;</span> /&gt;</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">RadioButton</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:id=</span><span class="st">&quot;@+id/tab_personal&quot;</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:gravity=</span><span class="st">&quot;center&quot;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:button=</span><span class="st">&quot;@null&quot;</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:drawableTop=</span><span class="st">&quot;@drawable/selector_tab_personal&quot;</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_width=</span><span class="st">&quot;0dp&quot;</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_weight=</span><span class="st">&quot;1&quot;</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:textColor=</span><span class="st">&quot;@drawable/selector_tab_color&quot;</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:text=</span><span class="st">&quot;个人中心&quot;</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>                /&gt;</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">RadioGroup</span>&gt;</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">LinearLayout</span>&gt;</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">RelativeLayout</span>&gt;</span></code></pre></div>
<p><code>android:button=&quot;@null&quot;</code>或<code>android:color=@android:color/transparent</code>可以去掉前面的小圆点</p>
<h3 id="selector">selector</h3>
<p>selector是状态选择器，可根据不同状态显示不同图片</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span> <span class="fu">?&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">selector</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 没有焦点时的背景图片 --&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">item</span><span class="ot"> android:state_window_focused=</span><span class="st">&quot;false&quot;</span><span class="ot"> android:drawable=</span><span class="st">&quot;@drawable/pic1&quot;</span> /&gt;</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 非触摸模式下获得焦点并单击时的背景图片 --&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">item</span><span class="ot"> android:state_focused=</span><span class="st">&quot;true&quot;</span><span class="ot"> android:state_pressed=</span><span class="st">&quot;true&quot;</span><span class="ot"> android:drawable=</span> <span class="st">&quot;@drawable/pic2&quot;</span> /&gt;</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 触摸模式下单击时的背景图片--&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">item</span><span class="ot"> android:state_focused=</span><span class="st">&quot;false&quot;</span><span class="ot"> android:state_pressed=</span><span class="st">&quot;true&quot;</span><span class="ot"> android:drawable=</span><span class="st">&quot;@drawable/pic3&quot;</span> /&gt;</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--选中时的图片背景--&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">item</span><span class="ot"> android:state_selected=</span><span class="st">&quot;true&quot;</span><span class="ot"> android:drawable=</span><span class="st">&quot;@drawable/pic4&quot;</span> /&gt;</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--获得焦点时的图片背景--&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">item</span><span class="ot"> android:state_focused=</span><span class="st">&quot;true&quot;</span><span class="ot"> android:drawable=</span><span class="st">&quot;@drawable/pic5&quot;</span> /&gt;</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 默认时的背景图片--&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">item</span><span class="ot"> android:drawable=</span><span class="st">&quot;@drawable/pic1&quot;</span> /&gt;</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">selector</span>&gt;</span></code></pre></div>
<p>selector从上到下进行匹配，无匹配条件的item应放在最后</p>
<h3 id="layer-list">layer-list</h3>
<p>layer-list可以堆叠显示控件，如阴影效果：</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">layer-list</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> android:left=</span><span class="st">&quot;3dp&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:top=</span><span class="st">&quot;6dp&quot;</span>&gt;</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">shape</span>&gt;</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">solid</span><span class="ot"> android:color=</span><span class="st">&quot;#b4b5b6&quot;</span>/&gt;</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">shape</span>&gt;</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">item</span>&gt;</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 阴影层 --&gt;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> android:bottom=</span><span class="st">&quot;6dp&quot;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:right=</span><span class="st">&quot;3dp&quot;</span>&gt;</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">shape</span>&gt;</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">solid</span><span class="ot"> android:color=</span><span class="st">&quot;#fff&quot;</span>/&gt;</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">shape</span>&gt;</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">item</span>&gt;</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">layer-list</span>&gt;</span></code></pre></div>
<p>叠加旋转：</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">layer-list</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span>&gt;</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">rotate</span><span class="ot"> android:fromDegrees=</span><span class="st">&quot;-10&quot;</span><span class="ot"> android:pivotX=</span><span class="st">&quot;0&quot;</span><span class="ot"> android:pivotY=</span><span class="st">&quot;0&quot;</span>&gt;</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">bitmap</span><span class="ot"> android:src=</span><span class="st">&quot;@drawable/pic1&quot;</span>/&gt;</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">rotate</span>&gt;</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">item</span>&gt;</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span>&gt;</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">rotate</span><span class="ot"> android:fromDegrees=</span><span class="st">&quot;15&quot;</span><span class="ot"> android:pivotX=</span><span class="st">&quot;0&quot;</span><span class="ot"> android:pivotY=</span><span class="st">&quot;0&quot;</span>&gt;</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">bitmap</span><span class="ot"> android:src=</span><span class="st">&quot;@drawable/pic2&quot;</span>/&gt;</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">rotate</span>&gt;</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">item</span>&gt;</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span>&gt;</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">rotate</span><span class="ot"> android:fromDegrees=</span><span class="st">&quot;40&quot;</span><span class="ot"> android:pivotX=</span><span class="st">&quot;0&quot;</span><span class="ot"> android:pivotY=</span><span class="st">&quot;0&quot;</span>&gt;</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">bitmap</span><span class="ot"> android:src=</span><span class="st">&quot;@drawable/pic3&quot;</span>/&gt;</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">rotate</span>&gt;</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">item</span>&gt;</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">layer-list</span>&gt;</span></code></pre></div>
<h3 id="optionsmenu">OptionsMenu</h3>
<p>在Activity中点击菜单键触发，用法：在Activity中重写onCreateOptionsMenu、onOptionsItemSelected</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onCreateOptionsMenu</span><span class="op">(</span><span class="bu">Menu</span> menu<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MenuItem</span> item <span class="op">=</span> menu<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;菜单一&quot;</span><span class="op">);</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;aaa&quot;</span><span class="op">);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span><span class="fu">setIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">);</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    menu<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">101</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="st">&quot;菜单二&quot;</span><span class="op">);</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    menu<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">102</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;菜单三&quot;</span><span class="op">);</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onOptionsItemSelected</span><span class="op">(</span><span class="bu">MenuItem</span> item<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span><span class="op">(</span>item<span class="op">.</span><span class="fu">getItemId</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">100</span><span class="op">:</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> <span class="st">&quot;点击了菜单一&quot;</span><span class="op">,</span> Toast<span class="op">.</span><span class="fu">LENGTH_SHORT</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">101</span><span class="op">:</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">//xxx</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">102</span><span class="op">:</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">//xxx</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onOptionsItemSelected</span><span class="op">(</span>item<span class="op">);</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="contextmenu">ContextMenu</h3>
<p>View长按触发，用法：重写onCreateContextMenu、onContextItemSelected，并用<code>activity.registerForContextMenu(view)</code>为view注册ContextMenu</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MainActivity <span class="kw">extends</span> Activity <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">requestWindowFeature</span><span class="op">(</span><span class="bu">Window</span><span class="op">.</span><span class="fu">FEATURE_NO_TITLE</span><span class="op">);</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_main</span><span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showListView</span><span class="op">();</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">showListView</span><span class="op">(){</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">ListView</span> listView <span class="op">=</span> <span class="op">(</span><span class="bu">ListView</span><span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">lv</span><span class="op">);</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> list<span class="op">=</span><span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">5</span><span class="op">;</span>i<span class="op">++){</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            list<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="st">&quot;file&quot;</span><span class="op">+(</span>i<span class="op">+</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        ArrayAdapter<span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> adapter<span class="op">=</span><span class="kw">new</span> ArrayAdapter<span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;(</span><span class="kw">this</span><span class="op">,</span>android<span class="op">.</span><span class="fu">R</span><span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">simple_list_item_1</span><span class="op">,</span>list<span class="op">);</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        listView<span class="op">.</span><span class="fu">setAdapter</span><span class="op">(</span>adapter<span class="op">);</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">registerForContextMenu</span><span class="op">(</span>listView<span class="op">);</span><span class="co">//为listview注册上下文菜单</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">//创建菜单</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onCreateContextMenu</span><span class="op">(</span>ContextMenu menu<span class="op">,</span> <span class="bu">View</span> v<span class="op">,</span> ContextMenu<span class="op">.</span><span class="fu">ContextMenuInfo</span> menuInfo<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreateContextMenu</span><span class="op">(</span>menu<span class="op">,</span> v<span class="op">,</span> menuInfo<span class="op">);</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">//设置mune显示的内容</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        menu<span class="op">.</span><span class="fu">setHeaderTitle</span><span class="op">(</span><span class="st">&quot;文件操作&quot;</span><span class="op">);</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        menu<span class="op">.</span><span class="fu">setHeaderIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">);</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        menu<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="st">&quot;copy&quot;</span><span class="op">);</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        menu<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="st">&quot;cut&quot;</span><span class="op">);</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        menu<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="st">&quot;past&quot;</span><span class="op">);</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        menu<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="st">&quot;cancel&quot;</span><span class="op">);</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">//响应菜单</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onContextItemSelected</span><span class="op">(</span><span class="bu">MenuItem</span> item<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>item<span class="op">.</span><span class="fu">getItemId</span><span class="op">()){</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="st">&quot;clicked copy&quot;</span><span class="op">,</span>Toast<span class="op">.</span><span class="fu">LENGTH_SHORT</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>                <span class="co">//xxx</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">3</span><span class="op">:</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>                <span class="co">//xxx</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">4</span><span class="op">:</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>                <span class="co">//xxx</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onContextItemSelected</span><span class="op">(</span>item<span class="op">);</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>｝</span></code></pre></div>
<h3 id="alertdialog">AlertDialog</h3>
<p>普通的确认对话框：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>AlertDialog<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> <span class="kw">new</span> AlertDialog<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;请做出选择&quot;</span><span class="op">).</span><span class="fu">setIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setMessage</span><span class="op">(</span><span class="st">&quot;标题&quot;</span><span class="op">)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setPositiveButton</span><span class="op">(</span><span class="st">&quot;是&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">int</span> which<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">}).</span><span class="fu">setNegativeButton</span><span class="op">(</span><span class="st">&quot;否&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">int</span> which<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">}).</span><span class="fu">setNeutralButton</span><span class="op">(</span><span class="st">&quot;不知道&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">int</span> which<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">});</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">create</span><span class="op">().</span><span class="fu">show</span><span class="op">();</span></span></code></pre></div>
<p>选项列表对话框：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> items <span class="op">=</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">&quot;北京&quot;</span><span class="op">,</span> <span class="st">&quot;上海&quot;</span><span class="op">,</span> <span class="st">&quot;广州&quot;</span><span class="op">,</span> <span class="st">&quot;深圳&quot;</span> <span class="op">};</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>AlertDialog<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> <span class="kw">new</span> AlertDialog<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">setIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">).</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;标题&quot;</span><span class="op">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setItems</span><span class="op">(</span>items<span class="op">,</span> <span class="kw">new</span> <span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span> <span class="dt">int</span> which<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">create</span><span class="op">().</span><span class="fu">show</span><span class="op">();</span></span></code></pre></div>
<p>单选列表对话框：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> items <span class="op">=</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">&quot;北京&quot;</span><span class="op">,</span> <span class="st">&quot;上海&quot;</span><span class="op">,</span> <span class="st">&quot;广州&quot;</span><span class="op">,</span> <span class="st">&quot;深圳&quot;</span> <span class="op">};</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>AlertDialog<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> <span class="kw">new</span> AlertDialog<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">setIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">).</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;标题&quot;</span><span class="op">)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setSingleChoiceItems</span><span class="op">(</span>items<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span> <span class="dt">int</span> which<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">create</span><span class="op">().</span><span class="fu">show</span><span class="op">();</span></span></code></pre></div>
<p>多选列表对话框：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> items <span class="op">=</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">&quot;北京&quot;</span><span class="op">,</span> <span class="st">&quot;上海&quot;</span><span class="op">,</span> <span class="st">&quot;广州&quot;</span><span class="op">,</span> <span class="st">&quot;深圳&quot;</span> <span class="op">};</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>AlertDialog<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> <span class="kw">new</span> AlertDialog<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">setIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;标题&quot;</span><span class="op">)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setMultiChoiceItems</span><span class="op">(</span>items<span class="op">,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="dt">boolean</span><span class="op">[]</span> <span class="op">{</span> <span class="kw">true</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="kw">false</span> <span class="op">},</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="fu">OnMultiChoiceClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span><span class="dt">int</span> which<span class="op">,</span> <span class="dt">boolean</span> isChecked<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>isChecked<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                            Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span>items<span class="op">[</span>which<span class="op">],</span> <span class="dv">0</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">});</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">create</span><span class="op">().</span><span class="fu">show</span><span class="op">();</span></span></code></pre></div>
<p>自定义列表项：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> items <span class="op">=</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">&quot;北京&quot;</span><span class="op">,</span> <span class="st">&quot;上海&quot;</span><span class="op">,</span> <span class="st">&quot;广州&quot;</span><span class="op">,</span> <span class="st">&quot;深圳&quot;</span> <span class="op">};</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>AlertDialog<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> <span class="kw">new</span> AlertDialog<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;标题&quot;</span><span class="op">)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setAdapter</span><span class="op">(</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> ArrayAdapter<span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                        R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">item</span><span class="op">,</span> R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">tv</span><span class="op">,</span> items<span class="op">),</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span> <span class="dt">int</span> which<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                        Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> items<span class="op">[</span>which<span class="op">],</span> <span class="dv">0</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">});</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">create</span><span class="op">().</span><span class="fu">show</span><span class="op">();</span></span></code></pre></div>
<p>自定义View列表：</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>AlertDialog<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> <span class="kw">new</span> AlertDialog<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">View</span> view2 <span class="op">=</span> <span class="bu">View</span><span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">login</span><span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> EditText username <span class="op">=</span> <span class="op">(</span>EditText<span class="op">)</span> view2<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">username</span><span class="op">);</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> EditText password <span class="op">=</span> <span class="op">(</span>EditText<span class="op">)</span> view2<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">password</span><span class="op">);</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="bu">Button</span> button <span class="op">=</span> <span class="op">(</span><span class="bu">Button</span><span class="op">)</span> view2<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">btn_login</span><span class="op">);</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;登录&quot;</span><span class="op">).</span><span class="fu">setIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setView</span><span class="op">(</span>view2<span class="op">);</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> AlertDialog alertDialog <span class="op">=</span> builder<span class="op">.</span><span class="fu">create</span><span class="op">();</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>button<span class="op">.</span><span class="fu">setOnClickListener</span><span class="op">(</span><span class="kw">new</span> <span class="bu">View</span><span class="op">.</span><span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span><span class="bu">View</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> uname <span class="op">=</span> username<span class="op">.</span><span class="fu">getText</span><span class="op">().</span><span class="fu">toString</span><span class="op">().</span><span class="fu">trim</span><span class="op">();</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> psd <span class="op">=</span> password<span class="op">.</span><span class="fu">getText</span><span class="op">().</span><span class="fu">toString</span><span class="op">().</span><span class="fu">trim</span><span class="op">();</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>uname<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;username&quot;</span><span class="op">)</span> <span class="op">&amp;&amp;</span> psd<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;password&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> <span class="st">&quot;登录成功&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> <span class="st">&quot;登录失败&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        alertDialog<span class="op">.</span><span class="fu">dismiss</span><span class="op">();</span><span class="co">// 对话框消失</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>alertDialog<span class="op">.</span><span class="fu">show</span><span class="op">();</span></span></code></pre></div>
<h3 id="日期时间dialog">日期时间Dialog</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">//获取当前年月日、时间</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Calendar</span> calendar <span class="op">=</span> <span class="bu">Calendar</span><span class="op">.</span><span class="fu">getInstance</span><span class="op">();</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> year <span class="op">=</span> calendar<span class="op">.</span><span class="fu">get</span><span class="op">(</span>calendar<span class="op">.</span><span class="fu">YEAR</span><span class="op">);</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> monthOfYear <span class="op">=</span> calendar<span class="op">.</span><span class="fu">get</span><span class="op">(</span>calendar<span class="op">.</span><span class="fu">MONTH</span><span class="op">);</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dayOfMonth <span class="op">=</span> calendar<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="bu">Calendar</span><span class="op">.</span><span class="fu">DAY_OF_MONTH</span><span class="op">);</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hourOfDay <span class="op">=</span> calendar<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="bu">Calendar</span><span class="op">.</span><span class="fu">HOUR_OF_DAY</span><span class="op">);</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> minute <span class="op">=</span> calendar<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="bu">Calendar</span><span class="op">.</span><span class="fu">MINUTE</span><span class="op">);</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">DatePickerDialog</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">OnDateSetListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onDateSet</span><span class="op">(</span>DatePicker view<span class="op">,</span> <span class="dt">int</span> year<span class="op">,</span> <span class="dt">int</span> monthOfYear<span class="op">,</span> <span class="dt">int</span> dayOfMonth<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> year<span class="op">,</span> monthOfYear<span class="op">,</span> dayOfMonth<span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">TimePickerDialog</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">OnTimeSetListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onTimeSet</span><span class="op">(</span>TimePicker view<span class="op">,</span> <span class="dt">int</span> hourOfDay<span class="op">,</span> <span class="dt">int</span> minute<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> hourOfDay<span class="op">,</span> minute<span class="op">,</span> <span class="kw">true</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span></code></pre></div>
<h3 id="listview">ListView</h3>
<p>常用属性有： - listSelector：数据项在选中、按下等不同状态时的Drawable
- android:divider：使用一个Drawable或者color设置数据项之间的间隔样式; -
android:dividerHeight：设置数据项之间的间隔距离; -
android:entries：设置一个资源Id用于填充ListView的数据项; -
android:footerDividersEnabled：设定列表表尾是否显示分割线，如果有表尾的话;
-
android:headerDividerEnabled：设定列表表头是否显示分割线，如果有表头的话;</p>
<p>常用方法有： - void addFooterView(View v)：添加表尾View视图; -
boolean removeFooterView(View v)：移除一个表尾View视图; - void
addHeaderView(View v)：添加一个表头View视图; - boolean
removeHeaderView(View v)：移除一个表头View视图; - void setEmptyView(View
v)：设置数据项为0时的空数据视图 - ListAdapter
getAdapter()：获取当前绑定的ListAdapter适配器; - void
setAdapter(ListAdapter
adapter)：设置一个ListAdapter适配器到当前ListView中; - void
setSelection(int posotion)：设定当前选中项; - long[]
getCheckItemIds()：获取当前选中项;</p>
<p>常用有四种Adapter：ArrayAdapter、SimpleAdapter、SimpleCursorAdapter、BaseAdapter</p>
<p>Adapter不仅可以用在ListView中，还能用在Spinner、ViewPager等其他控件中，虽然用的Adapter有所不同，但其设计思想是一致的</p>
<p>SimpleAdapter：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Object</span><span class="op">&gt;&gt;</span> listItem <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Object</span><span class="op">&gt;&gt;();</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Object</span><span class="op">&gt;</span> map <span class="op">=</span> <span class="kw">new</span> <span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Object</span><span class="op">&gt;();</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    map<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;ItemImage&quot;</span><span class="op">,</span> R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">icon</span><span class="op">);</span><span class="co">//加入图片</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    map<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;ItemTitle&quot;</span><span class="op">,</span> <span class="st">&quot;第&quot;</span><span class="op">+</span>i<span class="op">+</span><span class="st">&quot;行&quot;</span><span class="op">);</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    map<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;ItemText&quot;</span><span class="op">,</span> <span class="st">&quot;这是第&quot;</span><span class="op">+</span>i<span class="op">+</span><span class="st">&quot;行&quot;</span><span class="op">);</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    listItem<span class="op">.</span><span class="fu">add</span><span class="op">(</span>map<span class="op">);</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>SimpleAdapter mSimpleAdapter <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimpleAdapter</span><span class="op">(</span> MainActicity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> listItem<span class="op">,</span> R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">item</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="st">&quot;ItemImage&quot;</span><span class="op">,</span><span class="st">&quot;ItemTitle&quot;</span><span class="op">,</span> <span class="st">&quot;ItemText&quot;</span><span class="op">},</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[]</span> <span class="op">{</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">ItemImage</span><span class="op">,</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">ItemTitle</span><span class="op">,</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">ItemText</span><span class="op">}</span> <span class="op">);</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>listview<span class="op">.</span><span class="fu">setChoiceMode</span><span class="op">(</span><span class="bu">ListView</span><span class="op">.</span><span class="fu">CHOICE_MODE_SINGLE</span><span class="op">);</span><span class="co">//设置选择模式为单选</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>listview<span class="op">.</span><span class="fu">setAdapter</span><span class="op">(</span>mSimpleAdapter<span class="op">);</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>lv<span class="op">.</span><span class="fu">setOnItemClickListener</span><span class="op">(</span><span class="kw">new</span> <span class="fu">OnItemClickListener</span><span class="op">(){</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onItemClick</span><span class="op">(</span><span class="bu">ListView</span> parent<span class="op">,</span> <span class="bu">View</span> view<span class="op">,</span> <span class="dt">int</span> position<span class="op">,</span> <span class="dt">long</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code></pre></div>
<p>BaseAdapter</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyAdapter <span class="kw">extends</span> BaseAdapter <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">List</span><span class="op">&lt;</span>Student<span class="op">&gt;</span> stuList<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> LayoutInflater inflater<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MyAdapter</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>Student<span class="op">&gt;</span> stuList<span class="op">,</span><span class="bu">Context</span> context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">stuList</span> <span class="op">=</span> stuList<span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">inflater</span><span class="op">=</span>LayoutInflater<span class="op">.</span><span class="fu">from</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getCount</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> stuList<span class="op">==</span><span class="kw">null</span><span class="op">?</span><span class="dv">0</span><span class="op">:</span>stuList<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Student <span class="fu">getItem</span><span class="op">(</span><span class="dt">int</span> position<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> stuList<span class="op">.</span><span class="fu">get</span><span class="op">(</span>position<span class="op">);</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">long</span> <span class="fu">getItemId</span><span class="op">(</span><span class="dt">int</span> position<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> position<span class="op">;</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">View</span> <span class="fu">getView</span><span class="op">(</span><span class="dt">int</span> position<span class="op">,</span> <span class="bu">View</span> convertView<span class="op">,</span> ViewGroup parent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">View</span> view<span class="op">;</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">//listview只加载 一页可显示的item数+1 个的item，每次滚动只是把item的内容改了，而不会重新inflate一个item，convertView就是复用的组件，convertView只有第一次加载listview的时候才inflate可以节省内存</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>convertView <span class="op">==</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>            convertView <span class="op">=</span> inflater<span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">layout_student_item</span><span class="op">,</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>            ViewHolder viewHolder <span class="op">=</span> <span class="kw">new</span> <span class="fu">ViewHolder</span><span class="op">();</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>            viewHolder<span class="op">.</span><span class="fu">image_photo</span> <span class="op">=</span> <span class="op">(</span><span class="bu">ImageView</span><span class="op">)</span> view<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">image_photo</span><span class="op">);</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>            viewHolder<span class="op">.</span><span class="fu">tv_name</span> <span class="op">=</span> <span class="op">(</span>TextView<span class="op">)</span> view<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>            viewHolder<span class="op">.</span><span class="fu">tv_age</span> <span class="op">=</span> <span class="op">(</span>TextView<span class="op">)</span> view<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">age</span><span class="op">);</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>            convertView<span class="op">.</span><span class="fu">setTag</span><span class="op">(</span>viewHolder<span class="op">);</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>            view <span class="op">=</span> convertView<span class="op">;</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span><span class="cf">else</span><span class="op">{</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>            view <span class="op">=</span> convertView<span class="op">;</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>        Student student<span class="op">=</span><span class="fu">getItem</span><span class="op">(</span>position<span class="op">);</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        ViewHolder mViewHolder <span class="op">=</span> view<span class="op">.</span><span class="fu">getTag</span><span class="op">();</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>        mViewHolder<span class="op">.</span><span class="fu">image_photo</span><span class="op">.</span><span class="fu">setImageResource</span><span class="op">(</span>student<span class="op">.</span><span class="fu">getPhoto</span><span class="op">());</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        mViewHolder<span class="op">.</span><span class="fu">tv_name</span><span class="op">.</span><span class="fu">setText</span><span class="op">(</span>student<span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>        mViewHolder<span class="op">.</span><span class="fu">tv_age</span><span class="op">.</span><span class="fu">setText</span><span class="op">(</span><span class="bu">String</span><span class="op">.</span><span class="fu">valueOf</span><span class="op">(</span>student<span class="op">.</span><span class="fu">getAge</span><span class="op">()));</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> view<span class="op">;</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ViewHolder<span class="op">{</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ImageView</span> image_photo<span class="op">;</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    TextView tv_name<span class="op">;</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>    TextView tv_age<span class="op">;</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>更新ListView的数据：</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">//改变数据集（stuList），然后调</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>adapter<span class="op">.</span><span class="fu">notifyDataSetChanged</span><span class="op">();</span></span></code></pre></div>
<h3 id="viewpager">ViewPager</h3>
<h4 id="使用">使用</h4>
<p>xml</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">android.support.v4.view.ViewPager</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:id=</span><span class="st">&quot;@+id/viewpager&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;match_parent&quot;</span>&gt;</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">android.support.v4.view.ViewPager</span>&gt;</span></code></pre></div>
<p>JAVA代码（自定义PagerAdapter，并对ViewPager设置自己的PagerAdapter）</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">setupViewpager</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> list <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> id <span class="op">=</span> <span class="fu">getResources</span><span class="op">().</span><span class="fu">getIdentifier</span><span class="op">(</span><span class="st">&quot;img_&quot;</span> <span class="op">+</span> i<span class="op">,</span> <span class="st">&quot;mipmap&quot;</span><span class="op">,</span> <span class="fu">getPackageName</span><span class="op">());</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>       list<span class="op">.</span><span class="fu">add</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    ViewPager viewpager <span class="op">=</span> <span class="op">(</span>ViewPager<span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">viewpager</span><span class="op">);</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//设置PagerAdapter，如果与Fragment一起使用，使用的Adapter就是FragmentPagerAdapter或FragmentStatePagerAdapter</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    viewpager<span class="op">.</span><span class="fu">setAdapter</span><span class="op">(</span><span class="kw">new</span> <span class="fu">MyPagerAdapter</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span>list<span class="op">));</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//设置翻页动画</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    viewpager<span class="op">.</span><span class="fu">setPageTransformer</span><span class="op">(</span><span class="kw">false</span><span class="op">,</span><span class="kw">new</span> ViewPager<span class="op">.</span><span class="fu">PageTransformer</span><span class="op">(){</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">transformPage</span><span class="op">(</span><span class="bu">View</span> view<span class="op">,</span> <span class="dt">float</span> position<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>            <span class="co">//根据position对view进行动画设置</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">//设置翻页监听</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    viewpager<span class="op">.</span><span class="fu">addOnPageChangeListener</span><span class="op">(</span><span class="kw">new</span> ViewPager<span class="op">.</span><span class="fu">OnPageChangeListener</span><span class="op">(){</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onPageScrolled</span><span class="op">(</span><span class="dt">int</span> position<span class="op">,</span> <span class="dt">float</span> positionOffset<span class="op">,</span> <span class="dt">int</span> positionOffsetPixels<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onPageSelected</span><span class="op">(</span><span class="dt">int</span> position<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onPageScrollStateChanged</span><span class="op">(</span><span class="dt">int</span> state<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">//自定义PagerAdapter</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyPagerAdapter <span class="kw">extends</span> PagerAdapter<span class="op">{</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">Context</span> mContext<span class="op">;</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> mData<span class="op">;</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MyPagerAdapter</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> <span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> list<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>        mContext <span class="op">=</span> context<span class="op">;</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>        mData <span class="op">=</span> list<span class="op">;</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getCount</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">//如果想无限滑动，则返回一个较大的数（如：Integer.MAX_VALUE），然后通过viewpager.setCurrentItem计算设置起始页为中间的值（Integer.MAX_VALUE/2 - (Integer.MAX_VALUE/2 % mData.size())），但这时后面instantiateItem的position也要取模才是真实的position</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mData<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">//相当于ListView的getView，只不过还要将view加到viewgroup中，因为ViewPager不存在组件复用的情况，所以使不使用ViewHolder其实无所谓</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">Object</span> <span class="fu">instantiateItem</span><span class="op">(</span>ViewGroup container<span class="op">,</span> <span class="dt">int</span> position<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">View</span> view <span class="op">=</span> <span class="bu">View</span><span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>mContext<span class="op">,</span> R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">item</span><span class="op">,</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">ImageView</span> img <span class="op">=</span> <span class="op">(</span><span class="bu">ImageView</span><span class="op">)</span>view<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">img</span><span class="op">);</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>        img<span class="op">.</span><span class="fu">setImageResource</span><span class="op">(</span>list<span class="op">.</span><span class="fu">get</span><span class="op">(</span>position<span class="op">));</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>        container<span class="op">.</span><span class="fu">addView</span><span class="op">(</span>view<span class="op">);</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> view<span class="op">;</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">destroyItem</span><span class="op">(</span>ViewGroup container<span class="op">,</span> <span class="dt">int</span> position<span class="op">,</span> <span class="bu">Object</span> object<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>        container<span class="op">.</span><span class="fu">removeView</span><span class="op">((</span><span class="bu">View</span><span class="op">)</span>object<span class="op">);</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isViewFromObject</span><span class="op">(</span><span class="bu">View</span> view<span class="op">,</span> <span class="bu">Object</span> object<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> view <span class="op">==</span> object<span class="op">;</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="原理">原理</h4>
<p>ViewPager其实是通过<code>view.scrollTo</code>和<code>view.scrollBy</code>实现的，这两个函数可以移动所有的子view，scrollTo直接指定坐标，scrollBy指定偏移量，要注意的是，该偏移量向右为负，向左为正，向下为负，向上为正，是和transition时相反的</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastX<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastY<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">boolean</span> <span class="fu">onTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">){</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>event<span class="op">.</span><span class="fu">getAction</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_DOWN</span><span class="op">:</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>            <span class="co">//getX得到的是相对父布局原点的X，getRawX得到的是相对于屏幕左上方的X，Y同理</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>            lastX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            lastY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_MOVE</span><span class="op">:</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> endX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> endY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">//这里计算的DX、DY是transition时的（滑动和滚动是相反的，一个是背景（绿幕）在动，一个是手机屏幕在动），在scrollBy中要相对于起始坐标取反</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> DX <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>endX <span class="op">-</span> lastX<span class="op">);</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> DY <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>endY <span class="op">-</span> lastY<span class="op">);</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">//如果只能水平滑动，第二个参数就是getScrollY，getScrollY是相对于父布局的，由于每个item都会有一个viewgroup包裹，view放在父布局原点，一般getScrollY都是0，但如果view不是放在父布局原点，getScrollY就不是0</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>            <span class="co">//当view不是放在父布局原点时，就不能写成-DY了，必须用getScrollY() - DY</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scrollTo</span><span class="op">(</span><span class="fu">getScrollX</span><span class="op">()</span> <span class="op">-</span> DX<span class="op">,</span> <span class="fu">getScrollY</span><span class="op">()</span> <span class="op">-</span> DY<span class="op">);</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>            lastX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>            lastY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_UP</span><span class="op">:</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>同时ViewPager还有回弹，是通过<code>Scroller</code>实现的，原理时从startScroll开始，通过指定的起始和结束位置以及时间，分别计算X方向和Y方向的速度，然后每调一次invalidate，就根据调用的时长（<code>invalidate</code>-&gt;<code>draw</code>-&gt;<code>ondraw</code>-&gt;<code>computeScroll</code>-&gt;<code>invalidate</code>）滑动对应的距离（getCurrX、getCurrY，以坐标形式给出），直到滑动到对应位置（要在<code>computeScroll</code>判断，如果没有完成滑动，就调<code>invalidate</code>开始下一个周期）</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>Scroller mScroller<span class="op">;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">){</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_main</span><span class="op">);</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    mScroller <span class="op">=</span> <span class="kw">new</span> <span class="fu">Scroller</span><span class="op">(</span>MyActivity<span class="op">.</span><span class="fu">this</span><span class="op">);</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    button<span class="op">.</span><span class="fu">setOnClickListener</span><span class="op">(</span><span class="kw">new</span> <span class="fu">OnClickListener</span><span class="op">(){</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span><span class="bu">View</span> view<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">//获取屏幕宽度</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            DisplayMetrics metric <span class="op">=</span> <span class="kw">new</span> <span class="fu">DisplayMetrics</span><span class="op">();</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>            context<span class="op">.</span><span class="fu">getWindowManager</span><span class="op">().</span><span class="fu">getDefaultDisplay</span><span class="op">().</span><span class="fu">getRealMetrics</span><span class="op">(</span>metric<span class="op">);</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> width <span class="op">=</span> metric<span class="op">.</span><span class="fu">widthPixels</span><span class="op">;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>            <span class="co">//startScroll(int startX,int startY,int dx,int dy,int duration);</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">//从(0, 0)开始，向右滑动一个屏幕，总共500毫秒完成</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>            mScroller<span class="op">.</span><span class="fu">startScroll</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span> <span class="op">-</span>width<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">500</span><span class="op">);</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">invalidate</span><span class="op">();</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">//调用invalidate或postInvalidate时，除了调用onDraw外，还会调computeScroll</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">computeScroll</span><span class="op">(){</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>mScroller<span class="op">.</span><span class="fu">computeScrollOffset</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">//还没有完成滑动，继续滑动</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scrollTo</span><span class="op">(</span>mScroller<span class="op">.</span><span class="fu">getCurrX</span><span class="op">(),</span> mScroller<span class="op">.</span><span class="fu">getCurrY</span><span class="op">());</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">postInvalidate</span><span class="op">();</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">computeScroll</span><span class="op">();</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>手势操作还可以通过<code>GestureDetector</code>或<code>ViewDragHelper</code>实现</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> GestureDetector mDetector<span class="op">;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_main</span><span class="op">);</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//OnGestureListener也可以用SimpleOnGestureListener，其实就是一个把抽象方法改成空方法的OnGestureListener，不用写那么多个用不到的函数而已</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    mDetector <span class="op">=</span> <span class="kw">new</span> <span class="fu">GestureDetector</span><span class="op">(</span>MyActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span><span class="kw">new</span> GestureDetector<span class="op">.</span><span class="fu">OnGestureListener</span><span class="op">(){</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onDown</span><span class="op">(</span>MotionEvent e<span class="op">){</span><span class="cf">return</span> <span class="kw">true</span><span class="op">;}</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onFling</span><span class="op">(</span>MotionEvent e1<span class="op">,</span> MotionEvent e2<span class="op">,</span> <span class="dt">float</span> velocityX<span class="op">,</span> <span class="dt">float</span> velocityY<span class="op">){</span><span class="cf">return</span> <span class="kw">true</span><span class="op">;}</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onLongPress</span><span class="op">(</span>MotionEvent e<span class="op">){}</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onScroll</span><span class="op">(</span>MotionEvent e1<span class="op">,</span> MotionEvent e2<span class="op">,</span> <span class="dt">float</span> distanceX<span class="op">,</span> <span class="dt">float</span> distanceY<span class="op">){</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scrollBy</span><span class="op">((</span><span class="dt">int</span><span class="op">)(</span><span class="fu">getScrollX</span><span class="op">()-</span>distanceX<span class="op">),</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span><span class="fu">getScrollY</span><span class="op">()-</span>distanceY<span class="op">));</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onShowPress</span><span class="op">(</span>MotionEvent e<span class="op">){}</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onSingleTapUp</span><span class="op">(</span>MotionEvent e<span class="op">){</span><span class="cf">return</span> <span class="kw">true</span><span class="op">;}</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">//在onTouchEvent调GestureDetector的onTouchEvent，将事件交由GestureDetector处理</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">){</span> </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">mDetector</span><span class="op">.</span><span class="fu">onTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>有时比如向左滑出菜单会和点击事件冲突（滑出菜单由item实现，点击由子view实现，而且可能有多个按钮，就有多个点击事件），这时可以通过拦截事件来解决，这里是item的代码</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> menuwidth<span class="op">;</span><span class="co">//侧滑菜单的宽度，在onCreate时已赋值</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Scroller mScroller<span class="op">;</span><span class="co">//系统提供的计算回弹坐标的类，在onCreate时已赋值</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> downX<span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> downY<span class="op">;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastX<span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastY<span class="op">;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onInterceptTouchEvent</span><span class="op">(</span>Motion event<span class="op">){</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//intercept为true表示拦截事件，让事件由自己处理（拦截后会调用当前的onTouchEvent，在onTouchEvent中写滑出菜单的代码），为false表示不拦截，让item内每个按钮处理对应的点击事件</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">boolean</span> intercept <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span><span class="op">(</span>event<span class="op">.</span><span class="fu">getAction</span><span class="op">()){</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_DOWN</span><span class="op">:</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>            downX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>            downY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_MOVE</span><span class="op">:</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> endX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> endY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>            floast DX <span class="op">=</span> endX <span class="op">-</span> downX<span class="op">;</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>            floast DY <span class="op">=</span> endY <span class="op">-</span> downY<span class="op">;</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span><span class="op">(</span>DX<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">8</span><span class="op">){</span><span class="co">//水平滑动超过8px，则为水平滑动</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                intercept <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_UP</span><span class="op">:</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> intercept<span class="op">;</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="co">作用：</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co">1、让每个item在水平方向跟随用户拖动而移动</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="co">2、在ACTION_UP时，判断是要弹出菜单还是回弹菜单</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">boolean</span> <span class="fu">onTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">){</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>event<span class="op">.</span><span class="fu">getAction</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_DOWN</span><span class="op">:</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>            lastX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>            lastY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_MOVE</span><span class="op">:</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> endX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> endY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> DX <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>endX <span class="op">-</span> lastX<span class="op">);</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> DY <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>endY <span class="op">-</span> lastY<span class="op">);</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> toScrollX <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span><span class="fu">getScrollX</span><span class="op">()</span> <span class="op">-</span> DX<span class="op">);</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>            <span class="co">//屏蔽非法值，这里view的原点在父布局原点，getScrollX、getScrollY可以理解为view坐标（或偏移量，因为起点是(0,0)，移动多少偏移量也是多少，但要记住，这个偏移量是和transition相同的，和srcoll相反的），这里限制坐标在0~menuwidth之间</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>toScrollX <span class="op">&lt;</span> <span class="dv">0</span><span class="op">){</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>                toScrollX <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span><span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>toScrollX <span class="op">&gt;</span> menuwidth<span class="op">){</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>                toScrollX <span class="op">=</span> toScrollX<span class="op">;</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scrollTo</span><span class="op">(</span>toScrollX<span class="op">,</span> <span class="fu">getScrollY</span><span class="op">());</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>            lastX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>            lastY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_UP</span><span class="op">:</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>            <span class="co">//判断是滑出菜单还是回弹菜单</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>            <span class="co">//当view原点位于父布局的原点位置时，getScrollX、getScrollX可以理解为偏移量，这里view原点在父布局原点</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span><span class="fu">getScrollX</span><span class="op">()</span> <span class="op">&lt;</span> menuwidth<span class="op">/</span><span class="dv">2</span><span class="op">){</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>                <span class="co">//回弹菜单</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>                <span class="fu">closeMenu</span><span class="op">();</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span><span class="cf">else</span><span class="op">{</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>                <span class="co">//滑出菜单</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>                <span class="fu">openMenu</span><span class="op">();</span></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a><span class="co">这里滑出和回弹封装成方法的好处是：</span></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a><span class="co">1、当以后加到ListView中，ListView向下滑动，item要自动回弹，这时可以设ListView监听，在ListView滚动时调回弹的方法</span></span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a><span class="co">2、限制只能同时打开一个item菜单，当openMenu时，自定义回调接口通知用户打开了菜单，这时就要关闭其他的item菜单</span></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a><span class="co">//滑出菜单</span></span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">openMenu</span><span class="op">(){</span></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>    mScroller<span class="op">.</span><span class="fu">startScroll</span><span class="op">(</span><span class="fu">getScrollX</span><span class="op">(),</span> <span class="fu">getScrollY</span><span class="op">(),</span> menuwidth <span class="op">-</span> <span class="fu">getScrollX</span><span class="op">(),</span> <span class="fu">getScrollY</span><span class="op">())</span></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invalidate</span><span class="op">();</span></span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a><span class="co">//回弹菜单（水平方向回弹，竖直方向不变）</span></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">closeMenu</span><span class="op">(){</span></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>    mScroller<span class="op">.</span><span class="fu">startScroll</span><span class="op">(</span><span class="fu">getScrollX</span><span class="op">(),</span> <span class="fu">getScrollY</span><span class="op">(),</span> <span class="op">-</span> <span class="fu">getScrollX</span><span class="op">(),</span> <span class="fu">getScrollY</span><span class="op">())</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invalidate</span><span class="op">();</span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a><span class="co">//由于用到了Scroller，需重写此方法</span></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">computeScroll</span><span class="op">(){</span></span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>mScroller<span class="op">.</span><span class="fu">computeScrollOffset</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scrollTo</span><span class="op">(</span>mScroller<span class="op">.</span><span class="fu">getCurrX</span><span class="op">(),</span> mScroller<span class="op">.</span><span class="fu">getCurrY</span><span class="op">());</span></span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">postInvalidate</span><span class="op">();</span></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">computeScroll</span><span class="op">();</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>要自动滑动ViewPager，可以用handler发延时消息，这里只提供思路，不再列出具体实现</p>
<h4 id="tablayoutviewpager">TabLayout+ViewPager</h4>
<p>使用TabLayout前需在build.gradle中添加依赖</p>
<pre><code>compile &#39;com.android.support:design:25.2.0&#39;</code></pre>
<p>xml布局</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">LinearLayout</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ot">        xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:background=</span><span class="st">&quot;@android:color/white&quot;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        &gt;</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">android.support.design.widget.TabLayout</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:id=</span><span class="st">&quot;@+id/tablayout&quot;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_height=</span><span class="st">&quot;wrap_content&quot;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:background=</span><span class="st">&quot;#FFFFFF&quot;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="ot">        app:tabGravity=</span><span class="st">&quot;fill&quot;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="ot">        app:tabIndicatorColor=</span><span class="st">&quot;@color/toolBarColor&quot;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="ot">        app:tabMode=</span><span class="st">&quot;fixed&quot;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="ot">        app:tabSelectedTextColor=</span><span class="st">&quot;@color/toolBarColor&quot;</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="ot">        app:tabTextColor=</span><span class="st">&quot;#000000&quot;</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    /&gt;</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">android.support.v4.view.ViewPager</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:id=</span><span class="st">&quot;@+id/viewpager&quot;</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_height=</span><span class="st">&quot;0px&quot;</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_weight=</span><span class="st">&quot;1&quot;</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:background=</span><span class="st">&quot;@android:color/white&quot;</span>/&gt;</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a> &lt;/<span class="kw">LinearLayout</span>&gt;</span></code></pre></div>
<p>在ViewPager中使用Fragment需用FragmentPagerAdapter</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyPagerAdapter <span class="kw">extends</span> FragmentPagerAdapter <span class="op">{</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">Context</span> context<span class="op">;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">List</span><span class="op">&lt;</span>Fragment<span class="op">&gt;</span> fragmentList<span class="op">;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> list_Title<span class="op">;</span><span class="co">//TabLayout中的title</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MyPagerAdapter</span><span class="op">(</span>FragmentManager fm<span class="op">,</span><span class="bu">Context</span> context<span class="op">,</span><span class="bu">List</span><span class="op">&lt;</span>Fragment<span class="op">&gt;</span> fragmentList<span class="op">,</span><span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> list_Title<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span>fm<span class="op">);</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">context</span> <span class="op">=</span> context<span class="op">;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">fragmentList</span> <span class="op">=</span> fragmentList<span class="op">;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">list_Title</span> <span class="op">=</span> list_Title<span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Fragment <span class="fu">getItem</span><span class="op">(</span><span class="dt">int</span> position<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fragmentList<span class="op">.</span><span class="fu">get</span><span class="op">(</span>position<span class="op">);</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getCount</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> list_Title<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">//此方法用来显示tab上的标题</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">CharSequence</span> <span class="fu">getPageTitle</span><span class="op">(</span><span class="dt">int</span> position<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> list_Title<span class="op">.</span><span class="fu">get</span><span class="op">(</span>position<span class="op">);</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>关联TabLayout和ViewPager</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fragmentList <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>list_Title <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fragmentList<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">MyFragment</span><span class="op">());</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>fragmentList<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">MyFragment</span><span class="op">());</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>list_Title<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="st">&quot;one&quot;</span><span class="op">);</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>list_Title<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="st">&quot;two&quot;</span><span class="op">);</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>viewpager<span class="op">.</span><span class="fu">setAdapter</span><span class="op">(</span><span class="kw">new</span> <span class="fu">MyPagerAdapter</span><span class="op">(</span><span class="fu">getSupportFragmentManager</span><span class="op">(),</span> MyActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> fragmentList<span class="op">,</span> list_Title<span class="op">));</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>tablayout<span class="op">.</span><span class="fu">setupWithViewPager</span><span class="op">(</span>viewpager<span class="op">);</span><span class="co">//此方法就是让tablayout和ViewPager联动</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>tablayout<span class="op">.</span><span class="fu">setTabMode</span><span class="op">(</span>TabLayout<span class="op">.</span><span class="fu">MODE_SCROLLABLE</span><span class="op">);</span><span class="co">//如果标签很多，需要设置可滑动</span></span></code></pre></div>
<h3 id="recyclerview">RecyclerView</h3>
<p>使用前需在build.gradle中添加依赖</p>
<pre><code>implementation &#39;com.android.support:recyclerview-v7:27.0.2&#39;</code></pre>
<p>在xml中使用</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">android.support.v7.widget.RecyclerView</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:id=</span><span class="st">&quot;@+id/recyclerView&quot;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;match_parent&quot;</span>/&gt;</span></code></pre></div>
<p>在JAVA中配置</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mRecyclerView <span class="op">=</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">recyclerView</span><span class="op">);</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">//设置LayoutManager，可以通过LayoutManager设置显示为线性、网格(GridLayoutManager)、瀑布流(StaggeredGridLayoutManager，item高度不一致时使用)等</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>mRecyclerView<span class="op">.</span><span class="fu">setLayoutManager</span><span class="op">(</span><span class="kw">new</span> <span class="fu">LinearLayoutManager</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> LinearLayoutManager<span class="op">.</span><span class="fu">VERTICAL</span><span class="op">,</span> <span class="kw">false</span><span class="op">));</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">//设置添加或删除item时的动画，这里使用默认动画</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>mRecyclerView<span class="op">.</span><span class="fu">setItemAnimator</span><span class="op">(</span><span class="kw">new</span> <span class="fu">DefaultItemAnimator</span><span class="op">());</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">//添加分割线，添加多个时叠加显示</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">//ItemDecoration内置里一共有三个类继承该类，分别是 DividerItemDecoration(普通分割线，可以实现section(联系人列表中的按首字母拼音分组)、StickyHeader等效果)，ItemTouchHelper(可以实现拖拽和移动，侧滑删除等效果)，FastScroller(包权限，不开放给外部使用)</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>recyclerView<span class="op">.</span><span class="fu">addItemDecoration</span><span class="op">(</span><span class="kw">new</span> <span class="fu">DividerItemDecoration</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> RecyclerView<span class="op">.</span><span class="fu">ItemDecoration</span><span class="op">.</span><span class="fu">HORIZONTAL</span><span class="op">));</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">//设置适配器</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>mAdapter <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyRecyclerViewAdapter</span><span class="op">(</span>list<span class="op">);</span> </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>mRecyclerView<span class="op">.</span><span class="fu">setAdapter</span><span class="op">(</span>mAdapter<span class="op">);</span></span></code></pre></div>
<p>StickyHeader可参考
https://github.com/timehop/sticky-headers-recyclerview</p>
<p>Adapter与ListView类似，但ViewHolder要使用<code>RecyclerView.ViewHolder</code></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyRecyclerViewAdapterextends RecyclerView<span class="op">.</span><span class="fu">Adapter</span><span class="op">&lt;</span>MyAdapter<span class="op">.</span><span class="fu">ViewHolder</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> list<span class="op">;</span><span class="co">//要显示的数据</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MyAdapter</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> list<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">list</span> <span class="op">=</span> list<span class="op">;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> MyAdapter<span class="op">.</span><span class="fu">ViewHolder</span> <span class="fu">onCreateViewHolder</span><span class="op">(</span>ViewGroup parent<span class="op">,</span> <span class="dt">int</span> viewType<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">View</span> view <span class="op">=</span> LayoutInflater<span class="op">.</span><span class="fu">from</span><span class="op">(</span>parent<span class="op">.</span><span class="fu">getContext</span><span class="op">()).</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">item</span><span class="op">,</span> parent<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        MyAdapter<span class="op">.</span><span class="fu">ViewHolder</span> viewHolder <span class="op">=</span> <span class="kw">new</span> MyAdapter<span class="op">.</span><span class="fu">ViewHolder</span><span class="op">(</span>view<span class="op">);</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> viewHolder<span class="op">;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onBindViewHolder</span><span class="op">(</span>MyAdapter<span class="op">.</span><span class="fu">ViewHolder</span> holder<span class="op">,</span> <span class="dt">int</span> position<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        holder<span class="op">.</span><span class="fu">mText</span><span class="op">.</span><span class="fu">setText</span><span class="op">(</span>list<span class="op">.</span><span class="fu">get</span><span class="op">(</span>position<span class="op">));</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getItemCount</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> list<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ViewHolder <span class="kw">extends</span> RecyclerView<span class="op">.</span><span class="fu">ViewHolder</span> <span class="op">{</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>        TextView mText<span class="op">;</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ViewHolder</span><span class="op">(</span><span class="bu">View</span> itemView<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">super</span><span class="op">(</span>itemView<span class="op">);</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>            mText <span class="op">=</span> itemView<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">item_tx</span><span class="op">);</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="floatbutton">FloatButton</h3>
<p>FloatButton继承自ImageButton，基本用法和Button一样</p>
<p>使用前先在build.gradle中添加依赖</p>
<pre><code>compile &#39;com.android.support:design:22.2.0&#39;</code></pre>
<p>xml配置</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">android.support.design.widget.FloatingActionButton</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;wrap_content&quot;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;wrap_content&quot;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_gravity=</span><span class="st">&quot;right|bottom&quot;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:src=</span><span class="st">&quot;@mipmap/floatbutton&quot;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_margin=</span><span class="st">&quot;@dimen/fab_margin&quot;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    app:fabSize=</span><span class="st">&quot;mini&quot;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="ot">    app:backgroundTint=</span><span class="st">&quot;#ff87ffeb&quot;</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="ot">    app:borderWidth=</span><span class="st">&quot;0dp&quot;</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="ot">    app:rippleColor=</span><span class="st">&quot;#33728dff&quot;</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="ot">    app:elevation=</span><span class="st">&quot;6dp&quot;</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="ot">    app:pressedTranslationZ=</span><span class="st">&quot;12dp&quot;</span> /&gt;</span></code></pre></div>
<p><code>app:borderWidth</code>可以解决在5.x设备上没有阴影的问题，<code>android:layout_margin</code>的作用是防止设置了borderWidth后出现矩形边框，<code>app:backgroundTint</code>是按钮的背景颜色，<code>app:rippleColor</code>是点击的边缘阴影颜色，<code>app:elevation</code>是边缘阴影的宽度，<code>app:pressedTranslationZ</code>是点击时边缘阴影的宽度</p>
<p>values.xml</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dimen</span><span class="ot"> name=</span><span class="st">&quot;fab_margin&quot;</span>&gt;0dp&lt;/<span class="kw">dimen</span>&gt;</span></code></pre></div>
<p>values-v21.xml</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dimen</span><span class="ot"> name=</span><span class="st">&quot;fab_margin&quot;</span>&gt;16dp&lt;/<span class="kw">dimen</span>&gt;</span></code></pre></div>
<h3 id="appwidget">AppWidget</h3>
<p><code>AppWidget</code>是桌面小部件，比如常见的天气预报、时钟等就是<code>AppWidget</code></p>
<p>使用Android
Studio帮我们创建一个<code>AppWidget</code>，这时生成了三个文件</p>
<p>MyAppWidget.java</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyAppWidget <span class="kw">extends</span> AppWidgetProvider <span class="op">{</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">void</span> <span class="fu">updateAppWidget</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> AppWidgetManager appWidgetManager<span class="op">,</span> <span class="dt">int</span> appWidgetId<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">CharSequence</span> widgetText <span class="op">=</span> context<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>R<span class="op">.</span><span class="fu">string</span><span class="op">.</span><span class="fu">appwidget_text</span><span class="op">);</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        RemoteViews views <span class="op">=</span> <span class="kw">new</span> <span class="fu">RemoteViews</span><span class="op">(</span>context<span class="op">.</span><span class="fu">getPackageName</span><span class="op">(),</span> R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">my_app_widget</span><span class="op">);</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        views<span class="op">.</span><span class="fu">setTextViewText</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">appwidget_text</span><span class="op">,</span> widgetText<span class="op">);</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        appWidgetManager<span class="op">.</span><span class="fu">updateAppWidget</span><span class="op">(</span>appWidgetId<span class="op">,</span> views<span class="op">);</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//当小部件被添加时或者每次小部件更新时都会调用一次该方法</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onUpdate</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> AppWidgetManager appWidgetManager<span class="op">,</span> <span class="dt">int</span><span class="op">[]</span> appWidgetIds<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// There may be multiple widgets active, so update all of them</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> appWidgetId <span class="op">:</span> appWidgetIds<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">updateAppWidget</span><span class="op">(</span>context<span class="op">,</span> appWidgetManager<span class="op">,</span> appWidgetId<span class="op">);</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">//当小部件第一次被添加到桌面时回调该方法，可添加多次，但只在第一次调用</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onEnabled</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">)</span> <span class="op">{</span>  <span class="op">}</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">//当最后一个该类型的小部件从桌面移除时调用</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onDisabled</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">)</span> <span class="op">{</span>  <span class="op">}</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>首先创建了一个<code>RemoteViews</code>（远程view，它在其它进程中显示，却可以在另一个进程中更新），用于显示我们的<code>AppWidget</code>，然后通过<code>RemoteViews</code>的<code>setXXX</code>方法对<code>AppWidget</code>的内容进行更新，最后通过<code>updateAppWidget</code>执行更新</p>
<p>这里的<code>my_app_widget</code>是一个普通的布局文件，但是因为它只能通过<code>RemoteViews</code>的<code>setXXX</code>方法进行更新，所以能更新的view类型是有限的，它只能更新基本的系统控件，我们如果在<code>AppWidget</code>中使用了自定义控件，会无法更新</p>
<p>my_app_widget.xml</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">RelativeLayout</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:background=</span><span class="st">&quot;#09C&quot;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:padding=</span><span class="st">&quot;@dimen/widget_margin&quot;</span>&gt;</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">TextView</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:id=</span><span class="st">&quot;@+id/appwidget_text&quot;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_width=</span><span class="st">&quot;wrap_content&quot;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_height=</span><span class="st">&quot;wrap_content&quot;</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_centerHorizontal=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_centerVertical=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_margin=</span><span class="st">&quot;8dp&quot;</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:background=</span><span class="st">&quot;#09C&quot;</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:contentDescription=</span><span class="st">&quot;@string/appwidget_text&quot;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:text=</span><span class="st">&quot;@string/appwidget_text&quot;</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:textColor=</span><span class="st">&quot;#ffffff&quot;</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:textSize=</span><span class="st">&quot;24sp&quot;</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:textStyle=</span><span class="st">&quot;bold|italic&quot;</span> /&gt;</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">RelativeLayout</span>&gt;</span></code></pre></div>
<p><code>AppWidget</code>
是通过<code>BroadCastReceiver</code>的形式进行控制的，我们继承的<code>AppWidgetProvider</code>其实继承自
<code>BroadCastReceiver</code>，所以在<code>AndroidManifest.xml</code>中会生成<code>receiver</code></p>
<p>AndroidManifest.xml</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">receiver</span><span class="ot"> android:name=</span><span class="st">&quot;.MyAppWidget&quot;</span>&gt;</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;android.appwidget.action.APPWIDGET_UPDATE&quot;</span> /&gt;</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">meta-data</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:name=</span><span class="st">&quot;android.appwidget.provider&quot;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:resource=</span><span class="st">&quot;@xml/my_app_widget_info&quot;</span> /&gt;</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">receiver</span>&gt;</span></code></pre></div>
<p>其中action是<code>AppWidget</code>的固定写法，而<code>AppWidget</code>的配置是通过<code>meta-data</code>中指向的文件设置的</p>
<p>xml文件夹下的my_app_widget_info.xml指定了<code>AppWidget</code>的最小宽高，可调整大小的方向，更新时间间隔等</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">appwidget-provider</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:initialKeyguardLayout=</span><span class="st">&quot;@layout/my_app_widget&quot;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:initialLayout=</span><span class="st">&quot;@layout/my_app_widget&quot;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:minWidth=</span><span class="st">&quot;110dp&quot;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:minHeight=</span><span class="st">&quot;40dp&quot;</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:previewImage=</span><span class="st">&quot;@drawable/example_appwidget_preview&quot;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:resizeMode=</span><span class="st">&quot;horizontal|vertical&quot;</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:updatePeriodMillis=</span><span class="st">&quot;86400000&quot;</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:widgetCategory=</span><span class="st">&quot;home_screen&quot;</span>&gt;&lt;/<span class="kw">appwidget-provider</span>&gt;</span></code></pre></div>
<p>如果要实现点击<code>AppWidget</code>打开APP，这时一般不用<code>Intent</code>，而是用<code>PendingIntent</code></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onUpdate</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> AppWidgetManager appWidgetManager<span class="op">,</span> <span class="dt">int</span><span class="op">[]</span> appWidgetIds<span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>context<span class="op">,</span> MainActivity<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    PendingIntent pendingIntent <span class="op">=</span> PendingIntent<span class="op">.</span><span class="fu">getActivity</span><span class="op">(</span>context<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> intent<span class="op">,</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    RemoteViews view <span class="op">=</span> <span class="kw">new</span> <span class="fu">RemoteViews</span><span class="op">(</span>context<span class="op">.</span><span class="fu">getPackageName</span><span class="op">(),</span> R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">my_app_widget</span><span class="op">);</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    view<span class="op">.</span><span class="fu">setOnClickPendingIntent</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">ic_launcher_background</span><span class="op">,</span> pendingIntent<span class="op">);</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    appWidgetManager<span class="op">.</span><span class="fu">updateAppWidget</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">my_app_widget</span><span class="op">,</span>view<span class="op">);</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="shortcuts">Shortcuts</h3>
<p>长按应用图标显示应用快捷键菜单（Shortcuts），Android7.0加入的功能</p>
<h4 id="静态配置">静态配置</h4>
<p>在<code>/res/xml</code>中创建一个xml文件，这里我们命名为<code>shortcuts.xml</code></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">shortcuts</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">shortcut</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:shortcutId=</span><span class="st">&quot;compose&quot;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:enabled=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:icon=</span><span class="st">&quot;@drawable/compose_icon&quot;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:shortcutShortLabel=</span><span class="st">&quot;@string/compose_shortcut_short_label1&quot;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:shortcutLongLabel=</span><span class="st">&quot;@string/compose_shortcut_long_label1&quot;</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:shortcutDisabledMessage=</span><span class="st">&quot;@string/compose_disabled_message1&quot;</span>&gt;</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="ot">      android:action=</span><span class="st">&quot;android.intent.action.VIEW&quot;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="ot">      android:targetPackage=</span><span class="st">&quot;com.example.myapplication&quot;</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="ot">      android:targetClass=</span><span class="st">&quot;com.example.myapplication.ComposeActivity&quot;</span> /&gt;</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">categories</span><span class="ot"> android:name=</span><span class="st">&quot;android.shortcut.conversation&quot;</span> /&gt;</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">shortcut</span>&gt;</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Specify more shortcuts here. --&gt;</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">shortcuts</span>&gt;</span></code></pre></div>
<p>然后在<code>AndroidManifest.xml</code>中配置<code>activity</code>的<code>meta-data</code></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">activity</span><span class="ot"> android:name=</span><span class="st">&quot;Main&quot;</span>&gt;</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">category</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">meta-data</span><span class="ot"> android:name=</span><span class="st">&quot;android.app.shortcuts&quot;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="ot">               android:resource=</span><span class="st">&quot;@xml/shortcuts&quot;</span> /&gt; </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">activity</span>&gt;</span></code></pre></div>
<p>要注意的是，能配置<code>shortcuts</code>的<code>activity</code>必须是<code>android.intent.action.MAIN</code>和<code>android.intent.category.LAUNCHER</code></p>
<p>静态配置的<code>shortcuts</code>无法设置<code>Intent</code>的flag，flag默认为<code>FLAG_ACTIVITY_NEW_TASK</code>和<code>FLAG_ACTIVITY_CLEAR_TASK</code>，也就是如果当前Activity已经启动，通过<code>shortcuts</code>启动应用会把当前Activity销毁</p>
<h4 id="动态配置">动态配置</h4>
<p>通过<code>ShortcutManager</code>配置</p>
<p>添加：</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ShortcutManager shortcutManager <span class="op">=</span> <span class="fu">getSystemService</span><span class="op">(</span>ShortcutManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>ShortcutInfo shortcut <span class="op">=</span> <span class="kw">new</span> ShortcutInfo<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span>context<span class="op">,</span> <span class="st">&quot;id1&quot;</span><span class="op">)</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">setShortLabel</span><span class="op">(</span><span class="st">&quot;Website&quot;</span><span class="op">)</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">setLongLabel</span><span class="op">(</span><span class="st">&quot;Open the website&quot;</span><span class="op">)</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">setIcon</span><span class="op">(</span><span class="bu">Icon</span><span class="op">.</span><span class="fu">createWithResource</span><span class="op">(</span>context<span class="op">,</span> R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">icon_website</span><span class="op">))</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">setIntent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">ACTION_VIEW</span><span class="op">,</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                   Uri<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">&quot;https://www.mysite.example.com/&quot;</span><span class="op">)))</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>shortcutManager<span class="op">.</span><span class="fu">setDynamicShortcuts</span><span class="op">(</span><span class="bu">Arrays</span><span class="op">.</span><span class="fu">asList</span><span class="op">(</span>shortcut<span class="op">));</span></span></code></pre></div>
<p>更新：</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">List</span><span class="op">&lt;</span>ShortcutInfo<span class="op">&gt;</span> infoList <span class="op">=</span> shortcutManager<span class="op">.</span><span class="fu">getPinnedShortcuts</span><span class="op">();</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">//修改infoList</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">//...</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>shortcutManager<span class="op">.</span><span class="fu">updateShortcuts</span><span class="op">(</span>infoList<span class="op">);</span></span></code></pre></div>
<p>删除：</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ShortcutManager shortcutManager <span class="op">=</span> <span class="fu">getSystemService</span><span class="op">(</span>ShortcutManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">List</span><span class="op">&lt;</span>ShortcutInfo<span class="op">&gt;</span> infoList <span class="op">=</span> shortcutManager<span class="op">.</span><span class="fu">getDynamicShortcuts</span><span class="op">();</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> idList <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span>ShortcutInfo s <span class="op">:</span> infoList<span class="op">){</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    idList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>s<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>shortcutManager<span class="op">.</span><span class="fu">disableShortcuts</span><span class="op">(</span>idList<span class="op">,</span> <span class="st">&quot;已禁用&quot;</span><span class="op">);</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>shortcutManager<span class="op">.</span><span class="fu">removeDynamicShortcuts</span><span class="op">(</span>idList<span class="op">);</span></span></code></pre></div>
<h4 id="pinned-shortcuts">Pinned Shortcuts</h4>
<p>给Shortcuts条目生成应用图标放到桌面，Android8.0加入的功能</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ShortcutManager shortcutManager <span class="op">=</span> <span class="fu">getSystemService</span><span class="op">(</span>ShortcutManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>shortcutManager<span class="op">.</span><span class="fu">isRequestPinShortcutSupported</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//对于设置为enabled的已存在的shortcut，可以直接通过id获取</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//但如果是新建一个shortcut，就要指定id、shortLabel、intent</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//这里假设id为my-shortcut的shortcut已存在且为enabled</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    ShortcutInfo pinShortcutInfo <span class="op">=</span> <span class="kw">new</span> ShortcutInfo<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="st">&quot;my-shortcut&quot;</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//当用户尝试给shortcut创建桌面快捷方式时，我们要通过程序检测是否运行用户创建，这时就要用回调</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//对应的context需要重写createShortcutResultIntent()，并在该函数中处理回调</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    Intent pinnedShortcutCallbackIntent <span class="op">=</span> shortcutManager<span class="op">.</span><span class="fu">createShortcutResultIntent</span><span class="op">(</span>pinShortcutInfo<span class="op">);</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    PendingIntent successCallback <span class="op">=</span> PendingIntent<span class="op">.</span><span class="fu">getActivity</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> pinnedShortcutCallbackIntent<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    shortcutManager<span class="op">.</span><span class="fu">requestPinShortcut</span><span class="op">(</span>pinShortcutInfo<span class="op">,</span> successCallback<span class="op">.</span><span class="fu">getIntentSender</span><span class="op">());</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>对于<code>Pinned Shortcuts</code>，只能由用户删除，我们没有权限删除，但我们可以禁用</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>ShortcutManager shortcutManager <span class="op">=</span> <span class="fu">getSystemService</span><span class="op">(</span>ShortcutManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="bu">List</span><span class="op">&lt;</span>ShortcutInfo<span class="op">&gt;</span> infoList <span class="op">=</span> shortcutManager<span class="op">.</span><span class="fu">getPinnedShortcuts</span><span class="op">();</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> idList <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>ShortcutInfo info <span class="op">:</span> infoList<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    idList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>info<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>shortcutManager<span class="op">.</span><span class="fu">disableShortcuts</span><span class="op">(</span>idList<span class="op">,</span> <span class="st">&quot;已失效&quot;</span><span class="op">);</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">//虽然用了remove，但实际上只是禁用了</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>shortcutManager<span class="op">.</span><span class="fu">removeDynamicShortcuts</span><span class="op">(</span>idList<span class="op">);</span></span></code></pre></div>
<h2 id="布局方式">布局方式</h2>
<p>布局的通用属性： - layout_margin：外边距 - layout_padding：内边距 -
layout_width/height：宽高 - gravity：组件内容的对齐方式 -
layout_gravity：自身相对于父元素的布局</p>
<h3 id="linearlayout">LinearLayout</h3>
<ul>
<li>android:orientation=“vertical|horizontal: 方向控制</li>
<li>android:gravity=“center|center_vertical|center_horizontal|top|bottom|left|right:
控制内部控件对齐方式</li>
<li>android:layout_weight:
设置当前控件在父布局中的比例，使用时一般要把对应的weight或height设置为零</li>
</ul>
<h3 id="relativelayout">RelativeLayout</h3>
<p>常用的属性有</p>
<p>1、相对于父控件 - android:layout_alignParentTop
控件的顶部与父控件的顶部对齐; - android:layout_alignParentBottom
控件的底部与父控件的底部对齐; - android:layout_alignParentLeft
控件的左部与父控件的左部对齐; - android:layout_alignParentRight
控件的右部与父控件的右部对齐; - layout_alignParentStart
控件与父控件的开始位置对齐 - layout_alignParentStop
控件与父控件的结束位置对齐</p>
<p>2、相对给定ID控件 - layout_above 控件的底部置于给定ID的控件之上; -
android:layout_below 控件的底部置于给定ID的控件之下; -
android:layout_toLeftOf 控件的右边缘与给定ID的控件左边缘对齐; -
android:layout_toRightOf 控件的左边缘与给定ID的控件右边缘对齐; -
android:layout_alignBaseline 控件的baseline与给定ID的baseline对齐; -
android:layout_alignTop 控件的顶部边缘与给定ID的顶部边缘对齐; -
android:layout_alignBottom 控件的底部边缘与给定ID的底部边缘对齐; -
android:layout_alignLeft 控件的左边缘与给定ID的左边缘对齐; -
android:layout_alignRight 控件的右边缘与给定ID的右边缘对齐; -
layout_alignStart 控件与给定ID的开始位置对齐 - layout_alignStop
控件与给定ID的结束位置对齐</p>
<p>3、居中 - android:layout_centerHorizontal 水平居中; -
android:layout_centerVertical 垂直居中; - android:layout_centerInParent
父控件的中央;</p>
<h3 id="framelayout">FrameLayout</h3>
<p>从屏幕左上角按照层次堆叠方式布局，后面的控件覆盖前面的控件</p>
<h3 id="absolutelayout">AbsoluteLayout</h3>
<p>通过<code>android:layout_x</code>和<code>android:layout_y</code>，设置坐标，屏幕左上角为坐标(0,0)</p>
<h3 id="constraintlayout">ConstraintLayout</h3>
<p>AbsoluteLayout的替代品，对于Android
Studio的拖拽控件有较好的支持，使用前需添加依赖</p>
<pre><code>dependencies {
    compile &#39;com.android.support.constraint:constraint-layout:1.0.2&#39;
}</code></pre>
<h3 id="tablelayout">TableLayout</h3>
<p>由多个TableRow组成，一个TableRow由若干个view组成；TableLayout常用属性有
- android:shrinkColumns 设置可收缩的列，内容过多就收缩显示到第二行;; -
android:stretchColumns 设置可伸展的列，将空白区域填充满整个列; -
android:collapseColumns 设置要隐藏的列;</p>
<p>子控件常用属性： - android:layout_column 第几列; -
android:layout_span 占据列数;</p>
<h3 id="gridlayout">GridLayout</h3>
<p>网格布局，常用属性有 - android:rowCount 设置行数 -
android:columnCount 设置列数 - android:layout_row 组件在第几行 -
android:layout_column 组件在第几列 - android:layout_rowSpan 组件横跨几行
- android:layout_columnSpan 组件横跨几列 - android:layout_gravity =
“fill” 组件横跨几行或列后，需要加上填充属性</p>
<h3 id="drawerlayout">DrawerLayout</h3>
<p>抽屉布局，用于侧滑菜单(该布局在v4包:<code>android.support.v4.widget.DrawerLayout</code>)，里面一般使用<a href="https://developer.android.com/training/implementing-navigation/nav-drawer#java"><code>NavigationView</code></a>来实现菜单项</p>
<ul>
<li>监听事件:
<code>setDrawerListener(DrawerLayout.DrawerListener)</code>，一般用其实现类<code>ActionBarDrawerToggle</code>或<code>DrawerLayout.SimpleDrawerListener</code></li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">class</span> DrawerMenuToggle <span class="kw">extends</span> ActionBarDrawerToggle<span class="op">{</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">DrawerMenuToggle</span><span class="op">(</span>Activity activity<span class="op">,</span> DrawerLayout drawerLayout<span class="op">,</span> <span class="dt">int</span> drawerImageRes<span class="op">,</span> <span class="dt">int</span> openDrawerContentDescRes<span class="op">,</span> <span class="dt">int</span> closeDrawerContentDescRes<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span>activity<span class="op">,</span> drawerLayout<span class="op">,</span> drawerImageRes<span class="op">,</span> openDrawerContentDescRes<span class="op">,</span>closeDrawerContentDescRes<span class="op">);</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">//当侧滑菜单达到完全关闭的状态时，回调这个方法</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onDrawerClosed</span><span class="op">(</span><span class="bu">View</span> view<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onDrawerClosed</span><span class="op">(</span>view<span class="op">);</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">invalidateOptionsMenu</span><span class="op">();</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//当侧滑菜单完全打开时，这个方法被回调</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onDrawerOpened</span><span class="op">(</span><span class="bu">View</span> drawerView<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onDrawerOpened</span><span class="op">(</span>drawerView<span class="op">);</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">invalidateOptionsMenu</span><span class="op">();</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>要让DrawerLayout正常显示，需要在Activity的生命周期中做相应处理</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ActionBarDrawerToggle mDrawerToggle<span class="op">;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>DrawerLayout mDrawerLayout<span class="op">;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="bu">ListView</span> menuDrawer<span class="op">;</span><span class="co">//这里使用ListView显示菜单项</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onPostCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onPostCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    mDrawerToggle<span class="op">.</span><span class="fu">syncState</span><span class="op">();</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onConfigurationChanged</span><span class="op">(</span><span class="bu">Configuration</span> newConfig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onConfigurationChanged</span><span class="op">(</span>newConfig<span class="op">);</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    mDrawerToggle<span class="op">.</span><span class="fu">onConfigurationChanged</span><span class="op">(</span>newConfig<span class="op">);</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onCreateOptionsMenu</span><span class="op">(</span><span class="bu">Menu</span> menu<span class="op">)</span> <span class="op">{</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">getMenuInflater</span><span class="op">().</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">menu</span><span class="op">.</span><span class="fu">main</span><span class="op">,</span> menu<span class="op">);</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onOptionsItemSelected</span><span class="op">(</span><span class="bu">MenuItem</span> item<span class="op">)</span> <span class="op">{</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id <span class="op">=</span> item<span class="op">.</span><span class="fu">getItemId</span><span class="op">();</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>mDrawerToggle<span class="op">.</span><span class="fu">onOptionsItemSelected</span><span class="op">(</span>item<span class="op">))</span> <span class="op">{</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onOptionsItemSelected</span><span class="op">(</span>item<span class="op">);</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="co">//每次调用 invalidateOptionsMenu() ，下面的这个方法就会被回调</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="co">//之前在侧滑菜单的状态监听器中打开和关闭事件都调用了invalidateOptionsMenu()方法</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onPrepareOptionsMenu</span><span class="op">(</span><span class="bu">Menu</span> menu<span class="op">)</span> <span class="op">{</span></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">boolean</span> drawerOpen <span class="op">=</span> mDrawerLayout<span class="op">.</span><span class="fu">isDrawerOpen</span><span class="op">(</span>menuDrawer<span class="op">);</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">//对其他控件，如ActionBar做相应处理</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onPrepareOptionsMenu</span><span class="op">(</span>menu<span class="op">);</span></span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a><span class="co">//当按下返回功能键的时候，不是直接对Activity进行弹栈，而是先将菜单视图关闭</span></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onBackPressed</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">boolean</span> drawerState <span class="op">=</span>  mDrawerLayout<span class="op">.</span><span class="fu">isDrawerOpen</span><span class="op">(</span>menuDrawer<span class="op">);</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>drawerState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>        mDrawerLayout<span class="op">.</span><span class="fu">closeDrawers</span><span class="op">();</span></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onBackPressed</span><span class="op">();</span></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="slidingpanelayout">SlidingPaneLayout</h3>
<p>也是v4包中的布局，和DrawerLayout相似，但它可以指定两个子布局，第一个子布局就是侧滑菜单，第二个子布局是正常视图，下面是一个SlidingPaneLayout
+ ViewPager + Fragment + RadioGroup的例子</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">android.support.v4.widget.SlidingPaneLayout</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  xmlns:tools=</span><span class="st">&quot;http://schemas.android.com/tools&quot;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="ot">  android:layout_height=</span><span class="st">&quot;match_parent&quot;</span>&gt;</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">RelativeLayout</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="ot">      android:layout_width=</span><span class="st">&quot;250dp&quot;</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="ot">      android:layout_height=</span><span class="st">&quot;match_parent&quot;</span>&gt;</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">TextView</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:gravity=</span><span class="st">&quot;center&quot;</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:text=</span><span class="st">&quot;这是侧滑菜单&quot;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:textSize=</span><span class="st">&quot;30sp&quot;</span>/&gt;</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">RelativeLayout</span>&gt;</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">RelativeLayout</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="ot">      android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="ot">      android:layout_height=</span><span class="st">&quot;match_parent&quot;</span>&gt;</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">RadioGroup</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:layout_height=</span><span class="st">&quot;60dp&quot;</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:id=</span><span class="st">&quot;@+id/rg&quot;</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:orientation=</span><span class="st">&quot;horizontal&quot;</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:layout_alignParentBottom=</span><span class="st">&quot;true&quot;</span>&gt;</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>          &lt;<span class="kw">RadioButton</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="ot">              style=</span><span class="st">&quot;@style/bt&quot;</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="ot">              android:text=</span><span class="st">&quot;Red&quot;</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="ot">              android:checked=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="ot">              android:id=</span><span class="st">&quot;@+id/red_bt&quot;</span> /&gt;</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>          &lt;<span class="kw">RadioButton</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="ot">              style=</span><span class="st">&quot;@style/bt&quot;</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="ot">              android:text=</span><span class="st">&quot;Green&quot;</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="ot">              android:id=</span><span class="st">&quot;@+id/green_bt&quot;</span>/&gt;</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>          &lt;<span class="kw">RadioButton</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="ot">              style=</span><span class="st">&quot;@style/bt&quot;</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="ot">              android:text=</span><span class="st">&quot;Blue&quot;</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="ot">              android:id=</span><span class="st">&quot;@+id/blue_bt&quot;</span>/&gt;</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>      &lt;/<span class="kw">RadioGroup</span>&gt;</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">android.support.v4.view.ViewPager</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:layout_above=</span><span class="st">&quot;@id/rg&quot;</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="ot">          android:id=</span><span class="st">&quot;@+id/frag_vp&quot;</span>/&gt;</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">RelativeLayout</span>&gt;</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">android.support.v4.widget.SlidingPaneLayout</span>&gt;</span></code></pre></div>
<h2 id="sharepreference">SharePreference</h2>
<p>编辑SharePreference</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">MODE_APPEND: 追加方式存储</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">MODE_PRIVATE: 私有方式存储,其他应用无法访问</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">MODE_WORLD_READABLE: 表示当前文件可以被其他应用读取</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">MODE_WORLD_WRITEABLE: 表示当前文件可以被其他应用写入</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>SharedPreferences sharedPreferences <span class="op">=</span> <span class="fu">getSharedPreferences</span><span class="op">(</span><span class="st">&quot;filename&quot;</span><span class="op">,</span> <span class="bu">Context</span><span class="op">.</span><span class="fu">MODE_PRIVATE</span><span class="op">);</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>Editor editor <span class="op">=</span> sharedPreferences<span class="op">.</span><span class="fu">edit</span><span class="op">();</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>editor<span class="op">.</span><span class="fu">putString</span><span class="op">(</span><span class="st">&quot;key&quot;</span><span class="op">,</span> <span class="st">&quot;value&quot;</span><span class="op">);</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>editor<span class="op">.</span><span class="fu">putInt</span><span class="op">(</span><span class="st">&quot;num&quot;</span><span class="op">,</span> <span class="dv">1234</span><span class="op">);</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>editor<span class="op">.</span><span class="fu">commit</span><span class="op">();</span><span class="co">//提交</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>sharedPreferences<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;key&quot;</span><span class="op">,</span> <span class="st">&quot;&quot;</span><span class="op">);</span><span class="co">//第二个参数为如果key字段不存在时的默认返回值</span></span></code></pre></div>
<p>删除SharedPreferences产生的文件</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">File</span> file<span class="op">=</span> <span class="kw">new</span> <span class="bu">File</span><span class="op">(</span><span class="st">&quot;/data/data/&quot;</span><span class="op">+</span><span class="fu">getPackageName</span><span class="op">().</span><span class="fu">toString</span><span class="op">()+</span><span class="st">&quot;/shared_prefs&quot;</span><span class="op">,</span><span class="st">&quot;filename.xml&quot;</span><span class="op">);</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>file<span class="op">.</span><span class="fu">exists</span><span class="op">()){</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    file<span class="op">.</span><span class="fu">delete</span><span class="op">();</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>访问其他应用的SharedPreferences（要求要访问的应用的Preference创建时指定了Context.MODE_WORLD_READABLE或者Context.MODE_WORLD_WRITEABLE权限）</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">//创建其他应用的Context，通过该Context获取SharedPreferences</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Context</span> otherAppsContext <span class="op">=</span> <span class="fu">createPackageContext</span><span class="op">(</span><span class="st">&quot;com.myapp.app&quot;</span><span class="op">,</span> <span class="bu">Context</span><span class="op">.</span><span class="fu">CONTEXT_IGNORE_SECURITY</span><span class="op">);</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>SharedPreferences sharedPreferences <span class="op">=</span> otherAppsContext<span class="op">.</span><span class="fu">getSharedPreferences</span><span class="op">(</span><span class="st">&quot;filename&quot;</span><span class="op">,</span> <span class="bu">Context</span><span class="op">.</span><span class="fu">MODE_WORLD_READABLE</span><span class="op">);</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">//也可以通过直接读取xml来获取其他应用的SharedPreferences</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="bu">File</span> xmlFile <span class="op">=</span> <span class="kw">new</span> <span class="bu">File</span><span class="op">(</span>“<span class="op">/</span>data<span class="op">/</span>data<span class="op">/</span>com<span class="op">.</span><span class="fu">otherapp</span><span class="op">.</span><span class="fu">app</span><span class="op">/</span>shared_prefs<span class="op">/</span>filename<span class="op">.</span><span class="fu">xml</span>”<span class="op">);</span></span></code></pre></div>
<h2 id="内外部存储">内外部存储</h2>
<p>内部存储：</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">//路径为/data/data/package_name/files</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="bu">FileOutputStream</span> fos <span class="op">=</span> <span class="fu">openFileOutput</span><span class="op">(</span>fileName<span class="op">,</span>MODE_PRIVATE<span class="op">);</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="bu">FileInputStream</span> fin <span class="op">=</span> <span class="fu">openFileInput</span><span class="op">(</span>fileName<span class="op">);</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> filePath <span class="op">=</span> <span class="fu">getFilesDir</span><span class="op">()+</span><span class="bu">File</span><span class="op">.</span><span class="fu">separator</span><span class="op">+</span><span class="st">&quot;filename.txt&quot;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">//路径为/data/data/package_name/cache，若设备内部存储空间不足时，系统会自动删掉该文件夹下的文件</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> cachePath <span class="op">=</span> <span class="fu">getCacheDir</span><span class="op">()+</span><span class="bu">File</span><span class="op">.</span><span class="fu">separator</span><span class="op">+</span><span class="st">&quot;cachefile&quot;</span></span></code></pre></div>
<p>外部存储：</p>
<p>用到的权限有</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">uses-permission</span><span class="ot"> android:name=</span><span class="st">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span>&gt;&lt;/<span class="kw">uses-permission</span>&gt;</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">uses-permission</span><span class="ot"> android:name=</span><span class="st">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>&gt;&lt;/<span class="kw">uses-permission</span>&gt;</span></code></pre></div>
<p>java代码：</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">//路径为/mnt/sdcard</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Environment</span><span class="op">.</span><span class="fu">getExternalStorageDirectory</span><span class="op">();</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">//路径为/mnt/sdcard/Android/data/package_name/files，app被删除时，该文件夹也一并清空；如果参数非null，则得到的是files下的子文件夹的路径</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">getExternalFilesDir</span><span class="op">(</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">//路径为/mnt/sdcard/Android/data/package_name/cache</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getExternalCacheDir</span><span class="op">();</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co">//一般要先判断是否有sd卡</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span><span class="bu">Environment</span><span class="op">.</span><span class="fu">getExternalStorageState</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="bu">Environment</span><span class="op">.</span><span class="fu">MEDIA_MOUNTED</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//SD卡已装入</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="数据库">数据库</h2>
<p>继承SQLiteOpenHelper，重写onCreate、onUpgrade，然后通过自己的SQLiteOpenHelper获取SQLiteDatabase，进行数据库操作</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyDataBaseHelper <span class="kw">extends</span> SQLiteOpenHelper <span class="op">{</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> CREATE_BOOK <span class="op">=</span> <span class="st">&quot;create table Book(&quot;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="st">&quot;id integer primary key autoincrement,&quot;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="st">&quot;author text,&quot;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="st">&quot;price real,&quot;</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="st">&quot;pages integer,&quot;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="st">&quot;name text)&quot;</span><span class="op">;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> CREATE_CATEGORY <span class="op">=</span> <span class="st">&quot;create table Category (&quot;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="st">&quot;id integer primary key autoincrement, &quot;</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="st">&quot;category_name text, &quot;</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="st">&quot;category_code integer)&quot;</span><span class="op">;</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">Context</span> mContext<span class="op">;</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MyDataBaseHelper</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> <span class="bu">String</span> name<span class="op">,</span> SQLiteDatabase<span class="op">.</span><span class="fu">CursorFactory</span> factory<span class="op">,</span> <span class="dt">int</span> version<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span>context<span class="op">,</span> name<span class="op">,</span> factory<span class="op">,</span> version<span class="op">);</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        mContext <span class="op">=</span> context<span class="op">;</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>SQLiteDatabase db<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>        db<span class="op">.</span><span class="fu">execSQL</span><span class="op">(</span>CREATE_BOOK<span class="op">);</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>        Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span>mContext<span class="op">,</span> <span class="st">&quot;创建数据库成功！&quot;</span><span class="op">,</span> Toast<span class="op">.</span><span class="fu">LENGTH_SHORT</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">//当数据库版本号不一样的时候调用，一般是app升级后使用</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onUpgrade</span><span class="op">(</span>SQLiteDatabase db<span class="op">,</span> <span class="dt">int</span> oldVersion<span class="op">,</span> <span class="dt">int</span> newVersion<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>        db<span class="op">.</span><span class="fu">execSQL</span><span class="op">(</span><span class="st">&quot;drop table if exists Book&quot;</span><span class="op">);</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>        db<span class="op">.</span><span class="fu">execSQL</span><span class="op">(</span><span class="st">&quot;drop table if exists Category&quot;</span><span class="op">);</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">onCreate</span><span class="op">(</span>db<span class="op">);</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>使用：</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>MyDataBaseHelper dbHelper <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyDataBaseHelper</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span><span class="st">&quot;BookStore.db&quot;</span><span class="op">,</span><span class="kw">null</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">//当磁盘没有满的时候getWritableDatabase和getReadableDatabase返回的实例都是可读可写的，没有区别；只有当磁盘满了的时候，打开数据库失败，这时getReadableDatabase会继续尝试以只读方式打开数据库，而getWritableDatabase就会直接报错</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>SQLiteDatabase db <span class="op">=</span> dbHelper<span class="op">.</span><span class="fu">getWritableDatabase</span><span class="op">();</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>ContentValues values <span class="op">=</span> <span class="kw">new</span> <span class="fu">ContentValues</span><span class="op">();</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co">//插入数据</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">//如果insert的第三个参数为空，则表示插入一条除主键值以外其他字段为Null值的记录，为了满足SQL语法的需要， insert语句必须给定一个字段名，如：insert into person(name) values(NULL)，倘若不给定字段名 ， insert语句就成了这样： insert into person() values()，显然这不满足标准SQL的语法，所以第二个参数就是用来指定这种时候空字段的名称的，如果第三个参数values不为null，则可以把第二个参数设置为null</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">// 开始组装第一条数据</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;The Da Vinci Code&quot;</span><span class="op">);</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;author&quot;</span><span class="op">,</span> <span class="st">&quot;Dan Brown&quot;</span><span class="op">);</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;pages&quot;</span><span class="op">,</span> <span class="dv">454</span><span class="op">);</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;price&quot;</span><span class="op">,</span> <span class="fl">16.96</span><span class="op">);</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> rowid <span class="op">=</span> db<span class="op">.</span><span class="fu">insert</span><span class="op">(</span><span class="st">&quot;Book&quot;</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> values<span class="op">);</span><span class="co">//返回新添记录的行号,与主键id无关</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">clear</span><span class="op">();</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co">// 开始组装第二条数据</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;The Lost Symbol&quot;</span><span class="op">);</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;author&quot;</span><span class="op">,</span> <span class="st">&quot;Dan Brown&quot;</span><span class="op">);</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;pages&quot;</span><span class="op">,</span> <span class="dv">510</span><span class="op">);</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;price&quot;</span><span class="op">,</span> <span class="fl">19.95</span><span class="op">);</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>rowid <span class="op">=</span> db<span class="op">.</span><span class="fu">insert</span><span class="op">(</span>“Book”<span class="op">,</span><span class="kw">null</span><span class="op">,</span>values<span class="op">);</span><span class="co">//返回新添记录的行号,与主键id无关</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">clear</span><span class="op">();</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="co">//修改数据</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;price&quot;</span><span class="op">,</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">update</span><span class="op">(</span><span class="st">&quot;Book&quot;</span><span class="op">,</span>values<span class="op">,</span><span class="st">&quot;name = ?&quot;</span><span class="op">,</span><span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="st">&quot;The Da Vinci Code&quot;</span><span class="op">});</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>values<span class="op">.</span><span class="fu">clear</span><span class="op">();</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="co">//删除数据</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">delete</span><span class="op">(</span><span class="st">&quot;Book&quot;</span><span class="op">,</span><span class="st">&quot;page &gt; ?&quot;</span><span class="op">,</span><span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="st">&quot;500&quot;</span><span class="op">});</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="co">//查询数据</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="co">//query(table, columns, selection, selectionArgs, groupBy, having, orderBy, limit)</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="co">//从Book表中查询name字段中含有&quot;The&quot;的记录，按price降序，并对排序的结果跳过第一条记录，最多只获取五条记录</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="bu">Cursor</span> cursor <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span><span class="op">(</span><span class="st">&quot;Book&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="st">&quot;name&quot;</span><span class="op">,</span><span class="st">&quot;author&quot;</span><span class="op">,</span><span class="st">&quot;pages&quot;</span><span class="op">,</span><span class="st">&quot;price&quot;</span><span class="op">},</span> <span class="st">&quot;name like ?&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="st">&quot;%The%&quot;</span><span class="op">},</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="st">&quot;price desc&quot;</span><span class="op">,</span><span class="st">&quot;1,5&quot;</span><span class="op">);</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>cursor<span class="op">.</span><span class="fu">moveToFirst</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span> <span class="op">{</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 遍历Cursor对象，取出数据并打印</span></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> name <span class="op">=</span> cursor<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;name&quot;</span><span class="op">));</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> author <span class="op">=</span> cursor<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;author&quot;</span><span class="op">));</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pages <span class="op">=</span> cursor<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;pages&quot;</span><span class="op">));</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> price <span class="op">=</span> cursor<span class="op">.</span><span class="fu">getDouble</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;price&quot;</span><span class="op">));</span></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">while</span> <span class="op">(</span>cursor<span class="op">.</span><span class="fu">moveToNext</span><span class="op">());</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="co">//关闭表指针</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>cursor<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a><span class="co">//关闭数据库</span></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">close</span><span class="op">()</span></span></code></pre></div>
<p>事务处理：</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>MyDataBaseHelper dbHelper <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyDataBaseHelper</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span><span class="st">&quot;BookStore.db&quot;</span><span class="op">,</span><span class="kw">null</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>SQLiteDatabase db <span class="op">=</span> dbHelper<span class="op">.</span><span class="fu">getWritableDatabase</span><span class="op">();</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">beginTransaction</span><span class="op">();</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span><span class="op">{</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    db<span class="op">.</span><span class="fu">execSQL</span><span class="op">(</span><span class="st">&quot;update Book set price=18.4 where name=?&quot;</span><span class="op">,</span><span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="st">&quot;The Da Vinci Code&quot;</span><span class="op">});</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">/</span><span class="dv">0</span><span class="op">;</span><span class="co">//故意设置一个异常</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    db<span class="op">.</span><span class="fu">execSQL</span><span class="op">(</span><span class="st">&quot;update Book set price=20.3 where name=?&quot;</span><span class="op">,</span><span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="st">&quot;The Lost Symbol&quot;</span><span class="op">});</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    db<span class="op">.</span><span class="fu">setTransactionSuccessful</span><span class="op">();</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">Exception</span> e<span class="op">){</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">finally</span><span class="op">{</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    db<span class="op">.</span><span class="fu">endTransaction</span><span class="op">();</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span></code></pre></div>
<h2 id="网络">网络</h2>
<p>用到的权限</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">user-permission</span><span class="ot"> android:name=</span><span class="st">&quot;android.permission.INTERNET&quot;</span>/&gt;</span></code></pre></div>
<h3 id="httpclient"><del>HttpClient</del></h3>
<p>HttpClient在Android6.0以上已被移除，但仍然可以通过Apache提供的jar包来使用，在<code>build.gradle</code>中配置</p>
<pre><code>android {
    useLibrary &#39;org.apache.http.legacy&#39;
}</code></pre>
<p>Get请求：</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>HttpClient httpCient <span class="op">=</span> <span class="kw">new</span> <span class="fu">DefaultHttpClient</span><span class="op">();</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>HttpParams params <span class="op">=</span> httpClient<span class="op">.</span><span class="fu">getParams</span><span class="op">();</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>HttpConnectionParams<span class="op">.</span><span class="fu">setConnectionTimeout</span><span class="op">(</span>params<span class="op">,</span><span class="dv">5000</span><span class="op">);</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>HttpGet httpGet <span class="op">=</span> <span class="kw">new</span> <span class="fu">HttpGet</span><span class="op">(</span><span class="st">&quot;http://www.baidu.com&quot;</span><span class="op">);</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span><span class="op">{</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    HttpResponse httpResponse <span class="op">=</span> httpCient<span class="op">.</span><span class="fu">execute</span><span class="op">(</span>httpGet<span class="op">);</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>httpResponse<span class="op">.</span><span class="fu">getStatusLine</span><span class="op">().</span><span class="fu">getStatusCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">200</span><span class="op">){</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        HttpEntity entity <span class="op">=</span> httpResponse<span class="op">.</span><span class="fu">getEntity</span><span class="op">();</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> response <span class="op">=</span> EntityUtils<span class="op">.</span><span class="fu">toString</span><span class="op">(</span>entity<span class="op">,</span><span class="st">&quot;utf-8&quot;</span><span class="op">);</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">Exception</span> e<span class="op">){</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">finally</span><span class="op">{</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    httpClient<span class="op">.</span><span class="fu">getConnectionManager</span><span class="op">().</span><span class="fu">shutdown</span><span class="op">();</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Post请求：</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>HttpClient httpCient <span class="op">=</span> <span class="kw">new</span> <span class="fu">DefaultHttpClient</span><span class="op">();</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>HttpParams params <span class="op">=</span> httpClient<span class="op">.</span><span class="fu">getParams</span><span class="op">();</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>HttpConnectionParams<span class="op">.</span><span class="fu">setConnectionTimeout</span><span class="op">(</span>params<span class="op">,</span><span class="dv">5000</span><span class="op">);</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="bu">List</span><span class="op">&lt;</span><span class="bu">NameValuePair</span><span class="op">&gt;</span> list <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">NameValuePair</span><span class="op">&gt;();</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>list<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">BasicNameValuePair</span><span class="op">(</span><span class="st">&quot;key&quot;</span><span class="op">,</span> <span class="st">&quot;value&quot;</span><span class="op">));</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> result <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span><span class="op">{</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    UrlEncodedFormEntity entity <span class="op">=</span> <span class="kw">new</span> <span class="fu">UrlEncodedFormEntity</span><span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;UTF-8&quot;</span><span class="op">);</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    HttpPost httpPost <span class="op">=</span> <span class="kw">new</span> <span class="fu">HttpPost</span><span class="op">(</span><span class="st">&quot;http://127.0.0.1&quot;</span><span class="op">);</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    httpPost<span class="op">.</span><span class="fu">setEntity</span><span class="op">(</span>entity<span class="op">);</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    HttpResponse httpResponse <span class="op">=</span> client<span class="op">.</span><span class="fu">execute</span><span class="op">(</span>httpPost<span class="op">);</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>httpResponse<span class="op">.</span><span class="fu">getStatusLine</span><span class="op">().</span><span class="fu">getStatusCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">200</span><span class="op">){</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">InputStream</span> inputStream <span class="op">=</span> httpResponse<span class="op">.</span><span class="fu">getEntity</span><span class="op">().</span><span class="fu">getContent</span><span class="op">();</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">ByteArrayOutputStream</span> outputStream <span class="op">=</span> <span class="kw">new</span> <span class="bu">ByteArrayOutputStream</span><span class="op">();</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> data <span class="op">=</span> <span class="kw">new</span> <span class="dt">byte</span><span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> len <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>inputStream <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">((</span>len <span class="op">=</span> inputStream<span class="op">.</span><span class="fu">read</span><span class="op">(</span>data<span class="op">))</span> <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>                    outputStream<span class="op">.</span><span class="fu">write</span><span class="op">(</span>data<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> len<span class="op">);</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">(</span>outputStream<span class="op">.</span><span class="fu">toByteArray</span><span class="op">(),</span> <span class="st">&quot;UTF-8&quot;</span><span class="op">);</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">Exception</span> e<span class="op">){}</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">Exception</span> e<span class="op">){</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">finally</span><span class="op">{</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>    httpClient<span class="op">.</span><span class="fu">getConnectionManager</span><span class="op">().</span><span class="fu">shutdown</span><span class="op">();</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="httpurlconnection">HttpUrlConnection</h3>
<p>GET请求：</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">HttpURLConnection</span> connection <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">BufferedReader</span> reader <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> result <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span><span class="op">{</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">URL</span> url <span class="op">=</span> <span class="kw">new</span> <span class="bu">URL</span><span class="op">(</span><span class="st">&quot;http://127.0.0.1&quot;</span><span class="op">);</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    connection <span class="op">=</span> <span class="op">(</span><span class="bu">HttpURLConnection</span><span class="op">)</span>url<span class="op">.</span><span class="fu">openConnection</span><span class="op">();</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">.</span><span class="fu">setRequestMethod</span><span class="op">(</span><span class="st">&quot;GET&quot;</span><span class="op">);</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">.</span><span class="fu">setConnectTimeout</span><span class="op">(</span><span class="dv">8000</span><span class="op">);</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">.</span><span class="fu">setReadTimeout</span><span class="op">(</span><span class="dv">8000</span><span class="op">);</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">.</span><span class="fu">setRequestProperty</span><span class="op">(</span><span class="st">&quot;Cookie&quot;</span><span class="op">,</span> <span class="st">&quot;AppName=&quot;</span> <span class="op">+</span> <span class="bu">URLEncoder</span><span class="op">.</span><span class="fu">encode</span><span class="op">(</span><span class="st">&quot;你好&quot;</span><span class="op">,</span> <span class="st">&quot;UTF-8&quot;</span><span class="op">));</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>connection<span class="op">.</span><span class="fu">getResponseCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">200</span><span class="op">){</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">InputStream</span> in <span class="op">=</span> connection<span class="op">.</span><span class="fu">getInputStream</span><span class="op">();</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>        reader <span class="op">=</span> <span class="kw">new</span> <span class="bu">BufferedReader</span><span class="op">(</span><span class="kw">new</span> <span class="bu">InputStreamReader</span><span class="op">(</span>in<span class="op">));</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">StringBuilder</span> response <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringBuilder</span><span class="op">();</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> line<span class="op">;</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">((</span>line <span class="op">=</span> reader<span class="op">.</span><span class="fu">readLine</span><span class="op">())</span> <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>                response<span class="op">.</span><span class="fu">append</span><span class="op">(</span>line<span class="op">);</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> response<span class="op">.</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">Exception</span> e<span class="op">){</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">finally</span><span class="op">{</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>reader <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>            reader<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">IOException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>            e<span class="op">.</span><span class="fu">printStackTrace</span><span class="op">();</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>connection <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>        connection<span class="op">.</span><span class="fu">disconnect</span><span class="op">();</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>POST请求：</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="bu">HttpURLConnection</span> connection <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="bu">BufferedReader</span> reader <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> result <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span><span class="op">{</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">URL</span> url <span class="op">=</span> <span class="kw">new</span> <span class="bu">URL</span><span class="op">(</span><span class="st">&quot;http://127.0.0.1&quot;</span><span class="op">);</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    connection <span class="op">=</span> <span class="op">(</span><span class="bu">HttpURLConnection</span><span class="op">)</span>url<span class="op">.</span><span class="fu">openConnection</span><span class="op">();</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">.</span><span class="fu">setRequestMethod</span><span class="op">(</span><span class="st">&quot;POST&quot;</span><span class="op">);</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">.</span><span class="fu">setConnectTimeout</span><span class="op">(</span><span class="dv">8000</span><span class="op">);</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">.</span><span class="fu">setReadTimeout</span><span class="op">(</span><span class="dv">8000</span><span class="op">);</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">.</span><span class="fu">setDoOutput</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">FileInputStream</span> file <span class="op">=</span> <span class="kw">new</span> <span class="bu">FileInputStream</span><span class="op">(</span><span class="st">&quot;filename.png&quot;</span><span class="op">);</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">OutputStream</span> os <span class="op">=</span> connection<span class="op">.</span><span class="fu">getOutputStream</span><span class="op">();</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">((</span>count <span class="op">=</span> file<span class="op">.</span><span class="fu">read</span><span class="op">())</span> <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">){</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>        os<span class="op">.</span><span class="fu">write</span><span class="op">(</span>count<span class="op">);</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>    os<span class="op">.</span><span class="fu">flush</span><span class="op">();</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    os<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>connection<span class="op">.</span><span class="fu">getResponseCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">200</span><span class="op">){</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">InputStream</span> in <span class="op">=</span> connection<span class="op">.</span><span class="fu">getInputStream</span><span class="op">();</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>        reader <span class="op">=</span> <span class="kw">new</span> <span class="bu">BufferedReader</span><span class="op">(</span><span class="kw">new</span> <span class="bu">InputStreamReader</span><span class="op">(</span>in<span class="op">));</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">StringBuilder</span> response <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringBuilder</span><span class="op">();</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> line<span class="op">;</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">((</span>line <span class="op">=</span> reader<span class="op">.</span><span class="fu">readLine</span><span class="op">())</span> <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>                response<span class="op">.</span><span class="fu">append</span><span class="op">(</span>line<span class="op">);</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> response<span class="op">.</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">Exception</span> e<span class="op">){</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="cf">finally</span><span class="op">{</span></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>reader <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>            reader<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">IOException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>            e<span class="op">.</span><span class="fu">printStackTrace</span><span class="op">();</span></span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>connection <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a>        connection<span class="op">.</span><span class="fu">disconnect</span><span class="op">();</span></span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="https">HTTPS</h3>
<p><code>HTTPS</code>是<code>HTTP over SSL/TLS</code>，<code>HTTP</code>是应用层协议，<code>TCP</code>是传输层协议，在应用层和传输层之间，增加了一个安全套接层<code>SSL</code>/<code>TLS</code>，<code>SSL</code>/<code>TLS</code>层负责客户端和服务器之间的加解密算法协商、密钥交换、通信连接的建立，对<code>HTTP</code>而言，安全传输层是透明不可见的。</p>
<h4 id="pkicara">PKI、CA、RA</h4>
<p><strong>公钥基础设施</strong>(PKI)</p>
<p>假设现在A与B建立安全的连接进行通信</p>
<ol type="1">
<li>如果直接使用对称加密通信，那么密钥无法安全的送给B</li>
<li>如果直接使用非对称加密，A使用B的公钥加密，B使用私钥解密。但是因为B无法确保拿到的公钥就是A的公钥，因此也不能防止中间人攻击</li>
</ol>
<p>为了解决上述问题，引入了一个第三方，也就是<code>CA</code></p>
<p><strong>CA</strong>(Certificate Authority)</p>
<p><code>CA</code>用自己的私钥签发数字证书，数字证书中包含B的公钥。然后A可以用<code>CA</code>的<code>Root证书</code>（根证书）中的公钥来解密<code>CA</code>签发的证书，从而拿到合法的公钥</p>
<p>那么又引入了一个问题，如何保证<code>CA</code>的公钥是合法的呢。答案就是现代主流的浏览器会内置<code>CA</code>的证书。</p>
<p><strong>RA</strong>(Registration Authority)</p>
<p><code>RA</code>又叫中间证书，当<code>CA</code>的<code>Root证书</code>遭到破坏或者泄露时，由此<code>CA</code>颁发的其他证书就全部失去了安全性，所以现在主流的商业数字证书机构<code>CA</code>一般都是提供三级证书：<code>Root证书</code>签发中级<code>RA</code>证书，由<code>RA</code>证书签发用户使用的证书。这样<code>Root证书</code>可以离线存储来确保安全，即使<code>RA</code>证书出了问题，还可以用<code>Root证书</code>重新签署中间证书</p>
<h4 id="openssl">openssl</h4>
<p><strong>使用openssl生成自签名证书</strong></p>
<pre class="shell"><code># 使用idea加密算法生成key（我们的私钥）
openssl genrsa -idea -out xxx.key 1024
# 根据key生成csr（证书签名请求，可以理解为公钥）
openssl -req -new -key xxx.key -out xxx.csr
# 把key和csr打包成crt（CA机构通过公钥和我们上传的私钥生成crt）
openssl x509 -req -days 365 -in xxx.csr -signkey xxx.key -out xxx.crt

# 其他用法
# 去掉key中的密码（加密私钥转非加密）
openssl rsa -in xxx.key -out xxx_nopass.key
# 直接生成key和crt
openssl req -days 365 -x509 -sha256 -nodes -newkey rsa:2048 -keyout xxx.key -out xxx.crt</code></pre>
<p>验证过程：</p>
<ol type="1">
<li>客户端向服务器请求加密连接，服务器用私钥加密网页后，连同crt(证书)、及证书颁发机构等信息一起返回给客户端，客户端收到证书后先向CA确认该证书是否在CA中登记过。如果没有则提示用户证书不安全，并询问用户是否继续访问</li>
<li>如果证书安全或用户要求继续访问，则客户端把crt(证书)中的csr(公钥)取出来，然后在客户端随机生成一串密钥和一个随机的加密算法，并使用csr(公钥)加密，返回给服务器端</li>
<li>服务器端使用key(私钥)把随机秘钥和加密算法解出来</li>
<li>至此，客户端和服务器都知道一个动态生成的密钥和对应的加密算法，以后客户端和服务器数据的传输就通过该动态生成的密钥和加密算法加密</li>
</ol>
<p>说明：</p>
<ol type="1">
<li>私钥(key)：服务器端生成，服务器自己使用，用于加密和解密数据</li>
<li>公钥(csr)：服务器端生成，并上传到CA机构，由CA机构二次加密最终得到证书(crt)，用于加密和解密数据</li>
<li>证书(crt)：证书都是通过第三方认证机构颁发（比如CA机构）的，里面包含加密后的公钥，客户端把从服务器返回的证书和从CA机构获取的证书对比，确保服务器返回的证书没有被篡改</li>
</ol>
<p>在协商随机秘钥(及对应的加密算法)的过程中使用的是非对称加密，通过公钥加密的数据只能使用私钥解出来（反之亦然），协商完成后双方都知道一个随机秘钥(及对应的加密算法)，以后加密的数据都是用对称加密（加密解密用同一秘钥）</p>
<p>之所以在可以使用非对称加密来加密传输的数据的同时，还要协商一个对称加密的秘钥(及对应的加密算法)，是因为非对称加密需要复杂的计算，要消耗大量的资源，所以希望使用对称加密，但是如果直接使用静态的对称加密秘钥又无法保障秘钥安全，所以才采用通过非对称加密协商一个动态生成的对称加密秘钥(及对应的加密算法)</p>
<h4 id="https-api">HTTPS API</h4>
<h5 id="默认信任策略">默认信任策略</h5>
<div class="sourceCode" id="cb69"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="bu">URL</span> url <span class="op">=</span> <span class="kw">new</span> <span class="bu">URL</span><span class="op">(</span><span class="st">&quot;https://google.com&quot;</span><span class="op">);</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="bu">HttpsURLConnection</span> urlConnection <span class="op">=</span> url<span class="op">.</span><span class="fu">openConnection</span><span class="op">();</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="bu">InputStream</span> in <span class="op">=</span> urlConnection<span class="op">.</span><span class="fu">getInputStream</span><span class="op">();</span></span></code></pre></div>
<p>此时使用的是默认的<code>SSLSocketFactory</code>，与下段代码使用的<code>SSLContext</code>是一致的</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">synchronized</span> <span class="bu">SSLSocketFactory</span> <span class="fu">getDefaultSSLSocketFactory</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">SSLContext</span> sslContext <span class="op">=</span> <span class="bu">SSLContext</span><span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span><span class="st">&quot;TLS&quot;</span><span class="op">);</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>        sslContext<span class="op">.</span><span class="fu">init</span><span class="op">(</span><span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sslContext<span class="op">.</span><span class="fu">getSocketFactory</span><span class="op">();</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">GeneralSecurityException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">AssertionError</span><span class="op">();</span> <span class="co">// The system has no TLS. Just give up.</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>默认的<code>SSLSocketFactory</code>校验服务器的证书时，会信任设备内置的100多个根证书</p>
<p>此方法的特点：</p>
<ul>
<li>由系统校验服务端数字证书的合法性，用可信<code>CA</code>签发的数字证书的网站才可以正常访问，私有<code>CA</code>签发的数字证书的网站无法访问</li>
<li>不能抵御用户在设备上安装证书（将中间人服务器的证书放到设备的信任列表中）进行中间人攻击</li>
</ul>
<h5 id="自定义信任策略">自定义信任策略</h5>
<p>如果要使用私有<code>CA</code>签发的证书或自签名证书，必须自定义<code>sslContext</code>或直接重写校验证书链<code>TrustManager</code>(或其子类<code>X509TrustManager</code>)中的方法</p>
<p><code>TLS</code>是基于<code>X.509</code>认证的</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">synchronized</span> <span class="bu">SSLSocketFactory</span> <span class="fu">getMySSLSocketFactory</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 生成SSLContext对象</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">SSLContext</span> sslContext <span class="op">=</span> <span class="bu">SSLContext</span><span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span><span class="st">&quot;TLS&quot;</span><span class="op">);</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 从assets中加载我们自己的证书文件</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">InputStream</span> inStream <span class="op">=</span> Application<span class="op">.</span><span class="fu">getInstance</span><span class="op">().</span><span class="fu">getAssets</span><span class="op">().</span><span class="fu">open</span><span class="op">(</span><span class="st">&quot;anchor.cer&quot;</span><span class="op">);</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">CertificateFactory</span> cerFactory <span class="op">=</span> <span class="bu">CertificateFactory</span><span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span><span class="st">&quot;X.509&quot;</span><span class="op">);</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Certificate</span> cer <span class="op">=</span> cerFactory<span class="op">.</span><span class="fu">generateCertificate</span><span class="op">(</span>inStream<span class="op">);</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 密钥库，假设我们的私钥使用PKCS12打包，没有口令保护</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">KeyStore</span> keyStore <span class="op">=</span> <span class="bu">KeyStore</span><span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span><span class="st">&quot;PKCS12&quot;</span><span class="op">);</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>        keyStore<span class="op">.</span><span class="fu">load</span><span class="op">(</span><span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>        keyStore<span class="op">.</span><span class="fu">setCertificateEntry</span><span class="op">(</span><span class="st">&quot;anchor&quot;</span><span class="op">,</span> cer<span class="op">);</span><span class="co">// 加载证书到密钥库中</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 密钥管理器</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">KeyManagerFactory</span> keyFactory <span class="op">=</span> <span class="bu">KeyManagerFactory</span><span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span><span class="bu">KeyManagerFactory</span><span class="op">.</span><span class="fu">getDefaultAlgorithm</span><span class="op">());</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>        keyFactory<span class="op">.</span><span class="fu">init</span><span class="op">(</span>keyStore<span class="op">,</span> <span class="kw">null</span><span class="op">);</span><span class="co">// 加载密钥库到管理器</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 信任管理器</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">TrustManagerFactory</span> trustFactory <span class="op">=</span> <span class="bu">TrustManagerFactory</span><span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span><span class="bu">TrustManagerFactory</span><span class="op">.</span><span class="fu">getDefaultAlgorithm</span><span class="op">());</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>        trustFactory<span class="op">.</span><span class="fu">init</span><span class="op">(</span>keyStore<span class="op">);</span><span class="co">// 加载密钥库到信任管理器</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 初始化</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">//要注意的是SecureRandom在Android4.4以前有漏洞（当用户没有提供用于产生随机数的种子时，程序不能正确调整偏移量，导致伪随机数生成器(PRNG)生成随机序列的过程可被预测），在Android4.4以前的系统最好使用第三方框架（如NoHttp，已修复该漏洞），否则要自己修复这个漏洞</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>        sslContext<span class="op">.</span><span class="fu">init</span><span class="op">(</span>keyFactory<span class="op">.</span><span class="fu">getKeyManagers</span><span class="op">(),</span> trustFactory<span class="op">.</span><span class="fu">getTrustManagers</span><span class="op">(),</span> <span class="kw">new</span> <span class="bu">SecureRandom</span><span class="op">());</span></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sslContext<span class="op">.</span><span class="fu">getSocketFactory</span><span class="op">();</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">GeneralSecurityException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">AssertionError</span><span class="op">();</span> <span class="co">// The system has no TLS. Just give up.</span></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>如果要信任所有的<code>HTTPS</code>连接，可以使用<code>null</code>秘钥管理器和一个没有校验代码的<code>TrustManager</code>（不推荐）</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>sslContext <span class="op">=</span> <span class="bu">SSLContext</span><span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span><span class="st">&quot;TLS&quot;</span><span class="op">);</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>sslContext<span class="op">.</span><span class="fu">init</span><span class="op">(</span><span class="kw">null</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">TrustManager</span><span class="op">[]{</span><span class="kw">new</span> <span class="bu">X509TrustManager</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">checkClientTrusted</span><span class="op">(</span><span class="bu">X509Certificate</span><span class="op">[]</span> chain<span class="op">,</span> <span class="bu">String</span> authType<span class="op">)</span>  <span class="op">{}</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">checkServerTrusted</span><span class="op">(</span><span class="bu">X509Certificate</span><span class="op">[]</span> chain<span class="op">,</span> <span class="bu">String</span> authType<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">X509Certificate</span><span class="op">[]</span> <span class="fu">getAcceptedIssuers</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">new</span> <span class="bu">X509Certificate</span><span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="op">}},</span> <span class="kw">new</span> <span class="bu">SecureRandom</span><span class="op">());</span></span></code></pre></div>
<p>使用我们自定义的<code>SSLSocketFactory</code></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">URL</span> url <span class="op">=</span> <span class="kw">new</span> <span class="bu">URL</span><span class="op">(</span><span class="st">&quot;https://google.com&quot;</span><span class="op">);</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="bu">HttpsURLConnection</span> urlConnection <span class="op">=</span> <span class="op">(</span><span class="bu">HttpsURLConnection</span><span class="op">)</span>url<span class="op">.</span><span class="fu">openConnection</span><span class="op">();</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>urlConnection<span class="op">.</span><span class="fu">setSSLSocketFactory</span><span class="op">(</span><span class="fu">getMySSLSocketFactory</span><span class="op">());</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="bu">InputStream</span> in <span class="op">=</span> urlConnection<span class="op">.</span><span class="fu">getInputStream</span><span class="op">();</span></span></code></pre></div>
<p>在握手期间，如果 URL
的主机名和服务器的标识主机名不匹配，则验证机制可以回调<code>HostnameVerifier</code>来确定是否应该允许此连接</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="bu">HostnameVerifier</span> hostnameVerifier <span class="op">=</span> <span class="kw">new</span> <span class="bu">HostnameVerifier</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">verify</span><span class="op">(</span><span class="bu">String</span> hostname<span class="op">,</span> <span class="bu">SSLSession</span> session<span class="op">)</span> <span class="op">{</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">//使用</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>urlConnection<span class="op">.</span><span class="fu">setHostnameVerifier</span><span class="op">(</span>hostnameVerifier<span class="op">);</span></span></code></pre></div>
<h3 id="volley">Volley</h3>
<p>使用前先在build.gradle中添加依赖</p>
<pre><code>compile &#39;com.android.volley:volley:1.1.1&#39;</code></pre>
<h4 id="stringrequest">StringRequest</h4>
<p>GET请求：</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>RequestQueue mQueue <span class="op">=</span> Volley<span class="op">.</span><span class="fu">newRequestQueue</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>StringRequest stringRequest <span class="op">=</span> <span class="kw">new</span> <span class="fu">StringRequest</span><span class="op">(</span><span class="st">&quot;http://www.baidu.com&quot;</span><span class="op">,</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="bu">Response</span><span class="op">.</span><span class="fu">Listener</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onResponse</span><span class="op">(</span><span class="bu">String</span> response<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> <span class="kw">new</span> <span class="bu">Response</span><span class="op">.</span><span class="fu">ErrorListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onErrorResponse</span><span class="op">(</span>VolleyError error<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>                <span class="co">//</span><span class="al">TODO</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>mQueue<span class="op">.</span><span class="fu">add</span><span class="op">(</span>stringRequest<span class="op">);</span><span class="co">//执行请求</span></span></code></pre></div>
<p>POST请求：</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>RequestQueue mQueue <span class="op">=</span> Volley<span class="op">.</span><span class="fu">newRequestQueue</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>StringRequest stringRequest <span class="op">=</span> <span class="kw">new</span> <span class="fu">StringRequest</span><span class="op">(</span><span class="bu">Method</span><span class="op">.</span><span class="fu">POST</span><span class="op">,</span> <span class="st">&quot;http://127.0.0.1&quot;</span><span class="op">,</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="bu">Response</span><span class="op">.</span><span class="fu">Listener</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onResponse</span><span class="op">(</span><span class="bu">String</span> response<span class="op">)</span> <span class="op">{</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//重写getParams，设置POST的参数</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="bu">Map</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> <span class="fu">getParams</span><span class="op">()</span> <span class="kw">throws</span> AuthFailureError <span class="op">{</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Map</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> map <span class="op">=</span> <span class="kw">new</span> <span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;();</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>        map<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;params1&quot;</span><span class="op">,</span> <span class="st">&quot;value1&quot;</span><span class="op">);</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>        map<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;params2&quot;</span><span class="op">,</span> <span class="st">&quot;value2&quot;</span><span class="op">);</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> map<span class="op">;</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>mQueue<span class="op">.</span><span class="fu">add</span><span class="op">(</span>stringRequest<span class="op">);</span><span class="co">//执行请求</span></span></code></pre></div>
<h4 id="jsonobjectrequest">JsonObjectRequest</h4>
<div class="sourceCode" id="cb78"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>RequestQueue mQueue <span class="op">=</span> Volley<span class="op">.</span><span class="fu">newRequestQueue</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>JsonObjectRequest jsonObjectRequest <span class="op">=</span> <span class="kw">new</span> <span class="fu">JsonObjectRequest</span><span class="op">(</span><span class="st">&quot;http://127.0.0.1&quot;</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="bu">Response</span><span class="op">.</span><span class="fu">Listener</span><span class="op">&lt;</span>JSONObject<span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onResponse</span><span class="op">(</span>JSONObject response<span class="op">)</span> <span class="op">{</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> <span class="kw">new</span> <span class="bu">Response</span><span class="op">.</span><span class="fu">ErrorListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onErrorResponse</span><span class="op">(</span>VolleyError error<span class="op">)</span> <span class="op">{</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>mQueue<span class="op">.</span><span class="fu">add</span><span class="op">(</span>jsonObjectRequest<span class="op">);</span></span></code></pre></div>
<h4 id="imagerequest">ImageRequest</h4>
<div class="sourceCode" id="cb79"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>RequestQueue mQueue <span class="op">=</span> Volley<span class="op">.</span><span class="fu">newRequestQueue</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">//ImageRequest(URL,responseListener,maxwidth,maxheight,ColorProperties,errorListener)，其中maxwidth、maxheight设成0表示不限制图片大小</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>ImageRequest imageRequest <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageRequest</span><span class="op">(</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;http://127.0.0.1/pic.png&quot;</span><span class="op">,</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="bu">Response</span><span class="op">.</span><span class="fu">Listener</span><span class="op">&lt;</span>Bitmap<span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onResponse</span><span class="op">(</span>Bitmap response<span class="op">)</span> <span class="op">{</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> Bitmap<span class="op">.</span><span class="fu">Config</span><span class="op">.</span><span class="fu">RGB_565</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Response</span><span class="op">.</span><span class="fu">ErrorListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onErrorResponse</span><span class="op">(</span>VolleyError error<span class="op">)</span> <span class="op">{</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>mQueue<span class="op">.</span><span class="fu">add</span><span class="op">(</span>imageRequest<span class="op">);</span></span></code></pre></div>
<h4 id="imageloader">ImageLoader</h4>
<p>初始化</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>RequestQueue mQueue<span class="op">;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>ImageCache mImageCache<span class="op">;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>ImageLoader mImageLoader<span class="op">;</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    mQueue <span class="op">=</span> Volley<span class="op">.</span><span class="fu">newRequestQueue</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    ImageCache<span class="op">.</span><span class="fu">ImageCacheParams</span> cacheParams <span class="op">=</span> <span class="kw">new</span> ImageCache<span class="op">.</span><span class="fu">ImageCacheParams</span><span class="op">(</span>context<span class="op">,</span> FileManager<span class="op">.</span><span class="fu">CACHE_IMAGE_PATH_NEW</span><span class="op">);</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    cacheParams<span class="op">.</span><span class="fu">setMemCacheSizePercent</span><span class="op">(</span>context<span class="op">,</span> <span class="fl">0.2f</span><span class="op">);</span><span class="co">//缓存图片大小为原图的0.2倍</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    mImageCache <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageCache</span><span class="op">(</span>cacheParams<span class="op">);</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    mImageLoader <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageLoader</span><span class="op">(</span>mQueue<span class="op">,</span> imageCache<span class="op">);</span><span class="co">//注意导的是Volley下的ImageLoader</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>或者使用自定义ImageCache</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> VolleyImageCache <span class="kw">implements</span> ImageLoader<span class="op">.</span><span class="fu">ImageCache</span> <span class="op">{</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//LruCatch是Android提供的缓存工具</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> LruCache<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> Bitmap<span class="op">&gt;</span> mCache<span class="op">;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">VolleyImageCache</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> maxCacheSize <span class="op">=</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        mCache <span class="op">=</span> <span class="kw">new</span> LruCache<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> Bitmap<span class="op">&gt;(</span>maxCacheSize<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">//测量Bitmap的大小 ,便于统计缓存使用总量</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">protected</span> <span class="dt">int</span> <span class="fu">sizeOf</span><span class="op">(</span><span class="bu">String</span> key<span class="op">,</span> Bitmap value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> value<span class="op">.</span><span class="fu">getRowBytes</span><span class="op">()</span> <span class="op">*</span> value<span class="op">.</span><span class="fu">getHeight</span><span class="op">();</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Bitmap <span class="fu">getBitmap</span><span class="op">(</span><span class="bu">String</span> url<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mCache<span class="op">.</span><span class="fu">get</span><span class="op">(</span>url<span class="op">);</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">//缓存图片，以url作为key值</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">putBitmap</span><span class="op">(</span><span class="bu">String</span> url<span class="op">,</span> Bitmap bitmap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>        mCache<span class="op">.</span><span class="fu">put</span><span class="op">(</span>url<span class="op">,</span> bitmap<span class="op">);</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>使用</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>mImageCache<span class="op">.</span><span class="fu">getBitmapFromMemCache</span><span class="op">(</span>url<span class="op">)</span> <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    imageView<span class="op">.</span><span class="fu">setImageBitmap</span><span class="op">(</span>mImageCache<span class="op">.</span><span class="fu">getBitmapFromMemCache</span><span class="op">(</span>url<span class="op">));</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    ImageLoader<span class="op">.</span><span class="fu">ImageContainer</span> container <span class="op">=</span> mImageLoader<span class="op">.</span><span class="fu">get</span><span class="op">(</span>url<span class="op">,</span> TransitionImageListener<span class="op">.</span><span class="fu">obtain</span><span class="op">(</span>imageView<span class="op">,</span> R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">loading_pic</span><span class="op">,</span> R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">default_pic</span><span class="op">),</span> width<span class="op">,</span> height<span class="op">);</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    imageView<span class="op">.</span><span class="fu">setTag</span><span class="op">(</span>container<span class="op">);</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="networkimageview">NetworkImageView</h4>
<p>在xml中使用volley的NetworkImageView</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">com.android.volley.toolbox.NetworkImageView</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:id=</span><span class="st">&quot;@+id/network_image_view&quot;</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;200dp&quot;</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;200dp&quot;</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_gravity=</span><span class="st">&quot;center_horizontal&quot;</span>  /&gt;</span></code></pre></div>
<p>JAVA代码</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>NetworkImageView network_image_view <span class="op">=</span> <span class="op">(</span>NetworkImageView<span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">nivTestView</span><span class="op">);</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>network_image_view<span class="op">.</span><span class="fu">setDefaultImageResId</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">default_pic</span><span class="op">);</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>network_image_view<span class="op">.</span><span class="fu">setErrorImageResId</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">error_pic</span><span class="op">);</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>network_image_view<span class="op">.</span><span class="fu">setImageUrl</span><span class="op">(</span>url<span class="op">,</span> mImageLoader<span class="op">);</span></span></code></pre></div>
<h3 id="案例-多线程下载">案例: 多线程下载</h3>
<p><strong>原理</strong></p>
<ol type="1">
<li>Http的<code>Range</code>头字段指定每条线程从文件的什么位置开始下载，下载到什么位置为止，<code>Range</code>头需要服务器支持</li>
<li><code>RandomAccessFile</code>可以从文件指定位置开始写入</li>
</ol>
<p>所以我们先计算每条线程要下载的<code>Range</code>，然后再通过<code>RandomAccessFile</code>的<code>seek</code>函数指定写入位置即可</p>
<p><strong>实现</strong></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DownloadUtils <span class="op">{</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">Thread</span><span class="op">&gt;</span> <span class="fu">download</span><span class="op">(</span><span class="bu">String</span> url<span class="op">,</span> <span class="bu">String</span> fileDir<span class="op">,</span> <span class="dt">int</span> threadCount<span class="op">,</span> DownloadThread<span class="op">.</span><span class="fu">Callback</span> callback<span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span> <span class="op">{</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Long</span> size<span class="op">;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">Thread</span><span class="op">&gt;</span> threadList <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;(</span>threadCount<span class="op">);</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">HttpURLConnection</span> connection <span class="op">=</span> <span class="op">(</span><span class="bu">HttpURLConnection</span><span class="op">)</span> <span class="kw">new</span> <span class="bu">URL</span><span class="op">(</span>url<span class="op">).</span><span class="fu">openConnection</span><span class="op">();</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>        connection<span class="op">.</span><span class="fu">setConnectTimeout</span><span class="op">(</span><span class="dv">15</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">);</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>        connection<span class="op">.</span><span class="fu">setRequestMethod</span><span class="op">(</span><span class="st">&quot;GET&quot;</span><span class="op">);</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>        connection<span class="op">.</span><span class="fu">connect</span><span class="op">();</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>connection<span class="op">.</span><span class="fu">getResponseCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">200</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>            size <span class="op">=</span> <span class="op">(</span><span class="dt">long</span><span class="op">)</span> connection<span class="op">.</span><span class="fu">getContentLength</span><span class="op">();</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IllegalStateException</span><span class="op">(</span><span class="st">&quot;连接失败&quot;</span><span class="op">);</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">RandomAccessFile</span> raf <span class="op">=</span> <span class="kw">new</span> <span class="bu">RandomAccessFile</span><span class="op">(</span><span class="kw">new</span> <span class="bu">File</span><span class="op">(</span>fileDir<span class="op">),</span> <span class="st">&quot;rw&quot;</span><span class="op">);</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>        raf<span class="op">.</span><span class="fu">setLength</span><span class="op">(</span>size<span class="op">);</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>        raf<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">long</span> block <span class="op">=</span> size <span class="op">%</span> threadCount <span class="op">==</span> <span class="dv">0</span> <span class="op">?</span> size <span class="op">/</span> threadCount <span class="op">:</span> size <span class="op">/</span> threadCount <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> threadCount<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> start <span class="op">=</span> i <span class="op">*</span> block<span class="op">;</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> end <span class="op">=</span> start <span class="op">+</span> block <span class="op">&gt;=</span> size <span class="op">?</span> size <span class="op">:</span> start <span class="op">+</span> block <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Thread</span> thread <span class="op">=</span> <span class="kw">new</span> <span class="fu">DownloadThread</span><span class="op">(</span>url<span class="op">,</span> fileDir<span class="op">,</span> start<span class="op">,</span> end<span class="op">,</span> callback<span class="op">);</span></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>            threadList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>thread<span class="op">);</span></span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>            thread<span class="op">.</span><span class="fu">start</span><span class="op">();</span></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> threadList<span class="op">;</span></span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DownloadThread <span class="kw">extends</span> <span class="bu">Thread</span> <span class="op">{</span></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> url<span class="op">;</span></span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> fileDir<span class="op">;</span></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> start<span class="op">;</span></span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> end<span class="op">;</span></span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> progress<span class="op">;</span></span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Callback</span> callback<span class="op">;</span></span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DownloadThread</span><span class="op">(</span><span class="bu">String</span> url<span class="op">,</span> <span class="bu">String</span> fileDir<span class="op">,</span> <span class="dt">long</span> start<span class="op">,</span> <span class="dt">long</span> end<span class="op">,</span> <span class="bu">Callback</span> callback<span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">url</span> <span class="op">=</span> url<span class="op">;</span></span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">fileDir</span> <span class="op">=</span> fileDir<span class="op">;</span></span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">start</span> <span class="op">=</span> start<span class="op">;</span></span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">end</span> <span class="op">=</span> end<span class="op">;</span></span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">callback</span> <span class="op">=</span> callback<span class="op">;</span></span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>            <span class="bu">HttpURLConnection</span> conn <span class="op">=</span> <span class="op">(</span><span class="bu">HttpURLConnection</span><span class="op">)</span> <span class="kw">new</span> <span class="bu">URL</span><span class="op">(</span>url<span class="op">).</span><span class="fu">openConnection</span><span class="op">();</span></span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a>            conn<span class="op">.</span><span class="fu">setConnectTimeout</span><span class="op">(</span><span class="dv">15</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">);</span></span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a>            conn<span class="op">.</span><span class="fu">setRequestMethod</span><span class="op">(</span><span class="st">&quot;GET&quot;</span><span class="op">);</span></span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a>            conn<span class="op">.</span><span class="fu">setRequestProperty</span><span class="op">(</span><span class="st">&quot;Accept&quot;</span><span class="op">,</span> <span class="st">&quot;image/gif, image/jpeg, image/pjpeg,&quot;</span> <span class="op">+</span></span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot; image/pjpeg, application/x-shockwave-flash, application/xaml+xml, &quot;</span> <span class="op">+</span></span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;application/vnd.ms-xpsdocument, application/x-ms-xbap, &quot;</span> <span class="op">+</span></span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;application/x-ms-application, application/vnd.ms-excel, &quot;</span> <span class="op">+</span></span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;application/vnd.ms-powerpoint, application/msword, */*&quot;</span><span class="op">);</span></span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>            conn<span class="op">.</span><span class="fu">setRequestProperty</span><span class="op">(</span><span class="st">&quot;Referer&quot;</span><span class="op">,</span> url<span class="op">);</span></span>
<span id="cb85-59"><a href="#cb85-59" aria-hidden="true" tabindex="-1"></a>            conn<span class="op">.</span><span class="fu">setRequestProperty</span><span class="op">(</span><span class="st">&quot;Range&quot;</span><span class="op">,</span> <span class="st">&quot;bytes=&quot;</span> <span class="op">+</span> start <span class="op">+</span> <span class="st">&quot;-&quot;</span> <span class="op">+</span> end<span class="op">);</span><span class="co">// 设置获取实体数据的范围</span></span>
<span id="cb85-60"><a href="#cb85-60" aria-hidden="true" tabindex="-1"></a>            conn<span class="op">.</span><span class="fu">setRequestProperty</span><span class="op">(</span><span class="st">&quot;Connection&quot;</span><span class="op">,</span> <span class="st">&quot;Keep-Alive&quot;</span><span class="op">);</span></span>
<span id="cb85-61"><a href="#cb85-61" aria-hidden="true" tabindex="-1"></a>            conn<span class="op">.</span><span class="fu">connect</span><span class="op">();</span></span>
<span id="cb85-62"><a href="#cb85-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-63"><a href="#cb85-63" aria-hidden="true" tabindex="-1"></a>            <span class="co">//如果服务器支持Range头，则返回的状态码是206</span></span>
<span id="cb85-64"><a href="#cb85-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>conn<span class="op">.</span><span class="fu">getResponseCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">200</span> <span class="op">||</span> conn<span class="op">.</span><span class="fu">getResponseCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">206</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-65"><a href="#cb85-65" aria-hidden="true" tabindex="-1"></a>                <span class="bu">InputStream</span> is <span class="op">=</span> conn<span class="op">.</span><span class="fu">getInputStream</span><span class="op">();</span></span>
<span id="cb85-66"><a href="#cb85-66" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> len<span class="op">;</span></span>
<span id="cb85-67"><a href="#cb85-67" aria-hidden="true" tabindex="-1"></a>                <span class="dt">byte</span><span class="op">[]</span> buf <span class="op">=</span> <span class="kw">new</span> <span class="dt">byte</span><span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb85-68"><a href="#cb85-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-69"><a href="#cb85-69" aria-hidden="true" tabindex="-1"></a>                <span class="bu">RandomAccessFile</span> raf <span class="op">=</span> <span class="kw">new</span> <span class="bu">RandomAccessFile</span><span class="op">(</span><span class="kw">new</span> <span class="bu">File</span><span class="op">(</span>fileDir<span class="op">),</span> <span class="st">&quot;rwd&quot;</span><span class="op">);</span></span>
<span id="cb85-70"><a href="#cb85-70" aria-hidden="true" tabindex="-1"></a>                raf<span class="op">.</span><span class="fu">seek</span><span class="op">(</span>start<span class="op">);</span></span>
<span id="cb85-71"><a href="#cb85-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-72"><a href="#cb85-72" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">((</span>len <span class="op">=</span> is<span class="op">.</span><span class="fu">read</span><span class="op">(</span>buf<span class="op">))</span> <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-73"><a href="#cb85-73" aria-hidden="true" tabindex="-1"></a>                    raf<span class="op">.</span><span class="fu">write</span><span class="op">(</span>buf<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> len<span class="op">);</span></span>
<span id="cb85-74"><a href="#cb85-74" aria-hidden="true" tabindex="-1"></a>                    progress <span class="op">+=</span> len<span class="op">;</span></span>
<span id="cb85-75"><a href="#cb85-75" aria-hidden="true" tabindex="-1"></a>                    callback<span class="op">.</span><span class="fu">onProgress</span><span class="op">(</span>progress<span class="op">);</span></span>
<span id="cb85-76"><a href="#cb85-76" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb85-77"><a href="#cb85-77" aria-hidden="true" tabindex="-1"></a>                raf<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb85-78"><a href="#cb85-78" aria-hidden="true" tabindex="-1"></a>                is<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb85-79"><a href="#cb85-79" aria-hidden="true" tabindex="-1"></a>                callback<span class="op">.</span><span class="fu">onFinish</span><span class="op">();</span></span>
<span id="cb85-80"><a href="#cb85-80" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb85-81"><a href="#cb85-81" aria-hidden="true" tabindex="-1"></a>                callback<span class="op">.</span><span class="fu">onError</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Exception</span><span class="op">(</span><span class="st">&quot;网络错误，请求失败，状态码为&quot;</span> <span class="op">+</span> conn<span class="op">.</span><span class="fu">getResponseCode</span><span class="op">()));</span></span>
<span id="cb85-82"><a href="#cb85-82" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb85-83"><a href="#cb85-83" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-84"><a href="#cb85-84" aria-hidden="true" tabindex="-1"></a>            callback<span class="op">.</span><span class="fu">onError</span><span class="op">(</span>e<span class="op">);</span></span>
<span id="cb85-85"><a href="#cb85-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-86"><a href="#cb85-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb85-87"><a href="#cb85-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-88"><a href="#cb85-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">interface</span> <span class="bu">Callback</span> <span class="op">{</span></span>
<span id="cb85-89"><a href="#cb85-89" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">onProgress</span><span class="op">(</span><span class="dt">long</span> progress<span class="op">);</span></span>
<span id="cb85-90"><a href="#cb85-90" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">onFinish</span><span class="op">();</span></span>
<span id="cb85-91"><a href="#cb85-91" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">onError</span><span class="op">(</span><span class="bu">Exception</span> e<span class="op">);</span></span>
<span id="cb85-92"><a href="#cb85-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb85-93"><a href="#cb85-93" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="消息异步">消息异步</h2>
<h3 id="handler">Handler</h3>
<h4 id="基本使用">基本使用</h4>
<div class="sourceCode" id="cb86"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyHandlerActivity <span class="kw">extends</span> Activity<span class="op">{</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Handler</span> handler <span class="op">=</span> <span class="kw">new</span> <span class="bu">Handler</span><span class="op">(){</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleMessage</span><span class="op">(</span>Message msg<span class="op">){</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span><span class="op">(</span>msg<span class="op">.</span><span class="fu">what</span><span class="op">){</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>                    Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span><span class="kw">this</span><span class="op">,(</span><span class="bu">String</span><span class="op">)</span>msg<span class="op">.</span><span class="fu">obj</span><span class="op">,</span><span class="dv">0</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>                <span class="kw">default</span><span class="op">:</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">onButtonClick</span><span class="op">(</span>view v<span class="op">){</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="bu">Thread</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Runnable</span><span class="op">{</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span><span class="op">(){</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span><span class="op">{</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">Thread</span><span class="op">.</span><span class="fu">sleep</span><span class="op">(</span><span class="dv">2000</span><span class="op">);</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">Exception</span> e<span class="op">){</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>            Message msg <span class="op">=</span> Message<span class="op">.</span><span class="fu">obtain</span><span class="op">();</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>            msg<span class="op">.</span><span class="fu">what</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>            msg<span class="op">.</span><span class="fu">obj</span> <span class="op">=</span> <span class="st">&quot;Hello&quot;</span><span class="op">;</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>            handler<span class="op">.</span><span class="fu">sendMessage</span><span class="op">(</span>msg<span class="op">);</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}).</span><span class="fu">start</span><span class="op">();</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>除此以外，还有</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>handler<span class="op">.</span><span class="fu">post</span><span class="op">(</span><span class="bu">Runnable</span><span class="op">);</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>handler<span class="op">.</span><span class="fu">postAtTime</span><span class="op">(</span><span class="bu">Runnable</span><span class="op">,</span> <span class="dt">long</span><span class="op">);</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>handler<span class="op">.</span><span class="fu">postDelayed</span><span class="op">(</span><span class="bu">Runnable</span><span class="op">,</span> <span class="dt">long</span><span class="op">);</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>handler<span class="op">.</span><span class="fu">sendEmptyMessage</span><span class="op">(</span><span class="dt">int</span><span class="op">);</span><span class="co">//直接指定msg.what，其实内部会构造一个msg</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>handler<span class="op">.</span><span class="fu">sendMessage</span><span class="op">(</span>Message<span class="op">);</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>handler<span class="op">.</span><span class="fu">sendMessageAtTime</span><span class="op">(</span>Message<span class="op">,</span> <span class="dt">long</span><span class="op">);</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>handler<span class="op">.</span><span class="fu">sendMessageDelayed</span><span class="op">(</span>Message<span class="op">,</span> <span class="dt">long</span><span class="op">);</span><span class="co">//延迟指定时间发消息</span></span></code></pre></div>
<h4 id="底层原理">底层原理</h4>
<p>使用<code>Handler</code>的<code>sendMessage</code>等方法进行线程间通信实际上是把message放到了一个叫<code>MessageQueue</code>的消息队列中，然后由一个叫<code>Looper</code>的类不断的对<code>MessageQueue</code>进行遍历（<code>epoll</code>方式的轮询，<code>epoll</code>是linux提供的一种多路复用的机制，可以参考JAVA中NIO的实现原理），取出并执行message</p>
<p>UI线程默认会在启动时创建<code>Looper</code>，所以UI线程可以直接使用<code>Handler</code>，而如果UI线程需要往子线程中发消息，需要我们手动为子线程创建<code>Looper</code>，并执行遍历操作。<code>Looper</code>的构造函数是<code>private</code>的，我们只能通过静态方法创建</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyThread <span class="kw">extends</span> <span class="bu">Thread</span> <span class="op">{</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">Handler</span> mHandler<span class="op">;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">//创建Looper</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>        Looper<span class="op">.</span><span class="fu">prepare</span><span class="op">();</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>        mHandler <span class="op">=</span> <span class="kw">new</span> <span class="bu">Handler</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleMessage</span><span class="op">(</span>Message msg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// process incoming messages here</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">//执行轮询，在执行完任务后需要使用Looper.myLooper().quit()来停止轮询，否则可能会导致内存泄露</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>        Looper<span class="op">.</span><span class="fu">loop</span><span class="op">();</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><code>Looper</code>内部通过<code>ThreadLocal</code>的方式保存对当前线程的引用，所以<code>Looper</code>是与线程绑定的，而且一个线程只能有一个<code>Looper</code></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">final</span> <span class="bu">ThreadLocal</span><span class="op">&lt;</span>Looper<span class="op">&gt;</span> sThreadLocal <span class="op">=</span> <span class="kw">new</span> <span class="bu">ThreadLocal</span><span class="op">&lt;</span>Looper<span class="op">&gt;();</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">prepare</span><span class="op">(</span><span class="dt">boolean</span> quitAllowed<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sThreadLocal<span class="op">.</span><span class="fu">get</span><span class="op">()</span> <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;Only one Looper may be created per thread&quot;</span><span class="op">);</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    sThreadLocal<span class="op">.</span><span class="fu">set</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Looper</span><span class="op">(</span>quitAllowed<span class="op">));</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">loop</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Looper me <span class="op">=</span> <span class="fu">myLooper</span><span class="op">();</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>me <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;No Looper; Looper.prepare() wasn&#39;t called on this thread.&quot;</span><span class="op">);</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//创建MessageQueue</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> MessageQueue queue <span class="op">=</span> me<span class="op">.</span><span class="fu">mQueue</span><span class="op">;</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Make sure the identity of this thread is that of the local process,</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and keep track of what that identity token actually is.</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Binder</span><span class="op">.</span><span class="fu">clearCallingIdentity</span><span class="op">();</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">long</span> ident <span class="op">=</span> <span class="bu">Binder</span><span class="op">.</span><span class="fu">clearCallingIdentity</span><span class="op">();</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Allow overriding a threshold with a system prop. e.g.</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// adb shell &#39;setprop log.looper.1000.main.slow 1 &amp;&amp; stop &amp;&amp; start&#39;</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> thresholdOverride <span class="op">=</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>            SystemProperties<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;log.looper.&quot;</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>                    <span class="op">+</span> <span class="bu">Process</span><span class="op">.</span><span class="fu">myUid</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;.&quot;</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>                    <span class="op">+</span> <span class="bu">Thread</span><span class="op">.</span><span class="fu">currentThread</span><span class="op">().</span><span class="fu">getName</span><span class="op">()</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>                    <span class="op">+</span> <span class="st">&quot;.slow&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">boolean</span> slowDeliveryDetected <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">//轮询</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(;;)</span> <span class="op">{</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">//如果此时消息队列中有Message，那么next方法会立即返回该Message，如果此时消息队列中没有Message，那么next方法就会阻塞式地等待获取Message</span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>        Message msg <span class="op">=</span> queue<span class="op">.</span><span class="fu">next</span><span class="op">();</span> <span class="co">// might block</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>msg <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>            <span class="co">// No message indicates that the message queue is quitting.</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// This must be in a local variable, in case a UI event sets the logger</span></span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Printer logging <span class="op">=</span> me<span class="op">.</span><span class="fu">mLogging</span><span class="op">;</span></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>logging <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a>            logging<span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;&gt;&gt;&gt;&gt;&gt; Dispatching to &quot;</span> <span class="op">+</span> msg<span class="op">.</span><span class="fu">target</span> <span class="op">+</span> <span class="st">&quot; &quot;</span> <span class="op">+</span></span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a>                    msg<span class="op">.</span><span class="fu">callback</span> <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> msg<span class="op">.</span><span class="fu">what</span><span class="op">);</span></span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span> traceTag <span class="op">=</span> me<span class="op">.</span><span class="fu">mTraceTag</span><span class="op">;</span></span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a>        <span class="dt">long</span> slowDispatchThresholdMs <span class="op">=</span> me<span class="op">.</span><span class="fu">mSlowDispatchThresholdMs</span><span class="op">;</span></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a>        <span class="dt">long</span> slowDeliveryThresholdMs <span class="op">=</span> me<span class="op">.</span><span class="fu">mSlowDeliveryThresholdMs</span><span class="op">;</span></span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>thresholdOverride <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a>            slowDispatchThresholdMs <span class="op">=</span> thresholdOverride<span class="op">;</span></span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a>            slowDeliveryThresholdMs <span class="op">=</span> thresholdOverride<span class="op">;</span></span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">boolean</span> logSlowDelivery <span class="op">=</span> <span class="op">(</span>slowDeliveryThresholdMs <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>msg<span class="op">.</span><span class="fu">when</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">boolean</span> logSlowDispatch <span class="op">=</span> <span class="op">(</span>slowDispatchThresholdMs <span class="op">&gt;</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">boolean</span> needStartTime <span class="op">=</span> logSlowDelivery <span class="op">||</span> logSlowDispatch<span class="op">;</span></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">boolean</span> needEndTime <span class="op">=</span> logSlowDispatch<span class="op">;</span></span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>traceTag <span class="op">!=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> Trace<span class="op">.</span><span class="fu">isTagEnabled</span><span class="op">(</span>traceTag<span class="op">))</span> <span class="op">{</span></span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a>            Trace<span class="op">.</span><span class="fu">traceBegin</span><span class="op">(</span>traceTag<span class="op">,</span> msg<span class="op">.</span><span class="fu">target</span><span class="op">.</span><span class="fu">getTraceName</span><span class="op">(</span>msg<span class="op">));</span></span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span> dispatchStart <span class="op">=</span> needStartTime <span class="op">?</span> SystemClock<span class="op">.</span><span class="fu">uptimeMillis</span><span class="op">()</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span> dispatchEnd<span class="op">;</span></span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a>            <span class="co">//msg.target是一个Handler</span></span>
<span id="cb89-70"><a href="#cb89-70" aria-hidden="true" tabindex="-1"></a>            msg<span class="op">.</span><span class="fu">target</span><span class="op">.</span><span class="fu">dispatchMessage</span><span class="op">(</span>msg<span class="op">);</span></span>
<span id="cb89-71"><a href="#cb89-71" aria-hidden="true" tabindex="-1"></a>            dispatchEnd <span class="op">=</span> needEndTime <span class="op">?</span> SystemClock<span class="op">.</span><span class="fu">uptimeMillis</span><span class="op">()</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb89-72"><a href="#cb89-72" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">finally</span> <span class="op">{</span></span>
<span id="cb89-73"><a href="#cb89-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>traceTag <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-74"><a href="#cb89-74" aria-hidden="true" tabindex="-1"></a>                Trace<span class="op">.</span><span class="fu">traceEnd</span><span class="op">(</span>traceTag<span class="op">);</span></span>
<span id="cb89-75"><a href="#cb89-75" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb89-76"><a href="#cb89-76" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-77"><a href="#cb89-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>logSlowDelivery<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-78"><a href="#cb89-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>slowDeliveryDetected<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-79"><a href="#cb89-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">((</span>dispatchStart <span class="op">-</span> msg<span class="op">.</span><span class="fu">when</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-80"><a href="#cb89-80" aria-hidden="true" tabindex="-1"></a>                    Slog<span class="op">.</span><span class="fu">w</span><span class="op">(</span>TAG<span class="op">,</span> <span class="st">&quot;Drained&quot;</span><span class="op">);</span></span>
<span id="cb89-81"><a href="#cb89-81" aria-hidden="true" tabindex="-1"></a>                    slowDeliveryDetected <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb89-82"><a href="#cb89-82" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb89-83"><a href="#cb89-83" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb89-84"><a href="#cb89-84" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span><span class="fu">showSlowLog</span><span class="op">(</span>slowDeliveryThresholdMs<span class="op">,</span> msg<span class="op">.</span><span class="fu">when</span><span class="op">,</span> dispatchStart<span class="op">,</span> <span class="st">&quot;delivery&quot;</span><span class="op">,</span></span>
<span id="cb89-85"><a href="#cb89-85" aria-hidden="true" tabindex="-1"></a>                        msg<span class="op">))</span> <span class="op">{</span></span>
<span id="cb89-86"><a href="#cb89-86" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// Once we write a slow delivery log, suppress until the queue drains.</span></span>
<span id="cb89-87"><a href="#cb89-87" aria-hidden="true" tabindex="-1"></a>                    slowDeliveryDetected <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb89-88"><a href="#cb89-88" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb89-89"><a href="#cb89-89" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb89-90"><a href="#cb89-90" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-91"><a href="#cb89-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>logSlowDispatch<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-92"><a href="#cb89-92" aria-hidden="true" tabindex="-1"></a>            <span class="fu">showSlowLog</span><span class="op">(</span>slowDispatchThresholdMs<span class="op">,</span> dispatchStart<span class="op">,</span> dispatchEnd<span class="op">,</span> <span class="st">&quot;dispatch&quot;</span><span class="op">,</span> msg<span class="op">);</span></span>
<span id="cb89-93"><a href="#cb89-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-94"><a href="#cb89-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-95"><a href="#cb89-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>logging <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-96"><a href="#cb89-96" aria-hidden="true" tabindex="-1"></a>            logging<span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;&lt;&lt;&lt;&lt;&lt; Finished to &quot;</span> <span class="op">+</span> msg<span class="op">.</span><span class="fu">target</span> <span class="op">+</span> <span class="st">&quot; &quot;</span> <span class="op">+</span> msg<span class="op">.</span><span class="fu">callback</span><span class="op">);</span></span>
<span id="cb89-97"><a href="#cb89-97" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-98"><a href="#cb89-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-99"><a href="#cb89-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Make sure that during the course of dispatching the</span></span>
<span id="cb89-100"><a href="#cb89-100" aria-hidden="true" tabindex="-1"></a>        <span class="co">// identity of the thread wasn&#39;t corrupted.</span></span>
<span id="cb89-101"><a href="#cb89-101" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span> newIdent <span class="op">=</span> <span class="bu">Binder</span><span class="op">.</span><span class="fu">clearCallingIdentity</span><span class="op">();</span></span>
<span id="cb89-102"><a href="#cb89-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ident <span class="op">!=</span> newIdent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-103"><a href="#cb89-103" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">wtf</span><span class="op">(</span>TAG<span class="op">,</span> <span class="st">&quot;Thread identity changed from 0x&quot;</span></span>
<span id="cb89-104"><a href="#cb89-104" aria-hidden="true" tabindex="-1"></a>                    <span class="op">+</span> <span class="bu">Long</span><span class="op">.</span><span class="fu">toHexString</span><span class="op">(</span>ident<span class="op">)</span> <span class="op">+</span> <span class="st">&quot; to 0x&quot;</span></span>
<span id="cb89-105"><a href="#cb89-105" aria-hidden="true" tabindex="-1"></a>                    <span class="op">+</span> <span class="bu">Long</span><span class="op">.</span><span class="fu">toHexString</span><span class="op">(</span>newIdent<span class="op">)</span> <span class="op">+</span> <span class="st">&quot; while dispatching to &quot;</span></span>
<span id="cb89-106"><a href="#cb89-106" aria-hidden="true" tabindex="-1"></a>                    <span class="op">+</span> msg<span class="op">.</span><span class="fu">target</span><span class="op">.</span><span class="fu">getClass</span><span class="op">().</span><span class="fu">getName</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot; &quot;</span></span>
<span id="cb89-107"><a href="#cb89-107" aria-hidden="true" tabindex="-1"></a>                    <span class="op">+</span> msg<span class="op">.</span><span class="fu">callback</span> <span class="op">+</span> <span class="st">&quot; what=&quot;</span> <span class="op">+</span> msg<span class="op">.</span><span class="fu">what</span><span class="op">);</span></span>
<span id="cb89-108"><a href="#cb89-108" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-109"><a href="#cb89-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-110"><a href="#cb89-110" aria-hidden="true" tabindex="-1"></a>        msg<span class="op">.</span><span class="fu">recycleUnchecked</span><span class="op">();</span></span>
<span id="cb89-111"><a href="#cb89-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb89-112"><a href="#cb89-112" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>我们可以通过<code>Looper.myLooper()</code>来获取当前线程绑定的<code>Looper</code>，也可以通过<code>Looper.getMainLooper()</code>获取UI线程的<code>Looper</code></p>
<p>子线程是不能直接更新UI的，要在子线程更新UI，有以下方式：</p>
<ul>
<li>使用在UI线程创建的<code>Handler</code>，从子线程向UI线程发message</li>
<li>使用activity的<code>runOnUiThread(Runnable)</code>方法</li>
<li>创建在子线程创建<code>Handler</code>时，指定绑定的<code>Looper</code>为UI线程的Looper</li>
<li>使用view的<code>post(Runnable)</code>方法</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="bu">Thread</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Runnable</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    Log<span class="op">.</span><span class="fu">e</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span> <span class="st">&quot;在子线程中创建handler，通过并指定绑定的Looper为MainLooper：&quot;</span><span class="op">+</span><span class="bu">Thread</span><span class="op">.</span><span class="fu">currentThread</span><span class="op">().</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Handler</span> handler<span class="op">=</span><span class="kw">new</span> <span class="bu">Handler</span><span class="op">(</span><span class="fu">getMainLooper</span><span class="op">());</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    handler<span class="op">.</span><span class="fu">post</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Runnable</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">e</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span> <span class="st">&quot;使用子线程中创建handler往主线程发消息：&quot;</span><span class="op">+</span><span class="bu">Thread</span><span class="op">.</span><span class="fu">currentThread</span><span class="op">().</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="op">}).</span><span class="fu">start</span><span class="op">();</span></span></code></pre></div>
<p>对于Toast、showDialog，其内部也是使用<code>Handler</code>向UI线程发起更新UI的message的，在子线程中使用Toast、showDialog我们只需要为子线程创建<code>Looper</code>然后直接使用就可以了，因为其内部已经为我们完成在主线程运行的操作了</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="bu">Thread</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Runnable</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>        Looper<span class="op">.</span><span class="fu">prepare</span><span class="op">();</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>        Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> <span class="st">&quot;run on thread&quot;</span><span class="op">+</span><span class="bu">Thread</span><span class="op">.</span><span class="fu">currentThread</span><span class="op">().</span><span class="fu">getName</span><span class="op">(),</span> Toast<span class="op">.</span><span class="fu">LENGTH_SHORT</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        Looper<span class="op">.</span><span class="fu">loop</span><span class="op">();</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="op">}).</span><span class="fu">start</span><span class="op">();</span></span></code></pre></div>
<p>最后，在执行完任务后需要使用Looper.myLooper().quit()来停止轮询，否则可能会导致内存泄露</p>
<h4 id="内存泄露问题">内存泄露问题</h4>
<p>这里主要讨论<code>Handler</code>的内存泄露问题</p>
<p>延时的<code>Handler</code>容易造成内存泄漏（<code>Handler</code>持有activity的引用，导致activity无法回收），解决方法有两种：</p>
<ol type="1">
<li>在退出activity时清空<code>MessageQueue</code></li>
</ol>
<div class="sourceCode" id="cb92"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onDestory</span><span class="op">(){</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    handler<span class="op">.</span><span class="fu">removeCallbacksAndMessages</span><span class="op">(</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ol start="2" type="1">
<li>使用静态内部类+弱引用</li>
</ol>
<p>在Java中，非静态的内部类和匿名内部类都会隐式地持有其外部类的引用，静态的内部类不会持有外部类的引用，所以把handler定义成静态内部类的话，不会持有Activity的引用，Activity可以随便回收，这时还要在handler中把对Activity的引用改成弱引用（GC在回收内存的时候会忽略调弱引用，只要对象没有被强引用指向（实际上多数时候还要求没有软引用），都能被GC回收）</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> MyHandler <span class="kw">extends</span> <span class="bu">Handler</span><span class="op">{</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">WeakReference</span><span class="op">&lt;</span>Activity<span class="op">&gt;</span> mWeakReference<span class="op">;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MyHandler</span><span class="op">(</span>Activity activity<span class="op">){</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>        mWeakReference<span class="op">=</span><span class="kw">new</span> <span class="bu">WeakReference</span><span class="op">&lt;</span>Activity<span class="op">&gt;(</span>activity<span class="op">);</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleMessage</span><span class="op">(</span>Message msg<span class="op">){</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Activity activity<span class="op">=</span>mWeakReference<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>activity<span class="op">!=</span><span class="kw">null</span><span class="op">){</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>msg<span class="op">.</span><span class="fu">what</span> <span class="op">==</span> <span class="dv">1</span><span class="op">){</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>                <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="asynctask">AsyncTask</h3>
<div class="sourceCode" id="cb94"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>RequestQueue mQueue <span class="op">=</span> Volley<span class="op">.</span><span class="fu">newRequestQueue</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> AsyncTask<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Integer</span><span class="op">,</span> Bitmap<span class="op">&gt;(){</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//在doInBackground之前执行</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onPreExecute</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//在主线程执行</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> Bitmap <span class="fu">doInBackground</span><span class="op">(</span><span class="bu">String</span><span class="kw">...</span> args1<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">//在子线程执行</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>        Bitmap bitmap <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>        ImageRequest imageRequest <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageRequest</span><span class="op">(</span>args1<span class="op">[</span><span class="dv">0</span><span class="op">],</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="bu">Response</span><span class="op">.</span><span class="fu">Listener</span><span class="op">&lt;</span>Bitmap<span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onResponse</span><span class="op">(</span>Bitmap response<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>                bitmap <span class="op">=</span> response<span class="op">;</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> Bitmap<span class="op">.</span><span class="fu">Config</span><span class="op">.</span><span class="fu">RGB_565</span><span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>        mQueue<span class="op">.</span><span class="fu">add</span><span class="op">(</span>imageRequest<span class="op">);</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> times<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">publishProgress</span><span class="op">(</span>i<span class="op">);</span><span class="co">//提交之后，会执行onProcessUpdate方法</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> bitmap<span class="op">;</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">//在doInbackground之后执行</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onPostExecute</span><span class="op">(</span>Bitmap args3<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">//在主线程执行</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">//在调用cancel方法后会执行到这里</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCancelled</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onProgressUpdate</span><span class="op">(</span><span class="bu">Integer</span><span class="kw">...</span> args2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">//在主线程执行，一般用于更新进度条</span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a><span class="op">}.</span><span class="fu">execute</span><span class="op">(</span><span class="st">&quot;http://127.0.0.1/pic.png&quot;</span><span class="op">);</span></span></code></pre></div>
<h2 id="json解析">JSON解析</h2>
<h3 id="jsonobject和jsonarray">JSONObject和JSONArray</h3>
<p>JSONObject.toBean的数据是用<code>{ }</code>来表示的，如：<code>{ &quot;id&quot; : &quot;123&quot;, &quot;name&quot; : &quot;小明&quot;}</code></p>
<p>JSONArray是JSONObject的数组，用<code>[ ]</code>表示，如<code>[ { &quot;id&quot; : &quot;123&quot;, &quot;name&quot; : &quot;小明&quot;}, { &quot;id&quot; : &quot;124&quot;, &quot;name&quot; : &quot;小红&quot;} ]</code></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">//创建，根据json字符串的不同选择创建不同的对象</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>JSONObject jsonObject  <span class="op">=</span> <span class="kw">new</span> <span class="fu">JSONObject</span><span class="op">(</span><span class="bu">String</span> str<span class="op">);</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>JSONArray jsonArray <span class="op">=</span> <span class="kw">new</span> <span class="fu">JSONArray</span><span class="op">(</span><span class="bu">String</span> str<span class="op">);</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co">//JSONArray通过index获取JSONObject</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>JSONObject jsonObject <span class="op">=</span> <span class="op">(</span>JSONObject<span class="op">)</span>jsonArray<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co">//获取JSONObject内容</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> id <span class="op">=</span> jsonObject<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;id&quot;</span><span class="op">);</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> name <span class="op">=</span> jsonObject<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;name&quot;</span><span class="op">);</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co">//List转JSON，Map、Object同理，但要求Object是JavaBean（有get、set方法）</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> list <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;();</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>list<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="st">&quot;java&quot;</span><span class="op">);</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>list<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="st">&quot;android&quot;</span><span class="op">);</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>JSONArray jsonarray <span class="op">=</span> JSONArray<span class="op">.</span><span class="fu">fromObject</span><span class="op">(</span>list<span class="op">);</span></span></code></pre></div>
<h3 id="gson">Gson</h3>
<p>使用前先在build.gradle中添加依赖</p>
<pre><code>implementation &#39;com.google.code.gson:gson:2.8.5&#39;</code></pre>
<p>使用</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>Person person <span class="op">=</span> <span class="kw">new</span> <span class="fu">Person</span><span class="op">(</span><span class="dv">11</span><span class="op">,</span><span class="st">&quot;小明&quot;</span>，“Man”<span class="op">);</span><span class="co">//Person是一个JavaBean</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> jsonStr <span class="op">=</span> <span class="kw">new</span> Gson<span class="op">.</span><span class="fu">toJson</span><span class="op">(</span>person<span class="op">,</span> Person<span class="op">.</span><span class="fu">class</span><span class="op">);</span><span class="co">//Object转json</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>Person person2 <span class="op">=</span> <span class="kw">new</span> Gson<span class="op">.</span><span class="fu">fromJson</span><span class="op">(</span>jsonStr<span class="op">,</span> Person<span class="op">.</span><span class="fu">class</span><span class="op">);</span><span class="co">//json转Object</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co">json转List，json转Map同理，第二个参数是TypeToken的子类</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co">getType()作用是获取父类泛型：</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="co">ParameterizedType pt = (ParameterizedType)getClass().getGenericSuperclass();</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="co">Class clazz = (Class)pt.getActualTypeArguments()[0];</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="bu">List</span><span class="op">&lt;</span>Person<span class="op">&gt;</span> list <span class="op">=</span> <span class="kw">new</span> Gson<span class="op">.</span><span class="fu">fromJson</span><span class="op">(</span>jsonStr<span class="op">,</span> <span class="kw">new</span> TypeToken<span class="op">&lt;</span><span class="bu">List</span><span class="op">&lt;</span>Person<span class="op">&gt;&gt;(){}.</span><span class="fu">getType</span><span class="op">());</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="co">//Gson的注解，serialize和deserialize默认为true，serialize为true表示toJson时会序列化该属性，deserialize为true表示fromJson生成Java对象时会反序列化；SerializedName指定该字段在序列化成json时的名称</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Person<span class="op">{</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Expose</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Expose</span><span class="op">(</span>serialize <span class="op">=</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> name<span class="op">;</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Expose</span><span class="op">(</span>deserialize <span class="op">=</span> <span class="kw">false</span><span class="op">)</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> sex<span class="op">;</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">@SerializedName</span><span class="op">(</span><span class="st">&quot;addr&quot;</span><span class="op">)</span></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> address<span class="op">;</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">//以下省略get、set方法</span></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a><span class="co">//默认情况下@Expose注解是不起作用的，需要用GsonBuilder创建Gson的时候调用了GsonBuilder.excludeFieldsWithoutExposeAnnotation()方法</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a><span class="co">//使用GsonBuilder创建Gson可以更改Gson的默认参数</span></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>Gson gson2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">GsonBuilder</span><span class="op">().</span><span class="fu">setVersion</span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">excludeFieldsWithoutExposeAnnotation</span><span class="op">()</span></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">create</span><span class="op">();</span></span></code></pre></div>
<h2 id="自定义view">自定义View</h2>
<h3 id="生命周期">生命周期</h3>
<p><code>onFinishInflate()-&gt;onAttachToWindow()-&gt;measure()-&gt;onMeasure()-&gt;onSizeChanged()-&gt;layout()-&gt;onLayout()-&gt;draw()-&gt;onDraw()-&gt;onDetachedFromWindow</code>，自定义View一般要重写onMeasure和onDraw，自定义ViewGroup要重写onMeasure和onLayout；onMeasure和onLayout一般要调用多次才能完成测量和布局</p>
<p>onMeasure决定当前控件的宽高，其参数可以通过MeasureSpec.getMode()、MeasureSpec.getSize()解析；ViewGroup重写该方法主要是逐个测量子view的宽高(<code>for(int i=0;i&lt;getChildCount();i++){getChildAt(i).onMeasure(widthMeasureSpec，heightMeasureSpec);}</code>)，如果不重写该方法，而直接在onLayout指定大小的话，如果子view是ViewGroup，则无法显示该ViewGroup中的内容</p>
<p>onLayout指定子布局的位置或排列方式（水平、垂直），可以通过requestLayout强制重新布局</p>
<p>onDraw可以设置view的样式，常用的类有ShapeDrawable、Canvas、Paint，可以通过invalid或postInvalid强制重新绘制</p>
<h3 id="事件处理">事件处理</h3>
<p>默认情况下，事件从Activity开始，按照<code>dispatchTouchEvent()</code>-&gt;<code>onInterceptTouchEvent()</code>的顺序，从最顶层的控件传到点击处的控件，然后调用被点击控件的<code>OnTouchListener</code>-&gt;<code>onTouchEvent()</code>-&gt;<code>OnLongClickListener</code>-&gt;<code>OnClickListener</code>；某些情况下，事件还可以从子控件回传到父控件中</p>
<ul>
<li><code>dispatchTouchEvent()</code>：
<ul>
<li>如果返回false，则表明事件不会被进行分发，事件会以冒泡的方式被传递给上层的view或activity的<code>onTouchEvent()</code>方法进行消费；</li>
<li>如果返回true，表示事件已经在当前方法中被消费，不再往后传递；</li>
<li>如果<code>return super.dispatchTouchEvent(e)</code>，则表示按照默认的方式处理，事件会继续往后分发，此时当前view的<code>onIntercepterTouchEvent()</code>方法会捕获该事件，判断需不需要进行事件的拦截；</li>
</ul></li>
<li><code>onInterceptTouchEvent()</code>：
<ul>
<li>如果返回false，表示不对事件进行拦截，事件会被往后传递到当前view的子控件中，由子控件中的<code>dispatchTouchEvent()</code>方法进行分发处理；</li>
<li>如果返回true，表示拦截事件，将该事件交给当前view的<code>onTouchEvent()</code>方法进行处理；</li>
<li>如果<code>return super.onInterceptTouchEvent(e)</code>，则表示按照默认的方式处理，如果当前控件就是被点击的控件，则拦截事件，并交由当前view的<code>onTouchEvent()</code>方法处理，如果点击的是子控件，则不拦截事件，继续把事件分发到子控件；</li>
</ul></li>
<li>如果设置了<code>OnTouchListener</code>：
<ul>
<li>如果<code>onTouch()</code>返回false，则事件继续往后传递，交由<code>onTouchEvent()</code>处理；</li>
<li>如果返回true，由于<code>OnTouchListener</code>优先级比<code>onTouchEvent()</code>高，所以<code>onTouchEvent()</code>不会被调用，事件到此结束；</li>
</ul></li>
<li><code>onTouchEvent()</code>：
<ul>
<li>如果返回false，表明没有消费该事件，事件将会以冒泡的方式一直被传递到上层的view或Activity的<code>onTouchEvent()</code>事件处理，如果最上层的view或Activity的<code>onTouchEvent()</code>还是返回false，则该事件将消失，接下来的一系列事件都将会直接被上层的<code>onTouchEvent()</code>方法捕获；</li>
<li>如果返回true，表明消费了该事件，事件到此结束；</li>
<li>如果<code>return super.onTouchEvent(e)</code>，则表示按照默认的方式处理，效果和返回false一样；</li>
</ul></li>
<li>如果设置了<code>OnLongClickListener</code>和<code>OnClickListener</code>，只有<code>onTouchEvent()</code>不返回true才会被触发（实测如果调用了<code>super.onTouchEvent(e)</code>但是返回true也可以触发）</li>
</ul>
<p>父控件要拦截事件，则可以重写<code>onInterceptTouchEvent()</code>，并返回true，这样子控件就不会得到该事件，但子控件可以通过<code>getParent().requestDisallowInterceptTouchEvent()</code>来禁止拦截，该函数优先级比<code>onInterceptTouchEvent()</code>高</p>
<h3 id="事件拦截与消费">事件拦截与消费</h3>
<p>我们给LinearLayout重写<code>dispatchTouchEvent</code>、<code>onInterceptTouchEvent</code>、<code>onTouchEvent</code>，并给它设置<code>OnTouchListener</code>、<code>OnClickListener</code>、<code>OnLongClickListener</code></p>
<p>初始状态，没有任何拦截、消费的情况下：</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;onTouchEvent action=&quot;</span> <span class="op">+</span> event<span class="op">.</span><span class="fu">getAction</span><span class="op">());</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">dispatchTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;dispatchTouchEvent action=&quot;</span> <span class="op">+</span> event<span class="op">.</span><span class="fu">getAction</span><span class="op">());</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">dispatchTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onInterceptTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;onInterceptTouchEvent action=&quot;</span> <span class="op">+</span> event<span class="op">.</span><span class="fu">getAction</span><span class="op">());</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onInterceptTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>linearLayout<span class="op">.</span><span class="fu">setOnTouchListener</span><span class="op">((</span>view<span class="op">,</span> motionEvent<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;OnTouchListener action=&quot;</span> <span class="op">+</span> motionEvent<span class="op">.</span><span class="fu">getAction</span><span class="op">());</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>linearLayout<span class="op">.</span><span class="fu">setOnClickListener</span><span class="op">((</span>view<span class="op">)</span> <span class="op">-&gt;</span> <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;OnClickListener&quot;</span><span class="op">));</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>linearLayout<span class="op">.</span><span class="fu">setOnLongClickListener</span><span class="op">(</span>view <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;OnLongClickListener&quot;</span><span class="op">);</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code></pre></div>
<p>打印(<code>ACTION_DOWN = 0</code>、<code>ACTION_UP = 1</code>、<code>ACTION_MOVE = 2</code>)</p>
<pre><code>dispatchTouchEvent action=0
onInterceptTouchEvent action=0
onTouchListener action=0
onTouchEvent action=0
dispatchTouchEvent action=2
onTouchListener action=2
onTouchEvent action=2
onLongClickListener
dispatchTouchEvent action=1
onTouchListener action=1
onTouchEvent action=1
onClickListener</code></pre>
<p>把linearLayout的<code>super.onTouchEvent</code>删掉，直接返回<code>true</code>（表示消费了<code>onTouchEvent</code>事件）</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;onTouchEvent action=&quot;</span> <span class="op">+</span> event<span class="op">.</span><span class="fu">getAction</span><span class="op">());</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>这时<code>OnLongClickListener</code>和<code>OnClickListener</code>都不会触发</p>
<pre><code>dispatchTouchEvent action=0
onInterceptTouchEvent action=0
onTouchListener action=0
onTouchEvent action=0
dispatchTouchEvent action=2
onTouchListener action=2
onTouchEvent action=2
dispatchTouchEvent action=1
onTouchListener action=1
onTouchEvent action=1</code></pre>
<p>如果保留<code>super.onTouchEvent</code>，但返回<code>true</code></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;onTouchEvent action=&quot;</span> <span class="op">+</span> event<span class="op">.</span><span class="fu">getAction</span><span class="op">());</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>这时<code>OnLongClickListener</code>和<code>OnClickListener</code>可以正常触发，说明点击和长按事件是由<code>super.onTouchEvent</code>调用的，只要调用了<code>super.onTouchEvent</code>，无论我们有没有消费事件点击和长按都能正常执行</p>
<pre><code>dispatchTouchEvent action=0
onInterceptTouchEvent action=0
onTouchListener action=0
onTouchEvent action=0
onLongClickListener
dispatchTouchEvent action=2
onTouchListener action=2
onTouchEvent action=2
dispatchTouchEvent action=1
onTouchListener action=1
onTouchEvent action=1
onClickListener</code></pre>
<p>把代码恢复到初始状态，这时，如果我们在<code>setOnLongClickListener</code>返回<code>true</code></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>linearLayout<span class="op">.</span><span class="fu">setOnLongClickListener</span><span class="op">(</span>view <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;OnLongClickListener&quot;</span><span class="op">);</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code></pre></div>
<p>这时<code>OnClickListener</code>不会被触发</p>
<pre><code>dispatchTouchEvent action=0
onInterceptTouchEvent action=0
onTouchListener action=0
onTouchEvent action=0
onLongClickListener
dispatchTouchEvent action=2
onTouchListener action=2
onTouchEvent action=2
dispatchTouchEvent action=1
onTouchListener action=1
onTouchEvent action=1</code></pre>
<p>把代码恢复到初始状态，这时，如果我们在<code>linearLayout</code>的<code>onInterceptTouchEvent</code>中返回<code>true</code>，给<code>linearLayout</code>添加一个子控件<code>button</code>，并给重写button的<code>dispatchTouchEvent</code>、<code>onInterceptTouchEvent</code>、<code>onTouchEvent</code>，设置<code>OnTouchListener</code>、<code>OnClickListener</code>、<code>OnLongClickListener</code></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onInterceptTouchEvent</span><span class="op">(</span>MotionEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;linearLayout: onInterceptTouchEvent action=&quot;</span> <span class="op">+</span> event<span class="op">.</span><span class="fu">getAction</span><span class="op">());</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>对自己没有任何影响，但子控件会接收不到任何事件</p>
<pre><code>linearLayout: dispatchTouchEvent action=0
linearLayout: onInterceptTouchEvent action=0
linearLayout: onTouchListener action=0
linearLayout: onTouchEvent action=0
linearLayout: onLongClickListener
linearLayout: dispatchTouchEvent action=2
linearLayout: onTouchListener action=2
linearLayout: onTouchEvent action=2
linearLayout: dispatchTouchEvent action=1
linearLayout: onTouchListener action=1
linearLayout: onTouchEvent action=1
linearLayout: onClickListener</code></pre>
<p>而在没有拦截的时候是</p>
<pre><code>linearLayout: dispatchTouchEvent action=0
linearLayout: onInterceptTouchEvent action=0
button: dispatchTouchEvent action=0
button: onTouchListener
button: onTouchEvent action=0
button: onLongClickListener
linearLayout: dispatchTouchEvent action=2
linearLayout: onInterceptTouchEvent action=2
button: dispatchTouchEvent action=2
button: onTouchListener
button: onTouchEvent action=2
linearLayout: dispatchTouchEvent action=2
linearLayout: onInterceptTouchEvent action=2
button: dispatchTouchEvent action=2
button: onTouchListener
button: onTouchEvent action=2
linearLayout: dispatchTouchEvent action=1
linearLayout: onInterceptTouchEvent action=1
button: dispatchTouchEvent action=1
button: onTouchListener
button: onTouchEvent action=1
button: onClickListener</code></pre>
<p>总结</p>
<p>在没有消费事件的情况下，事件的传递流程是</p>
<pre class="flow"><code>st=&gt;start: 用户触摸
f1=&gt;operation: ViewGroup控件dispatchTouchEvent
f2=&gt;operation: ViewGroup控件onInterceptTouchEvent
f3=&gt;operation: View控件dispatchTouchEvent
f4=&gt;operation: View控件OnTouchListener
f5=&gt;operation: View控件onTouchEvent
cond1=&gt;condition: 继续触摸
f6=&gt;operation: View控件OnLongClickListener
f7=&gt;operation: View控件OnClickListener

st-&gt;f1-&gt;f2-&gt;f3-&gt;f4-&gt;f5-&gt;cond1
cond1(no)-&gt;f6-&gt;f7
cond1(yes)-&gt;f1</code></pre>
<p>如果父<code>View</code>在<code>OnInterceptTouchEvent</code>中返回true，则子<code>View</code>所有事件都不会接收到（子类可以通过<code>getParent().requestDisallInterceptRouchEvent(true)</code>来禁止父<code>View</code>拦截），此时子<code>View</code>的<code>onTouchEvent</code>事件交由父<code>View</code>的<code>onTouchEvent</code>处理</p>
<p>如果<code>onInterceptTouchEvent</code>在<code>ACTION_DOWN</code>的时候返回<code>false</code>，后面的<code>ACTION_MOVE</code>和<code>ACTION_UP</code>都不会再调用<code>onInterceptTouchEvent</code>（如果在<code>ACTION_DOWN</code>的时候返回<code>true</code>，后面的事件还能收到）</p>
<p>上面任何一个函数返回<code>true</code>，代表消费了事件，则后面的函数都不会继续执行，但<code>OnLongClickListener</code>和<code>OnClickListener</code>是通过<code>super.onTouchEvent</code>实现的，只要调用了<code>super.onTouchEvent</code>，无论有没有消费事件，都可以触发</p>
<p>上面的图画得不够准确，<code>OnLongClickListener</code>会在触摸一段事件后触发，触发后如果用户还在长按，还会继续执行<code>ViewGroup控件dispatchTouchEvent</code>到<code>View控件onTouchEvent</code>，但只会触发<code>OnLongClickListener</code>一次，而<code>OnClickListener</code>总是在最后触发的（<code>ACTION_UP</code>）</p>
<h3 id="案例-侧滑返回">案例: 侧滑返回</h3>
<p>参考github项目<a href="https://github.com/ikew0ng/SwipeBackLayout">SwipeBackLayout</a></p>
<p><strong>原理</strong></p>
<p>Activity本身是不可以滑动的，我们滑动的其实是
Activity里面的可见元素，而我们将Activity设置为透明的，滑动时，由于Activity的底部是透明的，我们就可以在滑动过程中看到下面的Activity，这样看起来就是在滑动
Activity</p>
<p><strong>实现</strong></p>
<p>设置Activity透明背景、切换动画</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">style</span><span class="ot"> name=</span><span class="st">&quot;AppTheme.TransparentActivity&quot;</span><span class="ot"> parent=</span><span class="st">&quot;Theme.AppCompat.NoActionBar&quot;</span>&gt;</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:windowBackground&quot;</span>&gt;@android:color/transparent&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:windowIsTranslucent&quot;</span>&gt;true&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:windowAnimationStyle&quot;</span>&gt;@style/SlideRightAnimation&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">style</span>&gt;</span></code></pre></div>
<p>设置Activity进入和退出的动画</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">style</span><span class="ot"> name=</span><span class="st">&quot;SlideRightAnimation&quot;</span><span class="ot"> parent=</span><span class="st">&quot;@android:style/Animation.Activity&quot;</span>&gt;</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:activityOpenEnterAnimation&quot;</span>&gt;@anim/slide_in_right&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:activityOpenExitAnimation&quot;</span>&gt;@null&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:activityCloseEnterAnimation&quot;</span>&gt;@null&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:activityCloseExitAnimation&quot;</span>&gt;@anim/slide_out_right&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:taskOpenEnterAnimation&quot;</span>&gt;@anim/slide_in_right&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:taskOpenExitAnimation&quot;</span>&gt;@null&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:taskCloseEnterAnimation&quot;</span>&gt;@null&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:taskCloseExitAnimation&quot;</span>&gt;@anim/slide_out_right&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:taskToFrontEnterAnimation&quot;</span>&gt;@anim/slide_in_right&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:taskToFrontExitAnimation&quot;</span>&gt;@null&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:taskToBackEnterAnimation&quot;</span>&gt;@null&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:taskToBackExitAnimation&quot;</span>&gt;@anim/slide_out_right&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:windowEnterAnimation&quot;</span>&gt;@anim/slide_in_right&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;android:windowExitAnimation&quot;</span>&gt;@anim/slide_out_right&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">style</span>&gt;</span></code></pre></div>
<p>slide_in_right.xml</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">translate</span><span class="ot">  xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:duration=</span><span class="st">&quot;250&quot;</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:fromXDelta=</span><span class="st">&quot;100%p&quot;</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:toXDelta=</span><span class="st">&quot;0&quot;</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:interpolator=</span><span class="st">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span>&gt;</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">translate</span>&gt;</span></code></pre></div>
<p>slide_out_right.xml</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">translate</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:duration=</span><span class="st">&quot;250&quot;</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:fromXDelta=</span><span class="st">&quot;0&quot;</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:toXDelta=</span><span class="st">&quot;100%p&quot;</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:interpolator=</span><span class="st">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span>&gt;</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">translate</span>&gt;</span></code></pre></div>
<p>我们的view都放在<code>DecorView</code>中（可以通过<code>HierarchyView</code>工具查看，该工具在sdk的tools目录下），我们把自己的SwipeBackLayout，加到<code>DecorView</code>中，然后通过监听SwipeBackLayout的<code>onTouchEvent</code>，可以判断是否需要滑动返回</p>
<p>把自己（SwipeBackLayout）替换为<code>DecorView</code>的第一个子view</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 在DecorView下增加SwipeBackLayout（FragmentLayout）</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>ViewGroup decor <span class="op">=</span> <span class="op">(</span>ViewGroup<span class="op">)</span> activity<span class="op">.</span><span class="fu">getWindow</span><span class="op">().</span><span class="fu">getDecorView</span><span class="op">();</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 拿到第一个子view-decorChild</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>ViewGroup decorChild <span class="op">=</span> <span class="op">(</span>ViewGroup<span class="op">)</span> decor<span class="op">.</span><span class="fu">getChildAt</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>ViewGroup<span class="op">.</span><span class="fu">LayoutParams</span> params <span class="op">=</span> decorChild<span class="op">.</span><span class="fu">getLayoutParams</span><span class="op">();</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 删除子view-decorChild</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>decor<span class="op">.</span><span class="fu">removeView</span><span class="op">(</span>decorChild<span class="op">);</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co">// 把子view-decorChild添加到SwipeBackLayout（FragmentLayout）下</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="fu">addView</span><span class="op">(</span>decorChild<span class="op">);</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="co">// 把SwipeBackLayout（FragmentLayout）添加到DecorView下</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>decor<span class="op">.</span><span class="fu">addView</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> params<span class="op">);</span></span></code></pre></div>
<p>监听事件</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>ViewGroup decorChild<span class="op">;</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="dt">boolean</span> swipeEnabled <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="dt">boolean</span> canSwipe <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="dt">boolean</span> ignoreSwipe <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> downX<span class="op">;</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> downY<span class="op">;</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastX<span class="op">;</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> currentX<span class="op">;</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> currentY<span class="op">;</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">dispatchTouchEvent</span><span class="op">(</span><span class="at">@NonNull</span> MotionEvent ev<span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>swipeEnabled <span class="op">&amp;&amp;</span> <span class="op">!</span>canSwipe <span class="op">&amp;&amp;</span> <span class="op">!</span>ignoreSwipe<span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>ev<span class="op">.</span><span class="fu">getAction</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_DOWN</span><span class="op">:</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>                downX <span class="op">=</span> ev<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>                downY <span class="op">=</span> ev<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>                currentX <span class="op">=</span> downX<span class="op">;</span></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>                currentY <span class="op">=</span> downY<span class="op">;</span></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>                lastX <span class="op">=</span> downX<span class="op">;</span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_MOVE</span><span class="op">:</span></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> dx <span class="op">=</span> ev<span class="op">.</span><span class="fu">getX</span><span class="op">()</span> <span class="op">-</span> downX<span class="op">;</span></span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> dy <span class="op">=</span> ev<span class="op">.</span><span class="fu">getY</span><span class="op">()</span> <span class="op">-</span> downY<span class="op">;</span></span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy <span class="op">&gt;</span> touchSlop <span class="op">*</span> touchSlop<span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>dy <span class="op">==</span> <span class="fl">0f</span> <span class="op">||</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span><span class="op">(</span>dx <span class="op">/</span> dy<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>                        downX <span class="op">=</span> ev<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a>                        downY <span class="op">=</span> ev<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>                        currentX <span class="op">=</span> downX<span class="op">;</span></span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>                        currentY <span class="op">=</span> downY<span class="op">;</span></span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a>                        lastX <span class="op">=</span> downX<span class="op">;</span></span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a>                        canSwipe <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a>                        ignoreSwipe <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ev<span class="op">.</span><span class="fu">getAction</span><span class="op">()</span> <span class="op">==</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_UP</span> <span class="op">||</span> ev<span class="op">.</span><span class="fu">getAction</span><span class="op">()</span> <span class="op">==</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_CANCEL</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a>        ignoreSwipe <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">dispatchTouchEvent</span><span class="op">(</span>ev<span class="op">);</span></span>
<span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb116-46"><a href="#cb116-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-47"><a href="#cb116-47" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb116-48"><a href="#cb116-48" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onInterceptTouchEvent</span><span class="op">(</span>MotionEvent ev<span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-49"><a href="#cb116-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> canSwipe <span class="op">||</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onInterceptTouchEvent</span><span class="op">(</span>ev<span class="op">);</span></span>
<span id="cb116-50"><a href="#cb116-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb116-51"><a href="#cb116-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-52"><a href="#cb116-52" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb116-53"><a href="#cb116-53" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onTouchEvent</span><span class="op">(</span><span class="at">@NonNull</span> MotionEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-54"><a href="#cb116-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>canSwipe<span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-55"><a href="#cb116-55" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> action <span class="op">=</span> event<span class="op">.</span><span class="fu">getAction</span><span class="op">();</span></span>
<span id="cb116-56"><a href="#cb116-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>action<span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-57"><a href="#cb116-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_DOWN</span><span class="op">:</span></span>
<span id="cb116-58"><a href="#cb116-58" aria-hidden="true" tabindex="-1"></a>                downX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb116-59"><a href="#cb116-59" aria-hidden="true" tabindex="-1"></a>                downY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb116-60"><a href="#cb116-60" aria-hidden="true" tabindex="-1"></a>                currentX <span class="op">=</span> downX<span class="op">;</span></span>
<span id="cb116-61"><a href="#cb116-61" aria-hidden="true" tabindex="-1"></a>                currentY <span class="op">=</span> downY<span class="op">;</span></span>
<span id="cb116-62"><a href="#cb116-62" aria-hidden="true" tabindex="-1"></a>                lastX <span class="op">=</span> downX<span class="op">;</span></span>
<span id="cb116-63"><a href="#cb116-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb116-64"><a href="#cb116-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_MOVE</span><span class="op">:</span></span>
<span id="cb116-65"><a href="#cb116-65" aria-hidden="true" tabindex="-1"></a>                currentX <span class="op">=</span> event<span class="op">.</span><span class="fu">getX</span><span class="op">();</span></span>
<span id="cb116-66"><a href="#cb116-66" aria-hidden="true" tabindex="-1"></a>                currentY <span class="op">=</span> event<span class="op">.</span><span class="fu">getY</span><span class="op">();</span></span>
<span id="cb116-67"><a href="#cb116-67" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> dx <span class="op">=</span> currentX <span class="op">-</span> lastX<span class="op">;</span></span>
<span id="cb116-68"><a href="#cb116-68" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span><span class="fu">getContentX</span><span class="op">()</span> <span class="op">+</span> dx <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-69"><a href="#cb116-69" aria-hidden="true" tabindex="-1"></a>                    decorChild<span class="op">.</span><span class="fu">setX</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb116-70"><a href="#cb116-70" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb116-71"><a href="#cb116-71" aria-hidden="true" tabindex="-1"></a>                    decorChild<span class="op">.</span><span class="fu">setX</span><span class="op">(</span>decorChild<span class="op">.</span><span class="fu">getX</span><span class="op">()</span> <span class="op">+</span> dx<span class="op">);</span></span>
<span id="cb116-72"><a href="#cb116-72" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb116-73"><a href="#cb116-73" aria-hidden="true" tabindex="-1"></a>                lastX <span class="op">=</span> currentX<span class="op">;</span></span>
<span id="cb116-74"><a href="#cb116-74" aria-hidden="true" tabindex="-1"></a>                <span class="fu">invalidate</span><span class="op">();</span></span>
<span id="cb116-75"><a href="#cb116-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb116-76"><a href="#cb116-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_UP</span><span class="op">:</span></span>
<span id="cb116-77"><a href="#cb116-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> MotionEvent<span class="op">.</span><span class="fu">ACTION_CANCEL</span><span class="op">:</span></span>
<span id="cb116-78"><a href="#cb116-78" aria-hidden="true" tabindex="-1"></a>                canSwipe <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb116-79"><a href="#cb116-79" aria-hidden="true" tabindex="-1"></a>                <span class="co">//回弹</span></span>
<span id="cb116-80"><a href="#cb116-80" aria-hidden="true" tabindex="-1"></a>                <span class="co">//...</span></span>
<span id="cb116-81"><a href="#cb116-81" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb116-82"><a href="#cb116-82" aria-hidden="true" tabindex="-1"></a>            <span class="kw">default</span><span class="op">:</span></span>
<span id="cb116-83"><a href="#cb116-83" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb116-84"><a href="#cb116-84" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb116-85"><a href="#cb116-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb116-86"><a href="#cb116-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onTouchEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb116-87"><a href="#cb116-87" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="shape">Shape</h3>
<p>shape可以自定义图形，对应JAVA代码中的ShapeDrawable类</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 矩形:rectangle、椭圆:oval、线:line、圆环:ring --&gt;</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co">对于ring(圆环)，还可以设置</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="co">android:innerRadius: 指圆环的内半径</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="co">android:thickness: 指圆环的厚度</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="co">android:innerRadiusRatio: 内半径占整个Drawable宽度的比例，默认是9，如果为n，那么内半径 = 宽度/n</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co">android:thicknessRatio: 厚度占整个Drawable宽度的比例，默认是3，如果为n，那么厚度 = 宽度/n</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="co">android:useLevel: 官方文档建议使用false，否则可能无法达到预期显示效果。除非当做LevelListDrawable来使用</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">shape</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:shape=</span><span class="er">[</span><span class="st">&quot;rectangle&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">oval</span><span class="er">&quot;</span> <span class="er">|</span> <span class="er">&quot;line&quot;</span> <span class="er">|</span> <span class="er">&quot;ring&quot;]</span> <span class="er">&gt;</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;!--</span> <span class="er">corners:圆角大小</span> <span class="er">--&gt;</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;corners</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>        <span class="er">android:radius</span><span class="ot">=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:topLeftRadius=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:topRightRadius=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:bottomLeftRadius=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:bottomRightRadius=</span><span class="st">&quot;integer&quot;</span> /&gt;</span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- gradient:渐变 --&gt;</span></span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">gradient</span></span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:angle=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:centerX=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:centerY=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:centerColor=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:endColor=</span><span class="st">&quot;color&quot;</span></span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:gradientRadius=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:startColor=</span><span class="st">&quot;color&quot;</span></span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:type=</span><span class="er">[</span><span class="st">&quot;linear&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">radial</span><span class="er">&quot;</span> <span class="er">|</span> <span class="er">&quot;sweep&quot;]</span></span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a>        <span class="er">android:useLevel</span><span class="ot">=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span> <span class="er">/&gt;</span></span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;padding</span></span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a>        <span class="er">android:left</span><span class="ot">=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:top=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:right=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:bottom=</span><span class="st">&quot;integer&quot;</span> /&gt;</span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">size</span></span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:width=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:height=</span><span class="st">&quot;integer&quot;</span> /&gt;</span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- solid:填充颜色 --&gt;</span></span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">solid</span></span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:color=</span><span class="st">&quot;color&quot;</span> /&gt;</span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- stroke:边框线 --&gt;</span></span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">stroke</span></span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:width=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-46"><a href="#cb117-46" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:color=</span><span class="st">&quot;color&quot;</span></span>
<span id="cb117-47"><a href="#cb117-47" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:dashWidth=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb117-48"><a href="#cb117-48" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:dashGap=</span><span class="st">&quot;integer&quot;</span> /&gt;</span>
<span id="cb117-49"><a href="#cb117-49" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>/shape&gt;</span></code></pre></div>
<p>JAVA代码中还可以通过指定Path实现其他效果</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">//画菱形</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>Path path <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">();</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">moveTo</span><span class="op">(</span><span class="dv">50</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span><span class="co">//单位都是px，实际使用需转成dp</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">lineTo</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">50</span><span class="op">);</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">lineTo</span><span class="op">(</span><span class="dv">50</span><span class="op">,</span> <span class="dv">100</span><span class="op">);</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">lineTo</span><span class="op">(</span><span class="dv">100</span><span class="op">,</span> <span class="dv">50</span><span class="op">);</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>ShapeDrawable mDrawables <span class="op">=</span> <span class="kw">new</span> <span class="fu">ShapeDrawable</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PathShape</span><span class="op">(</span>path<span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">100</span><span class="op">));</span></span></code></pre></div>
<h3 id="rectshape">RectShape</h3>
<p>RectShape</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>RectShape rectShape <span class="op">=</span> <span class="kw">new</span> <span class="fu">RectShape</span><span class="op">();</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>ShapeDrawable drawable <span class="op">=</span> <span class="kw">new</span> <span class="fu">ShapeDrawable</span><span class="op">(</span>rectShape<span class="op">);</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>drawable<span class="op">.</span><span class="fu">getPaint</span><span class="op">().</span><span class="fu">setColor</span><span class="op">(</span><span class="bu">Color</span><span class="op">.</span><span class="fu">BLUE</span><span class="op">);</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>drawable<span class="op">.</span><span class="fu">getPaint</span><span class="op">().</span><span class="fu">setStyle</span><span class="op">(</span><span class="bu">Paint</span><span class="op">.</span><span class="fu">Style</span><span class="op">.</span><span class="fu">FILL</span><span class="op">);</span></span></code></pre></div>
<p>其子类有</p>
<ul>
<li><p>ArcShape: 弧形</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>ArcShape arcShape <span class="op">=</span> <span class="kw">new</span> <span class="fu">ArcShape</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">180</span><span class="op">);</span></span></code></pre></div></li>
<li><p>OvalShape: 椭圆</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>OvalShape ovalShape <span class="op">=</span> <span class="kw">new</span> <span class="fu">OvalShape</span><span class="op">();</span></span></code></pre></div></li>
<li><p>RoundRectShape: 圆角矩形</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">//指定外部矩形的弧度</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span><span class="op">[]</span> outerRadii <span class="op">=</span> <span class="kw">new</span> <span class="dt">float</span><span class="op">[]</span> <span class="op">{</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span> <span class="op">};</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co">//执行内部矩形与外部矩形的距离</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>RectF inset <span class="op">=</span> <span class="kw">new</span> <span class="fu">RectF</span><span class="op">(</span><span class="dv">50</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">50</span><span class="op">);</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co">//内部矩形的弧度</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span><span class="op">[]</span> innerRadii <span class="op">=</span> <span class="kw">new</span> <span class="dt">float</span><span class="op">[]</span> <span class="op">{</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">20</span> <span class="op">};</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>RoundRectShape rr <span class="op">=</span> <span class="kw">new</span> <span class="fu">RoundRectShape</span><span class="op">(</span>outerRadii<span class="op">,</span> inset<span class="op">,</span> innerRadii<span class="op">);</span></span></code></pre></div></li>
</ul>
<h3 id="自定义属性">自定义属性</h3>
<p>在<code>res/values</code>文件下定义一个<code>attrs.xml</code>文件（文件名固定为<code>attrs.xml</code>，不可更改），内容如下</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">resources</span>&gt;</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">declare-styleable</span><span class="ot"> name=</span><span class="st">&quot;MyAttr&quot;</span>&gt;</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">attr</span><span class="ot"> name=</span><span class="st">&quot;name&quot;</span><span class="ot"> format=</span><span class="st">&quot;string&quot;</span>/&gt;</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">attr</span><span class="ot"> name=</span><span class="st">&quot;myWidth&quot;</span><span class="ot"> format=</span><span class="st">&quot;dimension&quot;</span> /&gt;</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">attr</span><span class="ot"> name=</span><span class="st">&quot;id&quot;</span><span class="ot"> format=</span><span class="st">&quot;integer&quot;</span>/&gt;</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">attr</span><span class="ot"> name=</span><span class="st">&quot;portrait&quot;</span><span class="ot"> format=</span><span class="st">&quot;reference|color&quot;</span>/&gt;</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">declare-styleable</span>&gt;</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">resources</span>&gt;</span></code></pre></div>
<p>format可以指定的属性有：</p>
<ul>
<li>color</li>
<li>boolean</li>
<li>dimension</li>
<li>float</li>
<li>integer</li>
<li>string</li>
<li>fraction: 百分数</li>
<li>enum: 枚举</li>
</ul>
<div class="sourceCode" id="cb124"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">attr</span><span class="ot"> name=</span><span class="st">&quot;style&quot;</span>&gt;</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>　　&lt;<span class="kw">enum</span><span class="ot"> name=</span><span class="st">&quot;STROKE&quot;</span><span class="ot"> value=</span><span class="st">&quot;0&quot;</span>&gt;&lt;/<span class="kw">enum</span>&gt;</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>　　&lt;<span class="kw">enum</span><span class="ot"> name=</span><span class="st">&quot;FILL&quot;</span><span class="ot"> value=</span><span class="st">&quot;1&quot;</span>&gt;&lt;/<span class="kw">enum</span>&gt;</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">attr</span>&gt;</span></code></pre></div>
<ul>
<li>flag: 自定义值</li>
</ul>
<div class="sourceCode" id="cb125"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">attr</span><span class="ot"> name=</span><span class="st">&quot;weight&quot;</span>&gt;</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">flag</span><span class="ot"> name=</span><span class="st">&quot;fat&quot;</span><span class="ot"> value=</span><span class="st">&quot;0&quot;</span> /&gt;</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">flag</span><span class="ot"> name=</span><span class="st">&quot;mid&quot;</span><span class="ot"> value=</span><span class="st">&quot;1&quot;</span> /&gt;</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">flag</span><span class="ot"> name=</span><span class="st">&quot;thin&quot;</span><span class="ot"> value=</span><span class="st">&quot;2&quot;</span> /&gt;</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">attr</span>&gt;</span></code></pre></div>
<ul>
<li>reference: 资源引用</li>
</ul>
<p>使用自定义属性</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">RelativeLayout</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="ot">xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="ot">xmlns:myapp=</span><span class="st">&quot;http://schemas.android.com/apk/res/com.myapp&quot;</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:orientation=</span><span class="st">&quot;vertical&quot;</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;fill_parent&quot;</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;fill_parent&quot;</span> &gt;</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">com.myapp.MyView</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:id=</span><span class="st">&quot;@+id/myview&quot;</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_width=</span><span class="st">&quot;fill_parent&quot;</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_height=</span><span class="st">&quot;wrap_content&quot;</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_alignParentBottom=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:gravity=</span><span class="st">&quot;center&quot;</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a><span class="ot">        myapp:name=</span><span class="st">&quot;小明&quot;</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a><span class="ot">        myapp:id=</span><span class="st">&quot;5&quot;</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="ot">        myapp:myWidth=</span><span class="st">&quot;50dp&quot;</span></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="ot">        myapp:portrait=</span><span class="st">&quot;@drawable/pic_portrait&quot;</span>/&gt;</span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">RelativeLayout</span>&gt;</span></code></pre></div>
<p>在JAVA代码中获取属性值</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>TypedArray typedArray <span class="op">=</span> context<span class="op">.</span><span class="fu">obtainStyledAttributes</span><span class="op">(</span>attrs<span class="op">,</span>R<span class="op">.</span><span class="fu">styleable</span><span class="op">.</span><span class="fu">MyAttr</span><span class="op">);</span><span class="co">//attrs就是当前自定义view的构造函数中的AttributeSet参数</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> typedArray<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>R<span class="op">.</span><span class="fu">styleable</span><span class="op">.</span><span class="fu">MyAttr_name</span><span class="op">,</span> <span class="st">&quot;&quot;</span><span class="op">);</span><span class="co">//第二个参数为不匹配时的默认值</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>id <span class="op">=</span> typedArray<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span>R<span class="op">.</span><span class="fu">styleable</span><span class="op">.</span><span class="fu">MyAttr_id</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>itemBg <span class="op">=</span> typedArray<span class="op">.</span><span class="fu">getResourceId</span><span class="op">(</span>R<span class="op">.</span><span class="fu">styleable</span><span class="op">.</span><span class="fu">MyAttr_portrait</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>typedArray<span class="op">.</span><span class="fu">recycle</span><span class="op">();</span><span class="co">//用完记得回收</span></span></code></pre></div>
<h2 id="service">Service</h2>
<p>配置</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">service</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:description=</span><span class="st">&quot;string resource&quot;</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:directBootAware=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:enabled</span><span class="ot">=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:exported</span><span class="ot">=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:icon</span><span class="ot">=</span><span class="st">&quot;drawable resource&quot;</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:isolatedProcess=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:label</span><span class="ot">=</span><span class="st">&quot;string resource&quot;</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:name=</span><span class="st">&quot;string&quot;</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:permission=</span><span class="st">&quot;string&quot;</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:process=</span><span class="st">&quot;string&quot;</span> &gt;</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;com.myapp.MyService&quot;</span> /&gt;</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">service</span>&gt;</span></code></pre></div>
<ul>
<li>android:directBootAware：默认为false，数据保存在Credential encrypted
storage，默认存储数据的地方，仅在用户解锁手机后可用；如果为true，则应用数据将保存在Device
encrypted storage，是Direct
Boot模式下和用户解锁手机后都可以使用的存储空间。当手机开机，首先进入一个Dierect
Boot的模式，在这个模式下只可以访问device-encrypted
store下的数据，无法访问credential-encrypted
store下的数据；当用户解锁后就都可以访问了，主要用于手机丢失时，以免手机数据被盗取；该设置四大组件都有，但主要用于receiver</li>
<li>android:enabled：是否可以被系统实例化，默认为 true因为父标签 也有
enable 属性，所以必须两个都为默认值 true
的情况下服务才会被激活，否则不会激活</li>
<li>android:exported：代表是否能被其他应用隐式调用，其默认值是由service中有无intent-filter决定的，如果有intent-filter，默认值为true，否则为false。为false的情况下，即使有intent-filter匹配，也无法打开，即无法被其他应用隐式调用；exported为true时无法跨进程通信</li>
<li>android:isolatedProcess：设置 true
意味着，服务会在一个特殊的进程下运行，这个进程与系统其他进程分开且没有自己的权限。与其通信的唯一途径是通过服务的API(bind
and start)</li>
<li>android:name：对应Service的全类名</li>
<li>android:permission：权限声明</li>
<li>android:process：是否需要在单独的进程中运行，当设置为android:process=”:remote”时，代表Service在单独的进程中运行（<code>:remote</code>的意思是在前面附上包名，相当于package_name:remote）</li>
<li>intent-filter中的action的name可以是任意字符串，只要创建隐式intent时一致就可以了(Android5.0以上就已经禁用了隐式intent，一般不再设置intent-filter)</li>
</ul>
<h3 id="startservice">startService</h3>
<p>startService方式启动：<code>onCreate()-&gt;onStartCommand()-&gt;onDestory()</code>，重复调用startService则会重复调用onStartCommand，而不会新建一个Service，由于onBind方法是个抽象方法，所以即使通过startService方式启动没有用到该方法，但还是必须重写，此时将返回值设成null即可，停止服务可以用stopService()或者StopSelf()；该方法一般用于一些后台操作（如播放音乐）</p>
<p><code>int onStartCommand(Intent intent, int flags, int startId)</code>，flag可选值有</p>
<ul>
<li>0：没有</li>
<li>START_FLAG_REDELIVERY：这个值代表了onStartCommand方法的返回值为START_REDELIVER_INTENT，而且在上一次服务被杀死前会去调用stopSelf方法停止服务</li>
<li>START_FLAG_RETRY：代表当onStartCommand调用后一直没有返回值时，会尝试重新去调用onStartCommand</li>
</ul>
<p>onStartCommand的返回值有 -
START_NOT_STICKY：表示当Service运行的进程被Android系统强制杀掉之后，不会重新创建该Service，如果想重新实例化该Service，就必须重新调用startService来启动
-
START_STICKY：表示Service运行的进程被Android系统强制杀掉之后，Android系统会将该Service依然设置为started状态（即运行状态），但是不再保存onStartCommand方法传入的intent对象，然后Android系统会尝试再次重新创建该Service，并执行onStartCommand回调方法，这时onStartCommand回调方法的Intent参数为null，也就是onStartCommand方法虽然会执行但是获取不到intent信息
-
START_REDELIVER_INTENT：表示Service运行的进程被Android系统强制杀掉之后，与返回START_STICKY的情况类似，Android系统会将再次重新创建该Service，并执行onStartCommand回调方法，但是不同的是，Android系统会再次将Service在被杀掉之前最后一次传入onStartCommand方法中的Intent再次保留下来并再次传入到重新创建后的Service的onStartCommand方法中，这样我们就能读取到intent参数
-
START_STICKY_COMPATIBILITY：START_STICKY的兼容版本，但不保证服务被杀死后一定能重启</p>
<p>IntentService是对Service封装，其实就是一个带有工作线程的Service，重写onHandleIntent，该函数是在子线程执行的，可以在其中执行耗时任务，重复调用startService时，就会重复调用该方法，但任务只能一个一个地执行，不能同时执行多个任务，当所有任务执行完成后，就会自动调用onDestory，无需手动停止Service</p>
<h3 id="bindservice">bindService</h3>
<p>bindService方式启动：<code>onCreate()-&gt;onBind()-&gt;onUnbind()-&gt;onDestory()</code>，重复调用bindService则会重复调用onBind，而不会新建一个Service，在Activity销毁时必须unbindService，否则会出现内存泄漏；该方法启动的服务一般用于两个线程的通讯（如AIDL）</p>
<ul>
<li>如果先bindService，再startService，则绑定服务将会转为启动服务运行，这时如果之前绑定的宿主（Activity）被销毁了，也不会影响服务的运行，服务还是会一直运行下去，指定收到调用停止服务或者内存不足时才会销毁该服务</li>
<li>如果先startService，再bindService，当前启动服务并不会转为绑定服务，但是还是会与宿主绑定，只是即使宿主解除绑定后，服务依然按启动服务的生命周期在后台运行，直到有Context调用了stopService()或是服务本身调用了stopSelf()方法抑或内存不足时才会销毁服务</li>
</ul>
<p>无论以哪种方式启动，Service都运行在它的宿主线程中，如果在Service中执行耗时操作时，主线程会卡死，会出现ANR(Android
Not
Response)，所以一般都是在Service中创建一个新的线程来处理一些耗时工作</p>
<p>绑定或启动服务的时机： -
如果只需要在Activity可见时与服务交互，则应在onStart()期间绑定，在onStop()期间取消绑定
-
如果希望Activity在后台停止运行状态下仍可接收响应，则可在onCreate()期间绑定，在onDestroy()期间取消绑定
- 注意：切勿在 Activity 的 onResume() 和 onPause()
期间绑定和取消绑定，因为每一次生命周期转换都会发生这些回调，这样反复绑定与解绑是不合理的</p>
<h3 id="context与service交互">Context与Service交互</h3>
<p>要在客户端（Activity）使用Service的公共方法，有以下思路：</p>
<h4 id="ibinder">IBinder</h4>
<p>自定义IBinder，用于Service(服务端)与客户端相同的进程中运行时的通讯</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyService <span class="kw">extends</span> <span class="bu">Service</span><span class="op">{</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> MyBinder binder <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyBinder</span><span class="op">();</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//自定义Binder，有一个返回服务器实例的方法</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> MyBinder <span class="kw">extends</span> <span class="bu">Binder</span> <span class="op">{</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>        MyService <span class="fu">getService</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> MyService<span class="op">.</span><span class="fu">this</span><span class="op">;</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//在onBind返回自定义的Binder，就可以通过该Binder获取Service实例</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IBinder <span class="fu">onBind</span><span class="op">(</span>Intent intent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> binder<span class="op">;</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//公共方法</span></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getName</span><span class="op">(){</span></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>        retrun <span class="kw">this</span><span class="op">.</span><span class="fu">getClass</span><span class="op">().</span><span class="fu">getName</span><span class="op">();</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MainActivity <span class="kw">extends</span> Activity<span class="op">{</span></span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>    ServiceConnection conn<span class="op">;</span></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> MyService myService<span class="op">;</span></span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">){</span></span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_main</span><span class="op">);</span></span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>        Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> MyService<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>        conn <span class="op">=</span> <span class="kw">new</span> <span class="fu">ServiceConnection</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>            <span class="co">//绑定成功的回调</span></span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onServiceConnected</span><span class="op">(</span>ComponentName name<span class="op">,</span> IBinder service<span class="op">)</span> <span class="op">{</span></span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>                MyService<span class="op">.</span><span class="fu">MyBinder</span> binder <span class="op">=</span> <span class="op">(</span>MyService<span class="op">.</span><span class="fu">MyBinder</span><span class="op">)</span> service<span class="op">;</span></span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>                myService <span class="op">=</span> binder<span class="op">.</span><span class="fu">getService</span><span class="op">();</span></span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>            <span class="co">//当取消绑定的时候被回调。但正常情况下是不被调用的，它的调用时机是当Service服务被意外销毁时，例如内存的资源不足时这个方法才被自动调用</span></span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb129-39"><a href="#cb129-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onServiceDisconnected</span><span class="op">(</span>ComponentName name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb129-40"><a href="#cb129-40" aria-hidden="true" tabindex="-1"></a>                myService<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb129-41"><a href="#cb129-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb129-42"><a href="#cb129-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb129-43"><a href="#cb129-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bindService</span><span class="op">(</span>intent<span class="op">,</span> conn<span class="op">,</span> <span class="bu">Service</span><span class="op">.</span><span class="fu">BIND_AUTO_CREATE</span><span class="op">);</span></span>
<span id="cb129-44"><a href="#cb129-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb129-45"><a href="#cb129-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-46"><a href="#cb129-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onDestory</span><span class="op">(){</span></span>
<span id="cb129-47"><a href="#cb129-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>myService <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb129-48"><a href="#cb129-48" aria-hidden="true" tabindex="-1"></a>            myService <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb129-49"><a href="#cb129-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">unbindService</span><span class="op">(</span>conn<span class="op">);</span></span>
<span id="cb129-50"><a href="#cb129-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb129-51"><a href="#cb129-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb129-52"><a href="#cb129-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="messenger">Messenger</h4>
<p>使用Messenger，可以执行进程间通信(IPC)，Messenger是以串行的方式处理客户端发来的消息，这样我们就不必对服务进行线程安全设计了；由于Message和Messenger都实现了Parcelable接口，可以进程传递数据，但message.obj没有实现该接口，所以无法跨进程传输对象</p>
<p>客户端向服务器端发消息：
①服务器端实现一个Handler，由其接收来自客户端的每个调用的回调
②用Handler创建Messenger对象
③Messenger创建一个IBinder，服务通过onBind()使其返回客户端
④客户端使用IBinder将Messenger（引用服务的Handler）实例化，然后使用Messenger将Message对象发送给服务
⑤服务在其Handler中（在handleMessage()方法中）接收每个Message</p>
<p>服务器端向客户端回复消息：
①客户端实现一个Handler，用于接收服务器端的回复 ②通过Handler创建Messenger
③通过message.replyTo将Messenger绑定到message中
④服务器端通过message.replyTo得到Messenger
⑤通过Messenger向客户端发回复</p>
<p>服务端：</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MessengerService <span class="kw">extends</span> <span class="bu">Service</span> <span class="op">{</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Messenger mMessenger <span class="op">=</span> <span class="kw">new</span> <span class="fu">Messenger</span><span class="op">(</span><span class="kw">new</span> <span class="fu">IncomingHandler</span><span class="op">());</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">static</span> <span class="dt">int</span> MSG_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">static</span> <span class="dt">int</span> MSG_2 <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> IncomingHandler <span class="kw">extends</span> <span class="bu">Handler</span> <span class="op">{</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleMessage</span><span class="op">(</span>Message msg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span><span class="op">(</span>msg<span class="op">.</span><span class="fu">what</span><span class="op">){</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> MSG_1<span class="op">:</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>                    <span class="co">//接收到来自客户端的信息</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>                    Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span> <span class="st">&quot;接收到客户端的message&quot;</span><span class="op">);</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>                    <span class="co">//回复客户端</span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>                    Messenger client<span class="op">=</span>msg<span class="op">.</span><span class="fu">replyTo</span><span class="op">;</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>                    Message replyMsg<span class="op">=</span>Message<span class="op">.</span><span class="fu">obtain</span><span class="op">(</span><span class="kw">null</span><span class="op">,</span>MessengerService<span class="op">.</span><span class="fu">MSG_2</span><span class="op">);</span></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>                    Bundle bundle<span class="op">=</span><span class="kw">new</span> <span class="fu">Bundle</span><span class="op">();</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>                    bundle<span class="op">.</span><span class="fu">putString</span><span class="op">(</span><span class="st">&quot;reply&quot;</span><span class="op">,</span><span class="st">&quot;ok&quot;</span><span class="op">);</span></span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>                    replyMsg<span class="op">.</span><span class="fu">setData</span><span class="op">(</span>bundle<span class="op">);</span></span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span><span class="op">{</span></span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a>                        client<span class="op">.</span><span class="fu">send</span><span class="op">(</span>replyMsg<span class="op">);</span></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">RemoteException</span> e<span class="op">){</span></span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>                        e<span class="op">.</span><span class="fu">printStackTrace</span><span class="op">();</span></span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a>                <span class="kw">default</span><span class="op">:</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IBinder <span class="fu">onBind</span><span class="op">(</span>Intent intent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mMessenger<span class="op">.</span><span class="fu">getBinder</span><span class="op">();</span></span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb130-32"><a href="#cb130-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>客户端：</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ActivityMessenger <span class="kw">extends</span> Activity <span class="op">{</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>    Messenger mService <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> ServiceConnection mConnection <span class="op">=</span> <span class="kw">new</span> <span class="fu">ServiceConnection</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onServiceConnected</span><span class="op">(</span>ComponentName className<span class="op">,</span> IBinder service<span class="op">)</span> <span class="op">{</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>            <span class="co">//通过服务端传递的IBinder对象,创建相应的Messenger，通过该Messenger对象与服务端进行交互</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>            mService <span class="op">=</span> <span class="kw">new</span> <span class="fu">Messenger</span><span class="op">(</span>service<span class="op">);</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onServiceDisconnected</span><span class="op">(</span>ComponentName className<span class="op">)</span> <span class="op">{</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>            mService <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//用于接收服务器端的回复</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Messenger mRecevierReplyMsg<span class="op">=</span> <span class="kw">new</span> <span class="fu">Messenger</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ReceiverReplyMsgHandler</span><span class="op">());</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="kw">class</span> ReceiverReplyMsgHandler <span class="kw">extends</span> <span class="bu">Handler</span><span class="op">(){</span></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleMessage</span><span class="op">(</span>Message msg<span class="op">){</span></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span> <span class="op">(</span>msg<span class="op">.</span><span class="fu">what</span><span class="op">){</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> MessengerService<span class="op">.</span><span class="fu">MSG_2</span><span class="op">:</span></span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>                    <span class="co">//得到服务器回复</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>                    Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span>msg<span class="op">.</span><span class="fu">getData</span><span class="op">().</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;reply&quot;</span><span class="op">));</span></span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>                <span class="kw">default</span><span class="op">:</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">){</span></span>
<span id="cb131-30"><a href="#cb131-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb131-31"><a href="#cb131-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_main</span><span class="op">);</span></span>
<span id="cb131-32"><a href="#cb131-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-33"><a href="#cb131-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bindService</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>ActivityMessenger<span class="op">.</span><span class="fu">this</span><span class="op">,</span> MessengerService<span class="op">.</span><span class="fu">class</span><span class="op">),</span> mConnection<span class="op">,</span> <span class="bu">Context</span><span class="op">.</span><span class="fu">BIND_AUTO_CREATE</span><span class="op">);</span></span>
<span id="cb131-34"><a href="#cb131-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>mService<span class="op">!=</span><span class="kw">null</span><span class="op">){</span></span>
<span id="cb131-35"><a href="#cb131-35" aria-hidden="true" tabindex="-1"></a>            Message msg <span class="op">=</span> Message<span class="op">.</span><span class="fu">obtain</span><span class="op">(</span><span class="kw">null</span><span class="op">,</span> MessengerService<span class="op">.</span><span class="fu">MSG_1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb131-36"><a href="#cb131-36" aria-hidden="true" tabindex="-1"></a>            <span class="co">//把接收服务器端的回复的Messenger通过Message的replyTo参数传递给服务端</span></span>
<span id="cb131-37"><a href="#cb131-37" aria-hidden="true" tabindex="-1"></a>            msg<span class="op">.</span><span class="fu">replyTo</span><span class="op">=</span>mRecevierReplyMsg<span class="op">;</span></span>
<span id="cb131-38"><a href="#cb131-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span><span class="op">{</span></span>
<span id="cb131-39"><a href="#cb131-39" aria-hidden="true" tabindex="-1"></a>                <span class="co">//向服务器端发消息</span></span>
<span id="cb131-40"><a href="#cb131-40" aria-hidden="true" tabindex="-1"></a>                mService<span class="op">.</span><span class="fu">send</span><span class="op">(</span>msg<span class="op">);</span></span>
<span id="cb131-41"><a href="#cb131-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span><span class="cf">catch</span> <span class="op">(</span><span class="bu">RemoteException</span> e<span class="op">){</span></span>
<span id="cb131-42"><a href="#cb131-42" aria-hidden="true" tabindex="-1"></a>                e<span class="op">.</span><span class="fu">printStackTrace</span><span class="op">();</span></span>
<span id="cb131-43"><a href="#cb131-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb131-44"><a href="#cb131-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb131-45"><a href="#cb131-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb131-46"><a href="#cb131-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-47"><a href="#cb131-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onDestory</span><span class="op">(){</span></span>
<span id="cb131-48"><a href="#cb131-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>mService<span class="op">!=</span><span class="kw">null</span><span class="op">){</span></span>
<span id="cb131-49"><a href="#cb131-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">unbindService</span><span class="op">(</span>mConnection<span class="op">);</span></span>
<span id="cb131-50"><a href="#cb131-50" aria-hidden="true" tabindex="-1"></a>            mService <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb131-51"><a href="#cb131-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb131-52"><a href="#cb131-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb131-53"><a href="#cb131-53" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>为了测试跨进程通信，还要对service配置<code>android:process=&quot;:remote&quot;</code>：</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">service</span><span class="ot"> android:name=</span><span class="st">&quot;.MessengerService&quot;</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="ot">         android:process=</span><span class="st">&quot;:remote&quot;</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>        /&gt;</span></code></pre></div>
<h4 id="aidl">AIDL</h4>
<p>AIDL也可以进行进程间通信(IPC)，由于Messenger是以串行的方式处理客户端发来的消息，效率很低，这时AIDL就可以实现并行处理消息</p>
<p>在Android
Studio中，需要在main目录下创建一个aidl文件夹（和java文件夹同级），然后在新建和当前应用一样的包名的包，然后新建一个aidl类型的文件，内容如下（通过模板创建时可能会生成其他方法，可以删掉不要）</p>
<p>IMyAidl.aidl：</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">myapp</span><span class="op">.</span><span class="im">app</span><span class="op">;</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">myapp</span><span class="op">.</span><span class="im">app</span><span class="op">.</span><span class="im">bean</span><span class="op">.</span><span class="im">Student</span><span class="op">;</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> IMyAidl <span class="op">{</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//自定义的远程通讯的方法</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">//除了基本数据类型，其他类型的参数都需要标上方向类型：in(输入), out(输出), inout(输入输出)</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> <span class="fu">addStudent</span><span class="op">(</span>in Student student<span class="op">);</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>Student<span class="op">&gt;</span> <span class="fu">getStudentAll</span><span class="op">();</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>如果通过AIDL传递对象，对象需实现<code>Parcelable</code>接口（类似JAVA的<code>Serializable</code>，是安卓的可持久化声明接口，但和<code>Serializable</code>不同的是，还需实现一些持久化相关的方法）并放在aidl文件夹下（可以是子目录），并在与实体类同级目录下有对应的映射声明</p>
<p>Student.java</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">myapp</span><span class="op">.</span><span class="im">app</span><span class="op">.</span><span class="im">bean</span><span class="op">;</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">android</span><span class="op">.</span><span class="im">os</span><span class="op">.</span><span class="im">Parcel</span><span class="op">;</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">android</span><span class="op">.</span><span class="im">os</span><span class="op">.</span><span class="im">Parcelable</span><span class="op">;</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Student <span class="kw">implements</span> Parcelable <span class="op">{</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> name<span class="op">;</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> className<span class="op">;</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Student</span><span class="op">(){}</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Student</span><span class="op">(</span><span class="dt">int</span> id<span class="op">,</span> <span class="bu">String</span> name<span class="op">,</span> <span class="bu">String</span> className<span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">id</span> <span class="op">=</span> id<span class="op">;</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">name</span> <span class="op">=</span> name<span class="op">;</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">className</span> <span class="op">=</span> className<span class="op">;</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="fu">Student</span><span class="op">(</span>Parcel in<span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>        id <span class="op">=</span> in<span class="op">.</span><span class="fu">readInt</span><span class="op">();</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> in<span class="op">.</span><span class="fu">readString</span><span class="op">();</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>        className <span class="op">=</span> in<span class="op">.</span><span class="fu">readString</span><span class="op">();</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> Creator<span class="op">&lt;</span>Student<span class="op">&gt;</span> CREATOR <span class="op">=</span> <span class="kw">new</span> Creator<span class="op">&lt;</span>Student<span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> Student <span class="fu">createFromParcel</span><span class="op">(</span>Parcel in<span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Student</span><span class="op">(</span>in<span class="op">);</span></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> Student<span class="op">[]</span> <span class="fu">newArray</span><span class="op">(</span><span class="dt">int</span> size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">new</span> Student<span class="op">[</span>size<span class="op">];</span></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">describeContents</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">writeToParcel</span><span class="op">(</span>Parcel dest<span class="op">,</span> <span class="dt">int</span> flags<span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>        dest<span class="op">.</span><span class="fu">writeInt</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a>        dest<span class="op">.</span><span class="fu">writeString</span><span class="op">(</span>name<span class="op">);</span></span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>        dest<span class="op">.</span><span class="fu">writeString</span><span class="op">(</span>classCame<span class="op">);</span></span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">readFromParcel</span><span class="op">(</span>Parcel source<span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>        id <span class="op">=</span> source<span class="op">.</span><span class="fu">readInt</span><span class="op">();</span></span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> source<span class="op">.</span><span class="fu">readString</span><span class="op">();</span></span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>        className <span class="op">=</span> source<span class="op">.</span><span class="fu">readString</span><span class="op">();</span></span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb134-56"><a href="#cb134-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb134-57"><a href="#cb134-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;Student{&quot;</span> <span class="op">+</span></span>
<span id="cb134-58"><a href="#cb134-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;id=&#39;&quot;</span> <span class="op">+</span> id <span class="op">+</span> <span class="ch">&#39;\&#39;&#39;</span> <span class="op">+</span></span>
<span id="cb134-59"><a href="#cb134-59" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;name=&#39;&quot;</span> <span class="op">+</span> name <span class="op">+</span> <span class="ch">&#39;\&#39;&#39;</span> <span class="op">+</span></span>
<span id="cb134-60"><a href="#cb134-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;className=&#39;&quot;</span> <span class="op">+</span> className <span class="op">+</span> <span class="ch">&#39;\&#39;&#39;</span> <span class="op">+</span></span>
<span id="cb134-61"><a href="#cb134-61" aria-hidden="true" tabindex="-1"></a>                <span class="ch">&#39;}&#39;</span><span class="op">;</span></span>
<span id="cb134-62"><a href="#cb134-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb134-63"><a href="#cb134-63" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>创建映射声明<code>Student.aidl</code>：</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">myapp</span><span class="op">.</span><span class="im">app</span><span class="op">.</span><span class="im">bean</span><span class="op">;</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>parcelable Student<span class="op">;</span></span></code></pre></div>
<p>点击Make Project，Android
Studio会在编译目录根据aidl文件描述生成IMyAidl.java文件，这个文件有一个Stub的静态内部类，其类型为IBinder，里面包含了我们之前在aidl文件中定义的方法，我们需要继承该类然后重写对应方法</p>
<p>AIDL是以服务方式提供的，所以一般会在Service中使用匿名内部类实现对应的方法，然后在<code>onBind()</code>返回（Service创建在正常java代码的目录下）</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyAidlService <span class="kw">extends</span> <span class="bu">Service</span> <span class="op">{</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> TAG <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getClass</span><span class="op">().</span><span class="fu">getSimpleName</span><span class="op">();</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">ArrayList</span><span class="op">&lt;</span>Student<span class="op">&gt;</span> studentList <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//通过匿名内部类实现之前声明的方法</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> IBinder mIBinder <span class="op">=</span> <span class="kw">new</span> IMyAidl<span class="op">.</span><span class="fu">Stub</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">addStudent</span><span class="op">(</span>Student student<span class="op">)</span> <span class="kw">throws</span> <span class="bu">RemoteException</span> <span class="op">{</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>            studentList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>student<span class="op">);</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>Student<span class="op">&gt;</span> <span class="fu">getStudentAll</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">RemoteException</span> <span class="op">{</span></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> studentList<span class="op">;</span></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Nullable</span></span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IBinder <span class="fu">onBind</span><span class="op">(</span>Intent intent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mIBinder<span class="op">;</span></span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>在AndroidManifest.xml中声明服务</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">service</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:name=</span><span class="st">&quot;.MyAidlService&quot;</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:enabled=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:exported=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:process=</span><span class="st">&quot;:aidl&quot;</span> &gt;</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;com.myapp.app.service.MyAidlService&quot;</span> /&gt;</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">service</span>&gt;</span></code></pre></div>
<p>至此服务器端已经配置完成，客户端要使用该AIDL服务，需把aidl文件夹整个复制到客户端代码中（相同位置），然后通过bind的方式启动服务</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> IMyAidl aidlProxy<span class="op">;</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> ServiceConnection conn <span class="op">=</span> <span class="kw">new</span> <span class="fu">ServiceConnection</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onServiceConnected</span><span class="op">(</span>ComponentName name<span class="op">,</span> IBinder service<span class="op">)</span> <span class="op">{</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//这里拿到的不是我们继承的Stub，而是一个Proxy（代理类），函数调用是先向Service请求，得到结果再返回，但在我们看来，调用方式是一样的，我们直接调用之前声明的方法即可</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>        aidlProxy <span class="op">=</span> IMyAidl<span class="op">.</span><span class="fu">Stub</span><span class="op">.</span><span class="fu">asInterface</span><span class="op">(</span>service<span class="op">);</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onServiceDisconnected</span><span class="op">(</span>ComponentName name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>        mAidl <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">click</span><span class="op">(</span><span class="bu">View</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>    Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>    intent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span><span class="st">&quot;com.myapp.app.service.MyAidlService&quot;</span><span class="op">);</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">//使用显式intent</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>    intent<span class="op">.</span><span class="fu">setPackage</span><span class="op">(</span><span class="st">&quot;com.myapp.app.service&quot;</span><span class="op">);</span></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bindService</span><span class="op">(</span>intent<span class="op">,</span> conn<span class="op">,</span> BIND_AUTO_CREATE<span class="op">);</span></span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="前台服务">前台服务</h3>
<p>由于Service的优先级很低，所以在手机灭屏一段时间后，service很可能就被系统回收了，为了保证service不会被系统回收，我们需要将service设置为前台服务，在这个时候状态栏上会出现一个通知，通过这个通知我们可以做一些操作</p>
<ul>
<li><code>startForeground(int id, Notification notification)</code>：该方法的作用是把当前服务设置为前台服务，其中id参数代表唯一标识通知的整型数，需要注意的是提供给
startForeground() 的整型 ID 不得为
0，而notification是一个状态栏的通知</li>
<li><code>stopForeground(boolean removeNotification)</code>：该方法是用来从前台删除服务，此方法传入一个布尔值，指示是否也删除状态栏通知，true为删除。
注意该方法并不会停止服务。
但是，如果在服务正在前台运行时将其停止，则通知也会被删除</li>
</ul>
<div class="sourceCode" id="cb139"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ForegroundService <span class="kw">extends</span> <span class="bu">Service</span> <span class="op">{</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> NOTIFICATION_DOWNLOAD_PROGRESS_ID <span class="op">=</span> <span class="bn">0x0001</span><span class="op">;</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">boolean</span> isRemove<span class="op">=</span><span class="kw">false</span><span class="op">;</span><span class="co">//是否需要移除</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">createNotification</span><span class="op">(){</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//使用兼容版本</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>    NotificationCompat<span class="op">.</span><span class="fu">Builder</span> builder<span class="op">=</span><span class="kw">new</span> NotificationCompat<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//设置状态栏的通知图标</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setSmallIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">mipmap</span><span class="op">.</span><span class="fu">ic_launcher</span><span class="op">);</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//设置通知栏横条的图标</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setLargeIcon</span><span class="op">(</span>BitmapFactory<span class="op">.</span><span class="fu">decodeResource</span><span class="op">(</span><span class="fu">getResources</span><span class="op">(),</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">screenflash_logo</span><span class="op">));</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//禁止用户点击删除按钮删除</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setAutoCancel</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//禁止滑动删除</span></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setOngoing</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//右上角的时间显示</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setShowWhen</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">//设置通知栏的标题内容</span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setContentTitle</span><span class="op">(</span><span class="st">&quot;I am Foreground Service!!!&quot;</span><span class="op">);</span></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">//创建通知</span></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Notification</span> notification <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">//设置为前台服务</span></span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">startForeground</span><span class="op">(</span>NOTIFICATION_DOWNLOAD_PROGRESS_ID<span class="op">,</span>notification<span class="op">);</span></span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> <span class="fu">onStartCommand</span><span class="op">(</span>Intent intent<span class="op">,</span> <span class="dt">int</span> flags<span class="op">,</span> <span class="dt">int</span> startId<span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">=</span>intent<span class="op">.</span><span class="fu">getExtras</span><span class="op">().</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;cmd&quot;</span><span class="op">);</span></span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>i<span class="op">==</span><span class="dv">0</span><span class="op">){</span></span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(!</span>isRemove<span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-29"><a href="#cb139-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">createNotification</span><span class="op">();</span></span>
<span id="cb139-30"><a href="#cb139-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb139-31"><a href="#cb139-31" aria-hidden="true" tabindex="-1"></a>        isRemove<span class="op">=</span><span class="kw">true</span><span class="op">;</span></span>
<span id="cb139-32"><a href="#cb139-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span><span class="cf">else</span> <span class="op">{</span></span>
<span id="cb139-33"><a href="#cb139-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">//移除前台服务</span></span>
<span id="cb139-34"><a href="#cb139-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>isRemove<span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-35"><a href="#cb139-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopForeground</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb139-36"><a href="#cb139-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb139-37"><a href="#cb139-37" aria-hidden="true" tabindex="-1"></a>        isRemove<span class="op">=</span><span class="kw">false</span><span class="op">;</span></span>
<span id="cb139-38"><a href="#cb139-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb139-39"><a href="#cb139-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-40"><a href="#cb139-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">super</span><span class="op">.</span><span class="fu">onStartCommand</span><span class="op">(</span>intent<span class="op">,</span> flags<span class="op">,</span> startId<span class="op">);</span></span>
<span id="cb139-41"><a href="#cb139-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb139-42"><a href="#cb139-42" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onDestroy</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb139-43"><a href="#cb139-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">//移除前台服务</span></span>
<span id="cb139-44"><a href="#cb139-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>isRemove<span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-45"><a href="#cb139-45" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopForeground</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb139-46"><a href="#cb139-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb139-47"><a href="#cb139-47" aria-hidden="true" tabindex="-1"></a>        isRemove<span class="op">=</span><span class="kw">false</span><span class="op">;</span></span>
<span id="cb139-48"><a href="#cb139-48" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onDestroy</span><span class="op">();</span></span>
<span id="cb139-49"><a href="#cb139-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb139-50"><a href="#cb139-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IBinder <span class="fu">onBind</span><span class="op">(</span>Intent intent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-51"><a href="#cb139-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb139-52"><a href="#cb139-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="android-5.0以上的隐式启动问题">Android
5.0以上的隐式启动问题</h3>
<p>显式启动</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span>ForegroundService<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">startService</span><span class="op">(</span>intent<span class="op">);</span></span></code></pre></div>
<p>隐式启动（远程启动服务，即在不同的应用中启动服务，必须使用隐式启动）</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> Intent serviceIntent<span class="op">=</span><span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span> serviceIntent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span><span class="st">&quot;com.myapp.ForegroundService&quot;</span><span class="op">);</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">startService</span><span class="op">(</span>serviceIntent<span class="op">);</span></span></code></pre></div>
<p>Android
5.0之后google出于安全的角度禁止了隐式声明Intent来启动Service</p>
<p>解决方式：</p>
<p>1、设置Action和packageName</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> Intent serviceIntent<span class="op">=</span><span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span> serviceIntent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span><span class="st">&quot;com.myapp.ForegroundService&quot;</span><span class="op">);</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>serviceIntent<span class="op">.</span><span class="fu">setPackage</span><span class="op">(</span><span class="fu">getPackageName</span><span class="op">());</span><span class="co">//设置应用的包名</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="fu">startService</span><span class="op">(</span>serviceIntent<span class="op">);</span></span></code></pre></div>
<p>2、将隐式启动转换为显示启动</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> Intent <span class="fu">getExplicitIntent</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> Intent implicitIntent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Retrieve all services that can match the given intent</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>    PackageManager pm <span class="op">=</span> context<span class="op">.</span><span class="fu">getPackageManager</span><span class="op">();</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>ResolveInfo<span class="op">&gt;</span> resolveInfo <span class="op">=</span> pm<span class="op">.</span><span class="fu">queryIntentServices</span><span class="op">(</span>implicitIntent<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Make sure only one match was found</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>resolveInfo <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> resolveInfo<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">!=</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get component info and create ComponentName</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>    ResolveInfo serviceInfo <span class="op">=</span> resolveInfo<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> packageName <span class="op">=</span> serviceInfo<span class="op">.</span><span class="fu">serviceInfo</span><span class="op">.</span><span class="fu">packageName</span><span class="op">;</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> className <span class="op">=</span> serviceInfo<span class="op">.</span><span class="fu">serviceInfo</span><span class="op">.</span><span class="fu">name</span><span class="op">;</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>    ComponentName component <span class="op">=</span> <span class="kw">new</span> <span class="fu">ComponentName</span><span class="op">(</span>packageName<span class="op">,</span> className<span class="op">);</span></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a new intent. Use the old one for extras and such reuse</span></span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>    Intent explicitIntent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>implicitIntent<span class="op">);</span></span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the component to be explicit</span></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a>    explicitIntent<span class="op">.</span><span class="fu">setComponent</span><span class="op">(</span>component<span class="op">);</span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> explicitIntent<span class="op">;</span></span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a><span class="co">//调用</span></span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">startMyService</span><span class="op">(){</span></span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a>    Intent mIntent<span class="op">=</span><span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span><span class="co">//辅助Intent</span></span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a>    mIntent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span><span class="st">&quot;com.myapp.ForegroundService&quot;</span><span class="op">);</span></span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Intent serviceIntent<span class="op">=</span><span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span><span class="fu">getExplicitIntent</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span>mIntent<span class="op">));</span></span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">startService</span><span class="op">(</span>serviceIntent<span class="op">);</span></span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="broadcastreceiver">BroadcastReceiver</h2>
<h3 id="注册">注册</h3>
<p>静态注册：</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">receiver</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:directBootAware=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:enabled</span><span class="ot">=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:exported</span><span class="ot">=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:icon</span><span class="ot">=</span><span class="st">&quot;drawable resource&quot;</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:label=</span><span class="st">&quot;string resource&quot;</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:name=</span><span class="st">&quot;.MyBroadcastReceiver&quot;</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:permission=</span><span class="st">&quot;string&quot;</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:process=</span><span class="st">&quot;string&quot;</span> &gt;</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent-filter</span><span class="ot"> android:priority=</span><span class="st">&quot;9&quot;</span>&gt;</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.action.BOOT_COMPLETED&quot;</span>/&gt;</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.action.INPUT_METHOD_CHANGED&quot;</span> /&gt;</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent-filter</span><span class="ot"> android:priority=</span><span class="st">&quot;10&quot;</span>&gt;</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;com.myapp.MyBroadcastReceiver&quot;</span>&gt;</span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">receiver</span>&gt;</span></code></pre></div>
<ul>
<li>android:directBootAware：默认为false，如果为true，则APP在进入DBM（Direct
Boot
Mode）后会收到系统的广播消息<code>Intent.ACTION_LOCKED_BOOT_COMPLETED</code>，表示开机完成，但用户没有解锁手机；当用户解锁手机后，如果是前台线程，则需接收<code>Intent.ACTION_USER_UNLOCKED</code>的广播，如果是后台线程，可以接收<code>Intent.ACTION_BOOT_COMPLETED</code>，并可以通过<code>UserManager.isUserUnlocked()</code>判断用户是否已经解锁手机；可以通过<code>Context.moveSharedPreferencesFrom()</code>和<code>Context.moveDatabaseFrom()</code>把数据转移到Device
encrypted storage，应用要访问Device encrypted
storage，需创建<code>Context directBootContext = appContext.createDeviceProtectedStorageContext()</code>.然后<code>directBootContext.openFileInput(&quot;filename&quot;)</code></li>
<li>android:exported：此broadcastReceiver能否接收其他App的发出的广播，默认值是由receiver中有无intent-filter决定的，如果有intent-filter，默认值为true，否则为false；exported为true时无法跨进程通信</li>
<li>android:permission：具有相应权限的广播发送者发送的广播才能被此BroadcastReceiver所接收</li>
<li>android:process：是否需要在单独的进程中运行，当设置为android:process=”:remote”时，代表BroadcastReceiver在单独的进程中运行</li>
<li>intent-filter：用于指定此广播接收器将接收的广播类型</li>
</ul>
<p>动态注册（必须在退出应用时解注册，否则会导致内存泄漏）：</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>MyBroadcastReceiver myBroadcastReceiver<span class="op">;</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onResume</span><span class="op">(){</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onResume</span><span class="op">();</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>    myBroadcastReceiver <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyBroadcastReceiver</span><span class="op">();</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>    IntentFilter intentFilter <span class="op">=</span> <span class="kw">new</span> <span class="fu">IntentFilter</span><span class="op">();</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>    intentFilter<span class="op">.</span><span class="fu">addAction</span><span class="op">(</span>android<span class="op">.</span><span class="fu">net</span><span class="op">.</span><span class="fu">conn</span><span class="op">.</span><span class="fu">CONNECTIVITY_CHANGE</span><span class="op">);</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//registerReceiver(myBroadcastReceiver, intentFilter);//注册广播</span></span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">registerReceiver</span><span class="op">(</span>myBroadcastReceiver<span class="op">,</span> intentFilter<span class="op">,</span> <span class="bu">Manifest</span><span class="op">.</span><span class="fu">permission</span><span class="op">.</span><span class="fu">SEND_SMS</span><span class="op">,</span> <span class="kw">null</span><span class="op">);</span><span class="co">//注册带权限的广播</span></span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onPause</span><span class="op">(){</span></span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onPause</span><span class="op">();</span></span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unregisterReceiver</span><span class="op">(</span>myBroadcastReceiver<span class="op">);</span></span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>不在onCreate()和onDestory() 或 onStart()和onStop()注册、注销是因为,
当系统因为内存不足时，要回收Activity占用的资源时，Activity在执行完onPause()方法后就会被销毁，有些生命周期方法onStop()，onDestory()就不会执行，当再回到此Activity时，是从onCreate方法开始执行，这时就有可能导致内存泄漏（虽然有内存泄漏的可能，但还是可以根据实际需求选择注册、解注册的时机）</p>
<p>JAVA代码：</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyBroadcastReceiver <span class="kw">extends</span> BroadcastReceiver <span class="op">{</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onReceive</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> Intent intent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">//BroadcastReceiver的onReceive生命周期很短，如果要执行&gt;16ms的工作（无论是否开启线程），需要使用goAsync，并在完成任务时调用pendingResult.finish()</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> PendingResult pendingResult <span class="op">=</span> <span class="fu">goAsync</span><span class="op">();</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>        AsyncTask<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> asyncTask <span class="op">=</span> <span class="kw">new</span> AsyncTask<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">protected</span> <span class="bu">String</span> <span class="fu">doInBackground</span><span class="op">(</span><span class="bu">String</span><span class="kw">...</span> params<span class="op">)</span> <span class="op">{</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>                <span class="bu">StringBuilder</span> sb <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringBuilder</span><span class="op">();</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>                sb<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">&quot;Action: &quot;</span> <span class="op">+</span> intent<span class="op">.</span><span class="fu">getAction</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>                sb<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">&quot;URI: &quot;</span> <span class="op">+</span> intent<span class="op">.</span><span class="fu">toUri</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">URI_INTENT_SCHEME</span><span class="op">).</span><span class="fu">toString</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>                pendingResult<span class="op">.</span><span class="fu">finish</span><span class="op">();</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>        asyncTask<span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="发送广播">发送广播</h3>
<p>广播的类型主要分为5类： - <code>Normal Broadcast</code> 普通广播 -
<code>System Broadcast</code> 系统广播 - <code>Ordered Broadcast</code>
有序广播 - <code>Sticky Broadcast</code> 粘性广播 -
<code>Local Broadcast</code> App应用内广播</p>
<h4 id="普通广播">普通广播</h4>
<p>发送广播的时候建议：</p>
<ul>
<li>增设相应权限permission，用于权限验证</li>
<li>发送广播时在intent中指定该广播接收器所在的包名，此广播将只会发送到此包中的App内与之相匹配的有效广播接收器中</li>
</ul>
<div class="sourceCode" id="cb147"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span><span class="st">&quot;com.myapp.MyBroadcastReceiver&quot;</span><span class="op">);</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setPackage</span><span class="op">(</span><span class="fu">getPackageName</span><span class="op">());</span><span class="co">//指定该广播接收器所在的包名</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="co">//sendBroadcast(intent);//发送广播</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sendBroadcast</span><span class="op">(</span>intent<span class="op">,</span> <span class="bu">Manifest</span><span class="op">.</span><span class="fu">permission</span><span class="op">.</span><span class="fu">SEND_SMS</span><span class="op">);</span><span class="co">//发送带权限的广播，此时也要求发送广播的应用在清单文件中声明此权限</span></span></code></pre></div>
<p>除了用系统的权限，还可以使用自定义权限</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 定义权限 --&gt;</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">uses-permission</span><span class="ot"> android:name=</span><span class="st">&quot;com.myapp.permissions.MY_BROADCAST&quot;</span> /&gt;</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 声明权限 --&gt;</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">permission</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:name=</span><span class="st">&quot;com.myapp.permissions.MY_BROADCAST&quot;</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:protectionLevel=</span><span class="st">&quot;signature&quot;</span> &gt;</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">permission</span>&gt;</span></code></pre></div>
<h4 id="系统广播">系统广播</h4>
<p>Intent下的常量大多都是系统广播，如<code>Intent.ACTION_AIRPLANE_MODE_CHANGED</code>、<code>Intent.ACTION_BATTERY_CHANGED</code>、<code>Intent.ACTION_BOOT_COMPLETED</code>、<code>Intent.ACTION_HEADSET_PLUG</code>、<code>Intent.ACTION_REBOOT</code>等</p>
<h4 id="有序广播">有序广播</h4>
<p>按照android:priority的顺序接收广播，优先级高的先接收到，同样优先级的情况下，动态注册的优先；先接收到的可以对广播进行拦截、更改等操作</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sendOrderedBroadcast</span><span class="op">(</span>intent<span class="op">);</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co">//BroadcastReceiver中：</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abortBroadcast</span><span class="op">();</span><span class="co">//中断广播，此方法只能在接收到有序广播的时候使用，其他广播下使用会报错</span></span></code></pre></div>
<h4 id="粘性广播"><del>粘性广播</del></h4>
<p>由于在Android5.0(API
21)中已经失效，所以不建议使用，在这里也不作过多的总结</p>
<h4 id="app应用内广播">App应用内广播</h4>
<p>用于防止由于注册的广播名称相同导致的冲突问题（安全性、效率性问题），应用内广播无法跨进程通信</p>
<p>使用应用内广播需将静态注册的receiver的exported属性设置为false，使得广播仅在本应用（本进程）中使用</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>MyBroadcastReceiver myBroadcastReceiver <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyBroadcastReceiver</span><span class="op">();</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>IntentFilter intentFilter <span class="op">=</span> <span class="kw">new</span> <span class="fu">IntentFilter</span><span class="op">();</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>intentFilter<span class="op">.</span><span class="fu">addAction</span><span class="op">(</span>android<span class="op">.</span><span class="fu">net</span><span class="op">.</span><span class="fu">conn</span><span class="op">.</span><span class="fu">CONNECTIVITY_CHANGE</span><span class="op">);</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>LocalBroadcastManager lbm <span class="op">=</span> LocalBroadcastManager<span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>lbm<span class="op">.</span><span class="fu">registerReceiver</span><span class="op">(</span>myBroadcastReceiver<span class="op">,</span> intentFilter<span class="op">);</span><span class="co">//注册应用内广播</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span><span class="st">&quot;com.myapp.MyBroadcastReceiver&quot;</span><span class="op">);</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>lbm<span class="op">.</span><span class="fu">sendBroadcast</span><span class="op">(</span>intent<span class="op">);</span></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>lbm<span class="op">.</span><span class="fu">unregisterReceiver</span><span class="op">(</span>myBroadcastReceiver<span class="op">);</span><span class="co">//解注册应用内广播</span></span></code></pre></div>
<p>对于不同注册方式的广播接收器回调OnReceive（Context context，Intent
intent）中的context返回值是不一样的： -
对于静态注册（全局+应用内广播），回调onReceive(context,
intent)中的context返回值是：ReceiverRestrictedContext -
对于全局广播的动态注册，回调onReceive(context,
intent)中的context返回值是：Activity Context -
对于应用内广播的动态注册（LocalBroadcastManager方式），回调onReceive(context,
intent)中的context返回值是：Application Context -
对于应用内广播的动态注册（非LocalBroadcastManager方式），回调onReceive(context,
intent)中的context返回值是：Activity Context</p>
<h2 id="contentprovider">ContentProvider</h2>
<h3 id="provider">Provider</h3>
<p>ContentProvider是允许不同应用进行数据交换的标准的API，它以URI（<code>Uniform Resource Identifier</code>统一资源标识符）的形式对外提供数据的访问操作接口，而其他应用则通过ContentResolver根据URI去访问指定的数据；不管该应用程序是否启动，其他程序都可以通过ContentProvider来操作自己的数据接口来操作其内部的数据</p>
<p>URI的组成：</p>
<pre><code>content://com.myapp.MyProvider/t_user/1
ˉˉˉˉˉˉˉ   ˉˉˉˉˉˉˉˉˉˉˉˉˉˉˉˉˉˉˉ  ˉˉˉˉˉ  ˉˉˉˉˉˉ
scheme          authority     table    query
 协议            授权信息      查询的表名 查询字段</code></pre>
<p>配置：</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">provider</span><span class="ot"> android:authorities=</span><span class="st">&quot;list&quot;</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:directBootAware=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:enabled</span><span class="ot">=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:exported</span><span class="ot">=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:grantUriPermissions</span><span class="ot">=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:icon</span><span class="ot">=</span><span class="st">&quot;drawable resource&quot;</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:initOrder=</span><span class="st">&quot;integer&quot;</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:label=</span><span class="st">&quot;string resource&quot;</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:multiprocess=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:name</span><span class="ot">=</span><span class="st">&quot;string&quot;</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:permission=</span><span class="st">&quot;string&quot;</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:process=</span><span class="st">&quot;string&quot;</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:readPermission=</span><span class="st">&quot;string&quot;</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:syncable=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>    <span class="er">android:writePermission</span><span class="ot">=</span><span class="st">&quot;string&quot;</span> &gt;</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 其中exported、authorities和name都是必须配置的属性，如果配置了Permission，其他应用想要访问必须设置对应的Permission，如: --&gt;</span></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">provider</span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:name=</span><span class="st">&quot;.MyProvider&quot;</span></span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:authorities=</span><span class="st">&quot;com.myapp.MyProvider&quot;</span></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:exported=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:readPermission=</span><span class="st">&quot;com.myapp.MyProvider.permission.READ&quot;</span></span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a>&gt; &lt;/<span class="kw">provider</span>&gt;</span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 其他应用中配置对应的Permission --&gt;</span></span>
<span id="cb152-26"><a href="#cb152-26" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">uses-permission</span><span class="ot"> android:name=</span><span class="st">&quot;com.myapp.MyProvider.permission.READ&quot;</span> /&gt;</span></code></pre></div>
<p>JAVA代码：</p>
<p>数据提供端</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyProvider <span class="kw">extends</span> ContentProvider<span class="op">{</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>    UriMatcher <span class="dt">static</span> matcher<span class="op">;</span><span class="co">//常用的判断URI是否匹配的类</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>    MySQLiteHelper helper<span class="op">;</span><span class="co">//ContentProvider的增删改查一般交由数据库处理</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span><span class="op">{</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>        matcher <span class="op">=</span> <span class="kw">new</span> <span class="fu">UriMatcher</span><span class="op">(</span>UriMatcher<span class="op">.</span><span class="fu">NO_MATCH</span><span class="op">);</span><span class="co">//构造函数指定没有匹配URI时的返回值</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>        matcher<span class="op">.</span><span class="fu">addURI</span><span class="op">(</span><span class="st">&quot;com.myapp.MyProvider&quot;</span><span class="op">,</span> <span class="st">&quot;t_user&quot;</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span><span class="co">//匹配到&quot;content://com.myapp.MyProvider/t_user&quot;的时候返回1</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>        matcher<span class="op">.</span><span class="fu">addURI</span><span class="op">(</span><span class="st">&quot;com.myapp.MyProvider&quot;</span><span class="op">,</span> <span class="st">&quot;t_user/#&quot;</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span><span class="co">//&quot;#&quot;表示任意数字</span></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onCreate</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>        help <span class="op">=</span> <span class="kw">new</span> <span class="fu">MySQLiteHelper</span><span class="op">(</span><span class="fu">getContext</span><span class="op">());</span></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="co">    根据URI返回一个表示MIME类型的字符串</span></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a><span class="co">    返回以&quot;vnd.android.cursor.item/&quot;开头的字符串表示单行记录</span></span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a><span class="co">    返回以&quot;vnd.android.cursor.dir/&quot;开头的字符串表示多行记录</span></span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a><span class="co">    当使用</span></span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Intent intent = new Intent();</span></span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a><span class="co">    intent.setAction(&quot;com.myapp.MyActivity&quot;);</span></span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a><span class="co">    intent.setData(&quot;content://com.myapp.MyProvider/t_user&quot;);</span></span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a><span class="co">    startActivity(intent)时，会匹配到该ContentProvider，此时会调用getType，会得到MIMETYPE为&quot;vnd.android.cursor.dir/t_user&quot;，这时如果有一个activity为</span></span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a><span class="co">    &lt;activity</span></span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a><span class="co">    android:name=&quot;.MyActivity&quot;</span></span>
<span id="cb153-27"><a href="#cb153-27" aria-hidden="true" tabindex="-1"></a><span class="co">    &lt;intent-filter&gt;</span></span>
<span id="cb153-28"><a href="#cb153-28" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;action android:name=&quot;com.myapp.MyActivity&quot; /&gt;</span></span>
<span id="cb153-29"><a href="#cb153-29" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span></span>
<span id="cb153-30"><a href="#cb153-30" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;data android:mimeType=&quot;vnd.android.cursor.dir/t_user&quot; /&gt;</span></span>
<span id="cb153-31"><a href="#cb153-31" aria-hidden="true" tabindex="-1"></a><span class="co">    &lt;/intent-filter&gt;</span></span>
<span id="cb153-32"><a href="#cb153-32" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;/activity&gt;</span></span>
<span id="cb153-33"><a href="#cb153-33" aria-hidden="true" tabindex="-1"></a><span class="co">    则会启动该activity</span></span>
<span id="cb153-34"><a href="#cb153-34" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb153-35"><a href="#cb153-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb153-36"><a href="#cb153-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getType</span><span class="op">(</span>Uri uri<span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-37"><a href="#cb153-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> code <span class="op">=</span> matcher<span class="op">.</span><span class="fu">match</span><span class="op">(</span>uri<span class="op">);</span></span>
<span id="cb153-38"><a href="#cb153-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> type <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb153-39"><a href="#cb153-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>code <span class="op">==</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-40"><a href="#cb153-40" aria-hidden="true" tabindex="-1"></a>            type <span class="op">=</span> <span class="st">&quot;vnd.android.cursor.dir/t_user&quot;</span><span class="op">;</span><span class="co">// dir代表多行数据</span></span>
<span id="cb153-41"><a href="#cb153-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>code <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-42"><a href="#cb153-42" aria-hidden="true" tabindex="-1"></a>            type <span class="op">=</span> <span class="st">&quot;vnd.android.cursor.item/t_user&quot;</span><span class="op">;</span><span class="co">// item单行</span></span>
<span id="cb153-43"><a href="#cb153-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb153-44"><a href="#cb153-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> type<span class="op">;</span></span>
<span id="cb153-45"><a href="#cb153-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb153-46"><a href="#cb153-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-47"><a href="#cb153-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb153-48"><a href="#cb153-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">Cursor</span> <span class="fu">query</span><span class="op">(</span>Uri uri<span class="op">,</span> <span class="bu">String</span><span class="op">[]</span> projection<span class="op">,</span> <span class="bu">String</span> selection<span class="op">,</span> <span class="bu">String</span><span class="op">[]</span> selectionArgs<span class="op">,</span> <span class="bu">String</span> sortOrder<span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-49"><a href="#cb153-49" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> code <span class="op">=</span> matcher<span class="op">.</span><span class="fu">match</span><span class="op">(</span>uri<span class="op">);</span></span>
<span id="cb153-50"><a href="#cb153-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Cursor</span> cursor <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb153-51"><a href="#cb153-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>code <span class="op">==</span> <span class="dv">1</span><span class="op">){</span></span>
<span id="cb153-52"><a href="#cb153-52" aria-hidden="true" tabindex="-1"></a>            cursor <span class="op">=</span> help<span class="op">.</span><span class="fu">getReadableDatabase</span><span class="op">().</span><span class="fu">query</span><span class="op">(</span> <span class="st">&quot;t_user&quot;</span><span class="op">,</span>  <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">&quot;id&quot;</span><span class="op">,</span> <span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;sex&quot;</span> <span class="op">},</span> selection<span class="op">,</span> selectionArgs<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> sortOrder<span class="op">);</span></span>
<span id="cb153-53"><a href="#cb153-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span><span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>code <span class="op">==</span> <span class="dv">2</span><span class="op">){</span></span>
<span id="cb153-54"><a href="#cb153-54" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> id <span class="op">=</span> ContentUris<span class="op">.</span><span class="fu">parseId</span><span class="op">(</span>uri<span class="op">);</span><span class="co">//取出&quot;#&quot;处的数字</span></span>
<span id="cb153-55"><a href="#cb153-55" aria-hidden="true" tabindex="-1"></a>            cursor <span class="op">=</span> help<span class="op">.</span><span class="fu">getReadableDatabase</span><span class="op">().</span><span class="fu">query</span><span class="op">(</span><span class="st">&quot;t_user&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">&quot;id&quot;</span><span class="op">,</span> <span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;sex&quot;</span> <span class="op">},</span> <span class="st">&quot;id=?&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="bu">String</span><span class="op">.</span><span class="fu">valueOf</span><span class="op">(</span>id<span class="op">)</span> <span class="op">},</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> sortOrder<span class="op">);</span></span>
<span id="cb153-56"><a href="#cb153-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb153-57"><a href="#cb153-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cursor<span class="op">;</span></span>
<span id="cb153-58"><a href="#cb153-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb153-59"><a href="#cb153-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-60"><a href="#cb153-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb153-61"><a href="#cb153-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Uri <span class="fu">insert</span><span class="op">(</span>Uri uri<span class="op">,</span> ContentValues values<span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-62"><a href="#cb153-62" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> code <span class="op">=</span> matcher<span class="op">.</span><span class="fu">match</span><span class="op">(</span>uri<span class="op">);</span></span>
<span id="cb153-63"><a href="#cb153-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>code <span class="op">!=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> code <span class="op">!=</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-64"><a href="#cb153-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;地址不能匹配&quot;</span><span class="op">);</span></span>
<span id="cb153-65"><a href="#cb153-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb153-66"><a href="#cb153-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">long</span> id <span class="op">=</span> help<span class="op">.</span><span class="fu">getWritableDatabase</span><span class="op">().</span><span class="fu">insert</span><span class="op">(</span><span class="st">&quot;t_user&quot;</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> values<span class="op">);</span></span>
<span id="cb153-67"><a href="#cb153-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ContentUris<span class="op">.</span><span class="fu">withAppendedId</span><span class="op">(</span>uri<span class="op">,</span> id<span class="op">);</span><span class="co">// 返回值代表访问新添加数据的URI</span></span>
<span id="cb153-68"><a href="#cb153-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb153-69"><a href="#cb153-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-70"><a href="#cb153-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb153-71"><a href="#cb153-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">delete</span><span class="op">(</span>Uri uri<span class="op">,</span> <span class="bu">String</span> selection<span class="op">,</span> <span class="bu">String</span><span class="op">[]</span> selectionArgs<span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-72"><a href="#cb153-72" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> code <span class="op">=</span> matcher<span class="op">.</span><span class="fu">match</span><span class="op">(</span>uri<span class="op">);</span></span>
<span id="cb153-73"><a href="#cb153-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>code <span class="op">==</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-74"><a href="#cb153-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;不能删除所有数据&quot;</span><span class="op">);</span></span>
<span id="cb153-75"><a href="#cb153-75" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>code <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-76"><a href="#cb153-76" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> id <span class="op">=</span> ContentUris<span class="op">.</span><span class="fu">parseId</span><span class="op">(</span>uri<span class="op">);</span></span>
<span id="cb153-77"><a href="#cb153-77" aria-hidden="true" tabindex="-1"></a>            help<span class="op">.</span><span class="fu">getWritableDatabase</span><span class="op">().</span><span class="fu">delete</span><span class="op">(</span><span class="st">&quot;t_user&quot;</span><span class="op">,</span> <span class="st">&quot;id=?&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> id <span class="op">+</span> <span class="st">&quot;&quot;</span> <span class="op">});</span></span>
<span id="cb153-78"><a href="#cb153-78" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb153-79"><a href="#cb153-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb153-80"><a href="#cb153-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb153-81"><a href="#cb153-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-82"><a href="#cb153-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb153-83"><a href="#cb153-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">update</span><span class="op">(</span>Uri uri<span class="op">,</span> ContentValues values<span class="op">,</span> <span class="bu">String</span> selection<span class="op">,</span> <span class="bu">String</span><span class="op">[]</span> selectionArgs<span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-84"><a href="#cb153-84" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> code <span class="op">=</span> matcher<span class="op">.</span><span class="fu">match</span><span class="op">(</span>uri<span class="op">);</span></span>
<span id="cb153-85"><a href="#cb153-85" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb153-86"><a href="#cb153-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>code <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-87"><a href="#cb153-87" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> id <span class="op">=</span> ContentUris<span class="op">.</span><span class="fu">parseId</span><span class="op">(</span>uri<span class="op">);</span></span>
<span id="cb153-88"><a href="#cb153-88" aria-hidden="true" tabindex="-1"></a>            row <span class="op">=</span> help<span class="op">.</span><span class="fu">getWritableDatabase</span><span class="op">().</span><span class="fu">update</span><span class="op">(</span><span class="st">&quot;t_user&quot;</span><span class="op">,</span> values<span class="op">,</span> <span class="st">&quot;id=?&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> id <span class="op">+</span> <span class="st">&quot;&quot;</span> <span class="op">});</span></span>
<span id="cb153-89"><a href="#cb153-89" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb153-90"><a href="#cb153-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> row<span class="op">;</span></span>
<span id="cb153-91"><a href="#cb153-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb153-92"><a href="#cb153-92" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>数据使用端（其他Activity）</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>Uri uri <span class="op">=</span> Uri<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">&quot;content://com.myapp.MyProvider/t_user&quot;</span><span class="op">);</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Cursor</span> cursor <span class="op">=</span> <span class="fu">getContentResolver</span><span class="op">().</span><span class="fu">query</span><span class="op">(</span>uri<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>cursor<span class="op">.</span><span class="fu">moveToNext</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id <span class="op">=</span> cursor<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;id&quot;</span><span class="op">));</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> name <span class="op">=</span> cursor<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;name&quot;</span><span class="op">));</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> sex <span class="op">=</span> cursor<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;sex&quot;</span><span class="op">));</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>    Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span><span class="st">&quot;id=&quot;</span><span class="op">+</span>id<span class="op">+</span><span class="st">&quot;,name=&quot;</span><span class="op">+</span>name<span class="op">+</span><span class="st">&quot;,sex=&quot;</span><span class="op">+</span>sex<span class="op">);</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>cursor<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span></code></pre></div>
<h3 id="observer">Observer</h3>
<p>使用<code>ContentObserver</code>内容观察者可以监听ContentProvider相关的数据变化；如果自定义的provider想通知监听的对象（ContentObserver），需在其对应方法update
/insert/delete时，显式地调用<code>this.getContentReslover().notifychange(uri,null)</code>，如果不显式调用，即使注册了ContentObserver，也不会收到回调（onChange）</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ObserverActivity <span class="kw">extends</span> Activity <span class="op">{</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>    ContentObserver observer<span class="op">;</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">Handler</span> handler <span class="op">=</span> <span class="kw">new</span> <span class="bu">Handler</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleMessage</span><span class="op">(</span>Message msg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>             <span class="cf">switch</span> <span class="op">(</span>msg<span class="op">.</span><span class="fu">what</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>                    Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span>msg<span class="op">.</span><span class="fu">obj</span><span class="op">.</span><span class="fu">toString</span><span class="op">());</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>                <span class="kw">default</span><span class="op">:</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>             <span class="op">}</span></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">main</span><span class="op">);</span></span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a>        observer <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyObserver</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> handler<span class="op">);</span></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">//注册内容观察者，监听短信数据变化，第二个参数代表是否精确匹配，像类似带&quot;#&quot;或者其他查询字段的URI必须为false才能匹配到</span></span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">getContentResolver</span><span class="op">().</span><span class="fu">registerContentObserver</span><span class="op">(</span>Uri<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">&quot;content://sms&quot;</span><span class="op">),</span> <span class="kw">true</span><span class="op">,</span> observer<span class="op">);</span></span>
<span id="cb155-22"><a href="#cb155-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb155-23"><a href="#cb155-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-24"><a href="#cb155-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb155-25"><a href="#cb155-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onDestory</span><span class="op">(){</span></span>
<span id="cb155-26"><a href="#cb155-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">//解注册</span></span>
<span id="cb155-27"><a href="#cb155-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">getContentResolver</span><span class="op">().</span><span class="fu">unregisterContentObserver</span><span class="op">(</span>observer<span class="op">);</span></span>
<span id="cb155-28"><a href="#cb155-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb155-29"><a href="#cb155-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb155-30"><a href="#cb155-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-31"><a href="#cb155-31" aria-hidden="true" tabindex="-1"></a><span class="co">//实现内容观察者需要继承ContentObserver</span></span>
<span id="cb155-32"><a href="#cb155-32" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyObserver <span class="kw">extends</span> ContentObserver <span class="op">{</span></span>
<span id="cb155-33"><a href="#cb155-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Context</span> context<span class="op">;</span></span>
<span id="cb155-34"><a href="#cb155-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Handler</span> handler<span class="op">;</span></span>
<span id="cb155-35"><a href="#cb155-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-36"><a href="#cb155-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MyObserver</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> <span class="bu">Handler</span> handler<span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-37"><a href="#cb155-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span>handler<span class="op">);</span></span>
<span id="cb155-38"><a href="#cb155-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">context</span> <span class="op">=</span> context<span class="op">;</span></span>
<span id="cb155-39"><a href="#cb155-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">handler</span> <span class="op">=</span> handler<span class="op">;</span></span>
<span id="cb155-40"><a href="#cb155-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb155-41"><a href="#cb155-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-42"><a href="#cb155-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">//当观察的内容发生变化是会触发该方法</span></span>
<span id="cb155-43"><a href="#cb155-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb155-44"><a href="#cb155-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onChange</span><span class="op">(</span><span class="dt">boolean</span> selfChange<span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-45"><a href="#cb155-45" aria-hidden="true" tabindex="-1"></a>        ContentResolver resolver <span class="op">=</span> context<span class="op">.</span><span class="fu">getContentResolver</span><span class="op">();</span></span>
<span id="cb155-46"><a href="#cb155-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Cursor</span> c <span class="op">=</span> resolver<span class="op">.</span><span class="fu">query</span><span class="op">(</span>Uri<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">&quot;content://sms&quot;</span><span class="op">),</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb155-47"><a href="#cb155-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>c <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb155-48"><a href="#cb155-48" aria-hidden="true" tabindex="-1"></a>            <span class="bu">StringBuilder</span> sb <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringBuilder</span><span class="op">();</span></span>
<span id="cb155-49"><a href="#cb155-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>c<span class="op">.</span><span class="fu">moveToNext</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb155-50"><a href="#cb155-50" aria-hidden="true" tabindex="-1"></a>                sb<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">&quot;发件人手机号码: &quot;</span> <span class="op">+</span> c<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>c<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;address&quot;</span><span class="op">))).</span><span class="fu">append</span><span class="op">(</span><span class="st">&quot;信息内容: &quot;</span> <span class="op">+</span> c<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>c<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;body&quot;</span><span class="op">))).</span><span class="fu">append</span><span class="op">(</span><span class="st">&quot;是否查看: &quot;</span> <span class="op">+</span> c<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>c<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;read&quot;</span><span class="op">))).</span><span class="fu">append</span><span class="op">(</span><span class="st">&quot;发送时间:&quot;</span><span class="op">+</span> <span class="bu">String</span><span class="op">.</span><span class="fu">format</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">%tF</span><span class="st"> %&lt;tT&quot;</span><span class="op">,</span> c<span class="op">.</span><span class="fu">getLong</span><span class="op">(</span>c<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;date&quot;</span><span class="op">)))).</span><span class="fu">append</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);}</span></span>
<span id="cb155-51"><a href="#cb155-51" aria-hidden="true" tabindex="-1"></a>            c<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb155-52"><a href="#cb155-52" aria-hidden="true" tabindex="-1"></a>            Message msg <span class="op">=</span> <span class="kw">new</span> <span class="fu">Message</span><span class="op">();</span></span>
<span id="cb155-53"><a href="#cb155-53" aria-hidden="true" tabindex="-1"></a>            msg<span class="op">.</span><span class="fu">what</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb155-54"><a href="#cb155-54" aria-hidden="true" tabindex="-1"></a>            msg<span class="op">.</span><span class="fu">obj</span> <span class="op">=</span> sb<span class="op">.</span><span class="fu">toString</span><span class="op">();</span><span class="co">//将读到的信息使用msg，传递给activity</span></span>
<span id="cb155-55"><a href="#cb155-55" aria-hidden="true" tabindex="-1"></a>            handler<span class="op">.</span><span class="fu">sendMessage</span><span class="op">(</span>msg<span class="op">);</span></span>
<span id="cb155-56"><a href="#cb155-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb155-57"><a href="#cb155-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb155-58"><a href="#cb155-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="案例-自动填写短信验证码">案例: 自动填写短信验证码</h3>
<div class="sourceCode" id="cb156"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SmsObserver <span class="kw">extends</span> ContentObserver <span class="op">{</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> SMS_URI_INBOX <span class="op">=</span> <span class="st">&quot;content://sms/inbox&quot;</span><span class="op">;</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Activity activity <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> smsContent <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> SmsListener listener<span class="op">;</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">SmsObserver</span><span class="op">(</span>Activity activity<span class="op">,</span> <span class="bu">Handler</span> handler<span class="op">,</span> SmsListener listener<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span>handler<span class="op">);</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">activity</span> <span class="op">=</span> activity<span class="op">;</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">listener</span> <span class="op">=</span> listener<span class="op">;</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onChange</span><span class="op">(</span><span class="dt">boolean</span> selfChange<span class="op">,</span> Uri uri<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onChange</span><span class="op">(</span>selfChange<span class="op">,</span> uri<span class="op">);</span></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>uri<span class="op">.</span><span class="fu">toString</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;content://sms/raw&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Cursor</span> cursor <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">//获取短信验证码</span></span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>        ContentResolver contentResolver <span class="op">=</span> activity<span class="op">.</span><span class="fu">getContentResolver</span><span class="op">();</span></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>        cursor <span class="op">=</span> contentResolver<span class="op">.</span><span class="fu">query</span><span class="op">(</span>Uri<span class="op">.</span><span class="fu">parse</span><span class="op">(</span>SMS_URI_INBOX<span class="op">),</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span> <span class="st">&quot;address&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">,</span> <span class="st">&quot;read&quot;</span> <span class="op">},</span> <span class="st">&quot;body like ? and read=?&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">&quot;%验证码%&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span> <span class="op">},</span> <span class="st">&quot;date desc&quot;</span><span class="op">);</span></span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>cursor <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>cursor<span class="op">.</span><span class="fu">moveToFirst</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>                <span class="bu">String</span> address <span class="op">=</span> c<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;address&quot;</span><span class="op">));</span></span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>                <span class="bu">String</span> smsbody <span class="op">=</span> cursor<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>cursor<span class="op">.</span><span class="fu">getColumnIndex</span><span class="op">(</span><span class="st">&quot;body&quot;</span><span class="op">));</span></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>                <span class="co">//如果不是我们发出的验证码则不处理</span></span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(!</span>address<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;1234567890&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>                <span class="bu">Pattern</span> p <span class="op">=</span> <span class="bu">Pattern</span><span class="op">.</span><span class="fu">compile</span><span class="op">(</span><span class="st">&quot;(</span><span class="sc">\\</span><span class="st">d{11})&quot;</span><span class="op">);</span></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>                <span class="bu">Matcher</span> m <span class="op">=</span> p<span class="op">.</span><span class="fu">matcher</span><span class="op">(</span>smsbody<span class="op">.</span><span class="fu">toString</span><span class="op">());</span></span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span><span class="op">(</span>matcher<span class="op">.</span><span class="fu">find</span><span class="op">()){</span></span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>                    smsContent <span class="op">=</span> m<span class="op">.</span><span class="fu">replaceAll</span><span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">).</span><span class="fu">trim</span><span class="op">().</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>                    listener<span class="op">.</span><span class="fu">onResult</span><span class="op">(</span>smsContent<span class="op">);</span></span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 短信回调接口 </span></span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">interface</span> SmsListener <span class="op">{</span></span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">onResult</span><span class="op">(</span><span class="bu">String</span> smsContent<span class="op">);</span></span>
<span id="cb156-45"><a href="#cb156-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb156-46"><a href="#cb156-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="动画">动画</h2>
<h3 id="tween动画">Tween动画</h3>
<p>Tween动画并不会改变view的实际位置，只是把图像移动了，但原来view（比如button）的位置仍然可以点击，适用于没有点击（触摸）事件的view使用</p>
<p>xml标签有alpha、rotate、scale、translate，对应的JAVA类名是AlphaAnimation、RotateAnimation、ScaleAnimation、TranslateAnimation，xml中多个Tween动画（复合动画）用set标签做顶级标签，JAVA中多个Tween动画（复合动画）用AnimationSet，比如：</p>
<p>xml创建Tween动画</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">set</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:interpolator=</span><span class="st">&quot;@[package:]anim/interpolator_resource&quot;</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:shareInterpolator=</span><span class="er">[</span><span class="st">&quot;true&quot;</span> <span class="er">|</span> <span class="er">&quot;</span><span class="ot">false</span><span class="er">&quot;]</span> <span class="er">&gt;</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;alpha</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>        <span class="er">android:fromAlpha</span><span class="ot">=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:toAlpha=</span><span class="st">&quot;float&quot;</span> /&gt;</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 可以直接写坐标，也可以用百分比，100%表示相对于自己 100%p表示相对于父布局 --&gt;</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">scale</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:fromXScale=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:toXScale=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:fromYScale=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:toYScale=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:pivotX=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:pivotY=</span><span class="st">&quot;float&quot;</span> /&gt;</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">translate</span></span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:fromXDelta=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:toXDelta=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:fromYDelta=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:toYDelta=</span><span class="st">&quot;float&quot;</span> /&gt;</span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">rotate</span></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:fromDegrees=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:toDegrees=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:pivotX=</span><span class="st">&quot;float&quot;</span></span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:pivotY=</span><span class="st">&quot;float&quot;</span> /&gt;</span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>/set&gt;</span></code></pre></div>
<p>JAVA加载xml中的Tween动画</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="bu">ImageView</span> imageView <span class="op">=</span> <span class="op">(</span><span class="bu">ImageView</span><span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">img</span><span class="op">);</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>Animation anim <span class="op">=</span> AnimationUtils<span class="op">.</span><span class="fu">loadAnimation</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> R<span class="op">.</span><span class="fu">anim</span><span class="op">.</span><span class="fu">anim</span><span class="op">);</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>imageView<span class="op">.</span><span class="fu">startAnimation</span><span class="op">(</span>anim<span class="op">);</span></span></code></pre></div>
<p>JAVA创建Tween动画</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>LinearLayout ll <span class="op">=</span> <span class="op">(</span>LinearLayout<span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">ll</span><span class="op">);</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>AnimationSet set <span class="op">=</span> <span class="kw">new</span> <span class="fu">AnimationSet</span><span class="op">();</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>AlphaAnimation alpha <span class="op">=</span> <span class="kw">new</span> <span class="fu">AlphaAnimation</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span><span class="co">// 0----&gt;1从透明到不透明</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>ScaleAnimation scale <span class="op">=</span> <span class="kw">new</span> <span class="fu">ScaleAnimation</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>RotateAnimation rotate <span class="op">=</span> <span class="kw">new</span> <span class="fu">RotateAnimation</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">360</span><span class="op">,</span> RotateAnimation<span class="op">.</span><span class="fu">RELATIVE_TO_SELF</span><span class="op">,</span> <span class="fl">0.5f</span><span class="op">,</span> RotateAnimation<span class="op">.</span><span class="fu">RELATIVE_TO_SELF</span><span class="op">,</span> <span class="fl">0.5f</span><span class="op">);</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>TranslateAnimation translate <span class="op">=</span> <span class="kw">new</span> <span class="fu">TranslateAnimation</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">300</span><span class="op">);</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">addAnimation</span><span class="op">(</span>alpha<span class="op">);</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">addAnimation</span><span class="op">(</span>scale<span class="op">);</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">addAnimation</span><span class="op">(</span>rotate<span class="op">);</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">addAnimation</span><span class="op">(</span>translate<span class="op">);</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">setDuration</span><span class="op">(</span><span class="dv">3000</span><span class="op">);</span><span class="co">//统一设置动画持续时间</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>ll<span class="op">.</span><span class="fu">startAnimation</span><span class="op">(</span>set<span class="op">);</span></span></code></pre></div>
<h3 id="帧动画">帧动画</h3>
<p>像播放幻灯片一样，传一组图片进去，然后依次循环播放，可以设置每一张图片的播放时间。帧动画可以通过xml创建，也可以java代码动态构建</p>
<p>xml创建</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">animation-list</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:oneshot=</span><span class="st">&quot;false&quot;</span>&gt;</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> android:drawable=</span><span class="st">&quot;@mipmap/run_1&quot;</span><span class="ot"> android:duration=</span><span class="st">&quot;150&quot;</span> /&gt;</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> android:drawable=</span><span class="st">&quot;@mipmap/run_2&quot;</span><span class="ot"> android:duration=</span><span class="st">&quot;150&quot;</span> /&gt;</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> android:drawable=</span><span class="st">&quot;@mipmap/run_3&quot;</span><span class="ot"> android:duration=</span><span class="st">&quot;150&quot;</span> /&gt;</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> android:drawable=</span><span class="st">&quot;@mipmap/run_4&quot;</span><span class="ot"> android:duration=</span><span class="st">&quot;150&quot;</span> /&gt;</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">animation-list</span>&gt;</span></code></pre></div>
<p>JAVA代码创建</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>AnimationDrawable anim <span class="op">=</span> <span class="kw">new</span> <span class="fu">AnimationDrawable</span><span class="op">();</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">6</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id <span class="op">=</span> <span class="fu">getResources</span><span class="op">().</span><span class="fu">getIdentifier</span><span class="op">(</span><span class="st">&quot;run_&quot;</span> <span class="op">+</span> i<span class="op">,</span> <span class="st">&quot;mipmap&quot;</span><span class="op">,</span> <span class="fu">getPackageName</span><span class="op">());</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>    Drawable drawable <span class="op">=</span> <span class="fu">getResources</span><span class="op">().</span><span class="fu">getDrawable</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>    anim<span class="op">.</span><span class="fu">addFrame</span><span class="op">(</span>drawable<span class="op">,</span> <span class="dv">150</span><span class="op">);</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>anim<span class="op">.</span><span class="fu">setOneShot</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>imageView<span class="op">.</span><span class="fu">setImageDrawable</span><span class="op">(</span>anim<span class="op">);</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>anim<span class="op">.</span><span class="fu">start</span><span class="op">();</span></span></code></pre></div>
<p>xml使用帧动画</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">ImageView</span>&gt;</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>    android:layout_width=&quot;200dp&quot;</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>    android:layout_height=&quot;200dp&quot;</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>    android:background=&quot;@drawable/animation_list&quot;</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">ImageView</span>&gt;</span></code></pre></div>
<p>JAVA代码使用帧动画（因为AnimationDrawable播放动画是依附在window上面的，
onCreate方法中调用时Window还未初始化完毕，所以不能放在onCreate中，而应放在onWindowFocusChanged中）</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onWindowFocusChanged</span><span class="op">(</span><span class="dt">boolean</span> hasFocus<span class="op">)</span> <span class="op">{</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onWindowFocusChanged</span><span class="op">(</span>hasFocus<span class="op">);</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ImageView</span> imageView <span class="op">=</span> <span class="op">(</span><span class="bu">ImageView</span><span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">iv</span><span class="op">);</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>    imageView<span class="op">.</span><span class="fu">setImageResource</span><span class="op">(</span>R<span class="op">.</span><span class="fu">drawable</span><span class="op">.</span><span class="fu">animation_list</span><span class="op">);</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>    AnimationDrawable anim <span class="op">=</span> <span class="op">(</span>AnimationDrawable<span class="op">)</span> imageView<span class="op">.</span><span class="fu">getBackground</span><span class="op">();</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>    anim<span class="op">.</span><span class="fu">start</span><span class="op">();</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//anim.stop();//停止动画</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="属性动画">属性动画</h3>
<p>属性动画（<code>ObjectAnimator</code>），继承自数值发生器（<code>ValueAnimator</code>），可以改变view的实际参数</p>
<p>ValueAnimator：</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>ValueAnimator animator <span class="op">=</span> ValueAnimator<span class="op">.</span><span class="fu">ofFloat</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">360</span><span class="op">);</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">setDuration</span><span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">setInterpolator</span><span class="op">(</span><span class="kw">new</span> <span class="fu">AccelerateInterpolator</span><span class="op">());</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">setRepeatCount</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">setRepeatMode</span><span class="op">(</span>ValueAnimator<span class="op">.</span><span class="fu">REVERSE</span><span class="op">);</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">addUpdateListener</span><span class="op">(</span><span class="kw">new</span> ValueAnimator<span class="op">.</span><span class="fu">AnimatorUpdateListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onAnimationUpdate</span><span class="op">(</span>ValueAnimator valueAnimator<span class="op">)</span> <span class="op">{</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">//value就是从0到360的数字，只不过每加一延时0.36毫秒(360/1000)</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> value <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>valueAnimator<span class="op">.</span><span class="fu">getAnimatedValue</span><span class="op">();</span></span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>        imageView<span class="op">.</span><span class="fu">setRotationY</span><span class="op">(</span>value<span class="op">);</span></span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">start</span><span class="op">();</span></span></code></pre></div>
<p>ObjectAnimator其实就是帮我们实现了常用动画的ValueAnimator</p>
<p>属性动画可以通过<code>ObjectAnimator.ofFloat()</code>、<code>ObjectAnimator.ofInt()</code>、<code>ObjectAnimator.ofObject()</code>等静态工厂方法创建，或者通过view.animate()创建，多个属性动画（复合动画）用AnimatorSet</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>AnimatorSet set <span class="op">=</span> <span class="kw">new</span> <span class="fu">AnimatorSet</span><span class="op">();</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>ObjectAnimator alpha <span class="op">=</span> ObjectAnimator<span class="op">.</span><span class="fu">ofFloat</span><span class="op">(</span>view<span class="op">,</span><span class="st">&quot;alpha&quot;</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="co">//JAVA代码中的单位是px，实际应用中应该根据公式转成dp</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>ObjectAnimator rotationX <span class="op">=</span> ObjectAnimator<span class="op">.</span><span class="fu">ofFloat</span><span class="op">(</span>view<span class="op">,</span><span class="st">&quot;rotationX&quot;</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">270</span><span class="op">,</span><span class="dv">50</span><span class="op">);</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>ObjectAnimator translationX <span class="op">=</span> ObjectAnimator<span class="op">.</span><span class="fu">ofFloat</span><span class="op">(</span>tv<span class="op">,</span> <span class="st">&quot;translationX&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="op">-</span><span class="dv">200</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>ObjectAnimator scaleX <span class="op">=</span> ObjectAnimator<span class="op">.</span><span class="fu">ofFloat</span><span class="op">(</span>view<span class="op">,</span> <span class="st">&quot;scaleX&quot;</span><span class="op">,</span> <span class="fl">1f</span><span class="op">,</span> <span class="fl">2f</span><span class="op">,</span> <span class="fl">1f</span><span class="op">);</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">play</span><span class="op">(</span>translationX<span class="op">).</span><span class="fu">before</span><span class="op">(</span>alpha<span class="op">);</span><span class="co">//先水平移动</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">play</span><span class="op">(</span>alpha<span class="op">).</span><span class="fu">with</span><span class="op">(</span>rotationX<span class="op">);</span><span class="co">//然后透明变换和旋转同时执行</span></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">play</span><span class="op">(</span>scaleX<span class="op">).</span><span class="fu">after</span><span class="op">(</span>alpha<span class="op">);</span><span class="co">//最后执行缩放动画</span></span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">setRepeatCount</span><span class="op">(-</span><span class="dv">1</span><span class="op">);</span><span class="co">//-1表示一直重复</span></span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">setDuration</span><span class="op">(</span><span class="dv">2000</span><span class="op">);</span><span class="co">//动画持续2秒</span></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">setStartDelay</span><span class="op">(</span><span class="dv">1000</span><span class="op">);</span><span class="co">//延迟1秒执行</span></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">start</span><span class="op">();</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a><span class="co">//通过view.animate()创建</span></span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>view<span class="op">.</span><span class="fu">animate</span><span class="op">().</span><span class="fu">translationXBy</span><span class="op">(</span>view<span class="op">.</span><span class="fu">getWidth</span><span class="op">())</span></span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">translationYBy</span><span class="op">(</span>view<span class="op">.</span><span class="fu">getWidth</span><span class="op">())</span></span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setDuration</span><span class="op">(</span><span class="dv">2000</span><span class="op">)</span></span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setInterpolator</span><span class="op">(</span><span class="kw">new</span> <span class="fu">BounceInterpolator</span><span class="op">())</span></span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">start</span><span class="op">();</span></span>
<span id="cb165-22"><a href="#cb165-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-23"><a href="#cb165-23" aria-hidden="true" tabindex="-1"></a><span class="co">//除了使用系统提供的变换方式，还可以自己指定动画的移动路径</span></span>
<span id="cb165-24"><a href="#cb165-24" aria-hidden="true" tabindex="-1"></a>Path path <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">();</span></span>
<span id="cb165-25"><a href="#cb165-25" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">cubicTo</span><span class="op">(</span><span class="fl">0.2f</span><span class="op">,</span> <span class="fl">0f</span><span class="op">,</span> <span class="fl">0.1f</span><span class="op">,</span> <span class="fl">1f</span><span class="op">,</span> <span class="fl">0.5f</span><span class="op">,</span> <span class="fl">1f</span><span class="op">);</span></span>
<span id="cb165-26"><a href="#cb165-26" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">lineTo</span><span class="op">(</span><span class="fl">1f</span><span class="op">,</span> <span class="fl">1f</span><span class="op">);</span></span>
<span id="cb165-27"><a href="#cb165-27" aria-hidden="true" tabindex="-1"></a>ObjectAnimator animator <span class="op">=</span> ObjectAnimator<span class="op">.</span><span class="fu">ofFloat</span><span class="op">(</span>iv<span class="op">,</span> view<span class="op">.</span><span class="fu">X</span><span class="op">,</span> view<span class="op">.</span><span class="fu">Y</span><span class="op">,</span> path<span class="op">);</span></span>
<span id="cb165-28"><a href="#cb165-28" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">setDuration</span><span class="op">(</span><span class="dv">2000</span><span class="op">);</span></span>
<span id="cb165-29"><a href="#cb165-29" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">setRepeatCount</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb165-30"><a href="#cb165-30" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">setRepeatMode</span><span class="op">(</span>ValueAnimator<span class="op">.</span><span class="fu">REVERSE</span><span class="op">);</span></span>
<span id="cb165-31"><a href="#cb165-31" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">start</span><span class="op">();</span></span></code></pre></div>
<h3 id="interpolator">Interpolator</h3>
<p>插值器（<code>Interpolator</code>）可以用来控制动画过程的变化速率</p>
<p>xml中使用：</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="co">下面是xml中所有的interpolator，对应的JAVA类就是把下划线去掉，单词首字母大写</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/accelerate_interpolator 设置动画为加速动画(动画播放中越来越快)</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/decelerate_interpolator 设置动画为减速动画(动画播放中越来越慢)</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/accelerate_decelerate_interpolator 设置动画为先加速在减速(开始速度最快 逐渐减慢)</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/anticipate_interpolator 先反向执行一段，然后再加速反向回来（相当于我们弹簧，先反向压缩一小段，然后在加速弹出）</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/anticipate_overshoot_interpolator 同上先反向一段，然后加速反向回来，执行完毕自带回弹效果（更形象的弹簧效果）</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/bounce_interpolator 执行完毕之后会回弹跳跃几段（相当于我们高空掉下一颗皮球，到地面是会跳动几下）</span></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/cycle_interpolator 循环，动画循环一定次数，值的改变为一正弦函数：Math.sin(2* mCycles* Math.PI* input)</span></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/linear_interpolator 线性均匀改变</span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="co">@android:anim/overshoot_interpolator 加速执行，结束之后回弹</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">set</span><span class="ot"> android:interpolator=</span><span class="st">&quot;@android:anim/accelerate_interpolator&quot;</span>&gt;</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- xxx --&gt;</span></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">set</span>&gt;</span></code></pre></div>
<p>JAVA中使用：</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>animation<span class="op">.</span><span class="fu">setInterpolator</span><span class="op">(</span><span class="kw">new</span> <span class="fu">AccelerateInterpolator</span><span class="op">());</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="co">//除了xml中对应的Interpolator类，还有JAVA代码特有的PathInterpolator</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="co">//PathInterpolator是按照贝塞尔曲线运动的，官方提供了一个工具类生成PathInterpolator，这样就不用自己实现贝塞尔曲线了</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="co">//三阶贝塞尔曲线</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>Path path <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">();</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">cubicTo</span><span class="op">(</span><span class="fl">0.2f</span><span class="op">,</span> <span class="fl">0f</span><span class="op">,</span> <span class="fl">0.1f</span><span class="op">,</span> <span class="fl">1f</span><span class="op">,</span> <span class="fl">0.5f</span><span class="op">,</span> <span class="fl">1f</span><span class="op">);</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">lineTo</span><span class="op">(</span><span class="fl">1f</span><span class="op">,</span> <span class="fl">1f</span><span class="op">);</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>ObjectAnimator animator <span class="op">=</span> ObjectAnimator<span class="op">.</span><span class="fu">ofFloat</span><span class="op">(</span>view<span class="op">,</span> <span class="bu">View</span><span class="op">.</span><span class="fu">TRANSLATION_X</span><span class="op">,</span> <span class="dv">500</span><span class="op">);</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">setInterpolator</span><span class="op">(</span>PathInterpolatorCompat<span class="op">.</span><span class="fu">create</span><span class="op">(</span>path<span class="op">));</span><span class="co">//通过工具类创建</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>animator<span class="op">.</span><span class="fu">start</span><span class="op">();</span></span></code></pre></div>
<h3 id="activity转场动画">Activity转场动画</h3>
<p>通过overridePendingTransition指定Activity转场动画</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">set</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">translate</span><span class="ot"> android:fromXDelta=</span><span class="st">&quot;100%&quot;</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="ot">               android:toXDelta=</span><span class="st">&quot;0%&quot;</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="ot">               android:duration=</span><span class="st">&quot;500&quot;</span> /&gt;</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">set</span>&gt;</span></code></pre></div>
<div class="sourceCode" id="cb169"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">set</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">translate</span><span class="ot"> android:fromXDelta=</span><span class="st">&quot;0%&quot;</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="ot">               android:toXDelta=</span><span class="st">&quot;-40%&quot;</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="ot">               android:duration=</span><span class="st">&quot;500&quot;</span> /&gt;</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">set</span>&gt;</span></code></pre></div>
<div class="sourceCode" id="cb170"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> Activity2<span class="op">.</span><span class="fu">class</span><span class="op">));</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">overridePendingTransition</span><span class="op">(</span>R<span class="op">.</span><span class="fu">anim</span><span class="op">.</span><span class="fu">slide_right_in</span><span class="op">,</span> R<span class="op">.</span><span class="fu">anim</span><span class="op">.</span><span class="fu">slide_left_out</span><span class="op">);</span></span></code></pre></div>
<p>Android5.0新增的转场动画 - Explode - Slide - Fade - Share</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CActivity <span class="kw">extends</span> AppCompatActivity <span class="op">{</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span><span class="at">@Nullable</span> Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">//设置Explode进场动画</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//getWindow().setEnterTransition(new Explode());</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">//设置Slide进场动画</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">//getWindow().setEnterTransition(new Slide());</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">//设置Fade进场、出场动画</span></span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">getWindow</span><span class="op">().</span><span class="fu">setEnterTransition</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Fade</span><span class="op">());</span></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">getWindow</span><span class="op">().</span><span class="fu">setExitTransition</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Fade</span><span class="op">());</span></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_c</span><span class="op">);</span></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>share动画：</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 首先，两个Activity共享的元素需要设置相同的transitionName： android:transitionName=&quot;fab&quot; --&gt;</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">Button</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:id=</span><span class="st">&quot;@+id/fab_button&quot;</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:layout_width=</span><span class="st">&quot;56dp&quot;</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:layout_height=</span><span class="st">&quot;56dp&quot;</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:background=</span><span class="st">&quot;@mipmap/ic_launcher&quot;</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:elevation=</span><span class="st">&quot;5dp&quot;</span></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:onClick=</span><span class="st">&quot;explode&quot;</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:transitionName=</span><span class="st">&quot;fab&quot;</span> /&gt;</span></code></pre></div>
<div class="sourceCode" id="cb173"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">Button</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:id=</span><span class="st">&quot;@+id/fab_button&quot;</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:layout_width=</span><span class="st">&quot;160dp&quot;</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:layout_height=</span><span class="st">&quot;160dp&quot;</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:layout_alignParentEnd=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:layout_below=</span><span class="st">&quot;@id/holder_view&quot;</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:layout_marginTop=</span><span class="st">&quot;-80dp&quot;</span></span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:background=</span><span class="st">&quot;@mipmap/ic_launcher&quot;</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:elevation=</span><span class="st">&quot;5dp&quot;</span></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a><span class="ot">     android:transitionName=</span><span class="st">&quot;fab&quot;</span> /&gt;</span></code></pre></div>
<div class="sourceCode" id="cb174"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 跳转时，要为每一个共享的view设置对应的transitionName</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="bu">View</span> fab <span class="op">=</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">fab_button</span><span class="op">);</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="bu">View</span> txName <span class="op">=</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">tx_user_name</span><span class="op">);</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> CActivity<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">,</span> ActivityOptions<span class="op">.</span><span class="fu">makeSceneTransitionAnimation</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>        Pair<span class="op">.</span><span class="fu">create</span><span class="op">(</span>view<span class="op">,</span> <span class="st">&quot;share&quot;</span><span class="op">),</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>        Pair<span class="op">.</span><span class="fu">create</span><span class="op">(</span>fab<span class="op">,</span> <span class="st">&quot;fab&quot;</span><span class="op">),</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>        Pair<span class="op">.</span><span class="fu">create</span><span class="op">(</span>txName<span class="op">,</span> <span class="st">&quot;user_name&quot;</span><span class="op">))</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">toBundle</span><span class="op">());</span></span></code></pre></div>
<div class="sourceCode" id="cb175"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 跳转的Activity在onCreate方法中开启Transition模式</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CActivity <span class="kw">extends</span> AppCompatActivity <span class="op">{</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span><span class="at">@Nullable</span> Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">getWindow</span><span class="op">().</span><span class="fu">requestFeature</span><span class="op">(</span><span class="bu">Window</span><span class="op">.</span><span class="fu">FEATURE_CONTENT_TRANSITIONS</span><span class="op">);</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_c</span><span class="op">);</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>使用5.0新增的动画要在startActivity的时候在第二个参数指定Bundle，固定写法为<code>ActivityOptions.makeSceneTransitionAnimation(this).toBundle()</code></p>
<div class="sourceCode" id="cb176"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> CActivity<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">,</span> ActivityOptions<span class="op">.</span><span class="fu">makeSceneTransitionAnimation</span><span class="op">(</span><span class="kw">this</span><span class="op">).</span><span class="fu">toBundle</span><span class="op">());</span></span></code></pre></div>
<h3 id="circularreveral">CircularReveral</h3>
<p>这是Android5.0推出的新的动画框架，可以给View做一个圆角的揭露效果</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co">//五个参数分别是View，中心点坐标x、y，开始半径，结束半径</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>Animator anim <span class="op">=</span> ViewAnimationUtils<span class="op">.</span><span class="fu">createCircularReveal</span><span class="op">(</span>view<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">hypot</span><span class="op">(</span>rect<span class="op">.</span><span class="fu">getWidth</span><span class="op">(),</span> rect<span class="op">.</span><span class="fu">getHeight</span><span class="op">()));</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>anim<span class="op">.</span><span class="fu">setDuration</span><span class="op">(</span><span class="dv">2000</span><span class="op">);</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>anim<span class="op">.</span><span class="fu">start</span><span class="op">();</span></span></code></pre></div>
<h3 id="矢量动画">矢量动画</h3>
<p>SVG就是标准的矢量图格式，xml中定义的path就是用了SVG的命令，SVG常用命令有</p>
<ul>
<li>M：新建起点，参数x，y（M20， 30）</li>
<li>L：连接直线，参数x，y（L30， 20）</li>
<li>H：纵坐标不变，横向连线，参数x（H20）</li>
<li>V：横坐标不变，纵向连线，参数y（V30）</li>
<li>Q：二次贝塞尔曲线，参数x1，y1，x2，y2（Q10，20，30，40）</li>
<li>C：三次贝塞尔曲线，参数x1，y1，x2，y2，x3，y3（C10，20，30，40，50，
60）</li>
<li>Z：连接首尾，闭合曲线，无参数</li>
</ul>
<p>首先创建一个ImageView</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">ImageView</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:id=</span><span class="st">&quot;@+id/imgBtn&quot;</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;200dp&quot;</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;200dp&quot;</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:onClick=</span><span class="st">&quot;startAnim&quot;</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:src=</span><span class="st">&quot;@drawable/animvectordrawable&quot;</span> /&gt;</span></code></pre></div>
<p>src指向的是一个<code>animated-vector</code>，<code>animated-vector</code>的drawable指定静态时显示的图案，<code>target</code>是对外部xml的引用，<code>target</code>（<code>objectAnimator</code>）的name对应<code>vector</code>中的name，用于指定图像的哪一部分做哪种动画</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- animvectordrawable.xml --&gt;</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">animated-vector</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:drawable=</span><span class="st">&quot;@drawable/vectordrawable&quot;</span> &gt;</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:name=</span><span class="st">&quot;rotationGroup&quot;</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:animation=</span><span class="st">&quot;@anim/rotation&quot;</span> /&gt;</span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:name=</span><span class="st">&quot;v&quot;</span></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:animation=</span><span class="st">&quot;@anim/path_morph&quot;</span> /&gt;</span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">animated-vector</span>&gt;</span></code></pre></div>
<p>第一个<code>target</code>指向的是一个<code>objectAnimator</code>，<code>objectAnimator</code>表示动画的变换方式</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- rotation.xml --&gt;</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">objectAnimator</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:duration=</span><span class="st">&quot;1500&quot;</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:propertyName=</span><span class="st">&quot;rotation&quot;</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:valueFrom=</span><span class="st">&quot;0&quot;</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:valueTo=</span><span class="st">&quot;360&quot;</span> /&gt;</span></code></pre></div>
<p>第二个<code>target</code>指向的是一个<code>set</code>，其中valueFrom、valueTo用的就是SVG命令</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- path_morph.xml --&gt;</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">set</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">objectAnimator</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:duration=</span><span class="st">&quot;1500&quot;</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:propertyName=</span><span class="st">&quot;pathData&quot;</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:valueFrom=</span><span class="st">&quot;M10,10 L60,10 L60,20 L10,20 Z M10,30 L60,30 L60,40 L10,40 Z M10,50 L60,50 L60,60 L10,60 Z&quot;</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:valueTo=</span><span class="st">&quot;M5,35 L40,0 L47.072,7.072 L12.072,42.072 Z M10,30 L60,30 L60,40 L10,40 Z M12.072,27.928 L47.072,62.928 L40,70 L5,35 Z&quot;</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:valueType=</span><span class="st">&quot;pathType&quot;</span> /&gt;</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">set</span>&gt;</span></code></pre></div>
<p><code>animated-vector</code>的drawable指向的是一个<code>vector</code>，<code>vector</code>是元素的矢量资源（静态时显示的图案），<code>animated-vector</code>规定，可以有多个动画同时进行，但是一个对象上只能加载一个动画，这里既做旋转又做path变换，就需要用group标签，把path变换动画放在path对象上，把旋转动画放在group对象上，从而实现整体的效果</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- vectordrawable.xml --&gt;</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">vector</span><span class="ot"> xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:height=</span><span class="st">&quot;300dp&quot;</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:width=</span><span class="st">&quot;300dp&quot;</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:viewportHeight=</span><span class="st">&quot;70&quot;</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:viewportWidth=</span><span class="st">&quot;70&quot;</span> &gt;</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">group</span></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:name=</span><span class="st">&quot;rotationGroup&quot;</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:pivotX=</span><span class="st">&quot;35&quot;</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:pivotY=</span><span class="st">&quot;35&quot;</span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:rotation=</span><span class="st">&quot;0.0&quot;</span> &gt;</span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">path</span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:name=</span><span class="st">&quot;v&quot;</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:fillColor=</span><span class="st">&quot;#000000&quot;</span></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="ot">            android:pathData=</span><span class="st">&quot;M10,10 L60,10 L60,20 L10,20 Z M10,30 L60,30 L60,40 L10,40 Z M10,50 L60,50 L60,60 L10,60 Z&quot;</span> /&gt;</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">group</span>&gt;</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">vector</span>&gt;</span></code></pre></div>
<p>xml设置好后就可以在JAVA代码中启动动画了</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="at">@RequiresApi</span><span class="op">(</span>api <span class="op">=</span> Build<span class="op">.</span><span class="fu">VERSION_CODES</span><span class="op">.</span><span class="fu">LOLLIPOP</span><span class="op">)</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">startAnim</span><span class="op">(</span><span class="bu">View</span> view<span class="op">)</span> <span class="op">{</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>    Drawable drawable <span class="op">=</span> imgBtn<span class="op">.</span><span class="fu">getDrawable</span><span class="op">();</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">((</span>Animatable<span class="op">)</span> drawable<span class="op">).</span><span class="fu">start</span><span class="op">();</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>但是这时只能从一个图像变换成另一个图像，并不能变回来，这时就需要使用<code>animated-selector</code></p>
<p>这里两个<code>item</code>分别表示两个状态（state_checked为true和默认状态），指向两个<code>vector</code>；两个<code>transition</code>分别指定两种状态之间互换的过渡动画，指向两个<code>animated-vector</code></p>
<div class="sourceCode" id="cb184"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">animated-selector</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> android:id=</span><span class="st">&quot;@+id/state_on&quot;</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:drawable=</span><span class="st">&quot;@drawable/ic_twitter&quot;</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:state_checked=</span><span class="st">&quot;true&quot;</span>/&gt;</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> android:id=</span><span class="st">&quot;@+id/state_off&quot;</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:drawable=</span><span class="st">&quot;@drawable/ic_heart&quot;</span> /&gt;</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">transition</span></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:fromId=</span><span class="st">&quot;@id/state_off&quot;</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:toId=</span><span class="st">&quot;@id/state_on&quot;</span></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:drawable=</span><span class="st">&quot;@drawable/avd_heart_to_twitter&quot;</span> /&gt;</span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">transition</span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:fromId=</span><span class="st">&quot;@id/state_on&quot;</span></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:toId=</span><span class="st">&quot;@id/state_off&quot;</span></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:drawable=</span><span class="st">&quot;@drawable/avd_twitter_to_heart&quot;</span> /&gt;</span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">animated-selector</span>&gt;</span></code></pre></div>
<p><code>transition</code>指向的其中一个<code>animated-vector</code>，这里指定了两个动画，一个是旋转动画，另一个是path动画</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">animated-vector</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:aapt=</span><span class="st">&quot;http://schemas.android.com/aapt&quot;</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:drawable=</span><span class="st">&quot;@drawable/ic_heart&quot;</span>&gt;</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> android:name=</span><span class="st">&quot;groupHeart&quot;</span>&gt;</span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">aapt:attr</span><span class="ot"> name=</span><span class="st">&quot;android:animation&quot;</span>&gt;</span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">objectAnimator</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:propertyName=</span><span class="st">&quot;rotation&quot;</span></span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:valueFrom=</span><span class="st">&quot;-360&quot;</span></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:valueTo=</span><span class="st">&quot;0&quot;</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:duration=</span><span class="st">&quot;1000&quot;</span> /&gt;</span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">aapt:attr</span>&gt;</span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">target</span>&gt;</span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> android:name=</span><span class="st">&quot;heart&quot;</span>&gt;</span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">aapt:attr</span><span class="ot"> name=</span><span class="st">&quot;android:animation&quot;</span>&gt;</span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">objectAnimator</span></span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:duration=</span><span class="st">&quot;1000&quot;</span></span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:propertyName=</span><span class="st">&quot;pathData&quot;</span></span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:valueFrom=</span><span class="st">&quot;M 12.0,21.35 l -1.45,-1.32 C 5.4,15.36,2.0,12.28,2.0,8.5 C 2.0,5.42,4.42,3.0,7.5,3.0 c 1.74,0.0,3.41,0.81,4.5,2.09 C 13.09,3.81,14.76,3.0,16.5,3.0 C 19.58,3.0,22.0,5.42,22.0,8.5 c 0.0,3.78,-3.4,6.86,-8.55,11.54 L 12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 C 12.0,21.35,12.0,21.35,12.0,21.35 L 12.0,21.35&quot;</span></span>
<span id="cb185-23"><a href="#cb185-23" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:valueTo=</span><span class="st">&quot;M 22.46,6.0 l 0.0,0.0 C 21.69,6.35,20.86,6.58,20.0,6.69 C 20.88,6.16,21.56,5.32,21.88,4.31 c 0.0,0.0,0.0,0.0,0.0,0.0 C 21.05,4.81,20.13,5.16,19.16,5.36 C 18.37,4.5,17.26,4.0,16.0,4.0 c 0.0,0.0,0.0,0.0,0.0,0.0 L 16.0,4.0 C 13.65,4.0,11.73,5.92,11.73,8.29 C 11.73,8.63,11.77,8.96,11.84,9.27 C 8.28,9.09,5.11,7.38,3.0,4.79 C 2.63,5.42,2.42,6.16,2.42,6.94 C 2.42,8.43,3.17,9.75,4.33,10.5 C 3.62,10.5,2.96,10.3,2.38,10.0 C 2.38,10.0,2.38,10.0,2.38,10.03 C 2.38,12.11,3.86,13.85,5.82,14.24 C 5.46,14.34,5.08,14.39,4.69,14.39 C 4.42,14.39,4.15,14.36,3.89,14.31 C 4.43,16.0,6.0,17.26,7.89,17.29 C 6.43,18.45,4.58,19.13,2.56,19.13 C 2.22,19.13,1.88,19.11,1.54,19.07 C 3.44,20.29,5.7,21.0,8.12,21.0 C 16.0,21.0,20.33,14.46,20.33,8.79 C 20.33,8.6,20.33,8.42,20.32,8.23 C 21.16,7.63,21.88,6.87,22.46,6.0 L 22.46,6.0&quot;</span></span>
<span id="cb185-24"><a href="#cb185-24" aria-hidden="true" tabindex="-1"></a><span class="ot">                android:valueType=</span><span class="st">&quot;pathType&quot;</span> /&gt;</span>
<span id="cb185-25"><a href="#cb185-25" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">aapt:attr</span>&gt;</span>
<span id="cb185-26"><a href="#cb185-26" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">target</span>&gt;</span>
<span id="cb185-27"><a href="#cb185-27" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">animated-vector</span>&gt;</span></code></pre></div>
<h2 id="fragment">Fragment</h2>
<h3 id="生命周期-1">生命周期</h3>
<p>[<code>onInflate()</code>-&gt;]<code>onAttach()</code>-&gt;<code>onCreate()</code>-&gt;<code>onCreateView()</code>-&gt;<code>onViewCreated()</code>-&gt;<code>onActivityCreated()</code>-&gt;<code>onViewStateRestored()</code>-&gt;<code>onStart()</code>-&gt;<code>onResume()</code>-&gt;<code>onCreateOptionsMenu()</code>-&gt;<code>onPrepareOptionsMenu()</code>-&gt;Fragment运行-&gt;<code>onPause()</code>-&gt;<code>onSaveInstanceState()</code>-&gt;<code>onStop()</code>-&gt;<code>onDestoryView()</code>-&gt;<code>onDestory()</code>-&gt;<code>onDetach()</code></p>
<ul>
<li>只有通过Inflater创建的Fragment才会调onInflate</li>
<li>只有第一次创建Fragment或者reattach的时候才会调onActivityCreated和onViewStateRestored，否则onViewCreate会直接调onStart</li>
<li>onStart执行时，Fragment由不可见变为可见状态</li>
<li>onResume执行时，Fragment处于活动状态，用户可与之交互</li>
<li>只有当setHasOptionsMenu(true)时，才会调用onCreateOptionsMenu和onPrepareOptionsMenu</li>
<li>onPause执行时，Fragment处于暂停状态，但依然可见，用户不能与之交互</li>
<li>onSaveInstanceState会在onDestroy之前的任意时刻调，调用的时机不固定，onSaveInstanceState会保存当前Fragment的状态。该方法会自动保存Fragment的状态，比如EditText键入的文本，即使Fragment被回收又重新创建，一样能恢复EditText之前键入的文本</li>
<li>onStop执行时，Fragment完全不可见</li>
<li>onDetach解除与Activity的绑定</li>
</ul>
<h3 id="静态添加">静态添加</h3>
<p>JAVA代码：</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyFragment <span class="kw">extends</span> Fragment <span class="op">{</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onAttach</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">){</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onAttach</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Activity之间传递参数可以通过getIntent().getExtras()</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">//而Fragment之间传递参数可以使用getArguments()</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>        Bundle bundle <span class="op">=</span> <span class="fu">getArguments</span><span class="op">();</span></span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">View</span> <span class="fu">onCreateView</span><span class="op">(</span>LayoutInflater inflater<span class="op">,</span> ViewGroup container<span class="op">,</span> Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">//通过Inflater加载布局R.layout.fragment1和普通activity的布局文件相同，只不过变成了由fragment来加载</span></span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">View</span> view <span class="op">=</span> <span class="bu">Inflater</span><span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">fragment1</span><span class="op">,</span> container<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> view<span class="op">;</span></span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onViewCreated</span><span class="op">(</span><span class="bu">View</span> view<span class="op">,</span> Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">//初始化布局、参数</span></span>
<span id="cb186-21"><a href="#cb186-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">//view.findViewById(...)</span></span>
<span id="cb186-22"><a href="#cb186-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb186-23"><a href="#cb186-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>xml使用自己的fragment（通过name设置）：</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;utf-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">LinearLayout</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:layout_height=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    android:orientation=</span><span class="st">&quot;vertical&quot;</span>&gt;</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">fragment</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:id=</span><span class="st">&quot;@+id/fragment1&quot;</span></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_width=</span><span class="st">&quot;match_parent&quot;</span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_height=</span><span class="st">&quot;0dp&quot;</span></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:layout_weight=</span><span class="st">&quot;1&quot;</span></span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:name=</span><span class="st">&quot;com.myapp.MyFragment&quot;</span>/&gt;</span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">LinearLayout</span>&gt;</span></code></pre></div>
<h3 id="动态添加与删除">动态添加与删除</h3>
<div class="sourceCode" id="cb188"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>FragmentManager frgmentManager <span class="op">=</span> <span class="fu">getFragmentManager</span><span class="op">();</span><span class="co">// v4中，getSupportFragmentManager</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>FragmentTransaction transaction <span class="op">=</span> frgmentManager<span class="op">.</span><span class="fu">benginTransatcion</span><span class="op">();</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">addToBackStack</span><span class="op">(</span><span class="kw">null</span><span class="op">);</span><span class="co">//支持返回键，点击返回时，回到上一个frgment,否则点返回直接退出app</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">add</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">containerViewId</span><span class="op">,</span> fragment1<span class="op">);</span><span class="co">//添加，containerView一般是FrameLayout</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="co">//如果在FragmentA中的EditText填了一些数据，当切换到FragmentB时，如果希望会到A还能看到数据，就用add加hide和show，如果不需要保存用户操作，就用add和remove</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">hide</span><span class="op">(</span>fragment1<span class="op">);</span><span class="co">//隐藏，搭配add使用</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">show</span><span class="op">(</span>fragment1<span class="op">);</span><span class="co">//显示，搭配add使用</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">setBreadCrumbShortTitle</span><span class="op">(</span>R<span class="op">.</span><span class="fu">string</span><span class="op">.</span><span class="fu">title</span><span class="op">);</span><span class="co">//添加标题</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a><span class="co">//transaction.replace(R.id.containerViewId, fragment2);//替换，和add、remove一样，会销毁布局容器内的已有视图，这样会导致每次切换Fragment时都会重新初始化，类似EditText中已输入的数据不会被保留</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a><span class="co">//在不考虑回退栈的情况下，remove会销毁整个Fragment实例，而detach则只是销毁其视图结构，实例并不会被销毁，如果当前Activity一直存在，那么在不希望保留用户操作的时候，你可以优先使用detach</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a><span class="co">//transaction.remove(fragment2);//删除</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a><span class="co">//transaction.detach(fragment2);//取消挂载</span></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">commit</span><span class="op">();</span><span class="co">//提交后才生效</span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a><span class="co">//可以手动返回上一个fragment</span></span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a><span class="fu">getFragmentManager</span><span class="op">().</span><span class="fu">popBackStack</span><span class="op">();</span></span></code></pre></div>
<p>如果使用add加hide和show，在旋转屏幕、从后台回来、使用Instant
Run调试等情况下，会出现重叠现象，这是因为当Activity被销毁再重新创建时（或其他情况导致再次调用onCreate时），onCreate被再次调用，重新初始化了Fragment并add了两个新的Fragment实例（当在onCreate中new
Fragment并add时），当点击按钮切换Fragment时，hide或show的实例是新创建的实例，这就导致了旧的Fragment没有被正确地hide，解决办法是</p>
<p>方法1：在add的时候添加tag，如onCreate被再次调用，就从FragmentManager中取回之前创建的Fragment</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>Fragment1 fragment1<span class="op">;</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>Fragment2 fragment2<span class="op">;</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_main</span><span class="op">);</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>    FragmentManager fragmentManager <span class="op">=</span> <span class="fu">getSupportFragmentManager</span><span class="op">();</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//防止fragment产生重叠问题</span></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>savedInstanceState <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>        fragment1 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Fragment1</span><span class="op">();</span></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>        fragment2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Fragment2</span><span class="op">();</span></span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a>        fragmentManager<span class="op">.</span><span class="fu">beginTransaction</span><span class="op">()</span></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">add</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">containerViewId</span><span class="op">,</span> fragment1<span class="op">,</span> Fragment1<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getName</span><span class="op">())</span></span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">add</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">containerViewId</span><span class="op">,</span> fragment2<span class="op">,</span> Fragment2<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getName</span><span class="op">())</span></span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">commit</span><span class="op">();</span></span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a>        fragment1 <span class="op">=</span> <span class="op">(</span>Fragment1<span class="op">)</span> fragmentManager<span class="op">.</span><span class="fu">findFragmentByTag</span><span class="op">(</span>Fragment1<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>        fragment2 <span class="op">=</span> <span class="op">(</span>Fragment2<span class="op">)</span> fragmentManager<span class="op">.</span><span class="fu">findFragmentByTag</span><span class="op">(</span>Fragment2<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a>    fragmentManager<span class="op">.</span><span class="fu">beginTransaction</span><span class="op">()</span></span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">show</span><span class="op">(</span>fragment1<span class="op">)</span></span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">hide</span><span class="op">(</span>fragment2<span class="op">)</span></span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">commit</span><span class="op">();</span></span>
<span id="cb189-29"><a href="#cb189-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>最好在Fragment中再判断一次Parent是否为空</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="bu">View</span> mRoot<span class="op">;</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">View</span> <span class="fu">onCreateView</span><span class="op">(</span>LayoutInflater inflater<span class="op">,</span> ViewGroup container<span class="op">,</span> Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>mRoot<span class="op">==</span><span class="kw">null</span><span class="op">){</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>        mRoot <span class="op">=</span> <span class="bu">Inflater</span><span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">fragment1</span><span class="op">,</span> container<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>mRoot<span class="op">.</span><span class="fu">getParent</span><span class="op">!=</span><span class="kw">null</span><span class="op">){</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">((</span>ViewGroup<span class="op">)</span>mRoot<span class="op">.</span><span class="fu">getParent</span><span class="op">()).</span><span class="fu">removeView</span><span class="op">(</span>mRoot<span class="op">);</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mRoot<span class="op">;</span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>方法2：直接禁止保存视图及相关数据，每次onCreate都全部重新初始化。当切换到其他app时，Activity被销毁并通过<code>onSaveInstanceState</code>保存Fragment及其他视图相关的数据，如果把<code>onSaveInstanceState</code>改成空的函数，则Activity被销毁时不会保存任何东西，这样之前add的Fragment也会被清空</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onSaveInstanceState</span><span class="op">(</span><span class="at">@NonNull</span> Bundle outState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//super.onSaveInstanceState(outState);</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="懒加载">懒加载</h3>
<p>当使用ViewPager+Fragment时，由于ViewPager一开始只加载前两页，而且默认同时加载三页（可以通过<code>setOffscreenPageLimit(int limit)</code>更改），多余的实例会销毁，这时懒加载就很有必要了。懒加载可以让当fragment对用户可见时才开始加载，而ViewPager中对用户不可见的页不会进行加载</p>
<p>在Fragment中有一个setUserVisibleHint的方法，这个方法是优于onCreate方法的，所以也可以作为Fragment的一个生命周期来看待，它会通过isVisibleToUser告诉我们当前Fragment我们是否可见，我们可以在可见的时候再进行加载（比如网络请求）</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co">//当该页面对用户可见/不可见时,系统都会回调此方法</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">setUserVisibleHint</span><span class="op">(</span><span class="dt">boolean</span> isVisibleToUser<span class="op">)</span> <span class="op">{</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>isVisibleToUser<span class="op">)</span> <span class="op">{</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">//网络请求等操作</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">setUserVisibleHint</span><span class="op">(</span>isVisibleToUser<span class="op">);</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>网络请求后一般要进行UI更新，但这时由于<code>setUserVisibleHint</code>先于<code>onCreate</code>调用，UI还没加载完，无法在setUserVisibleHint更新UI，所以一般在onViewCreated添加完成UI加载的标志，再根据<code>getUserVisibleHint()</code>判断用户是否可见，同时满足两个条件才开始网络请求</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">boolean</span> isViewCreated<span class="op">;</span><span class="co">//Fragment的View加载完毕的标记</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">boolean</span> isLoadingData<span class="op">;</span><span class="co">//是否正在加载数据，防止UI加载好并且对用户可见，开始了一次网络请求但还没完成请求时，重复调用lazyLoad后导致的重复请求</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onViewCreated</span><span class="op">(</span><span class="bu">View</span> view<span class="op">,</span> <span class="at">@Nullable</span> Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onViewCreated</span><span class="op">(</span>view<span class="op">,</span> savedInstanceState<span class="op">);</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>    isViewCreated <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lazyLoad</span><span class="op">();</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">setUserVisibleHint</span><span class="op">(</span><span class="dt">boolean</span> isVisibleToUser<span class="op">)</span> <span class="op">{</span></span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">setUserVisibleHint</span><span class="op">(</span>isVisibleToUser<span class="op">);</span></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>isVisibleToUser<span class="op">)</span> <span class="op">{</span></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lazyLoad</span><span class="op">();</span></span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">lazyLoad</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">//只有当view创建好并且对用户可见，而且没有正在加载数据时才开始加载数据</span></span>
<span id="cb193-21"><a href="#cb193-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>isViewCreated <span class="op">&amp;&amp;</span> <span class="fu">getUserVisibleHint</span><span class="op">()</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>isLoadingData<span class="op">)</span> <span class="op">{</span></span>
<span id="cb193-22"><a href="#cb193-22" aria-hidden="true" tabindex="-1"></a>        isLoadingData <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb193-23"><a href="#cb193-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> 网络请求等操作，一般新建线程来做</span></span>
<span id="cb193-24"><a href="#cb193-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">//数据加载完毕,恢复标记,防止重复加载</span></span>
<span id="cb193-25"><a href="#cb193-25" aria-hidden="true" tabindex="-1"></a>        isViewCreated <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb193-26"><a href="#cb193-26" aria-hidden="true" tabindex="-1"></a>        isLoadingData <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb193-27"><a href="#cb193-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb193-28"><a href="#cb193-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="其他">其他</h2>
<h3 id="横竖屏切换">横竖屏切换</h3>
<p>xml设置横竖屏</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>android:screenOrientation=&quot;portrait&quot;</span></code></pre></div>
<p>screenOrientation可选的值有： - unspecified
默认值，由系统判断状态自动切换 - landscape 横屏 - portrait 竖屏 - user
用户当前设置的orientation值 - behind
下一个要显示的Activity的orientation值 - sensor 使用传感器 用传感器的方向
- nosensor 不使用传感器 基本等同于unspecified</p>
<p>java设置横竖屏</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setRequestedOrientation</span><span class="op">(</span>ActivityInfo<span class="op">.</span><span class="fu">SCREEN_ORIENTATION_LANDSCAPE</span><span class="op">);</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setRequestedOrientation</span><span class="op">(</span>ActivityInfo<span class="op">.</span><span class="fu">SCREEN_ORIENTATION_PORTRAIT</span><span class="op">);</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a><span class="co">//获取横竖屏状态</span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> screenNum <span class="op">=</span> <span class="fu">getResources</span><span class="op">().</span><span class="fu">getConfiguration</span><span class="op">().</span><span class="fu">orientation</span><span class="op">;</span></span></code></pre></div>
<p>横竖屏切换时，会调用Activity的生命周期，导致组件内容会被重置（如EditText中的内容），如果不想被重置，需在清单文件中的activity中添加configChanges，并至少配置<code>orientation|keyboardHidden|screenSize</code>这三个属性，才能使切屏时Activity的生命周期不会被调用，只会执行onConfigurationChanged方法（只设置<code>orientation</code>不起作用）</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>android:configChanges=&quot;orientation|keyboardHidden|screenSize&quot;</span></code></pre></div>
<p>configChanges的可选值有： - orientation 屏幕在纵向和横向间旋转 -
keyboardHidden 键盘显示或隐藏 - screenSize 屏幕大小改变了 - fontScale
用户变更了首选的字体大小 - locale 用户选择了不同的语言设定 - keyboard
键盘类型变更，例如手机从12键盘切换到全键盘 - touchscreen或navigation
键盘或导航方式变化，一般不会发生这样的事件</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onConfigurationChanged</span><span class="op">(</span><span class="bu">Configuration</span> newConfig<span class="op">){</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>newConfig<span class="op">.</span><span class="fu">orientation</span> <span class="op">==</span> <span class="bu">Configuration</span><span class="op">.</span><span class="fu">ORIENTATION_LANDSCAPE</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">//当前屏幕为横屏</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//当前屏幕为竖屏</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onConfigurationChanged</span><span class="op">(</span>newConfig<span class="op">);</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>如果不设置<code>android:configChanges</code>，切屏会重新调用各个生命周期，切横屏时会执行一次，切竖屏时会执行两次</p>
<p>如果只设置了<code>android:configChanges=&quot;orientation&quot;</code>，横竖屏切换后，切屏还是会重新调用各个生命周期，切横、竖屏时只会执行一次</p>
<h3 id="java与javascript互调">JAVA与javascript互调</h3>
<p>先准备一个html（myweb.html）</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> http-equiv</span><span class="op">=</span><span class="st">&quot;Content-Type&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;text/html;charset=utf-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="dt">&gt;</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">actionFromJAVA</span>(){</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>         <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;log_msg&quot;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">+=</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;&lt;br</span><span class="sc">\&gt;</span><span class="st">JAVA调用了js函数&quot;</span><span class="op">;</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">actionFromJAVAWithParam</span>(arg){</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>         <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;log_msg&quot;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">+=</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>             (<span class="st">&quot;&lt;br</span><span class="sc">\&gt;</span><span class="st">JAVA调用了js函数并传递参数：&quot;</span><span class="op">+</span>arg)<span class="op">;</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>WebView与Javascript交互<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span><span class="ot"> onClick</span><span class="op">=</span><span class="st">&quot;window.myweb.actionFromJs()&quot;</span><span class="dt">&gt;</span>点击调用JAVA代码<span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">/&gt;</span></span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb198-24"><a href="#cb198-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span><span class="ot"> onClick</span><span class="op">=</span><span class="st">&quot;window.myweb.actionFromJsWithParam(&#39;come from Js&#39;)&quot;</span><span class="dt">&gt;</span>点击调用JAVA代码并传递参数<span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb198-25"><a href="#cb198-25" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb198-26"><a href="#cb198-26" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">/&gt;</span></span>
<span id="cb198-27"><a href="#cb198-27" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;log_msg&quot;</span><span class="dt">&gt;</span>调用打印信息<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb198-28"><a href="#cb198-28" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb198-29"><a href="#cb198-29" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>再准备一个WebView，JAVA调javascript只需要用Webview.loadUrl()，URL格式为”javascript:js中的函数名”</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> WebView webView<span class="op">;</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="bu">Button</span> button<span class="op">;</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">{</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_web_view</span><span class="op">);</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>    webView<span class="op">=</span> <span class="op">(</span>WebView<span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">web_view</span><span class="op">);</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>    button<span class="op">=</span> <span class="op">(</span><span class="bu">Button</span><span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">bt_button</span><span class="op">);</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>    WebSettings webSettings <span class="op">=</span> webView<span class="op">.</span><span class="fu">getSettings</span><span class="op">();</span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>    webSettings<span class="op">.</span><span class="fu">setJavaScriptEnabled</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span><span class="co">//支持javaScript</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>    webSettings<span class="op">.</span><span class="fu">setCacheMode</span><span class="op">(</span>WebSettings<span class="op">.</span><span class="fu">LOAD_NO_CACHE</span><span class="op">);</span><span class="co">//无缓存</span></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>    webSettings<span class="op">.</span><span class="fu">setDomStorageEnabled</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span><span class="co">//支持H5 如果不设置部分url加载会出现空白</span></span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a>    webSettings<span class="op">.</span><span class="fu">setSupportZoom</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span><span class="co">//支持缩放，默认为true。是下面那个的前提。</span></span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>    webSettings<span class="op">.</span><span class="fu">setBuiltInZoomControls</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span><span class="co">//设置内置的缩放控件。若为false，则该WebView不可缩放</span></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a>    webSettings<span class="op">.</span><span class="fu">setDisplayZoomControls</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span><span class="co">//隐藏原生的缩放控件</span></span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">//使得打开网页时不调用系统浏览器， 而是在本WebView中显示</span></span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a>    webView<span class="op">.</span><span class="fu">setWebViewClient</span><span class="op">(</span><span class="kw">new</span> <span class="fu">WebViewClient</span><span class="op">(){</span></span>
<span id="cb199-20"><a href="#cb199-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span>
<span id="cb199-21"><a href="#cb199-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">shouldOverrideUrlLoading</span><span class="op">(</span>WebView view<span class="op">,</span> <span class="bu">String</span> url<span class="op">)</span> <span class="op">{</span></span>
<span id="cb199-22"><a href="#cb199-22" aria-hidden="true" tabindex="-1"></a>            view<span class="op">.</span><span class="fu">loadUrl</span><span class="op">(</span>url<span class="op">);</span></span>
<span id="cb199-23"><a href="#cb199-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb199-24"><a href="#cb199-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb199-25"><a href="#cb199-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb199-26"><a href="#cb199-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-27"><a href="#cb199-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">//文件放在src/main/assets/下时，URL为file:///android_asset/xxx</span></span>
<span id="cb199-28"><a href="#cb199-28" aria-hidden="true" tabindex="-1"></a>    webView<span class="op">.</span><span class="fu">loadUrl</span><span class="op">(</span><span class="st">&quot;file:///android_asset/myweb.html&quot;</span><span class="op">);</span></span>
<span id="cb199-29"><a href="#cb199-29" aria-hidden="true" tabindex="-1"></a>    button<span class="op">.</span><span class="fu">setOnClickListener</span><span class="op">(</span><span class="kw">new</span> <span class="bu">View</span><span class="op">.</span><span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb199-30"><a href="#cb199-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb199-31"><a href="#cb199-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span><span class="bu">View</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb199-32"><a href="#cb199-32" aria-hidden="true" tabindex="-1"></a>                <span class="co">//无参数调用javascript的函数</span></span>
<span id="cb199-33"><a href="#cb199-33" aria-hidden="true" tabindex="-1"></a>                webView<span class="op">.</span><span class="fu">loadUrl</span><span class="op">(</span><span class="st">&quot;javascript:actionFromJAVA()&quot;</span><span class="op">);</span></span>
<span id="cb199-34"><a href="#cb199-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-35"><a href="#cb199-35" aria-hidden="true" tabindex="-1"></a>                <span class="bu">String</span> param <span class="op">=</span> <span class="st">&quot;JAVA&quot;</span><span class="op">;</span></span>
<span id="cb199-36"><a href="#cb199-36" aria-hidden="true" tabindex="-1"></a>                <span class="co">//有参数调用javascript的函数</span></span>
<span id="cb199-37"><a href="#cb199-37" aria-hidden="true" tabindex="-1"></a>                webView<span class="op">.</span><span class="fu">loadUrl</span><span class="op">(</span><span class="st">&quot;javascript:actionFromJAVAWithParam(&quot;</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&#39;</span><span class="st">&quot;</span> <span class="op">+</span> param <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&#39;</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span><span class="op">);</span></span>
<span id="cb199-38"><a href="#cb199-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb199-39"><a href="#cb199-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb199-40"><a href="#cb199-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>javascript调JAVA需要为webView设置JavaScriptInterface</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co">//第二个参数表示标识，javascript调JAVA函数时方法名前缀就是这个标识，如window.myweb.actionFromJs()，最前面的window是固定写法，然后是标识，最后才是JAVA的方法名，该方法就是第一个参数的Object中实现了的方法，且此方法要有@JavascriptInterface注解</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>webView<span class="op">.</span><span class="fu">addJavascriptInterface</span><span class="op">(</span><span class="kw">new</span> <span class="fu">MyObject</span><span class="op">(),</span><span class="st">&quot;myweb&quot;</span><span class="op">);</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="co">//要先addJavascriptInterface再loadUrl，JavascriptInterface才会生效</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>webView<span class="op">.</span><span class="fu">loadUrl</span><span class="op">(</span><span class="st">&quot;file:///android_asset/myweb.html&quot;</span><span class="op">);</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyObject<span class="op">{</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@JavascriptInterface</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">actionFromJs</span><span class="op">(){</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>        Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span> <span class="st">&quot;javascript调用了JAVA的函数&quot;</span><span class="op">);</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">//该函数不一定是主线程调，更新UI应该用runOnUiThread</span></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">runOnUiThread</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Runnable</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>                <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>                    Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span>MyActivity<span class="op">.</span><span class="fu">this</span><span class="op">,</span> <span class="st">&quot;js调用了Native函数&quot;</span><span class="op">,</span> Toast<span class="op">.</span><span class="fu">LENGTH_SHORT</span><span class="op">).</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">@JavascriptInterface</span></span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">actionFromJsWithParam</span><span class="op">(</span><span class="bu">String</span> arg<span class="op">){</span></span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a>        Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span> <span class="st">&quot;javascript调用了JAVA的函数，参数是&quot;</span><span class="op">+</span>arg<span class="op">);</span></span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="浏览器跳转app">浏览器跳转app</h3>
<p>浏览器跳转app通过URI实现，其中scheme和host是必须的，其他可以省略</p>
<pre><code>myapp://abcdefg.me/fromweb?data=4
ˉˉˉˉˉ   ˉˉˉˉˉˉˉˉˉ  ˉˉˉˉˉˉˉ ˉˉˉˉˉ
scheme    host      path   query</code></pre>
<p>html代码</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;myapp://abcdefg.me/fromweb?data=4&quot;</span><span class="dt">&gt;</span>启动应用程序<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span></code></pre></div>
<p>AndroidManifest.xml配置，通过data的scheme和host匹配（必须有这两个属性），如果设置了pathPrefix，再根据pathPrefix匹配（可选）</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.action.VIEW&quot;</span> /&gt;</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">category</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">category</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.category.BROWSABLE&quot;</span> /&gt;</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">data</span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:host=</span><span class="st">&quot;abcdefg.me&quot;</span></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:scheme=</span><span class="st">&quot;myapp&quot;</span></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:pathPrefix=</span><span class="st">&quot;/fromweb&quot;</span></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>        /&gt;</span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">intent-filter</span>&gt;</span></code></pre></div>
<p>JAVA通过<code>getIntent().getData</code>得到URI</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="fu">getIntent</span><span class="op">();</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> action <span class="op">=</span> intent<span class="op">.</span><span class="fu">getAction</span><span class="op">();</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">ACTION_VIEW</span><span class="op">.</span><span class="fu">equals</span><span class="op">(</span>action<span class="op">)){</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>    Uri uri <span class="op">=</span> intent<span class="op">.</span><span class="fu">getData</span><span class="op">();</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>uri <span class="op">!=</span> <span class="kw">null</span><span class="op">){</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> data <span class="op">=</span> uri<span class="op">.</span><span class="fu">getQueryParameter</span><span class="op">(</span><span class="st">&quot;data&quot;</span><span class="op">);</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="夜间模式">夜间模式</h3>
<p>官方的夜间模式支持只能在Android 6.0以上使用</p>
<ol type="1">
<li>添加依赖</li>
</ol>
<pre><code>dependencies {
    compile &#39;com.android.support:appcompat-v7:23.4.0&#39;
}</code></pre>
<ol start="2" type="1">
<li>让应用的主题继承自<code>DayNight</code></li>
</ol>
<div class="sourceCode" id="cb206"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">style</span><span class="ot"> name=</span><span class="st">&quot;AppTheme&quot;</span><span class="ot"> parent=</span><span class="st">&quot;Theme.AppCompat.DayNight&quot;</span>&gt;</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;colorPrimary&quot;</span>&gt;@color/colorPrimary&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;colorPrimaryDark&quot;</span>&gt;@color/colorPrimaryDark&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">&quot;colorAccent&quot;</span>&gt;@color/colorAccent&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">style</span>&gt;</span></code></pre></div>
<ol start="3" type="1">
<li>为不同的模式设置不同的<code>colors</code>和<code>style</code></li>
</ol>
<p>在<code>res</code>下新建<code>values-night</code>文件夹，当切换夜间主题时，会读取<code>values-night</code>中的<code>style.xml</code>或<code>colors.xml</code></p>
<ol start="4" type="1">
<li>指定主题</li>
</ol>
<p>在app初始化或者Application中用设置</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>AppCompatDelegate<span class="op">.</span><span class="fu">setDefaultNightMode</span><span class="op">(</span>AppCompatDelegate<span class="op">.</span><span class="fu">MODE_NIGHT_AUTO</span><span class="op">);</span></span></code></pre></div>
<p>在应用中设置，Activity必须是继承自<code>AppCompatActivity</code>的，设置完需重启Activity</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co">//获取当前模式</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> currentNightMode <span class="op">=</span> <span class="fu">getResources</span><span class="op">().</span><span class="fu">getConfiguration</span><span class="op">().</span><span class="fu">uiMode</span> <span class="op">&amp;</span> <span class="bu">Configuration</span><span class="op">.</span><span class="fu">UI_MODE_NIGHT_MASK</span><span class="op">;</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="co">//切换模式</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">getDelegate</span><span class="op">().</span><span class="fu">setLocalNightMode</span><span class="op">(</span>AppCompatDelegate<span class="op">.</span><span class="fu">MODE_NIGHT_YES</span><span class="op">);</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="co">//重启Activity，也可以用startActivity的方式重启</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="fu">recreate</span><span class="op">();</span></span></code></pre></div>
<p>有四个可选的模式</p>
<ul>
<li>MODE_NIGHT_YES: 暗色(dark)主题，使用夜间模式</li>
<li>MODE_NIGHT_NO: 亮色(light)主题，不使用夜间模式</li>
<li>MODE_NIGHT_AUTO: 根据当前时间自动切换(22：00-07：00为夜间模式)</li>
<li>MODE_NIGHT_FOLLOW_SYSTEM: 设置为跟随系统</li>
</ul>
<p>调整完日间/夜间模式后，必须重启Activity，这时可以使用动画来解决闪屏的问题</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">//这里不使用recreate的方式重启</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">finish</span><span class="op">();</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="fu">overridePendingTransition</span><span class="op">(</span>android<span class="op">.</span><span class="fu">R</span><span class="op">.</span><span class="fu">anim</span><span class="op">.</span><span class="fu">fade_in</span><span class="op">,</span>android<span class="op">.</span><span class="fu">R</span><span class="op">.</span><span class="fu">anim</span><span class="op">.</span><span class="fu">fade_out</span><span class="op">);</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getIntent</span><span class="op">());</span></span></code></pre></div>
<h3 id="intent">Intent</h3>
<h4 id="action">Action</h4>
<p>要执行的动作，系统提供的有： - Activity - ACTION_MAIN - ACTION_VIEW -
ACTION_ATTACH_DATA - ACTION_EDIT - ACTION_PICK - ACTION_CHOOSER -
ACTION_GET_CONTENT - ACTION_DIAL - ACTION_CALL - ACTION_SEND -
ACTION_SENDTO - ACTION_ANSWER - ACTION_INSERT - ACTION_DELETE -
ACTION_RUN - ACTION_SYNC - ACTION_PICK_ACTIVITY - ACTION_SEARCH -
ACTION_WEB_SEARCH - ACTION_FACTORY_TEST - Broadcast - ACTION_TIME_TICK -
ACTION_TIME_CHANGED - ACTION_TIMEZONE_CHANGED - ACTION_BOOT_COMPLETED -
ACTION_PACKAGE_ADDED - ACTION_PACKAGE_CHANGED - ACTION_PACKAGE_REMOVED -
ACTION_PACKAGE_RESTARTED - ACTION_PACKAGE_DATA_CLEARED -
ACTION_PACKAGES_SUSPENDED - ACTION_PACKAGES_UNSUSPENDED -
ACTION_UID_REMOVED - ACTION_BATTERY_CHANGED - ACTION_POWER_CONNECTED -
ACTION_POWER_DISCONNECTED - ACTION_SHUTDOWN</p>
<p>也可以自定义动作</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Intent intent = new Intent(&quot;com.myapp.intent.MY_ACTION&quot;);</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="co">//也可以写成</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span><span class="st">&quot;com.myapp.intent.MY_ACTION&quot;</span><span class="op">);</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span></span></code></pre></div>
<p>这时就会寻找<code>intent-filter</code>中带有此action的activity：</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">activity</span><span class="ot"> android:name=</span><span class="st">&quot;.MyActivity&quot;</span>&gt;</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;com.myapp.intent.MY_ACTION&quot;</span>/&gt;</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">category</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">activity</span>&gt;</span></code></pre></div>
<h4 id="category">Category</h4>
<p>系统提供的有： - CATEGORY_DEFAULT - CATEGORY_BROWSABLE - CATEGORY_TAB
- CATEGORY_ALTERNATIVE - CATEGORY_SELECTED_ALTERNATIVE -
CATEGORY_LAUNCHER - CATEGORY_INFO - CATEGORY_HOME - CATEGORY_PREFERENCE
- CATEGORY_TEST - CATEGORY_CAR_DOCK - CATEGORY_DESK_DOCK -
CATEGORY_LE_DESK_DOCK - CATEGORY_HE_DESK_DOCK - CATEGORY_CAR_MODE -
CATEGORY_APP_MARKET - CATEGORY_VR_HOME</p>
<p>在intent中指定category：</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span> intent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">ACTION_MAIN</span><span class="op">);</span><span class="co">// 添加Action属性 intent.addCategory(Intent.CATEGORY_HOME);// 添加Category属性</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span><span class="co">// 启动Activity</span></span></code></pre></div>
<p>在<code>intent-filter</code>中配置category：</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">activity</span><span class="ot"> android:name=</span><span class="st">&quot;.MyActivity&quot;</span>&gt;</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.action.ACTION_MAIN&quot;</span>/&gt;</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">category</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.category.CATEGORY_HOME&quot;</span>/&gt;</span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">activity</span>&gt;</span></code></pre></div>
<h4 id="data">Data</h4>
<p>执行动作所需的数据</p>
<p>用浏览器打开指定网页：</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">ACTION_VIEW</span><span class="op">);</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setData</span><span class="op">(</span>Uri<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">&quot;http://www.baidu.com&quot;</span><span class="op">));</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span></span></code></pre></div>
<p>打开系统拨号界面并指定电话号码：</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">ACTION_CALL</span><span class="op">);</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setData</span><span class="op">(</span>Uri<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">&quot;tel:12345678&quot;</span><span class="op">));</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span></span></code></pre></div>
<p>支持浏览器打开本应用时，也要指定data：</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.action.VIEW&quot;</span> /&gt;</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">category</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">category</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.category.BROWSABLE&quot;</span> /&gt;</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">data</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:scheme=</span><span class="st">&quot;myapp&quot;</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:host=</span><span class="st">&quot;abcdefg.me&quot;</span></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:port=</span><span class="st">&quot;8080&quot;</span></span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a><span class="ot">        android:pathPrefix=</span><span class="st">&quot;/fromweb&quot;</span></span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>        /&gt;</span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">intent-filter</span>&gt;</span></code></pre></div>
<p>模仿浏览器打开应用</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">ACTION_VIEW</span><span class="op">);</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setData</span><span class="op">(</span>Uri<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">&quot;myapp://abcdefg.me:8080/fromweb/path1?data=213&quot;</span><span class="op">));</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span></span></code></pre></div>
<h4 id="extras">Extras</h4>
<p>执行动作所需的附加信息</p>
<p>用浏览器搜索指定内容：</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">ACTION_WEB_SEARCH</span><span class="op">);</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">putExtra</span><span class="op">(</span>SearchManager<span class="op">.</span><span class="fu">QUERY</span><span class="op">,</span> <span class="st">&quot;android&quot;</span><span class="op">);</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span></span></code></pre></div>
<h4 id="type">Type</h4>
<p>通过MIME调用其他应用打开对应格式的文件</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">ACTION_VIEW</span><span class="op">);</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setDataAndType</span><span class="op">(</span>Uri<span class="op">.</span><span class="fu">fromFile</span><span class="op">(</span>file<span class="op">),</span> <span class="st">&quot;video/x-msvideo&quot;</span><span class="op">);</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span></span></code></pre></div>
<p>应用指定支持的type：</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">action</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.action.VIEW&quot;</span> /&gt;</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">category</span><span class="ot"> android:name=</span><span class="st">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">data</span><span class="ot"> android:mimeType=</span><span class="st">&quot;image/*&quot;</span> /&gt;</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">intent-filter</span>&gt;</span></code></pre></div>
<p>MIME大全</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="dt">static</span> <span class="bu">String</span><span class="op">[][]</span> MIME_MapTable <span class="op">=</span> <span class="op">{</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.323&quot;</span><span class="op">,</span> <span class="st">&quot;text/h323&quot;</span> <span class="op">},</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.3gp&quot;</span><span class="op">,</span> <span class="st">&quot;video/3gpp&quot;</span> <span class="op">},</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.aab&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-authoware-bin&quot;</span> <span class="op">},</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.aam&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-authoware-map&quot;</span> <span class="op">},</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.aas&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-authoware-seg&quot;</span> <span class="op">},</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.acx&quot;</span><span class="op">,</span> <span class="st">&quot;application/internet-property-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ai&quot;</span><span class="op">,</span> <span class="st">&quot;application/postscript&quot;</span> <span class="op">},</span></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.aif&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-aiff&quot;</span> <span class="op">},</span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.aifc&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-aiff&quot;</span> <span class="op">},</span></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.aiff&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-aiff&quot;</span> <span class="op">},</span></span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.als&quot;</span><span class="op">,</span> <span class="st">&quot;audio/X-Alpha5&quot;</span> <span class="op">},</span></span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.amc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ani&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.apk&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.android.package-archive&quot;</span> <span class="op">},</span></span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.asc&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.asd&quot;</span><span class="op">,</span> <span class="st">&quot;application/astound&quot;</span> <span class="op">},</span></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.asf&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-ms-asf&quot;</span> <span class="op">},</span></span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.asn&quot;</span><span class="op">,</span> <span class="st">&quot;application/astound&quot;</span> <span class="op">},</span></span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.asp&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-asap&quot;</span> <span class="op">},</span></span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.asr&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-ms-asf&quot;</span> <span class="op">},</span></span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.asx&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-ms-asf&quot;</span> <span class="op">},</span></span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.au&quot;</span><span class="op">,</span> <span class="st">&quot;audio/basic&quot;</span> <span class="op">},</span></span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.avb&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.avi&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-msvideo&quot;</span> <span class="op">},</span></span>
<span id="cb221-26"><a href="#cb221-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.awb&quot;</span><span class="op">,</span> <span class="st">&quot;audio/amr-wb&quot;</span> <span class="op">},</span></span>
<span id="cb221-27"><a href="#cb221-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.axs&quot;</span><span class="op">,</span> <span class="st">&quot;application/olescript&quot;</span> <span class="op">},</span></span>
<span id="cb221-28"><a href="#cb221-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.bas&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-29"><a href="#cb221-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.bcpio&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-bcpio&quot;</span> <span class="op">},</span></span>
<span id="cb221-30"><a href="#cb221-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.bin &quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-31"><a href="#cb221-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.bld&quot;</span><span class="op">,</span> <span class="st">&quot;application/bld&quot;</span> <span class="op">},</span></span>
<span id="cb221-32"><a href="#cb221-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.bld2&quot;</span><span class="op">,</span> <span class="st">&quot;application/bld2&quot;</span> <span class="op">},</span></span>
<span id="cb221-33"><a href="#cb221-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.bmp&quot;</span><span class="op">,</span> <span class="st">&quot;image/bmp&quot;</span> <span class="op">},</span></span>
<span id="cb221-34"><a href="#cb221-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.bpk&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-35"><a href="#cb221-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.bz2&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-bzip2&quot;</span> <span class="op">},</span></span>
<span id="cb221-36"><a href="#cb221-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.c&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-37"><a href="#cb221-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cal&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-cals&quot;</span> <span class="op">},</span></span>
<span id="cb221-38"><a href="#cb221-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cat&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-pkiseccat&quot;</span> <span class="op">},</span></span>
<span id="cb221-39"><a href="#cb221-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ccn&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-cnc&quot;</span> <span class="op">},</span></span>
<span id="cb221-40"><a href="#cb221-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cco&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-cocoa&quot;</span> <span class="op">},</span></span>
<span id="cb221-41"><a href="#cb221-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cdf&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-cdf&quot;</span> <span class="op">},</span></span>
<span id="cb221-42"><a href="#cb221-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cer&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-x509-ca-cert&quot;</span> <span class="op">},</span></span>
<span id="cb221-43"><a href="#cb221-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cgi&quot;</span><span class="op">,</span> <span class="st">&quot;magnus-internal/cgi&quot;</span> <span class="op">},</span></span>
<span id="cb221-44"><a href="#cb221-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.chat&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-chat&quot;</span> <span class="op">},</span></span>
<span id="cb221-45"><a href="#cb221-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.class&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-46"><a href="#cb221-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.clp&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msclip&quot;</span> <span class="op">},</span></span>
<span id="cb221-47"><a href="#cb221-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cmx&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-cmx&quot;</span> <span class="op">},</span></span>
<span id="cb221-48"><a href="#cb221-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.co&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-cult3d-object&quot;</span> <span class="op">},</span></span>
<span id="cb221-49"><a href="#cb221-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cod&quot;</span><span class="op">,</span> <span class="st">&quot;image/cis-cod&quot;</span> <span class="op">},</span></span>
<span id="cb221-50"><a href="#cb221-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.conf&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-51"><a href="#cb221-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cpio&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-cpio&quot;</span> <span class="op">},</span></span>
<span id="cb221-52"><a href="#cb221-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cpp&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-53"><a href="#cb221-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cpt&quot;</span><span class="op">,</span> <span class="st">&quot;application/mac-compactpro&quot;</span> <span class="op">},</span></span>
<span id="cb221-54"><a href="#cb221-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.crd&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mscardfile&quot;</span> <span class="op">},</span></span>
<span id="cb221-55"><a href="#cb221-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.crl&quot;</span><span class="op">,</span> <span class="st">&quot;application/pkix-crl&quot;</span> <span class="op">},</span></span>
<span id="cb221-56"><a href="#cb221-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.crt&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-x509-ca-cert&quot;</span> <span class="op">},</span></span>
<span id="cb221-57"><a href="#cb221-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.csh&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-csh&quot;</span> <span class="op">},</span></span>
<span id="cb221-58"><a href="#cb221-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.csm&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-csml&quot;</span> <span class="op">},</span></span>
<span id="cb221-59"><a href="#cb221-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.csml&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-csml&quot;</span> <span class="op">},</span></span>
<span id="cb221-60"><a href="#cb221-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.css&quot;</span><span class="op">,</span> <span class="st">&quot;text/css&quot;</span> <span class="op">},</span></span>
<span id="cb221-61"><a href="#cb221-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.cur&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-62"><a href="#cb221-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dcm&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-evm&quot;</span> <span class="op">},</span></span>
<span id="cb221-63"><a href="#cb221-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dcr&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-director&quot;</span> <span class="op">},</span></span>
<span id="cb221-64"><a href="#cb221-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dcx&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-dcx&quot;</span> <span class="op">},</span></span>
<span id="cb221-65"><a href="#cb221-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.der&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-x509-ca-cert&quot;</span> <span class="op">},</span></span>
<span id="cb221-66"><a href="#cb221-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dhtml&quot;</span><span class="op">,</span> <span class="st">&quot;text/html&quot;</span> <span class="op">},</span></span>
<span id="cb221-67"><a href="#cb221-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dir&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-director&quot;</span> <span class="op">},</span></span>
<span id="cb221-68"><a href="#cb221-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dll&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msdownload&quot;</span> <span class="op">},</span></span>
<span id="cb221-69"><a href="#cb221-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dmg&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-70"><a href="#cb221-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dms&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-71"><a href="#cb221-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.doc&quot;</span><span class="op">,</span> <span class="st">&quot;application/msword&quot;</span> <span class="op">},</span></span>
<span id="cb221-72"><a href="#cb221-72" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.docx&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span> <span class="op">},</span></span>
<span id="cb221-73"><a href="#cb221-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dot&quot;</span><span class="op">,</span> <span class="st">&quot;application/msword&quot;</span> <span class="op">},</span></span>
<span id="cb221-74"><a href="#cb221-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dvi&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-dvi&quot;</span> <span class="op">},</span></span>
<span id="cb221-75"><a href="#cb221-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dwf&quot;</span><span class="op">,</span> <span class="st">&quot;drawing/x-dwf&quot;</span> <span class="op">},</span></span>
<span id="cb221-76"><a href="#cb221-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dwg&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-autocad&quot;</span> <span class="op">},</span></span>
<span id="cb221-77"><a href="#cb221-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dxf&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-autocad&quot;</span> <span class="op">},</span></span>
<span id="cb221-78"><a href="#cb221-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.dxr&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-director&quot;</span> <span class="op">},</span></span>
<span id="cb221-79"><a href="#cb221-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ebk&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-expandedbook&quot;</span> <span class="op">},</span></span>
<span id="cb221-80"><a href="#cb221-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.emb&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-embl-dl-nucleotide&quot;</span> <span class="op">},</span></span>
<span id="cb221-81"><a href="#cb221-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.embl&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-embl-dl-nucleotide&quot;</span> <span class="op">},</span></span>
<span id="cb221-82"><a href="#cb221-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.eps&quot;</span><span class="op">,</span> <span class="st">&quot;application/postscript&quot;</span> <span class="op">},</span></span>
<span id="cb221-83"><a href="#cb221-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.epub&quot;</span><span class="op">,</span> <span class="st">&quot;application/epub+zip&quot;</span> <span class="op">},</span></span>
<span id="cb221-84"><a href="#cb221-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.eri&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-eri&quot;</span> <span class="op">},</span></span>
<span id="cb221-85"><a href="#cb221-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.es&quot;</span><span class="op">,</span> <span class="st">&quot;audio/echospeech&quot;</span> <span class="op">},</span></span>
<span id="cb221-86"><a href="#cb221-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.esl&quot;</span><span class="op">,</span> <span class="st">&quot;audio/echospeech&quot;</span> <span class="op">},</span></span>
<span id="cb221-87"><a href="#cb221-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.etc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-earthtime&quot;</span> <span class="op">},</span></span>
<span id="cb221-88"><a href="#cb221-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.etx&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-setext&quot;</span> <span class="op">},</span></span>
<span id="cb221-89"><a href="#cb221-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.evm&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-evm&quot;</span> <span class="op">},</span></span>
<span id="cb221-90"><a href="#cb221-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.evy&quot;</span><span class="op">,</span> <span class="st">&quot;application/envoy&quot;</span> <span class="op">},</span></span>
<span id="cb221-91"><a href="#cb221-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.exe&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-92"><a href="#cb221-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.fh4&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-freehand&quot;</span> <span class="op">},</span></span>
<span id="cb221-93"><a href="#cb221-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.fh5&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-freehand&quot;</span> <span class="op">},</span></span>
<span id="cb221-94"><a href="#cb221-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.fhc&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-freehand&quot;</span> <span class="op">},</span></span>
<span id="cb221-95"><a href="#cb221-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.fif&quot;</span><span class="op">,</span> <span class="st">&quot;application/fractals&quot;</span> <span class="op">},</span></span>
<span id="cb221-96"><a href="#cb221-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.flr&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vrml&quot;</span> <span class="op">},</span></span>
<span id="cb221-97"><a href="#cb221-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.flv&quot;</span><span class="op">,</span> <span class="st">&quot;flv-application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-98"><a href="#cb221-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.fm&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-maker&quot;</span> <span class="op">},</span></span>
<span id="cb221-99"><a href="#cb221-99" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.fpx&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-fpx&quot;</span> <span class="op">},</span></span>
<span id="cb221-100"><a href="#cb221-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.fvi&quot;</span><span class="op">,</span> <span class="st">&quot;video/isivideo&quot;</span> <span class="op">},</span></span>
<span id="cb221-101"><a href="#cb221-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.gau&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-gaussian-input&quot;</span> <span class="op">},</span></span>
<span id="cb221-102"><a href="#cb221-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.gca&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-gca-compressed&quot;</span> <span class="op">},</span></span>
<span id="cb221-103"><a href="#cb221-103" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.gdb&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-gdb&quot;</span> <span class="op">},</span></span>
<span id="cb221-104"><a href="#cb221-104" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.gif&quot;</span><span class="op">,</span> <span class="st">&quot;image/gif&quot;</span> <span class="op">},</span></span>
<span id="cb221-105"><a href="#cb221-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.gps&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-gps&quot;</span> <span class="op">},</span></span>
<span id="cb221-106"><a href="#cb221-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.gtar&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-gtar&quot;</span> <span class="op">},</span></span>
<span id="cb221-107"><a href="#cb221-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.gz&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-gzip&quot;</span> <span class="op">},</span></span>
<span id="cb221-108"><a href="#cb221-108" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.h&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-109"><a href="#cb221-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.hdf&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-hdf&quot;</span> <span class="op">},</span></span>
<span id="cb221-110"><a href="#cb221-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.hdm&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-hdml&quot;</span> <span class="op">},</span></span>
<span id="cb221-111"><a href="#cb221-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.hdml&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-hdml&quot;</span> <span class="op">},</span></span>
<span id="cb221-112"><a href="#cb221-112" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.hlp&quot;</span><span class="op">,</span> <span class="st">&quot;application/winhlp&quot;</span> <span class="op">},</span></span>
<span id="cb221-113"><a href="#cb221-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.hqx&quot;</span><span class="op">,</span> <span class="st">&quot;application/mac-binhex40&quot;</span> <span class="op">},</span></span>
<span id="cb221-114"><a href="#cb221-114" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.hta&quot;</span><span class="op">,</span> <span class="st">&quot;application/hta&quot;</span> <span class="op">},</span></span>
<span id="cb221-115"><a href="#cb221-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.htc&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-component&quot;</span> <span class="op">},</span></span>
<span id="cb221-116"><a href="#cb221-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.htm&quot;</span><span class="op">,</span> <span class="st">&quot;text/html&quot;</span> <span class="op">},</span></span>
<span id="cb221-117"><a href="#cb221-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.html&quot;</span><span class="op">,</span> <span class="st">&quot;text/html&quot;</span> <span class="op">},</span></span>
<span id="cb221-118"><a href="#cb221-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.hts&quot;</span><span class="op">,</span> <span class="st">&quot;text/html&quot;</span> <span class="op">},</span></span>
<span id="cb221-119"><a href="#cb221-119" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.htt&quot;</span><span class="op">,</span> <span class="st">&quot;text/webviewhtml&quot;</span> <span class="op">},</span></span>
<span id="cb221-120"><a href="#cb221-120" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ice&quot;</span><span class="op">,</span> <span class="st">&quot;x-conference/x-cooltalk&quot;</span> <span class="op">},</span></span>
<span id="cb221-121"><a href="#cb221-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ico&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-icon&quot;</span> <span class="op">},</span></span>
<span id="cb221-122"><a href="#cb221-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ief&quot;</span><span class="op">,</span> <span class="st">&quot;image/ief&quot;</span> <span class="op">},</span></span>
<span id="cb221-123"><a href="#cb221-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ifm&quot;</span><span class="op">,</span> <span class="st">&quot;image/gif&quot;</span> <span class="op">},</span></span>
<span id="cb221-124"><a href="#cb221-124" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ifs&quot;</span><span class="op">,</span> <span class="st">&quot;image/ifs&quot;</span> <span class="op">},</span></span>
<span id="cb221-125"><a href="#cb221-125" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.iii&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-iphone&quot;</span> <span class="op">},</span></span>
<span id="cb221-126"><a href="#cb221-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.imy&quot;</span><span class="op">,</span> <span class="st">&quot;audio/melody&quot;</span> <span class="op">},</span></span>
<span id="cb221-127"><a href="#cb221-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ins&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-internet-signup&quot;</span> <span class="op">},</span></span>
<span id="cb221-128"><a href="#cb221-128" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ips&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-ipscript&quot;</span> <span class="op">},</span></span>
<span id="cb221-129"><a href="#cb221-129" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ipx&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-ipix&quot;</span> <span class="op">},</span></span>
<span id="cb221-130"><a href="#cb221-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.isp&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-internet-signup&quot;</span> <span class="op">},</span></span>
<span id="cb221-131"><a href="#cb221-131" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.it&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-132"><a href="#cb221-132" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.itz&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-133"><a href="#cb221-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ivr&quot;</span><span class="op">,</span> <span class="st">&quot;i-world/i-vrml&quot;</span> <span class="op">},</span></span>
<span id="cb221-134"><a href="#cb221-134" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.j2k&quot;</span><span class="op">,</span> <span class="st">&quot;image/j2k&quot;</span> <span class="op">},</span></span>
<span id="cb221-135"><a href="#cb221-135" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jad&quot;</span><span class="op">,</span> <span class="st">&quot;text/vnd.sun.j2me.app-descriptor&quot;</span> <span class="op">},</span></span>
<span id="cb221-136"><a href="#cb221-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jam&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-jam&quot;</span> <span class="op">},</span></span>
<span id="cb221-137"><a href="#cb221-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jar&quot;</span><span class="op">,</span> <span class="st">&quot;application/java-archive&quot;</span> <span class="op">},</span></span>
<span id="cb221-138"><a href="#cb221-138" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.java&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-139"><a href="#cb221-139" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jfif&quot;</span><span class="op">,</span> <span class="st">&quot;image/pipeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-140"><a href="#cb221-140" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jnlp&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-java-jnlp-file&quot;</span> <span class="op">},</span></span>
<span id="cb221-141"><a href="#cb221-141" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jpe&quot;</span><span class="op">,</span> <span class="st">&quot;image/jpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-142"><a href="#cb221-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jpeg&quot;</span><span class="op">,</span> <span class="st">&quot;image/jpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-143"><a href="#cb221-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jpg&quot;</span><span class="op">,</span> <span class="st">&quot;image/jpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-144"><a href="#cb221-144" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jpz&quot;</span><span class="op">,</span> <span class="st">&quot;image/jpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-145"><a href="#cb221-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.js&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-javascript&quot;</span> <span class="op">},</span></span>
<span id="cb221-146"><a href="#cb221-146" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.jwc&quot;</span><span class="op">,</span> <span class="st">&quot;application/jwc&quot;</span> <span class="op">},</span></span>
<span id="cb221-147"><a href="#cb221-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.kjx&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-kjx&quot;</span> <span class="op">},</span></span>
<span id="cb221-148"><a href="#cb221-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lak&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-lak&quot;</span> <span class="op">},</span></span>
<span id="cb221-149"><a href="#cb221-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.latex&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-latex&quot;</span> <span class="op">},</span></span>
<span id="cb221-150"><a href="#cb221-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lcc&quot;</span><span class="op">,</span> <span class="st">&quot;application/fastman&quot;</span> <span class="op">},</span></span>
<span id="cb221-151"><a href="#cb221-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lcl&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-digitalloca&quot;</span> <span class="op">},</span></span>
<span id="cb221-152"><a href="#cb221-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lcr&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-digitalloca&quot;</span> <span class="op">},</span></span>
<span id="cb221-153"><a href="#cb221-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lgh&quot;</span><span class="op">,</span> <span class="st">&quot;application/lgh&quot;</span> <span class="op">},</span></span>
<span id="cb221-154"><a href="#cb221-154" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lha&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-155"><a href="#cb221-155" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lml&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-lml&quot;</span> <span class="op">},</span></span>
<span id="cb221-156"><a href="#cb221-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lmlpack&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-lmlpack&quot;</span> <span class="op">},</span></span>
<span id="cb221-157"><a href="#cb221-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.log&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-158"><a href="#cb221-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lsf&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-la-asf&quot;</span> <span class="op">},</span></span>
<span id="cb221-159"><a href="#cb221-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lsx&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-la-asf&quot;</span> <span class="op">},</span></span>
<span id="cb221-160"><a href="#cb221-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.lzh&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-161"><a href="#cb221-161" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m13&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msmediaview&quot;</span> <span class="op">},</span></span>
<span id="cb221-162"><a href="#cb221-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m14&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msmediaview&quot;</span> <span class="op">},</span></span>
<span id="cb221-163"><a href="#cb221-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m15&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-164"><a href="#cb221-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m3u&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mpegurl&quot;</span> <span class="op">},</span></span>
<span id="cb221-165"><a href="#cb221-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m3url&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mpegurl&quot;</span> <span class="op">},</span></span>
<span id="cb221-166"><a href="#cb221-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m4a&quot;</span><span class="op">,</span> <span class="st">&quot;audio/mp4a-latm&quot;</span> <span class="op">},</span></span>
<span id="cb221-167"><a href="#cb221-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m4b&quot;</span><span class="op">,</span> <span class="st">&quot;audio/mp4a-latm&quot;</span> <span class="op">},</span></span>
<span id="cb221-168"><a href="#cb221-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m4p&quot;</span><span class="op">,</span> <span class="st">&quot;audio/mp4a-latm&quot;</span> <span class="op">},</span></span>
<span id="cb221-169"><a href="#cb221-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m4u&quot;</span><span class="op">,</span> <span class="st">&quot;video/vnd.mpegurl&quot;</span> <span class="op">},</span></span>
<span id="cb221-170"><a href="#cb221-170" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.m4v&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-m4v&quot;</span> <span class="op">},</span></span>
<span id="cb221-171"><a href="#cb221-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ma1&quot;</span><span class="op">,</span> <span class="st">&quot;audio/ma1&quot;</span> <span class="op">},</span></span>
<span id="cb221-172"><a href="#cb221-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ma2&quot;</span><span class="op">,</span> <span class="st">&quot;audio/ma2&quot;</span> <span class="op">},</span></span>
<span id="cb221-173"><a href="#cb221-173" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ma3&quot;</span><span class="op">,</span> <span class="st">&quot;audio/ma3&quot;</span> <span class="op">},</span></span>
<span id="cb221-174"><a href="#cb221-174" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ma5&quot;</span><span class="op">,</span> <span class="st">&quot;audio/ma5&quot;</span> <span class="op">},</span></span>
<span id="cb221-175"><a href="#cb221-175" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.man&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-troff-man&quot;</span> <span class="op">},</span></span>
<span id="cb221-176"><a href="#cb221-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.map&quot;</span><span class="op">,</span> <span class="st">&quot;magnus-internal/imagemap&quot;</span> <span class="op">},</span></span>
<span id="cb221-177"><a href="#cb221-177" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mbd&quot;</span><span class="op">,</span> <span class="st">&quot;application/mbedlet&quot;</span> <span class="op">},</span></span>
<span id="cb221-178"><a href="#cb221-178" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mct&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mascot&quot;</span> <span class="op">},</span></span>
<span id="cb221-179"><a href="#cb221-179" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mdb&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msaccess&quot;</span> <span class="op">},</span></span>
<span id="cb221-180"><a href="#cb221-180" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mdz&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-181"><a href="#cb221-181" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.me&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-troff-me&quot;</span> <span class="op">},</span></span>
<span id="cb221-182"><a href="#cb221-182" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mel&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-vmel&quot;</span> <span class="op">},</span></span>
<span id="cb221-183"><a href="#cb221-183" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mht&quot;</span><span class="op">,</span> <span class="st">&quot;message/rfc822&quot;</span> <span class="op">},</span></span>
<span id="cb221-184"><a href="#cb221-184" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mhtml&quot;</span><span class="op">,</span> <span class="st">&quot;message/rfc822&quot;</span> <span class="op">},</span></span>
<span id="cb221-185"><a href="#cb221-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mi&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mif&quot;</span> <span class="op">},</span></span>
<span id="cb221-186"><a href="#cb221-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mid&quot;</span><span class="op">,</span> <span class="st">&quot;audio/mid&quot;</span> <span class="op">},</span></span>
<span id="cb221-187"><a href="#cb221-187" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.midi&quot;</span><span class="op">,</span> <span class="st">&quot;audio/midi&quot;</span> <span class="op">},</span></span>
<span id="cb221-188"><a href="#cb221-188" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mif&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mif&quot;</span> <span class="op">},</span></span>
<span id="cb221-189"><a href="#cb221-189" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mil&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-cals&quot;</span> <span class="op">},</span></span>
<span id="cb221-190"><a href="#cb221-190" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mio&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mio&quot;</span> <span class="op">},</span></span>
<span id="cb221-191"><a href="#cb221-191" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mmf&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-skt-lbs&quot;</span> <span class="op">},</span></span>
<span id="cb221-192"><a href="#cb221-192" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mng&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-mng&quot;</span> <span class="op">},</span></span>
<span id="cb221-193"><a href="#cb221-193" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mny&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msmoney&quot;</span> <span class="op">},</span></span>
<span id="cb221-194"><a href="#cb221-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.moc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mocha&quot;</span> <span class="op">},</span></span>
<span id="cb221-195"><a href="#cb221-195" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mocha&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mocha&quot;</span> <span class="op">},</span></span>
<span id="cb221-196"><a href="#cb221-196" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mod&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-197"><a href="#cb221-197" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mof&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-yumekara&quot;</span> <span class="op">},</span></span>
<span id="cb221-198"><a href="#cb221-198" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mol&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-mdl-molfile&quot;</span> <span class="op">},</span></span>
<span id="cb221-199"><a href="#cb221-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mop&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-mopac-input&quot;</span> <span class="op">},</span></span>
<span id="cb221-200"><a href="#cb221-200" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mov&quot;</span><span class="op">,</span> <span class="st">&quot;video/quicktime&quot;</span> <span class="op">},</span></span>
<span id="cb221-201"><a href="#cb221-201" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.movie&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-sgi-movie&quot;</span> <span class="op">},</span></span>
<span id="cb221-202"><a href="#cb221-202" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mp2&quot;</span><span class="op">,</span> <span class="st">&quot;video/mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-203"><a href="#cb221-203" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mp3&quot;</span><span class="op">,</span> <span class="st">&quot;audio/mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-204"><a href="#cb221-204" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mp4&quot;</span><span class="op">,</span> <span class="st">&quot;video/mp4&quot;</span> <span class="op">},</span></span>
<span id="cb221-205"><a href="#cb221-205" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpa&quot;</span><span class="op">,</span> <span class="st">&quot;video/mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-206"><a href="#cb221-206" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpc&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.mpohun.certificate&quot;</span> <span class="op">},</span></span>
<span id="cb221-207"><a href="#cb221-207" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpe&quot;</span><span class="op">,</span> <span class="st">&quot;video/mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-208"><a href="#cb221-208" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpeg&quot;</span><span class="op">,</span> <span class="st">&quot;video/mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-209"><a href="#cb221-209" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpg&quot;</span><span class="op">,</span> <span class="st">&quot;video/mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-210"><a href="#cb221-210" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpg4&quot;</span><span class="op">,</span> <span class="st">&quot;video/mp4&quot;</span> <span class="op">},</span></span>
<span id="cb221-211"><a href="#cb221-211" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpga&quot;</span><span class="op">,</span> <span class="st">&quot;audio/mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-212"><a href="#cb221-212" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpn&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.mophun.application&quot;</span> <span class="op">},</span></span>
<span id="cb221-213"><a href="#cb221-213" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpp&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-project&quot;</span> <span class="op">},</span></span>
<span id="cb221-214"><a href="#cb221-214" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mps&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mapserver&quot;</span> <span class="op">},</span></span>
<span id="cb221-215"><a href="#cb221-215" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mpv2&quot;</span><span class="op">,</span> <span class="st">&quot;video/mpeg&quot;</span> <span class="op">},</span></span>
<span id="cb221-216"><a href="#cb221-216" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mrl&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-mrml&quot;</span> <span class="op">},</span></span>
<span id="cb221-217"><a href="#cb221-217" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mrm&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mrm&quot;</span> <span class="op">},</span></span>
<span id="cb221-218"><a href="#cb221-218" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ms&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-troff-ms&quot;</span> <span class="op">},</span></span>
<span id="cb221-219"><a href="#cb221-219" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.msg&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-outlook&quot;</span> <span class="op">},</span></span>
<span id="cb221-220"><a href="#cb221-220" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mts&quot;</span><span class="op">,</span> <span class="st">&quot;application/metastream&quot;</span> <span class="op">},</span></span>
<span id="cb221-221"><a href="#cb221-221" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mtx&quot;</span><span class="op">,</span> <span class="st">&quot;application/metastream&quot;</span> <span class="op">},</span></span>
<span id="cb221-222"><a href="#cb221-222" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mtz&quot;</span><span class="op">,</span> <span class="st">&quot;application/metastream&quot;</span> <span class="op">},</span></span>
<span id="cb221-223"><a href="#cb221-223" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mvb&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msmediaview&quot;</span> <span class="op">},</span></span>
<span id="cb221-224"><a href="#cb221-224" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.mzv&quot;</span><span class="op">,</span> <span class="st">&quot;application/metastream&quot;</span> <span class="op">},</span></span>
<span id="cb221-225"><a href="#cb221-225" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nar&quot;</span><span class="op">,</span> <span class="st">&quot;application/zip&quot;</span> <span class="op">},</span></span>
<span id="cb221-226"><a href="#cb221-226" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nbmp&quot;</span><span class="op">,</span> <span class="st">&quot;image/nbmp&quot;</span> <span class="op">},</span></span>
<span id="cb221-227"><a href="#cb221-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-netcdf&quot;</span> <span class="op">},</span></span>
<span id="cb221-228"><a href="#cb221-228" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ndb&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-ndb&quot;</span> <span class="op">},</span></span>
<span id="cb221-229"><a href="#cb221-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ndwn&quot;</span><span class="op">,</span> <span class="st">&quot;application/ndwn&quot;</span> <span class="op">},</span></span>
<span id="cb221-230"><a href="#cb221-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nif&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-nif&quot;</span> <span class="op">},</span></span>
<span id="cb221-231"><a href="#cb221-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nmz&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-scream&quot;</span> <span class="op">},</span></span>
<span id="cb221-232"><a href="#cb221-232" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nokia-op-logo&quot;</span><span class="op">,</span> <span class="st">&quot;image/vnd.nok-oplogo-color&quot;</span> <span class="op">},</span></span>
<span id="cb221-233"><a href="#cb221-233" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.npx&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-netfpx&quot;</span> <span class="op">},</span></span>
<span id="cb221-234"><a href="#cb221-234" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nsnd&quot;</span><span class="op">,</span> <span class="st">&quot;audio/nsnd&quot;</span> <span class="op">},</span></span>
<span id="cb221-235"><a href="#cb221-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nva&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-neva1&quot;</span> <span class="op">},</span></span>
<span id="cb221-236"><a href="#cb221-236" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.nws&quot;</span><span class="op">,</span> <span class="st">&quot;message/rfc822&quot;</span> <span class="op">},</span></span>
<span id="cb221-237"><a href="#cb221-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.oda&quot;</span><span class="op">,</span> <span class="st">&quot;application/oda&quot;</span> <span class="op">},</span></span>
<span id="cb221-238"><a href="#cb221-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ogg&quot;</span><span class="op">,</span> <span class="st">&quot;audio/ogg&quot;</span> <span class="op">},</span></span>
<span id="cb221-239"><a href="#cb221-239" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.oom&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-AtlasMate-Plugin&quot;</span> <span class="op">},</span></span>
<span id="cb221-240"><a href="#cb221-240" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.p10&quot;</span><span class="op">,</span> <span class="st">&quot;application/pkcs10&quot;</span> <span class="op">},</span></span>
<span id="cb221-241"><a href="#cb221-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.p12&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pkcs12&quot;</span> <span class="op">},</span></span>
<span id="cb221-242"><a href="#cb221-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.p7b&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pkcs7-certificates&quot;</span> <span class="op">},</span></span>
<span id="cb221-243"><a href="#cb221-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.p7c&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pkcs7-mime&quot;</span> <span class="op">},</span></span>
<span id="cb221-244"><a href="#cb221-244" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.p7m&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pkcs7-mime&quot;</span> <span class="op">},</span></span>
<span id="cb221-245"><a href="#cb221-245" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.p7r&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pkcs7-certreqresp&quot;</span> <span class="op">},</span></span>
<span id="cb221-246"><a href="#cb221-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.p7s&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pkcs7-signature&quot;</span> <span class="op">},</span></span>
<span id="cb221-247"><a href="#cb221-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pac&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-pac&quot;</span> <span class="op">},</span></span>
<span id="cb221-248"><a href="#cb221-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pae&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-epac&quot;</span> <span class="op">},</span></span>
<span id="cb221-249"><a href="#cb221-249" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pan&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pan&quot;</span> <span class="op">},</span></span>
<span id="cb221-250"><a href="#cb221-250" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pbm&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-portable-bitmap&quot;</span> <span class="op">},</span></span>
<span id="cb221-251"><a href="#cb221-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pcx&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-pcx&quot;</span> <span class="op">},</span></span>
<span id="cb221-252"><a href="#cb221-252" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pda&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-pda&quot;</span> <span class="op">},</span></span>
<span id="cb221-253"><a href="#cb221-253" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pdb&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-pdb&quot;</span> <span class="op">},</span></span>
<span id="cb221-254"><a href="#cb221-254" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pdf&quot;</span><span class="op">,</span> <span class="st">&quot;application/pdf&quot;</span> <span class="op">},</span></span>
<span id="cb221-255"><a href="#cb221-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pfr&quot;</span><span class="op">,</span> <span class="st">&quot;application/font-tdpfr&quot;</span> <span class="op">},</span></span>
<span id="cb221-256"><a href="#cb221-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pfx&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pkcs12&quot;</span> <span class="op">},</span></span>
<span id="cb221-257"><a href="#cb221-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pgm&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-portable-graymap&quot;</span> <span class="op">},</span></span>
<span id="cb221-258"><a href="#cb221-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pict&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-pict&quot;</span> <span class="op">},</span></span>
<span id="cb221-259"><a href="#cb221-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pko&quot;</span><span class="op">,</span> <span class="st">&quot;application/ynd.ms-pkipko&quot;</span> <span class="op">},</span></span>
<span id="cb221-260"><a href="#cb221-260" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pm&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-perl&quot;</span> <span class="op">},</span></span>
<span id="cb221-261"><a href="#cb221-261" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pma&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-perfmon&quot;</span> <span class="op">},</span></span>
<span id="cb221-262"><a href="#cb221-262" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pmc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-perfmon&quot;</span> <span class="op">},</span></span>
<span id="cb221-263"><a href="#cb221-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pmd&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pmd&quot;</span> <span class="op">},</span></span>
<span id="cb221-264"><a href="#cb221-264" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pml&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-perfmon&quot;</span> <span class="op">},</span></span>
<span id="cb221-265"><a href="#cb221-265" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pmr&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-perfmon&quot;</span> <span class="op">},</span></span>
<span id="cb221-266"><a href="#cb221-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pmw&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-perfmon&quot;</span> <span class="op">},</span></span>
<span id="cb221-267"><a href="#cb221-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.png&quot;</span><span class="op">,</span> <span class="st">&quot;image/png&quot;</span> <span class="op">},</span></span>
<span id="cb221-268"><a href="#cb221-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pnm&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-portable-anymap&quot;</span> <span class="op">},</span></span>
<span id="cb221-269"><a href="#cb221-269" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pnz&quot;</span><span class="op">,</span> <span class="st">&quot;image/png&quot;</span> <span class="op">},</span></span>
<span id="cb221-270"><a href="#cb221-270" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pot,&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-powerpoint&quot;</span> <span class="op">},</span></span>
<span id="cb221-271"><a href="#cb221-271" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ppm&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-portable-pixmap&quot;</span> <span class="op">},</span></span>
<span id="cb221-272"><a href="#cb221-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pps&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-powerpoint&quot;</span> <span class="op">},</span></span>
<span id="cb221-273"><a href="#cb221-273" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ppt&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-powerpoint&quot;</span> <span class="op">},</span></span>
<span id="cb221-274"><a href="#cb221-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pptx&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.openxmlformats-officedocument.presentationml.presentation&quot;</span> <span class="op">},</span></span>
<span id="cb221-275"><a href="#cb221-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pqf&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-cprplayer&quot;</span> <span class="op">},</span></span>
<span id="cb221-276"><a href="#cb221-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pqi&quot;</span><span class="op">,</span> <span class="st">&quot;application/cprplayer&quot;</span> <span class="op">},</span></span>
<span id="cb221-277"><a href="#cb221-277" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.prc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-prc&quot;</span> <span class="op">},</span></span>
<span id="cb221-278"><a href="#cb221-278" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.prf&quot;</span><span class="op">,</span> <span class="st">&quot;application/pics-rules&quot;</span> <span class="op">},</span></span>
<span id="cb221-279"><a href="#cb221-279" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.prop&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-280"><a href="#cb221-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.proxy&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-ns-proxy-autoconfig&quot;</span> <span class="op">},</span></span>
<span id="cb221-281"><a href="#cb221-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ps&quot;</span><span class="op">,</span> <span class="st">&quot;application/postscript&quot;</span> <span class="op">},</span></span>
<span id="cb221-282"><a href="#cb221-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ptlk&quot;</span><span class="op">,</span> <span class="st">&quot;application/listenup&quot;</span> <span class="op">},</span></span>
<span id="cb221-283"><a href="#cb221-283" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pub&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mspublisher&quot;</span> <span class="op">},</span></span>
<span id="cb221-284"><a href="#cb221-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.pvx&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-pv-pvx&quot;</span> <span class="op">},</span></span>
<span id="cb221-285"><a href="#cb221-285" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.qcp&quot;</span><span class="op">,</span> <span class="st">&quot;audio/vnd.qcelp&quot;</span> <span class="op">},</span></span>
<span id="cb221-286"><a href="#cb221-286" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.qt&quot;</span><span class="op">,</span> <span class="st">&quot;video/quicktime&quot;</span> <span class="op">},</span></span>
<span id="cb221-287"><a href="#cb221-287" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.qti&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-quicktime&quot;</span> <span class="op">},</span></span>
<span id="cb221-288"><a href="#cb221-288" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.qtif&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-quicktime&quot;</span> <span class="op">},</span></span>
<span id="cb221-289"><a href="#cb221-289" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.r3t&quot;</span><span class="op">,</span> <span class="st">&quot;text/vnd.rn-realtext3d&quot;</span> <span class="op">},</span></span>
<span id="cb221-290"><a href="#cb221-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ra&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-pn-realaudio&quot;</span> <span class="op">},</span></span>
<span id="cb221-291"><a href="#cb221-291" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ram&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-pn-realaudio&quot;</span> <span class="op">},</span></span>
<span id="cb221-292"><a href="#cb221-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rar&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-293"><a href="#cb221-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ras&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-cmu-raster&quot;</span> <span class="op">},</span></span>
<span id="cb221-294"><a href="#cb221-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rc&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-295"><a href="#cb221-295" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rdf&quot;</span><span class="op">,</span> <span class="st">&quot;application/rdf+xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-296"><a href="#cb221-296" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rf&quot;</span><span class="op">,</span> <span class="st">&quot;image/vnd.rn-realflash&quot;</span> <span class="op">},</span></span>
<span id="cb221-297"><a href="#cb221-297" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rgb&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-rgb&quot;</span> <span class="op">},</span></span>
<span id="cb221-298"><a href="#cb221-298" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rlf&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-richlink&quot;</span> <span class="op">},</span></span>
<span id="cb221-299"><a href="#cb221-299" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rm&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-pn-realaudio&quot;</span> <span class="op">},</span></span>
<span id="cb221-300"><a href="#cb221-300" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rmf&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-rmf&quot;</span> <span class="op">},</span></span>
<span id="cb221-301"><a href="#cb221-301" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rmi&quot;</span><span class="op">,</span> <span class="st">&quot;audio/mid&quot;</span> <span class="op">},</span></span>
<span id="cb221-302"><a href="#cb221-302" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rmm&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-pn-realaudio&quot;</span> <span class="op">},</span></span>
<span id="cb221-303"><a href="#cb221-303" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rmvb&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-pn-realaudio&quot;</span> <span class="op">},</span></span>
<span id="cb221-304"><a href="#cb221-304" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rnx&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.rn-realplayer&quot;</span> <span class="op">},</span></span>
<span id="cb221-305"><a href="#cb221-305" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.roff&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-troff&quot;</span> <span class="op">},</span></span>
<span id="cb221-306"><a href="#cb221-306" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rp&quot;</span><span class="op">,</span> <span class="st">&quot;image/vnd.rn-realpix&quot;</span> <span class="op">},</span></span>
<span id="cb221-307"><a href="#cb221-307" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rpm&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-pn-realaudio-plugin&quot;</span> <span class="op">},</span></span>
<span id="cb221-308"><a href="#cb221-308" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rt&quot;</span><span class="op">,</span> <span class="st">&quot;text/vnd.rn-realtext&quot;</span> <span class="op">},</span></span>
<span id="cb221-309"><a href="#cb221-309" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rte&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-gps&quot;</span> <span class="op">},</span></span>
<span id="cb221-310"><a href="#cb221-310" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rtf&quot;</span><span class="op">,</span> <span class="st">&quot;application/rtf&quot;</span> <span class="op">},</span></span>
<span id="cb221-311"><a href="#cb221-311" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rtg&quot;</span><span class="op">,</span> <span class="st">&quot;application/metastream&quot;</span> <span class="op">},</span></span>
<span id="cb221-312"><a href="#cb221-312" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rtx&quot;</span><span class="op">,</span> <span class="st">&quot;text/richtext&quot;</span> <span class="op">},</span></span>
<span id="cb221-313"><a href="#cb221-313" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rv&quot;</span><span class="op">,</span> <span class="st">&quot;video/vnd.rn-realvideo&quot;</span> <span class="op">},</span></span>
<span id="cb221-314"><a href="#cb221-314" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.rwc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-rogerwilco&quot;</span> <span class="op">},</span></span>
<span id="cb221-315"><a href="#cb221-315" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.s3m&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-316"><a href="#cb221-316" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.s3z&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-317"><a href="#cb221-317" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sca&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-supercard&quot;</span> <span class="op">},</span></span>
<span id="cb221-318"><a href="#cb221-318" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.scd&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msschedule&quot;</span> <span class="op">},</span></span>
<span id="cb221-319"><a href="#cb221-319" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sct&quot;</span><span class="op">,</span> <span class="st">&quot;text/scriptlet&quot;</span> <span class="op">},</span></span>
<span id="cb221-320"><a href="#cb221-320" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sdf&quot;</span><span class="op">,</span> <span class="st">&quot;application/e-score&quot;</span> <span class="op">},</span></span>
<span id="cb221-321"><a href="#cb221-321" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sea&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-stuffit&quot;</span> <span class="op">},</span></span>
<span id="cb221-322"><a href="#cb221-322" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.setpay&quot;</span><span class="op">,</span> <span class="st">&quot;application/set-payment-initiation&quot;</span> <span class="op">},</span></span>
<span id="cb221-323"><a href="#cb221-323" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.setreg&quot;</span><span class="op">,</span> <span class="st">&quot;application/set-registration-initiation&quot;</span> <span class="op">},</span></span>
<span id="cb221-324"><a href="#cb221-324" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sgm&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-sgml&quot;</span> <span class="op">},</span></span>
<span id="cb221-325"><a href="#cb221-325" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sgml&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-sgml&quot;</span> <span class="op">},</span></span>
<span id="cb221-326"><a href="#cb221-326" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sh&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-sh&quot;</span> <span class="op">},</span></span>
<span id="cb221-327"><a href="#cb221-327" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.shar&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-shar&quot;</span> <span class="op">},</span></span>
<span id="cb221-328"><a href="#cb221-328" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.shtml&quot;</span><span class="op">,</span> <span class="st">&quot;magnus-internal/parsed-html&quot;</span> <span class="op">},</span></span>
<span id="cb221-329"><a href="#cb221-329" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.shw&quot;</span><span class="op">,</span> <span class="st">&quot;application/presentations&quot;</span> <span class="op">},</span></span>
<span id="cb221-330"><a href="#cb221-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.si6&quot;</span><span class="op">,</span> <span class="st">&quot;image/si6&quot;</span> <span class="op">},</span></span>
<span id="cb221-331"><a href="#cb221-331" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.si7&quot;</span><span class="op">,</span> <span class="st">&quot;image/vnd.stiwap.sis&quot;</span> <span class="op">},</span></span>
<span id="cb221-332"><a href="#cb221-332" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.si9&quot;</span><span class="op">,</span> <span class="st">&quot;image/vnd.lgtwap.sis&quot;</span> <span class="op">},</span></span>
<span id="cb221-333"><a href="#cb221-333" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sis&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.symbian.install&quot;</span> <span class="op">},</span></span>
<span id="cb221-334"><a href="#cb221-334" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sit&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-stuffit&quot;</span> <span class="op">},</span></span>
<span id="cb221-335"><a href="#cb221-335" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.skd&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-Koan&quot;</span> <span class="op">},</span></span>
<span id="cb221-336"><a href="#cb221-336" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.skm&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-Koan&quot;</span> <span class="op">},</span></span>
<span id="cb221-337"><a href="#cb221-337" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.skp&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-Koan&quot;</span> <span class="op">},</span></span>
<span id="cb221-338"><a href="#cb221-338" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.skt&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-Koan&quot;</span> <span class="op">},</span></span>
<span id="cb221-339"><a href="#cb221-339" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.slc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-salsa&quot;</span> <span class="op">},</span></span>
<span id="cb221-340"><a href="#cb221-340" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.smd&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-smd&quot;</span> <span class="op">},</span></span>
<span id="cb221-341"><a href="#cb221-341" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.smi&quot;</span><span class="op">,</span> <span class="st">&quot;application/smil&quot;</span> <span class="op">},</span></span>
<span id="cb221-342"><a href="#cb221-342" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.smil&quot;</span><span class="op">,</span> <span class="st">&quot;application/smil&quot;</span> <span class="op">},</span></span>
<span id="cb221-343"><a href="#cb221-343" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.smp&quot;</span><span class="op">,</span> <span class="st">&quot;application/studiom&quot;</span> <span class="op">},</span></span>
<span id="cb221-344"><a href="#cb221-344" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.smz&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-smd&quot;</span> <span class="op">},</span></span>
<span id="cb221-345"><a href="#cb221-345" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.snd&quot;</span><span class="op">,</span> <span class="st">&quot;audio/basic&quot;</span> <span class="op">},</span></span>
<span id="cb221-346"><a href="#cb221-346" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.spc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-pkcs7-certificates&quot;</span> <span class="op">},</span></span>
<span id="cb221-347"><a href="#cb221-347" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.spl&quot;</span><span class="op">,</span> <span class="st">&quot;application/futuresplash&quot;</span> <span class="op">},</span></span>
<span id="cb221-348"><a href="#cb221-348" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.spr&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-sprite&quot;</span> <span class="op">},</span></span>
<span id="cb221-349"><a href="#cb221-349" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sprite&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-sprite&quot;</span> <span class="op">},</span></span>
<span id="cb221-350"><a href="#cb221-350" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sdp&quot;</span><span class="op">,</span> <span class="st">&quot;application/sdp&quot;</span> <span class="op">},</span></span>
<span id="cb221-351"><a href="#cb221-351" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.spt&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-spt&quot;</span> <span class="op">},</span></span>
<span id="cb221-352"><a href="#cb221-352" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.src&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-wais-source&quot;</span> <span class="op">},</span></span>
<span id="cb221-353"><a href="#cb221-353" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sst&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-pkicertstore&quot;</span> <span class="op">},</span></span>
<span id="cb221-354"><a href="#cb221-354" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.stk&quot;</span><span class="op">,</span> <span class="st">&quot;application/hyperstudio&quot;</span> <span class="op">},</span></span>
<span id="cb221-355"><a href="#cb221-355" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.stl&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-pkistl&quot;</span> <span class="op">},</span></span>
<span id="cb221-356"><a href="#cb221-356" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.stm&quot;</span><span class="op">,</span> <span class="st">&quot;text/html&quot;</span> <span class="op">},</span></span>
<span id="cb221-357"><a href="#cb221-357" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.svg&quot;</span><span class="op">,</span> <span class="st">&quot;image/svg+xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-358"><a href="#cb221-358" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sv4cpio&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-sv4cpio&quot;</span> <span class="op">},</span></span>
<span id="cb221-359"><a href="#cb221-359" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.sv4crc&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-sv4crc&quot;</span> <span class="op">},</span></span>
<span id="cb221-360"><a href="#cb221-360" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.svf&quot;</span><span class="op">,</span> <span class="st">&quot;image/vnd&quot;</span> <span class="op">},</span></span>
<span id="cb221-361"><a href="#cb221-361" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.svg&quot;</span><span class="op">,</span> <span class="st">&quot;image/svg+xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-362"><a href="#cb221-362" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.svh&quot;</span><span class="op">,</span> <span class="st">&quot;image/svh&quot;</span> <span class="op">},</span></span>
<span id="cb221-363"><a href="#cb221-363" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.svr&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-svr&quot;</span> <span class="op">},</span></span>
<span id="cb221-364"><a href="#cb221-364" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.swf&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-shockwave-flash&quot;</span> <span class="op">},</span></span>
<span id="cb221-365"><a href="#cb221-365" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.swfl&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-shockwave-flash&quot;</span> <span class="op">},</span></span>
<span id="cb221-366"><a href="#cb221-366" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.t&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-troff&quot;</span> <span class="op">},</span></span>
<span id="cb221-367"><a href="#cb221-367" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tad&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-368"><a href="#cb221-368" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.talk&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-speech&quot;</span> <span class="op">},</span></span>
<span id="cb221-369"><a href="#cb221-369" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tar&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-tar&quot;</span> <span class="op">},</span></span>
<span id="cb221-370"><a href="#cb221-370" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.taz&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-tar&quot;</span> <span class="op">},</span></span>
<span id="cb221-371"><a href="#cb221-371" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tbp&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-timbuktu&quot;</span> <span class="op">},</span></span>
<span id="cb221-372"><a href="#cb221-372" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tbt&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-timbuktu&quot;</span> <span class="op">},</span></span>
<span id="cb221-373"><a href="#cb221-373" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tcl&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-tcl&quot;</span> <span class="op">},</span></span>
<span id="cb221-374"><a href="#cb221-374" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tex&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-tex&quot;</span> <span class="op">},</span></span>
<span id="cb221-375"><a href="#cb221-375" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.texi&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-texinfo&quot;</span> <span class="op">},</span></span>
<span id="cb221-376"><a href="#cb221-376" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.texinfo&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-texinfo&quot;</span> <span class="op">},</span></span>
<span id="cb221-377"><a href="#cb221-377" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tgz&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-compressed&quot;</span> <span class="op">},</span></span>
<span id="cb221-378"><a href="#cb221-378" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.thm&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.eri.thm&quot;</span> <span class="op">},</span></span>
<span id="cb221-379"><a href="#cb221-379" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tif&quot;</span><span class="op">,</span> <span class="st">&quot;image/tiff&quot;</span> <span class="op">},</span></span>
<span id="cb221-380"><a href="#cb221-380" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tiff&quot;</span><span class="op">,</span> <span class="st">&quot;image/tiff&quot;</span> <span class="op">},</span></span>
<span id="cb221-381"><a href="#cb221-381" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tki&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-tkined&quot;</span> <span class="op">},</span></span>
<span id="cb221-382"><a href="#cb221-382" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tkined&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-tkined&quot;</span> <span class="op">},</span></span>
<span id="cb221-383"><a href="#cb221-383" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.toc&quot;</span><span class="op">,</span> <span class="st">&quot;application/toc&quot;</span> <span class="op">},</span></span>
<span id="cb221-384"><a href="#cb221-384" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.toy&quot;</span><span class="op">,</span> <span class="st">&quot;image/toy&quot;</span> <span class="op">},</span></span>
<span id="cb221-385"><a href="#cb221-385" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tr&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-troff&quot;</span> <span class="op">},</span></span>
<span id="cb221-386"><a href="#cb221-386" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.trk&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-gps&quot;</span> <span class="op">},</span></span>
<span id="cb221-387"><a href="#cb221-387" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.trm&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msterminal&quot;</span> <span class="op">},</span></span>
<span id="cb221-388"><a href="#cb221-388" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tsi&quot;</span><span class="op">,</span> <span class="st">&quot;audio/tsplayer&quot;</span> <span class="op">},</span></span>
<span id="cb221-389"><a href="#cb221-389" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tsp&quot;</span><span class="op">,</span> <span class="st">&quot;application/dsptype&quot;</span> <span class="op">},</span></span>
<span id="cb221-390"><a href="#cb221-390" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.tsv&quot;</span><span class="op">,</span> <span class="st">&quot;text/tab-separated-values&quot;</span> <span class="op">},</span></span>
<span id="cb221-391"><a href="#cb221-391" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ttf&quot;</span><span class="op">,</span> <span class="st">&quot;application/octet-stream&quot;</span> <span class="op">},</span></span>
<span id="cb221-392"><a href="#cb221-392" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ttz&quot;</span><span class="op">,</span> <span class="st">&quot;application/t-time&quot;</span> <span class="op">},</span></span>
<span id="cb221-393"><a href="#cb221-393" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.txt&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-394"><a href="#cb221-394" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.uls&quot;</span><span class="op">,</span> <span class="st">&quot;text/iuls&quot;</span> <span class="op">},</span></span>
<span id="cb221-395"><a href="#cb221-395" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ult&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-396"><a href="#cb221-396" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ustar&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-ustar&quot;</span> <span class="op">},</span></span>
<span id="cb221-397"><a href="#cb221-397" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.uu&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-uuencode&quot;</span> <span class="op">},</span></span>
<span id="cb221-398"><a href="#cb221-398" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.uue&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-uuencode&quot;</span> <span class="op">},</span></span>
<span id="cb221-399"><a href="#cb221-399" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vcd&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-cdlink&quot;</span> <span class="op">},</span></span>
<span id="cb221-400"><a href="#cb221-400" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vcf&quot;</span><span class="op">,</span> <span class="st">&quot;text/x-vcard&quot;</span> <span class="op">},</span></span>
<span id="cb221-401"><a href="#cb221-401" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vdo&quot;</span><span class="op">,</span> <span class="st">&quot;video/vdo&quot;</span> <span class="op">},</span></span>
<span id="cb221-402"><a href="#cb221-402" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vib&quot;</span><span class="op">,</span> <span class="st">&quot;audio/vib&quot;</span> <span class="op">},</span></span>
<span id="cb221-403"><a href="#cb221-403" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.viv&quot;</span><span class="op">,</span> <span class="st">&quot;video/vivo&quot;</span> <span class="op">},</span></span>
<span id="cb221-404"><a href="#cb221-404" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vivo&quot;</span><span class="op">,</span> <span class="st">&quot;video/vivo&quot;</span> <span class="op">},</span></span>
<span id="cb221-405"><a href="#cb221-405" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vmd&quot;</span><span class="op">,</span> <span class="st">&quot;application/vocaltec-media-desc&quot;</span> <span class="op">},</span></span>
<span id="cb221-406"><a href="#cb221-406" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vmf&quot;</span><span class="op">,</span> <span class="st">&quot;application/vocaltec-media-file&quot;</span> <span class="op">},</span></span>
<span id="cb221-407"><a href="#cb221-407" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vmi&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-dreamcast-vms-info&quot;</span> <span class="op">},</span></span>
<span id="cb221-408"><a href="#cb221-408" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vms&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-dreamcast-vms&quot;</span> <span class="op">},</span></span>
<span id="cb221-409"><a href="#cb221-409" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vox&quot;</span><span class="op">,</span> <span class="st">&quot;audio/voxware&quot;</span> <span class="op">},</span></span>
<span id="cb221-410"><a href="#cb221-410" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vqe&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-twinvq-plugin&quot;</span> <span class="op">},</span></span>
<span id="cb221-411"><a href="#cb221-411" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vqf&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-twinvq&quot;</span> <span class="op">},</span></span>
<span id="cb221-412"><a href="#cb221-412" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vql&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-twinvq&quot;</span> <span class="op">},</span></span>
<span id="cb221-413"><a href="#cb221-413" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vre&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vream&quot;</span> <span class="op">},</span></span>
<span id="cb221-414"><a href="#cb221-414" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vrml&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vrml&quot;</span> <span class="op">},</span></span>
<span id="cb221-415"><a href="#cb221-415" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vrt&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vrt&quot;</span> <span class="op">},</span></span>
<span id="cb221-416"><a href="#cb221-416" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vrw&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vream&quot;</span> <span class="op">},</span></span>
<span id="cb221-417"><a href="#cb221-417" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.vts&quot;</span><span class="op">,</span> <span class="st">&quot;workbook/formulaone&quot;</span> <span class="op">},</span></span>
<span id="cb221-418"><a href="#cb221-418" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wav&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-wav&quot;</span> <span class="op">},</span></span>
<span id="cb221-419"><a href="#cb221-419" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wax&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-ms-wax&quot;</span> <span class="op">},</span></span>
<span id="cb221-420"><a href="#cb221-420" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wbmp&quot;</span><span class="op">,</span> <span class="st">&quot;image/vnd.wap.wbmp&quot;</span> <span class="op">},</span></span>
<span id="cb221-421"><a href="#cb221-421" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wcm&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-works&quot;</span> <span class="op">},</span></span>
<span id="cb221-422"><a href="#cb221-422" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wdb&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-works&quot;</span> <span class="op">},</span></span>
<span id="cb221-423"><a href="#cb221-423" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.web&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.xara&quot;</span> <span class="op">},</span></span>
<span id="cb221-424"><a href="#cb221-424" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wi&quot;</span><span class="op">,</span> <span class="st">&quot;image/wavelet&quot;</span> <span class="op">},</span></span>
<span id="cb221-425"><a href="#cb221-425" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wis&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-InstallShield&quot;</span> <span class="op">},</span></span>
<span id="cb221-426"><a href="#cb221-426" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wks&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-works&quot;</span> <span class="op">},</span></span>
<span id="cb221-427"><a href="#cb221-427" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wm&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-ms-wm&quot;</span> <span class="op">},</span></span>
<span id="cb221-428"><a href="#cb221-428" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wma&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-ms-wma&quot;</span> <span class="op">},</span></span>
<span id="cb221-429"><a href="#cb221-429" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmd&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-ms-wmd&quot;</span> <span class="op">},</span></span>
<span id="cb221-430"><a href="#cb221-430" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmf&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-msmetafile&quot;</span> <span class="op">},</span></span>
<span id="cb221-431"><a href="#cb221-431" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wml&quot;</span><span class="op">,</span> <span class="st">&quot;text/vnd.wap.wml&quot;</span> <span class="op">},</span></span>
<span id="cb221-432"><a href="#cb221-432" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmlc&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.wap.wmlc&quot;</span> <span class="op">},</span></span>
<span id="cb221-433"><a href="#cb221-433" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmls&quot;</span><span class="op">,</span> <span class="st">&quot;text/vnd.wap.wmlscript&quot;</span> <span class="op">},</span></span>
<span id="cb221-434"><a href="#cb221-434" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmlsc&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.wap.wmlscriptc&quot;</span> <span class="op">},</span></span>
<span id="cb221-435"><a href="#cb221-435" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmlscript&quot;</span><span class="op">,</span> <span class="st">&quot;text/vnd.wap.wmlscript&quot;</span> <span class="op">},</span></span>
<span id="cb221-436"><a href="#cb221-436" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmv&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-ms-wmv&quot;</span> <span class="op">},</span></span>
<span id="cb221-437"><a href="#cb221-437" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmx&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-ms-wmx&quot;</span> <span class="op">},</span></span>
<span id="cb221-438"><a href="#cb221-438" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wmz&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-ms-wmz&quot;</span> <span class="op">},</span></span>
<span id="cb221-439"><a href="#cb221-439" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wpng&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-up-wpng&quot;</span> <span class="op">},</span></span>
<span id="cb221-440"><a href="#cb221-440" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wps&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-works&quot;</span> <span class="op">},</span></span>
<span id="cb221-441"><a href="#cb221-441" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wpt&quot;</span><span class="op">,</span> <span class="st">&quot;x-lml/x-gps&quot;</span> <span class="op">},</span></span>
<span id="cb221-442"><a href="#cb221-442" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wri&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-mswrite&quot;</span> <span class="op">},</span></span>
<span id="cb221-443"><a href="#cb221-443" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wrl&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vrml&quot;</span> <span class="op">},</span></span>
<span id="cb221-444"><a href="#cb221-444" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wrz&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vrml&quot;</span> <span class="op">},</span></span>
<span id="cb221-445"><a href="#cb221-445" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.ws&quot;</span><span class="op">,</span> <span class="st">&quot;text/vnd.wap.wmlscript&quot;</span> <span class="op">},</span></span>
<span id="cb221-446"><a href="#cb221-446" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wsc&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.wap.wmlscriptc&quot;</span> <span class="op">},</span></span>
<span id="cb221-447"><a href="#cb221-447" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wv&quot;</span><span class="op">,</span> <span class="st">&quot;video/wavelet&quot;</span> <span class="op">},</span></span>
<span id="cb221-448"><a href="#cb221-448" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wvx&quot;</span><span class="op">,</span> <span class="st">&quot;video/x-ms-wvx&quot;</span> <span class="op">},</span></span>
<span id="cb221-449"><a href="#cb221-449" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.wxl&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-wxl&quot;</span> <span class="op">},</span></span>
<span id="cb221-450"><a href="#cb221-450" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.x-gzip&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-gzip&quot;</span> <span class="op">},</span></span>
<span id="cb221-451"><a href="#cb221-451" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xaf&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vrml&quot;</span> <span class="op">},</span></span>
<span id="cb221-452"><a href="#cb221-452" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xar&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.xara&quot;</span> <span class="op">},</span></span>
<span id="cb221-453"><a href="#cb221-453" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xbm&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-xbitmap&quot;</span> <span class="op">},</span></span>
<span id="cb221-454"><a href="#cb221-454" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xdm&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-xdma&quot;</span> <span class="op">},</span></span>
<span id="cb221-455"><a href="#cb221-455" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xdma&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-xdma&quot;</span> <span class="op">},</span></span>
<span id="cb221-456"><a href="#cb221-456" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xdw&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.fujixerox.docuworks&quot;</span> <span class="op">},</span></span>
<span id="cb221-457"><a href="#cb221-457" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xht&quot;</span><span class="op">,</span> <span class="st">&quot;application/xhtml+xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-458"><a href="#cb221-458" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xhtm&quot;</span><span class="op">,</span> <span class="st">&quot;application/xhtml+xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-459"><a href="#cb221-459" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xhtml&quot;</span><span class="op">,</span> <span class="st">&quot;application/xhtml+xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-460"><a href="#cb221-460" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xla&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-excel&quot;</span> <span class="op">},</span></span>
<span id="cb221-461"><a href="#cb221-461" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xlc&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-excel&quot;</span> <span class="op">},</span></span>
<span id="cb221-462"><a href="#cb221-462" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xll&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-excel&quot;</span> <span class="op">},</span></span>
<span id="cb221-463"><a href="#cb221-463" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xlm&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-excel&quot;</span> <span class="op">},</span></span>
<span id="cb221-464"><a href="#cb221-464" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xls&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-excel&quot;</span> <span class="op">},</span></span>
<span id="cb221-465"><a href="#cb221-465" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xlsx&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span> <span class="op">},</span></span>
<span id="cb221-466"><a href="#cb221-466" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xlt&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-excel&quot;</span> <span class="op">},</span></span>
<span id="cb221-467"><a href="#cb221-467" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xlw&quot;</span><span class="op">,</span> <span class="st">&quot;application/vnd.ms-excel&quot;</span> <span class="op">},</span></span>
<span id="cb221-468"><a href="#cb221-468" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xm&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-469"><a href="#cb221-469" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xml&quot;</span><span class="op">,</span> <span class="st">&quot;text/plain&quot;</span> <span class="op">},</span></span>
<span id="cb221-470"><a href="#cb221-470" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xml&quot;</span><span class="op">,</span> <span class="st">&quot;application/xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-471"><a href="#cb221-471" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xmz&quot;</span><span class="op">,</span> <span class="st">&quot;audio/x-mod&quot;</span> <span class="op">},</span></span>
<span id="cb221-472"><a href="#cb221-472" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xof&quot;</span><span class="op">,</span> <span class="st">&quot;x-world/x-vrml&quot;</span> <span class="op">},</span></span>
<span id="cb221-473"><a href="#cb221-473" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xpi&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-xpinstall&quot;</span> <span class="op">},</span></span>
<span id="cb221-474"><a href="#cb221-474" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xpm&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-xpixmap&quot;</span> <span class="op">},</span></span>
<span id="cb221-475"><a href="#cb221-475" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xsit&quot;</span><span class="op">,</span> <span class="st">&quot;text/xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-476"><a href="#cb221-476" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xsl&quot;</span><span class="op">,</span> <span class="st">&quot;text/xml&quot;</span> <span class="op">},</span></span>
<span id="cb221-477"><a href="#cb221-477" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xul&quot;</span><span class="op">,</span> <span class="st">&quot;text/xul&quot;</span> <span class="op">},</span></span>
<span id="cb221-478"><a href="#cb221-478" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xwd&quot;</span><span class="op">,</span> <span class="st">&quot;image/x-xwindowdump&quot;</span> <span class="op">},</span></span>
<span id="cb221-479"><a href="#cb221-479" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.xyz&quot;</span><span class="op">,</span> <span class="st">&quot;chemical/x-pdb&quot;</span> <span class="op">},</span></span>
<span id="cb221-480"><a href="#cb221-480" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.yz1&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-yz1&quot;</span> <span class="op">},</span></span>
<span id="cb221-481"><a href="#cb221-481" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.z&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-compress&quot;</span> <span class="op">},</span></span>
<span id="cb221-482"><a href="#cb221-482" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.zac&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-zaurus-zac&quot;</span> <span class="op">},</span></span>
<span id="cb221-483"><a href="#cb221-483" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.zip&quot;</span><span class="op">,</span> <span class="st">&quot;application/zip&quot;</span> <span class="op">},</span></span>
<span id="cb221-484"><a href="#cb221-484" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;.json&quot;</span><span class="op">,</span> <span class="st">&quot;application/json&quot;</span> <span class="op">}</span></span>
<span id="cb221-485"><a href="#cb221-485" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb221-486"><a href="#cb221-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-487"><a href="#cb221-487" aria-hidden="true" tabindex="-1"></a><span class="co">//根据文件后缀名获得对应的MIME类型</span></span>
<span id="cb221-488"><a href="#cb221-488" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="bu">String</span> <span class="fu">getMIMEType</span><span class="op">(</span><span class="bu">File</span> file<span class="op">)</span> <span class="op">{</span></span>
<span id="cb221-489"><a href="#cb221-489" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> type <span class="op">=</span> <span class="st">&quot;*/*&quot;</span><span class="op">;</span></span>
<span id="cb221-490"><a href="#cb221-490" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> fName <span class="op">=</span> file<span class="op">.</span><span class="fu">getName</span><span class="op">();</span></span>
<span id="cb221-491"><a href="#cb221-491" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 获取后缀名前的分隔符&quot;.&quot;在fName中的位置。</span></span>
<span id="cb221-492"><a href="#cb221-492" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dotIndex <span class="op">=</span> fName<span class="op">.</span><span class="fu">lastIndexOf</span><span class="op">(</span><span class="st">&quot;.&quot;</span><span class="op">);</span></span>
<span id="cb221-493"><a href="#cb221-493" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>dotIndex <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb221-494"><a href="#cb221-494" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> type<span class="op">;</span></span>
<span id="cb221-495"><a href="#cb221-495" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb221-496"><a href="#cb221-496" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* 获取文件的后缀名 */</span></span>
<span id="cb221-497"><a href="#cb221-497" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> end <span class="op">=</span> fName<span class="op">.</span><span class="fu">substring</span><span class="op">(</span>dotIndex<span class="op">,</span> fName<span class="op">.</span><span class="fu">length</span><span class="op">()).</span><span class="fu">toLowerCase</span><span class="op">();</span></span>
<span id="cb221-498"><a href="#cb221-498" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>end <span class="op">==</span> <span class="st">&quot;&quot;</span><span class="op">)</span></span>
<span id="cb221-499"><a href="#cb221-499" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> type<span class="op">;</span></span>
<span id="cb221-500"><a href="#cb221-500" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 在MIME和文件类型的匹配表中找到对应的MIME类型。</span></span>
<span id="cb221-501"><a href="#cb221-501" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> MIME_MapTable<span class="op">.</span><span class="fu">length</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span> </span>
<span id="cb221-502"><a href="#cb221-502" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>end<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>MIME_MapTable<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">]))</span></span>
<span id="cb221-503"><a href="#cb221-503" aria-hidden="true" tabindex="-1"></a>            type <span class="op">=</span> MIME_MapTable<span class="op">[</span>i<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb221-504"><a href="#cb221-504" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb221-505"><a href="#cb221-505" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> type<span class="op">;</span></span>
<span id="cb221-506"><a href="#cb221-506" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="component">Component</h4>
<div class="sourceCode" id="cb222"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="co">//方法1，指定context、class</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setComponent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ComponentName</span><span class="op">(</span><span class="fu">getApplicationContext</span><span class="op">(),</span> MyActivity<span class="op">.</span><span class="fu">class</span><span class="op">));</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="co">//方法2，指定context、action</span></span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setComponent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ComponentName</span><span class="op">(</span><span class="fu">getApplicationContext</span><span class="op">(),</span> <span class="st">&quot;com.myapp.intent.MyActivity&quot;</span><span class="op">));</span></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a><span class="co">//方法3，用于匹配其他包的目标，指定包名、全类名</span></span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setComponent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ComponentName</span><span class="op">(</span><span class="st">&quot;com.myapp.other&quot;</span><span class="op">,</span> <span class="st">&quot;com.myapp.other.OtherActivity&quot;</span><span class="op">));</span></span></code></pre></div>
<h4 id="flag">FLAG</h4>
<p>FLAG可以指定Activity的启动方式（参考前面的”Activity的四种加载模式”）</p>
<p>在Service等非Activity中启动Activity的时候，必须指定<code>FLAG_ACTIVITY_NEW_TASK</code></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>intent<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>Intent<span class="op">.</span><span class="fu">FLAG_ACTIVITY_NEW_TASK</span><span class="op">)</span></span></code></pre></div>
<h4 id="显式和隐式intent">显式和隐式intent</h4>
<p>显式：只要指定了Component、class、packageName的其中一个，都是显式的</p>
<p>隐式：不直接指定启动哪个Activity（或者其他Context），而是通过Action、Data、Category来筛选除合适的Activity（或者其他Context）</p>
<p>Android5.0以后，禁止使用隐式Intent来启动Service，否则会报错(service
intent must be explicit)</p>
<h3 id="systemservice">SystemService</h3>
<p>使用<code>context.getSystemService</code>可以获取各种系统管理工具，如</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>Vibrator mVibrator <span class="op">=</span> <span class="op">(</span>Vibrator<span class="op">)</span> <span class="fu">getSystemService</span><span class="op">(</span><span class="bu">Context</span><span class="op">.</span><span class="fu">VIBRATOR_SERVICE</span><span class="op">);</span></span></code></pre></div>
<p>服务有：</p>
<ul>
<li>WINDOW_SERVICE，返回WindowManager</li>
<li>LAYOUT_INFLATER_SERVICE，返回LayoutInflater</li>
<li>ACTIVITY_SERVICE，返回ActivityManager</li>
<li>POWER_SERVICE，返回PowerManger</li>
<li>ALARM_SERVICE，返回AlarmManager，闹钟的服务</li>
<li>NOTIFICATION_SERVICE，返回NotificationManager，状态栏的服务</li>
<li>KEYGUARD_SERVICE，返回KeyguardManager，键盘锁的服务</li>
<li>LOCATION_SERVICE，返回LocationManager，位置的服务，如GPS</li>
<li>SEARCH_SERVICE，返回SearchManager，搜索的服务</li>
<li>VIBRATOR_SERVICE，返回Vebrator，手机震动的服务</li>
<li>CONNECTIVITY_SERVICE，返回Connectivity，网络连接的服务</li>
<li>IPSEC_SERVICE，返回IpSecManager</li>
<li>WIFI_SERVICE，返回WifiManager，Wi-Fi服务</li>
<li>WIFI_AWARE_SERVICE，返回WifiAwareManager</li>
<li>WIFI_P2P_SERVICE，返回WifiP2pManager</li>
<li>INPUT_METHOD_SERVICE，返回InputMethodManager</li>
<li>UI_MODE_SERVICE，返回UiModeManager</li>
<li>DOWNLOAD_SERVICE，返回DownloadManager</li>
<li>BATTERY_SERVICE，返回BatteryManager</li>
<li>JOB_SCHEDULER_SERVICE，返回JobScheduler</li>
<li>NETWORK_STATS_SERVICE，返回NetworkStatsManager</li>
<li>HARDWARE_PROPERTIES_SERVICE，返回HardwarePropertiesManager</li>
<li>TELEPHONY_SERVICE，返回TeleponyManager，电话服务</li>
</ul>
<h3 id="动态权限获取">动态权限获取</h3>
<p>通过<code>ContextCompat.checkSelfPermission</code>判断是否拥有授权，如果没有，就通过<code>ActivityCompat.requestPermissions</code>尝试获取权限，然后在<code>onRequestPermissionsResult</code>回调中检测用户是否授权，并执行对应的操作</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="co">//需要授权的地方</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span><span class="bu">View</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Android 6.0 以上才需要动态获取权限</span></span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>Build<span class="op">.</span><span class="fu">VERSION</span><span class="op">.</span><span class="fu">SDK_INT</span> <span class="op">&gt;=</span> <span class="dv">23</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ContextCompat<span class="op">.</span><span class="fu">checkSelfPermission</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="bu">Manifest</span><span class="op">.</span><span class="fu">permission</span><span class="op">.</span><span class="fu">CALL_PHONE</span><span class="op">)</span> <span class="op">!=</span> PackageManager<span class="op">.</span><span class="fu">PERMISSION_GRANTED</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">//未授权，尝试申请权限</span></span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">requestPermissions</span><span class="op">(</span><span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="bu">Manifest</span><span class="op">.</span><span class="fu">permission</span><span class="op">.</span><span class="fu">CALL_PHONE</span><span class="op">},</span> <span class="dv">1001</span><span class="op">);</span><span class="co">//系统会弹框让用户授权，然后调用onRequestPermissionsResult</span></span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span><span class="op">{</span></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">//已授权，直接执行</span></span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">makeCall</span><span class="op">();</span></span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb225-15"><a href="#cb225-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">//不需要动态获取权限，直接执行</span></span>
<span id="cb225-16"><a href="#cb225-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">makeCall</span><span class="op">();</span></span>
<span id="cb225-17"><a href="#cb225-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb225-18"><a href="#cb225-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb225-19"><a href="#cb225-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-20"><a href="#cb225-20" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb225-21"><a href="#cb225-21" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onRequestPermissionsResult</span><span class="op">(</span><span class="dt">int</span> requestCode<span class="op">,</span> <span class="at">@NonNull</span> <span class="bu">String</span><span class="op">[]</span> permissions<span class="op">,</span> <span class="at">@NonNull</span> <span class="dt">int</span><span class="op">[]</span> grantResults<span class="op">)</span> <span class="op">{</span></span>
<span id="cb225-22"><a href="#cb225-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">onRequestPermissionsResult</span><span class="op">(</span>requestCode<span class="op">,</span> permissions<span class="op">,</span> grantResults<span class="op">);</span></span>
<span id="cb225-23"><a href="#cb225-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>requestCode<span class="op">)</span> <span class="op">{</span></span>
<span id="cb225-24"><a href="#cb225-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="dv">1001</span><span class="op">:</span></span>
<span id="cb225-25"><a href="#cb225-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>grantResults<span class="op">.</span><span class="fu">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> grantResults<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> PackageManager<span class="op">.</span><span class="fu">PERMISSION_GRANTED</span><span class="op">){</span></span>
<span id="cb225-26"><a href="#cb225-26" aria-hidden="true" tabindex="-1"></a>                <span class="co">//同意权限申请</span></span>
<span id="cb225-27"><a href="#cb225-27" aria-hidden="true" tabindex="-1"></a>                <span class="fu">makeCall</span><span class="op">();</span></span>
<span id="cb225-28"><a href="#cb225-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span><span class="fu">requestPermissionAgain</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb225-29"><a href="#cb225-29" aria-hidden="true" tabindex="-1"></a>                <span class="co">//再次尝试申请权限成功</span></span>
<span id="cb225-30"><a href="#cb225-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">makeCall</span><span class="op">();</span></span>
<span id="cb225-31"><a href="#cb225-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb225-32"><a href="#cb225-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb225-33"><a href="#cb225-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">default</span><span class="op">:</span></span>
<span id="cb225-34"><a href="#cb225-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb225-35"><a href="#cb225-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb225-36"><a href="#cb225-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb225-37"><a href="#cb225-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-38"><a href="#cb225-38" aria-hidden="true" tabindex="-1"></a><span class="co">//再次尝试申请权限，带自定义的提示框</span></span>
<span id="cb225-39"><a href="#cb225-39" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">boolean</span> <span class="fu">requestPermissionAgain</span><span class="op">(){</span></span>
<span id="cb225-40"><a href="#cb225-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ContextCompat<span class="op">.</span><span class="fu">checkSelfPermission</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="bu">Manifest</span><span class="op">.</span><span class="fu">permission</span><span class="op">.</span><span class="fu">CALL_PHONE</span><span class="op">)</span> <span class="op">!=</span> PackageManager<span class="op">.</span><span class="fu">PERMISSION_GRANTED</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb225-41"><a href="#cb225-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">//未授权</span></span>
<span id="cb225-42"><a href="#cb225-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">//检查是否需要弹出提示框</span></span>
<span id="cb225-43"><a href="#cb225-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ActivityCompat<span class="op">.</span><span class="fu">shouldShowRequestPermissionRationale</span><span class="op">(</span>activity<span class="op">,</span> permissionList<span class="op">.</span><span class="fu">get</span><span class="op">(</span>i<span class="op">)))</span> <span class="op">{</span></span>
<span id="cb225-44"><a href="#cb225-44" aria-hidden="true" tabindex="-1"></a>            <span class="co">//用户上次点击了此次拒绝，再次弹框询问用户是否授权（app内弹框）</span></span>
<span id="cb225-45"><a href="#cb225-45" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> AlertDialog<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">)</span></span>
<span id="cb225-46"><a href="#cb225-46" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;未授权&quot;</span><span class="op">)</span></span>
<span id="cb225-47"><a href="#cb225-47" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setMessage</span><span class="op">(</span><span class="st">&quot;需要电话权限才能开始打电话&quot;</span><span class="op">)</span></span>
<span id="cb225-48"><a href="#cb225-48" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setNegativeButton</span><span class="op">(</span><span class="st">&quot;取消&quot;</span><span class="op">,</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb225-49"><a href="#cb225-49" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setPositiveButton</span><span class="op">(</span><span class="st">&quot;立即授权&quot;</span><span class="op">,</span> <span class="kw">new</span> DialogInterface<span class="op">.</span><span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb225-50"><a href="#cb225-50" aria-hidden="true" tabindex="-1"></a>                    <span class="at">@Override</span></span>
<span id="cb225-51"><a href="#cb225-51" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span> <span class="dt">int</span> which<span class="op">)</span> <span class="op">{</span></span>
<span id="cb225-52"><a href="#cb225-52" aria-hidden="true" tabindex="-1"></a>                        ActivityCompat<span class="op">.</span><span class="fu">requestPermissions</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span><span class="bu">Manifest</span><span class="op">.</span><span class="fu">permission</span><span class="op">.</span><span class="fu">CALL_PHONE</span><span class="op">},</span> <span class="dv">1001</span><span class="op">);</span><span class="co">//在app内弹框</span></span>
<span id="cb225-53"><a href="#cb225-53" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb225-54"><a href="#cb225-54" aria-hidden="true" tabindex="-1"></a>                <span class="op">})</span></span>
<span id="cb225-55"><a href="#cb225-55" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setCancelable</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span></span>
<span id="cb225-56"><a href="#cb225-56" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb225-57"><a href="#cb225-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb225-58"><a href="#cb225-58" aria-hidden="true" tabindex="-1"></a>            <span class="co">//用户第一次使用 或者 用户拒绝且勾选不再提示（弹框提示用户说如果不给权限就不能用，需要在设置中打开权限，因为这时再调ActivityCompat.requestPermissions也不会出现授权框了）</span></span>
<span id="cb225-59"><a href="#cb225-59" aria-hidden="true" tabindex="-1"></a>            <span class="co">//由于无法区分是用户第一次使用还是用户拒绝且勾选不再提示，所以需要在调用本方法前先申请一次权限，如果拒绝了再掉本方法，这样可以去掉第一次使用的情况</span></span>
<span id="cb225-60"><a href="#cb225-60" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> AlertDialog<span class="op">.</span><span class="fu">Builder</span><span class="op">(</span><span class="kw">this</span><span class="op">)</span></span>
<span id="cb225-61"><a href="#cb225-61" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span><span class="st">&quot;未授权&quot;</span><span class="op">)</span></span>
<span id="cb225-62"><a href="#cb225-62" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setMessage</span><span class="op">(</span><span class="st">&quot;需要电话权限才能开始打电话&quot;</span><span class="op">)</span></span>
<span id="cb225-63"><a href="#cb225-63" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setNegativeButton</span><span class="op">(</span><span class="st">&quot;取消&quot;</span><span class="op">,</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb225-64"><a href="#cb225-64" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setPositiveButton</span><span class="op">(</span><span class="st">&quot;去设置&quot;</span><span class="op">,</span> <span class="kw">new</span> DialogInterface<span class="op">.</span><span class="fu">OnClickListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb225-65"><a href="#cb225-65" aria-hidden="true" tabindex="-1"></a>                    <span class="at">@Override</span></span>
<span id="cb225-66"><a href="#cb225-66" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span>DialogInterface dialog<span class="op">,</span> <span class="dt">int</span> which<span class="op">)</span> <span class="op">{</span></span>
<span id="cb225-67"><a href="#cb225-67" aria-hidden="true" tabindex="-1"></a>                        Intent intent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">();</span></span>
<span id="cb225-68"><a href="#cb225-68" aria-hidden="true" tabindex="-1"></a>                        intent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span>Settings<span class="op">.</span><span class="fu">ACTION_APPLICATION_DETAILS_SETTINGS</span><span class="op">);</span></span>
<span id="cb225-69"><a href="#cb225-69" aria-hidden="true" tabindex="-1"></a>                        Uri uri <span class="op">=</span> Uri<span class="op">.</span><span class="fu">fromParts</span><span class="op">(</span><span class="st">&quot;package&quot;</span><span class="op">,</span> <span class="fu">getPackageName</span><span class="op">(),</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb225-70"><a href="#cb225-70" aria-hidden="true" tabindex="-1"></a>                        intent<span class="op">.</span><span class="fu">setData</span><span class="op">(</span>uri<span class="op">);</span></span>
<span id="cb225-71"><a href="#cb225-71" aria-hidden="true" tabindex="-1"></a>                        context<span class="op">.</span><span class="fu">startActivity</span><span class="op">(</span>intent<span class="op">);</span><span class="co">//去设置中打开权限</span></span>
<span id="cb225-72"><a href="#cb225-72" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb225-73"><a href="#cb225-73" aria-hidden="true" tabindex="-1"></a>                <span class="op">})</span></span>
<span id="cb225-74"><a href="#cb225-74" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setCancelable</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span></span>
<span id="cb225-75"><a href="#cb225-75" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">show</span><span class="op">();</span></span>
<span id="cb225-76"><a href="#cb225-76" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb225-77"><a href="#cb225-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb225-78"><a href="#cb225-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb225-79"><a href="#cb225-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb225-80"><a href="#cb225-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb225-81"><a href="#cb225-81" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>要注意的是，Activity和Fragment授权的函数是不同的，如果Fragment使用了Activity的函数进行授权，是不会出现授权提示框的，反之亦然</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">getPermissionInFragment</span><span class="op">(</span>Fragment fragment<span class="op">,</span> <span class="bu">String</span> permission<span class="op">,</span> <span class="dt">int</span> requestCode<span class="op">)</span> <span class="op">{</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ContextCompat<span class="op">.</span><span class="fu">checkSelfPermission</span><span class="op">(</span>fragment<span class="op">.</span><span class="fu">getContext</span><span class="op">(),</span> permission<span class="op">)</span> <span class="op">!=</span> PackageManager<span class="op">.</span><span class="fu">PERMISSION_GRANTED</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>        fragment<span class="op">.</span><span class="fu">requestPermissions</span><span class="op">(</span><span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span>permission<span class="op">},</span> requestCode<span class="op">);</span></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">getPermissionInActivity</span><span class="op">(</span>Activity activity<span class="op">,</span> <span class="bu">String</span> permission<span class="op">,</span> <span class="dt">int</span> requestCode<span class="op">)</span> <span class="op">{</span></span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ContextCompat<span class="op">.</span><span class="fu">checkSelfPermission</span><span class="op">(</span>activity<span class="op">,</span> permission<span class="op">)</span> <span class="op">!=</span> PackageManager<span class="op">.</span><span class="fu">PERMISSION_GRANTED</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>        activity<span class="op">.</span><span class="fu">requestPermissions</span><span class="op">(</span><span class="kw">new</span> <span class="bu">String</span><span class="op">[]{</span>permission<span class="op">},</span> requestCode<span class="op">);</span></span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="通知">通知</h3>
<div class="sourceCode" id="cb227"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>NotificationManager notificationManager <span class="op">=</span> <span class="op">(</span>NotificationManager<span class="op">)</span> context<span class="op">.</span><span class="fu">getSystemService</span><span class="op">(</span><span class="bu">Context</span><span class="op">.</span><span class="fu">NOTIFICATION_SERVICE</span><span class="op">);</span> </span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="co">//创建点击通知时发送的intent</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>Intent resultIntent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>context<span class="op">,</span> MainActivity<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>TaskStackBuilder stackBuilder <span class="op">=</span> TaskStackBuilder<span class="op">.</span><span class="fu">create</span><span class="op">(</span>context<span class="op">);</span><span class="co">//点击通知打开Activity，在Activity中按返回键时回到MainActivity，而不是回到主屏幕</span></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>stackBuilder<span class="op">.</span><span class="fu">addParentStack</span><span class="op">(</span>MainActivity<span class="op">.</span><span class="fu">class</span><span class="op">);</span><span class="co">//添加Activity到返回栈</span></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>stackBuilder<span class="op">.</span><span class="fu">addNextIntent</span><span class="op">(</span>resultIntent<span class="op">);</span><span class="co">//添加Intent到栈顶</span></span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>PendingIntent resultPendingIntent <span class="op">=</span> stackBuilder<span class="op">.</span><span class="fu">getPendingIntent</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> PendingIntent<span class="op">.</span><span class="fu">FLAG_UPDATE_CURRENT</span><span class="op">);</span></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a><span class="co">//创建删除通知时发送的intent</span></span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a>Intent deleteIntent <span class="op">=</span> <span class="kw">new</span> <span class="fu">Intent</span><span class="op">(</span>context<span class="op">,</span> NotificationService<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a>deleteIntent<span class="op">.</span><span class="fu">setAction</span><span class="op">(</span><span class="st">&quot;xxx&quot;</span><span class="op">);</span><span class="co">//删除时往Service中发消息</span></span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a>PendingIntent deletePendingIntent <span class="op">=</span> PendingIntent<span class="op">.</span><span class="fu">getService</span><span class="op">(</span>context<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> deleteIntent<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-15"><a href="#cb227-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-16"><a href="#cb227-16" aria-hidden="true" tabindex="-1"></a><span class="co">//创建通知</span></span>
<span id="cb227-17"><a href="#cb227-17" aria-hidden="true" tabindex="-1"></a><span class="bu">Notification</span><span class="op">.</span><span class="fu">Builder</span> notificationBuilder <span class="op">=</span> <span class="kw">new</span> <span class="bu">Notification</span><span class="op">.</span><span class="fu">Builder</span><span class="op">(</span>context<span class="op">,</span> NotificationChannels<span class="op">.</span><span class="fu">LOW</span><span class="op">)</span></span>
<span id="cb227-18"><a href="#cb227-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setContentTitle</span><span class="op">(</span><span class="st">&quot;通知&quot;</span><span class="op">)</span><span class="co">//设置通知标题</span></span>
<span id="cb227-19"><a href="#cb227-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setContentText</span><span class="op">(</span><span class="st">&quot;内容&quot;</span><span class="op">)</span><span class="co">//设置通知内容</span></span>
<span id="cb227-20"><a href="#cb227-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setSmallIcon</span><span class="op">(</span>R<span class="op">.</span><span class="fu">mipmap</span><span class="op">.</span><span class="fu">ic_notification</span><span class="op">)</span><span class="co">//设置通知栏处的小图标（需要背景透明的png图片）</span></span>
<span id="cb227-21"><a href="#cb227-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setLargeIcon</span><span class="op">(</span>BitmapFactory<span class="op">.</span><span class="fu">decodeResource</span><span class="op">(</span>context<span class="op">.</span><span class="fu">getResources</span><span class="op">(),</span> R<span class="op">.</span><span class="fu">mipmap</span><span class="op">.</span><span class="fu">ic_notifiation_big</span><span class="op">))</span><span class="co">//设置展开通知栏后显示的大图标</span></span>
<span id="cb227-22"><a href="#cb227-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setColor</span><span class="op">(</span><span class="bu">Color</span><span class="op">.</span><span class="fu">parseColor</span><span class="op">(</span><span class="st">&quot;#8161F6&quot;</span><span class="op">))</span><span class="co">//展开通知栏后会在大图标的右下角显示小图标（Android 5.x和6.x中），可以通过setColor设置小图标的背景色</span></span>
<span id="cb227-23"><a href="#cb227-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setAutoCancel</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//设置点击通知后自动删除通知</span></span>
<span id="cb227-24"><a href="#cb227-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">//.setOngoing(true)//设置通知不可删除</span></span>
<span id="cb227-25"><a href="#cb227-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setWhen</span><span class="op">(</span><span class="bu">System</span><span class="op">.</span><span class="fu">currentTimeMillis</span><span class="op">())</span><span class="co">//设置通知时间</span></span>
<span id="cb227-26"><a href="#cb227-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setShowWhen</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//设置显示通知时间</span></span>
<span id="cb227-27"><a href="#cb227-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setContentIntent</span><span class="op">(</span>resultPendingIntent<span class="op">)</span><span class="co">//设置点击通知时的响应事件</span></span>
<span id="cb227-28"><a href="#cb227-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">setDeleteIntent</span><span class="op">(</span>deletePendingIntent<span class="op">);</span><span class="co">//设置删除通知时的响应事件</span></span>
<span id="cb227-29"><a href="#cb227-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-30"><a href="#cb227-30" aria-hidden="true" tabindex="-1"></a><span class="co">/*要使用带可点击控件的通知（比如快速回复、确定取消、音乐播放暂停按钮等），可以使用Notification.Action.Builder创建，再通过builder.setActions设置</span></span>
<span id="cb227-31"><a href="#cb227-31" aria-hidden="true" tabindex="-1"></a><span class="co">比如带两个按钮的通知：</span></span>
<span id="cb227-32"><a href="#cb227-32" aria-hidden="true" tabindex="-1"></a><span class="co"> Notification.Action yesAction = new Notification.Action.Builder(</span></span>
<span id="cb227-33"><a href="#cb227-33" aria-hidden="true" tabindex="-1"></a><span class="co">                Icon.createWithResource(&quot;&quot;, R.mipmap.ic_yes),</span></span>
<span id="cb227-34"><a href="#cb227-34" aria-hidden="true" tabindex="-1"></a><span class="co">                &quot;YES&quot;,</span></span>
<span id="cb227-35"><a href="#cb227-35" aria-hidden="true" tabindex="-1"></a><span class="co">                yesPendingIntent)</span></span>
<span id="cb227-36"><a href="#cb227-36" aria-hidden="true" tabindex="-1"></a><span class="co">                .build();</span></span>
<span id="cb227-37"><a href="#cb227-37" aria-hidden="true" tabindex="-1"></a><span class="co">Notification.Action noAction = new Notification.Action.Builder(</span></span>
<span id="cb227-38"><a href="#cb227-38" aria-hidden="true" tabindex="-1"></a><span class="co">                Icon.createWithResource(&quot;&quot;, R.mipmap.ic_no),</span></span>
<span id="cb227-39"><a href="#cb227-39" aria-hidden="true" tabindex="-1"></a><span class="co">                &quot;NO&quot;,</span></span>
<span id="cb227-40"><a href="#cb227-40" aria-hidden="true" tabindex="-1"></a><span class="co">                noPendingIntent)</span></span>
<span id="cb227-41"><a href="#cb227-41" aria-hidden="true" tabindex="-1"></a><span class="co">                .build();</span></span>
<span id="cb227-42"><a href="#cb227-42" aria-hidden="true" tabindex="-1"></a><span class="co">notificationBuilder.setActions(yesAction, noAction);</span></span>
<span id="cb227-43"><a href="#cb227-43" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb227-44"><a href="#cb227-44" aria-hidden="true" tabindex="-1"></a><span class="co">/*要使用其他样式的通知，可以使用Notification.xxxStyle内部类创建，再通过builder.setStyle设置</span></span>
<span id="cb227-45"><a href="#cb227-45" aria-hidden="true" tabindex="-1"></a><span class="co">比如大图效果通知</span></span>
<span id="cb227-46"><a href="#cb227-46" aria-hidden="true" tabindex="-1"></a><span class="co">Notification.BigPictureStyle bigPictureStyle = new Notification.BigPictureStyle()</span></span>
<span id="cb227-47"><a href="#cb227-47" aria-hidden="true" tabindex="-1"></a><span class="co">                .setBigContentTitle(&quot;这是一个大图效果的通知&quot;)</span></span>
<span id="cb227-48"><a href="#cb227-48" aria-hidden="true" tabindex="-1"></a><span class="co">                .setSummaryText(&quot;通知内容，图片的文字描述&quot;)</span></span>
<span id="cb227-49"><a href="#cb227-49" aria-hidden="true" tabindex="-1"></a><span class="co">                .bigPicture(BitmapFactory.decodeResource(context.getResources(), R.mipmap.big_style_picture));</span></span>
<span id="cb227-50"><a href="#cb227-50" aria-hidden="true" tabindex="-1"></a><span class="co">notificationBuilder.setStyle(bigPictureStyle);</span></span>
<span id="cb227-51"><a href="#cb227-51" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb227-52"><a href="#cb227-52" aria-hidden="true" tabindex="-1"></a><span class="co">/*自定义通知样式</span></span>
<span id="cb227-53"><a href="#cb227-53" aria-hidden="true" tabindex="-1"></a><span class="co">RemoteViews customView = new RemoteViews(context.getPackageName(),R.layout.custom_view_layout);</span></span>
<span id="cb227-54"><a href="#cb227-54" aria-hidden="true" tabindex="-1"></a><span class="co">RemoteViews customBigView = new RemoteViews(context.getPackageName(), R.layout.custom_big_view_layout);</span></span>
<span id="cb227-55"><a href="#cb227-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-56"><a href="#cb227-56" aria-hidden="true" tabindex="-1"></a><span class="co">customBigView.setImageViewBitmap(R.id.iv_content, BitmapFactory.decodeResource(context.getResources(), R.mipmap.ic_icon));</span></span>
<span id="cb227-57"><a href="#cb227-57" aria-hidden="true" tabindex="-1"></a><span class="co">customBigView.setTextViewText(R.id.tv_title, &quot;标题&quot;);</span></span>
<span id="cb227-58"><a href="#cb227-58" aria-hidden="true" tabindex="-1"></a><span class="co">customBigView.setTextViewText(R.id.tv_summery, &quot;内容&quot;);</span></span>
<span id="cb227-59"><a href="#cb227-59" aria-hidden="true" tabindex="-1"></a><span class="co">customBigView.setOnClickPendingIntent(R.id.iv_content, pendingIntent);</span></span>
<span id="cb227-60"><a href="#cb227-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-61"><a href="#cb227-61" aria-hidden="true" tabindex="-1"></a><span class="co">notificationBuilder.setCustomContentView(customView);//设置自定义小视图</span></span>
<span id="cb227-62"><a href="#cb227-62" aria-hidden="true" tabindex="-1"></a><span class="co">notificationBuilder.setCustomBigContentView(customBigView);//设置自定义大视图</span></span>
<span id="cb227-63"><a href="#cb227-63" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb227-64"><a href="#cb227-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-65"><a href="#cb227-65" aria-hidden="true" tabindex="-1"></a><span class="co">//在Android 8.0 及以上的版本，需要设置NotificationChannel才能正常使用通知</span></span>
<span id="cb227-66"><a href="#cb227-66" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>android<span class="op">.</span><span class="fu">os</span><span class="op">.</span><span class="fu">Build</span><span class="op">.</span><span class="fu">VERSION</span><span class="op">.</span><span class="fu">SDK_INT</span> <span class="op">&gt;=</span> android<span class="op">.</span><span class="fu">os</span><span class="op">.</span><span class="fu">Build</span><span class="op">.</span><span class="fu">VERSION_CODES</span><span class="op">.</span><span class="fu">O</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb227-67"><a href="#cb227-67" aria-hidden="true" tabindex="-1"></a>    NotificationChannel channel <span class="op">=</span> <span class="kw">new</span> <span class="fu">NotificationChannel</span><span class="op">(</span>channelID<span class="op">,</span> channelName<span class="op">,</span> NotificationManager<span class="op">.</span><span class="fu">IMPORTANCE_HIGH</span><span class="op">);</span><span class="co">//不同的重要等级有不同的显示方式</span></span>
<span id="cb227-68"><a href="#cb227-68" aria-hidden="true" tabindex="-1"></a>    channel<span class="op">.</span><span class="fu">setDescription</span><span class="op">(</span>description<span class="op">);</span></span>
<span id="cb227-69"><a href="#cb227-69" aria-hidden="true" tabindex="-1"></a>    channel<span class="op">.</span><span class="fu">enableLights</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span><span class="co">//是否在桌面图标右上角展示小红点</span></span>
<span id="cb227-70"><a href="#cb227-70" aria-hidden="true" tabindex="-1"></a>    channel<span class="op">.</span><span class="fu">setLightColor</span><span class="op">(</span><span class="bu">Color</span><span class="op">.</span><span class="fu">RED</span><span class="op">);</span><span class="co">//小红点颜色</span></span>
<span id="cb227-71"><a href="#cb227-71" aria-hidden="true" tabindex="-1"></a>    channel<span class="op">.</span><span class="fu">enableVibration</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span><span class="co">//如果不设置声音和振动，会按照重要等级按系统默认的方式来播放对应的通知效果</span></span>
<span id="cb227-72"><a href="#cb227-72" aria-hidden="true" tabindex="-1"></a>    channel<span class="op">.</span><span class="fu">setVibrationPattern</span><span class="op">(</span><span class="kw">new</span> <span class="dt">long</span><span class="op">[]{</span><span class="dv">100</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">300</span><span class="op">,</span> <span class="dv">400</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">400</span><span class="op">,</span> <span class="dv">300</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">400</span><span class="op">});</span></span>
<span id="cb227-73"><a href="#cb227-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*或者禁用声音和振动</span></span>
<span id="cb227-74"><a href="#cb227-74" aria-hidden="true" tabindex="-1"></a><span class="co">    channel.setSound(null,null);</span></span>
<span id="cb227-75"><a href="#cb227-75" aria-hidden="true" tabindex="-1"></a><span class="co">    channel.setVibrationPattern(null);*/</span></span>
<span id="cb227-76"><a href="#cb227-76" aria-hidden="true" tabindex="-1"></a>    channel<span class="op">.</span><span class="fu">setShowBadge</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span><span class="co">//是否在长按桌面图标时显示此channel的通知</span></span>
<span id="cb227-77"><a href="#cb227-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-78"><a href="#cb227-78" aria-hidden="true" tabindex="-1"></a>    notificationManager<span class="op">.</span><span class="fu">createNotificationChannel</span><span class="op">(</span>channel<span class="op">);</span><span class="co">//创建Channel</span></span>
<span id="cb227-79"><a href="#cb227-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-80"><a href="#cb227-80" aria-hidden="true" tabindex="-1"></a>    notificationBuilder<span class="op">.</span><span class="fu">setChannelId</span><span class="op">(</span>channelID<span class="op">);</span><span class="co">//设置channelID</span></span>
<span id="cb227-81"><a href="#cb227-81" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb227-82"><a href="#cb227-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-83"><a href="#cb227-83" aria-hidden="true" tabindex="-1"></a><span class="co">//发送通知</span></span>
<span id="cb227-84"><a href="#cb227-84" aria-hidden="true" tabindex="-1"></a>notificationManager<span class="op">.</span><span class="fu">notify</span><span class="op">(</span>notificationID<span class="op">,</span> notificationBuilder<span class="op">.</span><span class="fu">build</span><span class="op">());</span></span></code></pre></div>
<h3 id="ndk">NDK</h3>
<p>Android Studio下的配置</p>
<p>1、新建一个项目，在File-&gt;Project
Structure中指定NDK的路径，路径不能含有空格，而且最好不要有中文</p>
<p>2、建一个JAVA类，将要调用的C中的函数声明为native，同时通过静态代码块加载so文件，然后Rebuild
Project，就会在<code>app\build\intermediates</code>目录下新生成classes文件夹</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">myapp</span><span class="op">.</span><span class="im">jnidemo</span><span class="op">;</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> JniUtils <span class="op">{</span></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span><span class="op">{</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">loadLibrary</span><span class="op">(</span><span class="st">&quot;MyJniLib&quot;</span><span class="op">);</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//JAVA调C</span></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">native</span> <span class="bu">String</span> <span class="fu">javaCallC</span><span class="op">(</span><span class="bu">String</span> str<span class="op">);</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//JAVA调C，然后C回调JAVA中的cCallJava函数</span></span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">native</span> <span class="dt">void</span> <span class="fu">cCallJavaCallback</span><span class="op">();</span></span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//C调JAVA的函数</span></span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">cCallJava</span><span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> j<span class="op">){</span></span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a>        Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span> <span class="st">&quot;C调用了JAVA&quot;</span><span class="op">);</span></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>i <span class="op">+</span> j<span class="op">);</span></span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>3、生成对应的头文件：</p>
<p>打开AS Terminal（或者cmd也可以），在AS
Terminal中切换目录至<code>app/build/intermediates/classes/debug</code>，输入<code>javah -jni com.myapp.jnidemo.JniUtils</code>（<code>javah -jni 全类名</code>），这时就会在debug文件夹中生成<code>com_myapp_jnidemo_JniUtils.h</code>（可能会有编译错误，能生成头文件就行），这时再把这个头文件剪切到<code>src/main/jni</code>下（jni文件夹需手动创建）</p>
<p>一般情况下在<code>app/src/main</code>使用<code>javah -jni 全类名</code>也可以，但可能会出现无法生成头文件的情况，所以最好还是在<code>app/build/intermediates/classes/debug</code>下执行javah</p>
<p>在JDK10中已经把<code>javah</code>命令删除，使用<code>javac -h 生成的头文件目录 java文件</code>(如<code>javac -h jnidir Test.java</code>)替代</p>
<p>4、写对应的C文件</p>
<p>再在jni文件夹创建一个JniTest.c文件（名字可随便取），JAVA对应C的函数名可以在头文件中查看，其固定格式为<code>Java_包名_类名_方法名</code>（把<code>.</code>改成<code>_</code>），前两个参数也固定为<code>JNIEnv *env</code>和<code>jobject obj</code>，JAVA的基本数据类型对应的C类型及常用方法已经在jni.h中定义好，可以在jni.h中查看（在NDK目录搜jni.h），对基本数据类型和反射JAVA类的操作几乎都是由JNIEnv完成</p>
<p>C调JAVA函数时用到的方法签名可以在<code>app/build/intermediates/classes/debug</code>中使用<code>javap -s 全类名</code>得到类中所有方法的签名</p>
<p>JniTest.c：</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;com_myapp_jnidemo_JniUtils.h&quot;</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="co">//JNIEXPORT和JNICALL可以删掉，不影响运行</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="co">//jAVA要调的C函数，方法名遵循&quot;Java_包名_类名_方法名&quot;的格式</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>JNIEXPORT jstring JNICALL Java_com_myapp_jnidemo_JniUtils_javaCallC<span class="op">(</span>JNIEnv <span class="op">*</span>env<span class="op">,</span> jobject obj<span class="op">,</span> jstring str<span class="op">){</span></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(*</span>env<span class="op">)-&gt;</span>NewStringUTF<span class="op">(</span>env<span class="op">,</span><span class="st">&quot;I am from C!&quot;</span><span class="op">);</span></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a><span class="co">//C调JAVA的函数，因为要用到JNIEnv，所以一般用于JAVA调C，然后C回调JAVA</span></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a><span class="co">//jobject就是调用该函数的类对象，这里是JniUtils</span></span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>JNIEXPORT <span class="dt">void</span> JNICALL Java_com_myapp_jnidemo_JniUtils_cCallJavaCallback<span class="op">(</span>JNIEnv <span class="op">*</span>env<span class="op">,</span> jobject obj<span class="op">){</span></span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1.得到字节码，第二个参数为&quot;全类名&quot;，把&quot;.&quot;改成&quot;/&quot;</span></span>
<span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a>    jclass jclazz <span class="op">=</span> <span class="op">(*</span>env<span class="op">)-&gt;</span>FindClass<span class="op">(</span>env<span class="op">,</span> <span class="st">&quot;com/myapp/jnidemo/JniUtils&quot;</span><span class="op">);</span></span>
<span id="cb229-14"><a href="#cb229-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2.得到方法ID，第四个参数为方法签名，可以在debug目录下使用&quot;javap -s 全类名&quot;，来得到类的所有方法签名（因为函数可以重裁，只有方法名还不知道要调哪个方法，需指定方法签名）</span></span>
<span id="cb229-15"><a href="#cb229-15" aria-hidden="true" tabindex="-1"></a>    jmethodID methodID <span class="op">=</span> <span class="op">(*</span>env<span class="op">)-&gt;</span>GetMethodID<span class="op">(</span>env<span class="op">,</span> jclazz<span class="op">,</span> <span class="st">&quot;cCallJava&quot;</span><span class="op">,</span> <span class="st">&quot;(II)I&quot;</span><span class="op">);</span></span>
<span id="cb229-16"><a href="#cb229-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3.实例化对象</span></span>
<span id="cb229-17"><a href="#cb229-17" aria-hidden="true" tabindex="-1"></a>    jobject jobj <span class="op">=</span> <span class="op">(*</span>env<span class="op">)-&gt;</span>AllocObject<span class="op">(</span>env<span class="op">,</span> jclazz<span class="op">);</span></span>
<span id="cb229-18"><a href="#cb229-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">//4.调用方法</span></span>
<span id="cb229-19"><a href="#cb229-19" aria-hidden="true" tabindex="-1"></a>    jint result <span class="op">=</span> <span class="op">(*</span>env<span class="op">)-&gt;</span>CallIntMethod<span class="op">(</span>env<span class="op">,</span> jobj<span class="op">,</span> methodID<span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb229-20"><a href="#cb229-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>5、配置编译参数</p>
<p>配置App目录下的build.gradle，添加ndk节点：</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode gradle"><code class="sourceCode groovy"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>buildTypes <span class="op">{</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>    release <span class="op">{</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>        minifyEnabled <span class="kw">false</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>        proguardFiles <span class="fu">getDefaultProguardFile</span><span class="op">(</span><span class="st">&#39;proguard-android.txt&#39;</span><span class="op">),</span> <span class="st">&#39;proguard-rules.pro&#39;</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>        ndk<span class="op">{</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>            moduleName <span class="st">&quot;MyJniLib&quot;</span><span class="co">//生成的so名字</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>            abiFilters <span class="st">&quot;armeabi&quot;</span><span class="op">,</span> <span class="st">&quot;armeabi-v7a&quot;</span><span class="op">,</span> <span class="st">&quot;x86&quot;</span><span class="co">//输出指定三种abi体系结构下的so库，让代码可以在这三种环境下运行</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>    debug<span class="op">{</span></span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>        ndk<span class="op">{</span></span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>            moduleName <span class="st">&quot;MyJniLib&quot;</span></span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>            abiFilters <span class="st">&quot;armeabi&quot;</span><span class="op">,</span> <span class="st">&quot;armeabi-v7a&quot;</span><span class="op">,</span> <span class="st">&quot;x86&quot;</span></span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>配置gradle.properties，让Android Studio兼容旧版的NDK</p>
<pre><code>android.useDeprecatedNdk=true</code></pre>
<p>6、至此JNI已配置完成，可以在JAVA中使用NDK了</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>JniUtils jniUtils <span class="op">=</span> <span class="kw">new</span> <span class="fu">JniUtils</span><span class="op">();</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> str <span class="op">=</span> jniUtils<span class="op">.</span><span class="fu">javaCallC</span><span class="op">(</span>“java”<span class="op">);</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>jniUtils<span class="op">.</span><span class="fu">cCallJavaCallback</span><span class="op">();</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span><span class="st">&quot;TAG&quot;</span><span class="op">,</span>str<span class="op">)</span></span></code></pre></div>
<h3 id="热更新">热更新</h3>
<p>参考</p>
<p>腾讯项目 <a href="https://github.com/Tencent/tinker/wiki">Tinker</a></p>
<p>阿里项目 <a href="https://github.com/alibaba/AndFix">AndFix</a></p>
<h3 id="material-design">Material Design</h3>
<p>参考 <a href="https://github.com/1sters/material_design_zh">Material
Design中文文档</a></p>
<p>https://material.io/</p>
<h3 id="设计模式">设计模式</h3>
<p><a href="https://github.com/googlesamples/android-architecture">官方MVP使用案例</a></p>
<p>参考文章</p>
<p><a href="https://www.jianshu.com/p/cf446be43ae8">解读Android官方MVP项目单元测试</a></p>
<p><a href="http://zjutkz.net/2016/04/13/%E9%80%89%E6%8B%A9%E6%81%90%E6%83%A7%E7%97%87%E7%9A%84%E7%A6%8F%E9%9F%B3%EF%BC%81%E6%95%99%E4%BD%A0%E8%AE%A4%E6%B8%85MVC%EF%BC%8CMVP%E5%92%8CMVVM/">选择恐惧症的福音！教你认清MVC，MVP和MVVM</a></p>
<h3 id="学习路线">学习路线</h3>
<p><a href="http://hukai.me/android-training-course-in-chinese/index.html">Android官方培训课程中文版</a></p>
<p><a href="https://www.kancloud.cn/alex_wsc/androids/401771">老罗的Android之旅（总结）</a></p>
<p><a href="https://github.com/aosp-mirror/platform_frameworks_base">Android
framework源码（github）</a></p>
<p><a href="https://android.googlesource.com/">Android源码（googlesource）</a></p>
<p><a href="https://github.com/wasabeef/awesome-android-libraries">安卓开发常用的第三方库集合</a></p>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/index.html">微信小程序文档</a></p>
</body>
</html>
